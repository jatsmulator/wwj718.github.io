<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"><channel><title>writing for time</title><link>/</link><description></description><lastBuildDate>Thu, 07 Feb 2019 00:00:00 +0000</lastBuildDate><item><title>codelab-adapter与应答模式</title><link>/codelab-adapter-req-rep.html</link><description>&lt;p&gt;从&lt;a href="https://codelab-adapter-docs.codelab.club/dev_guide/Architecture/"&gt;架构图&lt;/a&gt;中可以看出&lt;a href="https://codelab-adapter-docs.codelab.club"&gt;codelab-adapter&lt;/a&gt;中的消息是异步的，无论是websocket还是ZeroMQ pub/sub,都是异步的。&lt;/p&gt;
&lt;p&gt;有开发者希望codelab-adapter能支持应答模式: client(Scratch3.0/Blockly)发出request message，server回应reply message. 应答模式的逻辑由下图展现:&lt;/p&gt;
&lt;p&gt;&lt;img width=300 src="http://wwj-fig-bed.just4fun.site/req-rep_e2fd951a.png"&gt;&lt;/p&gt;
&lt;h1 id="_1"&gt;应答模式在积木块上的表现&lt;/h1&gt;
&lt;p&gt;使用应答模式的积木块，表现为运行的积木块，往codelab-adapter发出request message之后进入阻塞状态，直到codelab-adapter返回reply message，得到结果之后，才继续往下运行。&lt;/p&gt;
&lt;h1 id="_2"&gt;应答模式的应用场景&lt;/h1&gt;
&lt;p&gt;应答模式有很多应用场景，web开发者对http很熟悉，http便是典型的应答模式，想想你能用http做的事，便知道哪些事情适合用应答模式来做。&lt;/p&gt;
&lt;p&gt;接触过&lt;a href="http://www.ros.org/"&gt;ROS&lt;/a&gt;的开发者, 对异步消息和应答模式的使用场景应该很熟悉。&lt;a href="http://www.ros.org/"&gt;ROS&lt;/a&gt;的核心便是消息系统。&lt;/p&gt;
&lt;p&gt;我们举个具体例子，它来自codelab-adapter开发者的真实应用场景。 他需要一个&lt;code&gt;REPORTER&lt;/code&gt;类型的积木块，该积木块的功能是获取电位计的值。&lt;/p&gt;
&lt;p&gt;当然对于这个需求，我们可能会建议采用这种模式:源源不断发送电位计的值到scratch3.0中，诸如我们在&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/extension_microbit.py"&gt;extension_microbit&lt;/a&gt;采用的策略。但对于一些传感器或固件(如&lt;a href="https://www.arduino.cc/en/reference/firmata"&gt;Firmata&lt;/a&gt;)，采用同步模式可能是更经济简易的做法。&lt;/p&gt;
&lt;h1 id="_3"&gt;基于异步消息实现&lt;/h1&gt;
&lt;p&gt;由于异步消息是codelab-adapter基础架构的一部分，所以我们准备采用异步消息来实现应答模式。&lt;/p&gt;
&lt;p&gt;我们写个简单的例子，来展示如何使用应答模式，积木块发出消息后，codelab-adapter的req-rep插件将消息反转，休眠1秒，再返回反转后的消息，以下是相应的源代码.&lt;/p&gt;
&lt;h3 id="scratch3_req_rep"&gt;scratch3_req_rep&lt;/h3&gt;
&lt;p&gt;Scratch3.0中的插件源码见: &lt;a href="https://github.com/Scratch3Lab/scratch3_req_rep"&gt;scratch3_req_rep&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;核心是利用promise。在消息层面，为每条消息添加messageID.&lt;/p&gt;
&lt;h3 id="extension_req_rep"&gt;extension_req_rep&lt;/h3&gt;
&lt;p&gt;codelab-adapter插件源码见: &lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/extension_req_rep.py"&gt;extension_req_rep&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="_4"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/LLK/scratch-vm/blob/develop/src/util/jsonrpc.js"&gt;jsonrpc.js&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Thu, 07 Feb 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-02-07:codelab-adapter-req-rep.html</guid><category>codelab</category></item></channel></rss>