<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"><channel><title>writing for time</title><link>/</link><description></description><lastBuildDate>Mon, 11 Mar 2019 00:00:00 +0000</lastBuildDate><item><title>万物积木化开发者社区</title><link>/forums-4-developers.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/forums_efbc7c2c.png" /&gt;&lt;/p&gt;
&lt;h1 id="_1"&gt;突然登场&lt;/h1&gt;
&lt;p&gt;我们刚采用&lt;a href="https://discourse.org/"&gt;discourse&lt;/a&gt;搭建了一个开发者社区:  &lt;a href="http://forums.codelab.club"&gt;forums.codelab.club&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;为何突然创建一个开发者社区？它的定位是什么？适合谁来玩？起名能不能接地气一些？能不能冲黄钻？页面有没有飞来飞去那种21世纪初风格的广告？&lt;/p&gt;
&lt;p&gt;假装大家存在这些我们临时臆想的疑惑，以便于本文能够顺利进行下去：）&lt;/p&gt;
&lt;p&gt;让我们来逐个回答这些问题。&lt;/p&gt;
&lt;h3 id="_2"&gt;为何突然创建一个开发者社区？&lt;/h3&gt;
&lt;p&gt;"应广大群众的强烈要求"这种理由我们是说不出口的。&lt;/p&gt;
&lt;p&gt;首先对积木化编程感兴趣的开发者人群就不&lt;code&gt;广大&lt;/code&gt;, 这些开发者中跟我保持联系的人也一点都不&lt;code&gt;广大&lt;/code&gt;。近年少儿编程比较火热，陆续有公司和开发者加入其中，积木化编程似乎是大家绕不开的话题。陆续一些开发者给我发邮件讨论技术问题，也有讨论教育的，不过人数不多。聊着聊着就成了微信好友，私下聊天中，有几人提到是不是折腾一个开发者社区，@比老师最早提出这个想法。&lt;/p&gt;
&lt;p&gt;为了说明这不是为了行文方便所做的虚构，也不是&lt;code&gt;我的朋友&lt;/code&gt;系列，当然有截屏为证。&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/forums_7aa7a086.png" /&gt;&lt;/p&gt;
&lt;p&gt;放出截屏，倒不是为了证明我真的有朋友，而是@Juwan今早的这段话，很能说明构建论坛的初衷。&lt;/p&gt;
&lt;p&gt;论坛目前由@Juwan和我发起，欢迎大家一起来玩。&lt;/p&gt;
&lt;h3 id="_3"&gt;它的初心和定位是什么？&lt;/h3&gt;
&lt;p&gt;@Juwan有许多精彩的思考，聊天中，他很好地回答了这个问题:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;不管怎样，是用什么积木都无所谓&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;需要更多的开发者做在一起讨论自己能做的事情，找出彼此的擅长点，协同开发，形成良好的氛围&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;scratch3那边的开发者，但就目前所公开的资料，难度还是有些大，现在一堆人在群里问的最多的是，这东西怎么开发啊&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;让懂技术的人愿意分享自己的技术给外界&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;让各类开发者加入&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="_4"&gt;适合谁来玩？&lt;/h3&gt;
&lt;p&gt;所有对积木化编程感兴趣的开发者。&lt;/p&gt;
&lt;p&gt;开发者这个词外延比较大。Ta既可以是希望大家一起来玩积木化编程平台的构建者，也可以是积木化编程平台的用户，无论是基础设施的构建者，还是使用者，大家都在编程，都称为开发者是没有问题的。&lt;/p&gt;
&lt;p&gt;积木化编程的基础设施，目前主流的有Scratch、blockly。其他不够主流的还挺多，诸如我很喜欢的Etoys、Snap!、GP、Switch Toy-Con Garage、node-red ...&lt;/p&gt;
&lt;h3 id="_5"&gt;起名敢不敢接地气一些？&lt;/h3&gt;
&lt;p&gt;这锅@Juwan来背，我已逃离现场：）&lt;/p&gt;
&lt;p&gt;你看我最初建议的是: &lt;code&gt;积木化编程开发小组&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;@Juwan觉得太局限了，应该&lt;code&gt;Think Bigger&lt;/code&gt;。于是采用&lt;a href="https://adapter.codelab.club/"&gt;codelab-adapter&lt;/a&gt;的口号:  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;万物积木化&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;反正我挺喜欢这名字，支持@Juwan的提议，如果有人觉得名字不接地气，这锅他背。&lt;/p&gt;
&lt;!--
论坛板块

    Scratch3.0
        microbit
        raspberrypi
    Blockly
    makecode
    codelab-adapter

值得翻译的文章
--&gt;

&lt;h1 id="_6"&gt;其他娱乐问题&lt;/h1&gt;
&lt;h3 id="_7"&gt;能不能冲黄钻？&lt;/h3&gt;
&lt;p&gt;本论坛未接受腾讯赞助，不能冲黄钻 :(&lt;/p&gt;
&lt;h3 id="21"&gt;页面有没有飞来飞去那种21世纪初风格的广告？&lt;/h3&gt;
&lt;p&gt;当然没有， 我们又不用Discuz!&lt;/p&gt;
&lt;h3 id="logo"&gt;连Logo都没有就好意思放出来？&lt;/h3&gt;
&lt;p&gt;好意思。&lt;/p&gt;
&lt;p&gt;如果你愿意帮忙设计就更好啦！&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;还有问题？就你问题多，好啦，来论坛里问吧：&lt;a href="http://forums.codelab.club"&gt;forums.codelab.club&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;大家各自选一些好玩的方向，围绕积木化编程即可，欢迎来玩鸭。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Mon, 11 Mar 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-03-11:forums-4-developers.html</guid><category>blocks</category></item><item><title>CodeLab ❤️ Blender</title><link>/codelab-love-blender.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/codelab-blender_835e054d.png" /&gt;&lt;/p&gt;
&lt;h1 id="_1"&gt;前言&lt;/h1&gt;
&lt;p&gt;@Shaun Miller使用codelab-adapter驱动Cozmo和Vector，在&lt;a href="http://scratch3.codelab.club"&gt;CodeLab积木平台&lt;/a&gt;中制作了一部机器人相声: 《Where did the human go?》&lt;/p&gt;
&lt;p&gt;Shaun Miller在自我介绍里说:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I am a software engineer in cyber security, and write code in python and C. My 11 year old nephew told me about Vector and asked for one for Christmas. I picked one up to give him and started playing with it so I could explain how it works to him, and I am attached.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;他在《Where did the human go?》的项目背景介绍中提到:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I work as a volunteer at a high school helping to teach introduction Computer Science programming. The teachers asked to me to give a presentation on making videos with the Anki robots based on some recent animations that I made. One of the goals is to hopefully get Cozmo and or Vector into the school’s curriculum.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;下边是他在社区里分享的创作成果:&lt;/p&gt;
&lt;video width=600px src="http://scratch3-files.just4fun.site/where-did-the-human-go.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;我们的老朋友@cyke一如既往地在帖子下对CodeLab予以鼓励，他认为我们在积木上的设计是个&lt;code&gt;brilliant idea&lt;/code&gt;，@cyke补充说:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;You must remark that the “anim” Codelab block does’t exist in Codelab extension of the great Scratch lab 3.0 inline IDE (based on official Scratch 3.0) but you can use the block “exec” (this block exists in the Scratch lab for Cozmo and this block exists in the Codelab Adapter for Scratch lab for Vector). These blocks doesn’t use the same Anki SDK ! Vector is using its own API and Cozmo does the same too.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;此刻，@cyke可能在用google翻译读这篇文章:) 感谢@cyke的支持。&lt;/p&gt;
&lt;p&gt;之后我和@Shaun Miller在帖子里闲聊。@Shaun Miller提到:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I also noticed you have something related to Blender. I’m a huge fan of Blender for video editing, and have been thinking about creating a 3D model of Cozmo and Vector. My plan is to make a parody of the game ‘Touhou Project 6 - The Embodiment of the Scarlet Devil’ but using Vector as the protagonist and Cozmo as the enemies / antagonists. But that’s 6-12 months out at best, but if I can make it work, it will be awesome.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;@Shaun Miller试图去做的事情，正是CodeLab在&lt;a href="https://blog.just4fun.site/Codelab-Recent-situation-and-future.html#_9"&gt;未来社&lt;/a&gt;中想做的事情之一, 所以我们准备支持@Shaun Miller的计划。&lt;/p&gt;
&lt;p&gt;@Shaun Miller接下来提到他的计划细节:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;My eventual plan is to create a 3D model of both Vector and Comzo. Those would be the smaller actual characters that fire projectiles at each other. Should be able to generate some interesting projectile patterns using the particle system. I would also alter the camera angle to not be a strict birds-eye view, but angled to make it more 3D (keeping the boss higher to have a more dramatic effect making them seem more powerful). I would then film the real robots on my green screen and use them to mimic the conversations between the protagonist (left side) and antagonist (right side). Possibly not using their voices, and only using text and robot animations. Vector would be the protagonist, and Cozmo the antagonist. After each stage, Cozmo would change colors to mimic the color of the boss in the real game. Also after each stage, Cozmo would become less silly and more darker in personality as Vector gets closer to the truth. The truth would reference another anime ‘Elfen Lied’ (great anime, very violent). I won’t spoil exactly what I’m thinking here, but I think the Elfen Lied story fits well here. The characters in ‘Embodiment of the Scarlet Devil’ game are known for eating people, which is where I got the idea to have Cozmo say ‘I ate him!’ when Vector asks ‘Where did the human go?’ in my video for this post.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;同时他提醒我说Blender进入2.8时,有巨大变更，&lt;a href="https://www.blender.org"&gt;blender2.8&lt;/a&gt;是blender十年来最大的一次变更。这次变更中，codelab-adapter目前依赖的&lt;code&gt;Blender Game Engine&lt;/code&gt;将会消失，于是我决定用周末时间重写codelab-adapter的blender插件。&lt;/p&gt;
&lt;p&gt;周六下午写完了插件。 最新的&lt;a href="https://codelab-adapter-docs.codelab.club/extension_guide/blender/"&gt;插件&lt;/a&gt;除了兼容blender的最新版本,我们也做到了向前兼容。&lt;/p&gt;
&lt;video width=600px src="http://wwj-tmp-video.just4fun.site/blender.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;在我们展示完插件的使用示例后，@Shaun Miller觉得设计很简洁，他提到codelab-adapter blender插件对他制作3d动画可能提供的帮助:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;As animation scenes get more complex, it gets harder to know what object is moving where. Especially if you have multiple objects moving in different patterns. If we use this Blender codelab-adapter, I think this can give us a better view as to what is happening in a given animation. Lets say we have 4 minutes of multiple animations, and we realize we want to make a change from 2:30 to 2:40. I’m thinking with this adapter, we might be able to drill into that particular spot easier.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;愿意尝鲜的朋友，欢迎阅读教程文档: &lt;a href="https://codelab-adapter-docs.codelab.club/extension_guide/blender/"&gt;blender extension&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="_2"&gt;想象空间&lt;/h1&gt;
&lt;p&gt;利用最新版本的blender插件，用户除了可以使用积木控制3D角色、制作3D动画/电影，还可以利用积木，以编程的方式创作3D角色，如此一来构建大规模的机器人军队将变得容易！利用随机数和循环，可以轻松创作出个体姿态各异的机器人军团。&lt;/p&gt;
&lt;p&gt;codelab-adapter的目标是将&lt;code&gt;万物积木化&lt;/code&gt;， 接入Blender的例子很好地展示codelab-adapter想做的事情:  我们可以接入到任何开放生态中，无论是全球最有趣的AI玩具：Cozmo/Vector，还是全球最好的3D动画创作工具Blender，我们都能将其积木化，通过积木封装领域概念，从而将编程能力赋予给各个领域的创作者，同时我们也将其用于教育。&lt;/p&gt;
&lt;p&gt;当我们将blender积木化之后，除了可以赋予动画艺术家们编程能力，让他们更轻松构建大型动画场景，还可以让3D相关的教育变得更为友好，这正是@Shaun Miller在做的事，希望@Shaun Miller能为我们带来有趣的探索成果：）&lt;/p&gt;
&lt;h3 id="_3"&gt;自定义积木&lt;/h3&gt;
&lt;p&gt;在积木设计上，我们依然采用EIM(Everything Is Message)风格，我们给出了一个万能积木，允许@Shaun Miller这样热衷教育的开发者，去自定义适合他的教育场景的积木。&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/codelab-blender_6f0de8e3.png" width=500&gt;&lt;/p&gt;
&lt;p&gt;我们相信正是这种开放性，让CodeLab可以专注在基础设施上，而让各个领域比我们更优秀的开发者去设计出适合他们领域的积木。&lt;/p&gt;
&lt;p&gt;我们相信&lt;code&gt;万物积木化&lt;/code&gt;的核心一环是构建开发者社区，而不是构建一个闭环的体系去包罗万物。&lt;/p&gt;
&lt;p&gt;我们相信这不是一种谦虚，这是一种清醒。&lt;/p&gt;
&lt;h1 id="todo"&gt;todo&lt;/h1&gt;
&lt;p&gt;将blender_server写成blender插件。&lt;/p&gt;
&lt;h1 id="_4"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blender.stackexchange.com/questions/56011/how-to-install-pip-for-blenders-bundled-python"&gt;How to install Pip for Blender's bundled Python?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/blockly-3D.html#blenderpython"&gt;积木化编程与3D场景&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://docs.blender.org/api/blender2.8/info_overview.html#script-loading"&gt;Script Loading&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Mon, 04 Mar 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-03-04:codelab-love-blender.html</guid><category>codelab</category></item><item><title>Scratch3技术分析之云变量 API(第7篇)</title><link>/scratch3-cloud-var.html</link><description>&lt;h1 id="_1"&gt;关于云变量&lt;/h1&gt;
&lt;p&gt;我们先来看下云变量的样子:&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/cloud_var_06e2784a.png" width=400&gt;&lt;/p&gt;
&lt;p&gt;Scratch团队在&lt;a href="https://scratch.mit.edu/info/faq/#clouddata"&gt;FAQ&lt;/a&gt;里解释了&lt;/p&gt;
&lt;h3 id="_2"&gt;什么是云变量&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;云变量可以让作品里保存的数据与Scratch社区的其他人所共享。你可以利用云变量发布调查或其他作品，而社区中的其他人可以访问和修改这些数据。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="_3"&gt;谁能看见云变量中存放的数据？&lt;/h3&gt;
&lt;p&gt;当你运行一个用了云变量的作品时，你使用过程中产生的数据会存放在你的用户名下，其他人可以看到这些数据。&lt;/p&gt;
&lt;h3 id="_4"&gt;云变量可以存放什么类型的数据？&lt;/h3&gt;
&lt;p&gt;云变量只能存放数字。&lt;/p&gt;
&lt;h3 id="_5"&gt;我能使用云变量创建聊天室吗？&lt;/h3&gt;
&lt;p&gt;不可以。虽然在技术上是可能的，但Scratch网站不允许这样做。&lt;/p&gt;
&lt;h3 id="_6"&gt;谁可以改变云变量的内容?&lt;/h3&gt;
&lt;p&gt;只有你和项目的查看者才能将数据存储在项目的云变量中。
如果人们进入项目内部源码或重新混合(remix)你的代码，将会创建变量的副本，而不会影响或更改原始变量。&lt;/p&gt;
&lt;h3 id="_7"&gt;可以用云变量创作多人游戏吗？&lt;/h3&gt;
&lt;p&gt;由于网速和同步的问题，创作多人游戏比较困难。但仍然有一些Scratcher别出心载，使用云变量制作回合制游戏以及其他类型的游戏。&lt;/p&gt;
&lt;p&gt;云变量会在后台产生日志。每个项目最多有10个云变量。&lt;/p&gt;
&lt;p&gt;Scratch新用户可能无法使用云数据。Scratch团队不希望Scratch新手滥用云变量，因为它可能会给系统带来很大的负担。&lt;/p&gt;
&lt;p&gt;云变量会自动更新，利用这个特性，可以建立联机游戏和聊天室，但官方不希望有高频交互，这将带来服务器压力。此外，实时性也不能保证，如果你希望建立实时的强连接，参考&lt;a href="https://blog.just4fun.site/codelab-adapter-wormhole.html"&gt;codelab-adapter的虫洞(wormhole)&lt;/a&gt;。&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;说了半天，你可以看一个带有云变量的项目&lt;a href="https://scratch.mit.edu/projects/246551861/"&gt;Google Chrome Dino Run 2 remix&lt;/a&gt;&lt;/p&gt;
&lt;!--If you're going to remix this project, please change at least one thing. The main point of remixing is to add your own ideas to an existing project. However, some remixes on Scratch have been exact copies of their original project. If you remix my project without changing anything, it may get reported and you may get alerted for this. Also, a favorite and/or love-it for my project, as well as credit to me would be appreciated if you remix my project. Thanks!--&gt;

&lt;p&gt;解释完了云变量，我们进入技术分析部分，我们试图回答: 云变量是怎么实现的，并给出简单的实现例子。&lt;/p&gt;
&lt;h1 id="_8"&gt;分析&lt;/h1&gt;
&lt;p&gt;和之前的分析一样，借助Chrome DevTools,我们来观察创建和使用云变量的过程中都发生了什么。&lt;/p&gt;
&lt;h3 id="_9"&gt;创建变量&lt;/h3&gt;
&lt;p&gt;注意: 你的账号不能是新注册的，否则你没有创建云变量的权限。&lt;/p&gt;
&lt;p&gt;创建我们的第一个云变量: &lt;code&gt;test_cloud_var&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-cloud-var_d21ca552.png" /&gt;&lt;/p&gt;
&lt;p&gt;来看看请求细节(Headers)&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-cloud-var_0f36e615.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Sec-WebSocket-Key&lt;/code&gt; 是一个Base64 encode的值，这个是浏览器随机生成的。websocket中似乎没有处理用户凭证相关的问题。&lt;/p&gt;
&lt;p&gt;接着看看Frames:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-cloud-var_a14e579c.png" /&gt;&lt;/p&gt;
&lt;p&gt;向上的箭头表示的数据流向为 &lt;code&gt;client(scratch-gui)-&amp;gt; server&lt;/code&gt;
向下的箭头表示的数据流向为 &lt;code&gt;server-&amp;gt; client&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;创建变量的过程非常简单：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;建立websocket通道&lt;/li&gt;
&lt;li&gt;在websocket通道中来回传送json。采用类似&lt;a href="https://zh.wikipedia.org/zh-hans/JSON-RPC"&gt;json-rpc&lt;/a&gt;的交互方式。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;后端的云变量服务地址位于&lt;code&gt;wss://clouddata.scratch.mit.edu/&lt;/code&gt;，通过这个线索，我们可以找到与云变量相关的&lt;a href="https://github.com/LLK/scratch-gui/blob/master/src/lib/cloud-provider.js"&gt;前端源码&lt;/a&gt;, 源码非常简单。&lt;/p&gt;
&lt;h3 id="_10"&gt;设置变量&lt;/h3&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-cloud-var-set_bc8d8fd7.png" /&gt;&lt;/p&gt;
&lt;p&gt;值得注意的是，设置变量的过程，数据从前端发往服务端，服务端不做响应。&lt;/p&gt;
&lt;h3 id="_11"&gt;刷新项目&lt;/h3&gt;
&lt;p&gt;项目中存在云变量时，我们重新打开这个项目，默认将拉去云变量中存储的的值&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/_1b02b641.png" /&gt;&lt;/p&gt;
&lt;h3 id="_12"&gt;删除云变量&lt;/h3&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-cloud-ver_37e1fe2c.png" /&gt;&lt;/p&gt;
&lt;h3 id="_13"&gt;权限问题&lt;/h3&gt;
&lt;p&gt;从&lt;a href="https://github.com/LLK/scratch-gui/blob/master/src/lib/cloud-provider.js#L32"&gt;前端源码&lt;/a&gt;中似乎没看到权限相关的部分。&lt;/p&gt;
&lt;p&gt;明天有空做个实验，试试未登录状态是否能与云变量服务进行通信。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;ws&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;WebSocket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;wss://clouddata.scratch.mit.edu/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="nx"&gt;ws&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;onopen&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;evt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; 
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;method&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;handshake&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;user&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;wwj718&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;project_id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;291228938&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="nx"&gt;ws&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;stringify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;\n&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;

&lt;span class="nx"&gt;ws&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;onmessage&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;evt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Received Message: &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;evt&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;    
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;实验发现只有在登陆情况下，才能建立websocket连接。websocket在建立连接的时候会携带cookie，这就是实现用户身份验证的关键。&lt;/p&gt;
&lt;h1 id="_14"&gt;实现一个云变量服务&lt;/h1&gt;
&lt;p&gt;下边我们给出兼容Scratch开源前端的云变量后端实现。这个实现只作为原理展示，如果你要用于生产环境，需要做些调整。&lt;/p&gt;
&lt;p&gt;该实现基于Python的&lt;a href="https://github.com/aaugustin/websockets"&gt;websockets&lt;/a&gt;&lt;!--和&lt;a href="https://github.com/aio-libs/aioredis"&gt;aioredis&lt;/a&gt;库。--&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;json&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;asyncio&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;websockets&lt;/span&gt;
&lt;span class="c1"&gt;# json-rpc&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;handshake&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;req_json&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c1"&gt;# 返回项目中已有的云变量&lt;/span&gt;
    &lt;span class="n"&gt;project_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;req_json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;project_id&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;method&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;set&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;project_id&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;project_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;☁ test&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;value&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;req_json&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c1"&gt;# {&amp;quot;method&amp;quot;:&amp;quot;create&amp;quot;,&amp;quot;user&amp;quot;:&amp;quot;wwj718&amp;quot;,&amp;quot;project_id&amp;quot;:&amp;quot;291229535&amp;quot;,&amp;quot;name&amp;quot;:&amp;quot;☁ test1&amp;quot;,&amp;quot;value&amp;quot;:0}&lt;/span&gt;
    &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;req_json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;method&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;ack&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;reply&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;OK&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;set&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;req_json&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c1"&gt;# {&amp;quot;method&amp;quot;:&amp;quot;set&amp;quot;,&amp;quot;user&amp;quot;:&amp;quot;wwj718&amp;quot;,&amp;quot;project_id&amp;quot;:&amp;quot;291229535&amp;quot;,&amp;quot;name&amp;quot;:&amp;quot;☁ test1&amp;quot;,&amp;quot;value&amp;quot;:&amp;quot;0&amp;quot;}&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;delete&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;req_json&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c1"&gt;# {&amp;quot;method&amp;quot;:&amp;quot;delete&amp;quot;,&amp;quot;user&amp;quot;:&amp;quot;wwj718&amp;quot;,&amp;quot;project_id&amp;quot;:&amp;quot;291229535&amp;quot;,&amp;quot;name&amp;quot;:&amp;quot;☁ test1&amp;quot;}&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;

&lt;span class="n"&gt;method_map&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;
&lt;span class="n"&gt;method_map&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;handshake&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;handshake&lt;/span&gt;
&lt;span class="n"&gt;method_map&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;create&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;create&lt;/span&gt;
&lt;span class="n"&gt;method_map&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;set&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;set&lt;/span&gt;
&lt;span class="n"&gt;method_map&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;delete&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;delete&lt;/span&gt;

&lt;span class="n"&gt;async&lt;/span&gt; &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;handle_cloud_data&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;websocket&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;async&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;message&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;websocket&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="c1"&gt;# from IPython import embed;embed()&lt;/span&gt;
        &lt;span class="c1"&gt;# message结尾有换行符\n, 流&lt;/span&gt;
        &lt;span class="n"&gt;req_json&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loads&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strip&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;request data:&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;req_json&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;method&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;req_json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;method&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;handle&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;method_map&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;handle&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;handle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;req_json&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;await&lt;/span&gt; &lt;span class="n"&gt;websocket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dumps&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;


&lt;span class="n"&gt;asyncio&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_event_loop&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run_until_complete&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;websockets&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;serve&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;handle_cloud_data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;0.0.0.0&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8765&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;server is running&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;asyncio&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_event_loop&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run_forever&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;测试代码与scratch-gui中的代码基本一致:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;ws&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;WebSocket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ws://127.0.0.1:8765&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="nx"&gt;ws&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;onopen&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;evt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; 
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;method&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;handshake&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;user&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;wwj718&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;project_id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;291228938&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="nx"&gt;ws&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;stringify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;\n&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;

&lt;span class="nx"&gt;ws&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;onmessage&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;evt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Received Message: &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;evt&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;    

&lt;span class="c1"&gt;// var data = {&amp;quot;method&amp;quot;:&amp;quot;set&amp;quot;,&amp;quot;user&amp;quot;:&amp;quot;wwj718&amp;quot;,&amp;quot;project_id&amp;quot;:&amp;quot;291228938&amp;quot;,&amp;quot;name&amp;quot;:&amp;quot;☁ test1&amp;quot;,&amp;quot;value&amp;quot;:&amp;quot;1&amp;quot;}&lt;/span&gt;
&lt;span class="c1"&gt;// ws.send(JSON.stringify(data)+&amp;quot;\n&amp;quot;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/websocket_83fe43ed.png" /&gt;&lt;/p&gt;
&lt;p&gt;如果你要用于生产环境，还需要处理cookie和多个客户端一同读写云变量的问题(考虑到读写频率，推荐使用redis， 如果你的后端也用python异步api实现，推荐使用&lt;a href="https://github.com/aio-libs/aioredis"&gt;aioredis&lt;/a&gt;)。&lt;/p&gt;
&lt;h3 id="websocket"&gt;websocket测试工具&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://asleepysamurai.com/articles/socketwrench?show=hn1"&gt;Socket Wrench&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="_15"&gt;其他值得留意的问题&lt;/h1&gt;
&lt;h3 id="_16"&gt;速率限制&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://github.com/LLK/scratch-gui/blob/master/src/lib/cloud-provider.js#L32"&gt;throttle 10&lt;/a&gt;:&lt;/p&gt;
&lt;p&gt;Send a message to the cloud server at a rate of no more than 10 messages/sec&lt;/p&gt;
&lt;p&gt;&lt;code&gt;this.sendCloudData = throttle(this._sendCloudData, 100);&lt;/code&gt;&lt;/p&gt;
&lt;h1 id="_17"&gt;参考:&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/LLK/scratch-gui/blob/master/src/lib/cloud-provider.js"&gt;cloud-provider.js&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://lodash.think2011.net/throttle"&gt;throttle&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://en.scratch-wiki.info/wiki/Cloud_Data"&gt;Cloud Data&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://scratch.mit.edu/info/faq/#clouddata"&gt;Cloud Variables&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Mon, 04 Mar 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-03-04:scratch3-cloud-var.html</guid><category>scratch</category></item><item><title>codelab-adapter的虫洞(wormhole)</title><link>/codelab-adapter-wormhole.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/wormhole_4fcface5.png" /&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;相隔遥远的两个巫师同时讲一句相同的魔法咒语，这导致了他们之间建立了某种神秘的联系。接着一个巫师把魔法书扔进虫洞，书就从另一个巫师身边的虫洞掉了出来。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;上上周去了趟杭州/南京，与几个团队碰面交流。期间聊到许多有趣的技术话题，大家对codelab-adapter的架构设计、合作计划以及未来目标都很感兴趣。&lt;/p&gt;
&lt;p&gt;其中聊到的一个话题让我印象深刻: codelab-adapter计划对classroom/club中的协作者提供怎样的支持？&lt;/p&gt;
&lt;p&gt;设想这样一种场景，一群用户聚集在一个线下空间里，线下空间可能是一个线下俱乐部(如&lt;a href="https://coderdojo.com"&gt;coderdojo&lt;/a&gt;)、一个线下培训机构、一个班级、以及我们的&lt;a href="https://blog.just4fun.site/about-codelab-club.html#neverland"&gt;codelab neverland&lt;/a&gt;。他们接入同一个局域网中。学习者们身处同样的物理空间，我们是否考虑将他们所处的虚拟空间和创作平台中也连接在一起，支持更多的协作和交互。&lt;/p&gt;
&lt;p&gt;Scratch本身有考虑人的连接，出于这个考虑，他们构建了&lt;a href="https://scratch.mit.edu"&gt;线上社区&lt;/a&gt;, &lt;a href="https://en.wikipedia.org/wiki/Mitchel_Resnick"&gt;Mitchel Resnick&lt;/a&gt;(Scratch之父)宣称相比于Scratch这个创作工具，Scratch社区是他们更重要的创造。&lt;/p&gt;
&lt;p&gt;但目前Scratch社区并不支持强连接，诸如构建一个聊天工具或联网游戏。&lt;/p&gt;
&lt;p&gt;如果你是《终身幼儿园》的忠实粉丝，你会发现为classroom/club提供强连接是践行4P理念(Projects, Passion, Peers, Play)的绝佳机会。&lt;/p&gt;
&lt;p&gt;从杭州/南京回来之后，一直在想这件事。&lt;/p&gt;
&lt;h1 id="_1"&gt;思考&lt;/h1&gt;
&lt;p&gt;将局域网内的机器进行联机不是什么难事。利用局域网内的ip地址或hostname，建立socket连接，就可以连接局域网内的机器。&lt;/p&gt;
&lt;p&gt;这只是技术上可行，教育层面呢？拿ip地址来说，当我们告诉学习者如何查看ip地址时，Ta需要了解ip地址这个概念吗？还是只是做一个机械操作(&lt;code&gt;ifconfig/ipconfig&lt;/code&gt;)？又或者我们应该在教学工具中内置查看ip地址功能呢？&lt;/p&gt;
&lt;p&gt;&lt;a href="https://zh.wikipedia.org/zh-hans/%E8%89%BE%E4%BC%A6%C2%B7%E5%87%AF"&gt;艾伦·凯&lt;/a&gt;上周在Quora上回答了一个问题 &lt;a href="https://www.quora.com/What-does-Alan-Kay-think-of-using-either-Squeak-or-Pharo-as-the-first-language-for-introducing-programming"&gt;为何艾伦·凯认为入门编程应当使用Squeak/Pharo&lt;/a&gt;，他说: &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;服务于教学和学习的用户界面有许多需要考虑的因素。如果你只想选择一个重点来考虑，那应该是"减少认知负担"。&lt;/p&gt;
&lt;p&gt;它需要处于试图学习的人的心理空间中。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;艾伦·凯对编程教育的观点极大影响着CodeLab，我们对codelab-adapter的设计以及积木的设计都深受他的影响。&lt;/p&gt;
&lt;p&gt;我们希望"减少认知负担"。如果我们希望构建一种积木，允许实时在局域网内的Scratch中传递消息。它最好是类似&lt;code&gt;broadcask&lt;/code&gt;和&lt;code&gt;when I receive&lt;/code&gt;这类的积木， 它与Scratch的事件积木以及CodeLab的EIM积木保持完全相同的结构。这样用户无需学习新概念，只需要利用&lt;code&gt;传递消息&lt;/code&gt;就能进行联网创作。&lt;/p&gt;
&lt;p&gt;我们想构建这样的积木:&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/wormhole_b1b53851.png" width=400 /&gt;&lt;/p&gt;
&lt;p&gt;于是，我们想到"虫洞"的概念。&lt;a href="https://github.com/warner/magic-wormhole"&gt;magic-wormhole&lt;/a&gt;是我很喜欢的一个开源项目，它的灵感来自:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;相隔遥远的两个巫师同时讲一句相同的魔法咒语，这导致了他们之间建立了某种神秘的联系。接着一个巫师把魔法书扔进虫洞，书就从另一个巫师身边的虫洞掉了出来。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这个概念如此简洁。巫师只是说了相同的咒语，连接就自动建立了。虫洞是声明式的！上帝说要有光，于是就有了光，看起来也类似申明式编程。&lt;/p&gt;
&lt;p&gt;我们将"虫洞"内置到codelab-adapter中，codelab-adapter通过一个"咒语"发现彼此，之后自动建立连接，消息在adapter内置的虫洞中传递，用户只要收取虫洞里的消息即可。&lt;/p&gt;
&lt;p&gt;一旦有了目标，github里总有项目能节约你90%的编程工作：）&lt;/p&gt;
&lt;p&gt;我们选择zeromq来传递消息。zeromq有着比socket优美得多的设计。&lt;a href="https://blog.codingnow.com/"&gt;云风&lt;/a&gt;在他的博客文章&lt;a href="https://blog.codingnow.com/2011/02/zeromq_message_patterns.html"&gt;ZeroMQ 的模式&lt;/a&gt;里写道:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;任何分布式，并行的需求，都可以用这三种模型组合起来解决问题。ZeroMQ 只专注和解决了消息通讯这一基本问题，干的非常漂亮。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;任何消息通讯相关的问题，ZeroMQ都是非常好的选择。&lt;/p&gt;
&lt;p&gt;还有一件事需要考虑，传递消息之前，需要发现局域网中的各个codelab-adapter的ip，可以采用&lt;a href="http://www.cs.ubbcluj.ro/~dadi/compnet/labs/lab3/udp-broadcast.html"&gt;UDP – Broadcast&lt;/a&gt;来做。&lt;/p&gt;
&lt;h1 id="_2"&gt;理念&lt;/h1&gt;
&lt;p&gt;Bret Victor在他的出色演讲《Inventing on Principle》里说&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;If there is something in the world you feel the wrong and you have a vision for what a better world could be, you can find your guiding principle and you can fight for a cause.  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;codelab-adapter的guiding principle是 &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Everything Is Message(EIM)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;灵感来自艾伦凯设计smalltalk时采用的原则:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Everything is an object, and objects communicate only by sending each other messages.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;smalltalk的一致性，允许所有的语法(概念)在一张明信片中写完，一个小孩在Ta入门的时候学会这些概念，可以用于创造小玩具。待Ta长大后，如果雄心勃勃想构建一个操作系统，需要的所有东西，都在Ta小时候看过的那张明信片上。&lt;/p&gt;
&lt;p&gt;wormhole的设计依然满足EIM原则，codelab-adapter的架构试图保持一致性。我们之所以重视一致性，原因之一是计划等到codelab-adapter开源之后，用它的源码本身来教学编程。我们希望一致性带来简单和清晰，让一个3年级的孩子可以完全理解codelab-adapter。并能轻松去改造和拓展它。&lt;/p&gt;
&lt;h1 id="_3"&gt;发布计划&lt;/h1&gt;
&lt;p&gt;codelab-adapter的下个版本将内置虫洞(wormhole)功能。&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/extension-wormhole_6cc39199.png" width=350/&gt;&lt;/p&gt;
&lt;h1 id="_4"&gt;使用场景&lt;/h1&gt;
&lt;p&gt;虫洞功能将支持很多有趣的场景。&lt;/p&gt;
&lt;p&gt;它尤其适合classroom/club/线下活动 场景。正如我们前头提到的: 一群人聚集在一个物理空间里，他们接入同样的局域网，虫洞就发生作用。&lt;/p&gt;
&lt;h3 id="_5"&gt;学习者&lt;/h3&gt;
&lt;p&gt;利用虫洞功能，学习者可以轻松为他的小区或学校创建聊天程序，当然也可以用于在Scratch中制作网络游戏。&lt;/p&gt;
&lt;p&gt;利用codelab-adapter连接硬件的能力，他们甚至可以一起构建一个"机器军团"。&lt;/p&gt;
&lt;h3 id="_6"&gt;教师&lt;/h3&gt;
&lt;p&gt;在俱乐部/教室场景中，教师可以利用虫洞功能管理局域网中的设备，甚至构建教学引导程序。就像在机房中教室机与学生机的互动。只要基于虫洞构建新的插件来支持这些场景即可。&lt;/p&gt;
&lt;p&gt;虫洞本身也可以用于教学计算机网络。&lt;/p&gt;
&lt;h3 id="_7"&gt;开发者&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Everything Is Message(EIM)&lt;/code&gt;。 虫洞由消息实现，通过处理收发消息，开发者可以任意改造它！&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/wormhole_ba56fdff.png" width=500&gt;&lt;/p&gt;
&lt;h3 id="scratch"&gt;Scratch社区&lt;/h3&gt;
&lt;p&gt;我们来展示一个例子: &lt;/p&gt;
&lt;video width=600 src="http://scratch3-files.just4fun.site/wormhole.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;右边的“螃蟹”由树莓派中的adapter驱动(用户A)，而左边的小猫则由电脑中的adapter驱动(用户B)。任何一个设备上的操作将传递到局域中的所有adapter。由于scratch和adapter在设计上都受smalltalk的影响，采纳&lt;code&gt;everything is message&lt;/code&gt;的设计原则，所以&lt;a href="https://scratch.mit.edu"&gt;MIT Scratch社区&lt;/a&gt;里3500多万用户创建的超过1亿的项目将直接得到虫洞功能，在局域网内随意连接！延迟在毫秒级。足以构建实时游戏。&lt;/p&gt;
&lt;h1 id="because-we-can"&gt;because we can&lt;/h1&gt;
&lt;p&gt;如果我们是谢耳朵，我们就要基于虫洞去制作视频聊天工具。复现《生活大爆炸》里的著名桥段， &lt;/p&gt;
&lt;p&gt;"But why？"(面对面在局域网内，为何需要视频聊天) &lt;/p&gt;
&lt;p&gt;"because we can"(基于ZeroMQ的虫洞每秒钟能处理2000万条消息啊)&lt;/p&gt;
&lt;h1 id="_8"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/warner/magic-wormhole"&gt;magic-wormhole&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.cs.ubbcluj.ro/~dadi/compnet/labs/lab3/udp-broadcast.html"&gt;UDP – Broadcast&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.quora.com/What-does-Alan-Kay-think-of-using-either-Squeak-or-Pharo-as-the-first-language-for-introducing-programming"&gt;What does Alan Kay think of using either Squeak or Pharo as the first language for introducing programming?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Fri, 01 Mar 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-03-01:codelab-adapter-wormhole.html</guid><category>codelab</category></item><item><title>基于树莓派的积木化编程解决方案</title><link>/codelab-rpi-mqtt-solution.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/codelab-rpi_107126cc.png" /&gt;&lt;/p&gt;
&lt;h1 id="_1"&gt;前言&lt;/h1&gt;
&lt;p&gt;此前在&lt;a href="https://blog.just4fun.site/rpi-car-difficult.html"&gt;一辆树莓派可编程小车的问题&lt;/a&gt;一文中论述了构建一个服务于编程教学的树莓派小车，将遭遇的问题。&lt;/p&gt;
&lt;p&gt;本文基于我们在&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;、IoT和积木化编程这几方面的探索，继续前行，试图构建一个服务于编程教育的解决方案，它是开放的！我们将展示一个原型，欢迎社区开发者加入进来继续完善它。目前已有两家公司愿意与我们一起探索树莓派生态。&lt;/p&gt;
&lt;p&gt;我们在&lt;a href="https://blog.just4fun.site/codelab-love-iot.html"&gt;CodeLab ❤️ IoT&lt;/a&gt;承诺说:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;本周，我会给出一个具体例子: 在树莓派中使用extension_iot.py，定制出extension_iot_rpi.py， 而后者是可以实际服务于硬件教学的插件。 在这个例子中我们将展示，如何在几天内快速构建一个教学产品，可以直接推向最终用户，它甚至包括了管理功能(如远程故障处理和升级)!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;CodeLab关注:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;开放性&lt;/li&gt;
&lt;li&gt;简单易用&lt;/li&gt;
&lt;li&gt;可扩展&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="mqtt"&gt;为何选择MQTT&lt;/h1&gt;
&lt;p&gt;尽管使用EIM插件也能构建出完整解决方案，诸如我们此前演示的&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/adapter-tensorflow.html"&gt;运行在树莓派中的scratch3-adapter tensorflow插件&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/adapter-opencv.html"&gt;运行在树莓派中的 scratch3-adapter opencv 插件&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;但本文试图使用mqtt来做。使用mqtt的一个好处是，可以提供远程故障处理和升级！&lt;/p&gt;
&lt;p&gt;即便在内网中，&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;也提供了&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/extension_mqtt_broker.py"&gt;MQTT Broker插件&lt;/a&gt;，使用mqtt，可以轻松地远程维护和管理设备。&lt;/p&gt;
&lt;h1 id="_2"&gt;已有工作&lt;/h1&gt;
&lt;p&gt;CodeLab在mqtt(IoT)这块的工作，&lt;a href="https://blog.just4fun.site/codelab-love-iot.html"&gt;CodeLab ❤️ IoT&lt;/a&gt;一文做了梳理。&lt;/p&gt;
&lt;p&gt;简而言之，我们做了如下工作:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Scratch IoT Extension: 构建了与mqtt通信的通用Scratch3积木(类似EIM)&lt;/li&gt;
&lt;li&gt;codelab-adapter &lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/extension_iot.py"&gt;extension_iot&lt;/a&gt;:  构建了可用于订阅和发布mqtt消息的codelab-adapter通用插件(类似extension_eim)&lt;/li&gt;
&lt;li&gt;IoT server: iot.codelab.club:  构建了运行在公网上的mqtt server(MQTT Messaging Broker)(支持用户身份)&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="_3"&gt;继续前行&lt;/h1&gt;
&lt;p&gt;有了以上工作，要完成我们的目标，只有一件事需要做了，就是基于&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/extension_iot.py"&gt;extension_iot&lt;/a&gt;去处理订阅地消息即可！&lt;/p&gt;
&lt;p&gt;无论是教学产品的具体功能，还是管理这个教学产品，通过消息都可以完成这些任务。想想EIM的含义(也是它的理念): Everything Is Message。&lt;/p&gt;
&lt;p&gt;我们暂时还是将教学产品设想为一辆树莓派小车，正如我们在&lt;a href="https://blog.just4fun.site/rpi-car-difficult.html"&gt;一辆树莓派可编程小车的问题&lt;/a&gt;所做的假设。一旦你理解原理，构建任何项目都是ok的。&lt;/p&gt;
&lt;p&gt;为了简化这个问题，我就不去实际淘宝一辆小车配件了。为了展示原理，我们将构建类似&lt;code&gt;def move_forward(distance): print("move_forward:{}".format(distance))&lt;/code&gt;的函数，用以说明问题。实际中，无非在这些函数里写上具体功能罢了。&lt;/p&gt;
&lt;h3 id="_4"&gt;动起手来！&lt;/h3&gt;
&lt;p&gt;这儿将展示Scratch中的积木如何让小车运动起来。&lt;/p&gt;
&lt;p&gt;源码参考&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/extension_iot_rpi.py"&gt;extension_iot_rpi&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;只需要关注如何处理消息部分即可(想想我们以前在EIM中做的讨论，思路完全一样！)&lt;/p&gt;
&lt;p&gt;其中与树莓派小车功能相关的代码，放到一个类中:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;RpiCar&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;myRpiCar&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;logger&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;logger&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;move_forward&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;distance&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="c1"&gt;# todo 采用gpiozero去驱动舵机实现&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;info&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;move_forward:{}&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;distance&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;move_backward&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;distance&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;info&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;move_backward:{}&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;distance&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;运行起来试试效果！&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/codelab-rpi_9ee24405.png" /&gt;&lt;/p&gt;
&lt;p&gt;完美运行！&lt;/p&gt;
&lt;p&gt;上述示例插件中，只提供picar(picar 是RpiCar的实例)、&lt;a href="https://github.com/RPi-Distro/python-gpiozero"&gt;gpiozero&lt;/a&gt;供外部调用。如果你希望给出更多的自由，可以参考&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/extension_python_kernel.py"&gt;extension_python_kernel&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;一旦建立了连接，至于怎么处理消息，社区里有大量案例可以学习:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/extension_vector.py"&gt;extension_vector&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/extension_cozmo.py"&gt;extension_cozmo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/extension_python_kernel.py"&gt;extension_python_kernel&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="_5"&gt;远程管理&lt;/h3&gt;
&lt;p&gt;除了要用积木控制小车(这是我们的核心任务)。我们前边还承诺要构建管理功能(如远程故障处理和升级)。解决方案同样基于消息。&lt;/p&gt;
&lt;p&gt;管理功能可能会涉及硬件的批量升级之类的功能。 安全问题需要做些考虑，建议使用独立的mqtt用户来做(概念上，这个用户是管理员)。权限相关的问题可以基于用户模型来做，这个话题涉及基于角色的访问控制(Role-Based Access Control，RBAC)的讨论，linux操作系统也是这样做的，有兴趣，可以看我之前的文章:&lt;a href="https://blog.just4fun.site/understand-permission.html"&gt;理解权限系统&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;我建议将远程管理作为独立的codelab-adapter extension。而不要混杂在&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/extension_iot_rpi.py"&gt;extension_iot_rpi&lt;/a&gt;，否则，一不小心容易有安全隐患。 限于篇幅，安全这块不过多讨论。做好权限控制，一般就不会有大问题。&lt;/p&gt;
&lt;p&gt;这里给出一个演示例子，试图给出概念上的说明: 怎么基于消息来做远程设备管理。和前边一样，同样通过消息安装系统依赖只需发送消息&lt;code&gt;myRpiManager.install_system_pkg("git")&lt;/code&gt;， 相关源码是:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;subprocess&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;socket&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;RpiManager&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;myRpiManager&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;run_shell_cmd&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;cmd&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;subprocess&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Popen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cmd&lt;/span&gt; &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;shell&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# 是否需要运行结果&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;pip3_install&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;pkg_name&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;cmd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;pip3 install {}&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pkg_name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run_shell_cmd&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cmd&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;install_system_pkg&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pkg_name&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;cmd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sudo apt install {}&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pkg_name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run_shell_cmd&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cmd&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;restart&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="c1"&gt;# 使用sudo 需要用超级用户运行codelab-adapter&lt;/span&gt;
        &lt;span class="n"&gt;cmd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;sudo restart&amp;quot;&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run_shell_cmd&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cmd&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_hostname&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gethostname&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;exec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cmd&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;exec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cmd&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# python exec&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如果你要使用&lt;code&gt;sudo&lt;/code&gt;(如安装系统软件), 那么你就需要使用sudo来运行&lt;code&gt;codelab-adapter&lt;/code&gt;。&lt;/p&gt;
&lt;h1 id="_6"&gt;一些注意事项&lt;/h1&gt;
&lt;p&gt;为了实现开箱可用，我们做了不少工作。&lt;/p&gt;
&lt;h3 id="codelab-adapter"&gt;codelab-adapter的命令行模式&lt;/h3&gt;
&lt;p&gt;codelab-adapter目前支持命令行运行:&lt;code&gt;./codelab-adapter --mode cli&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/codelab-cli_0b468f64.png" /&gt;&lt;/p&gt;
&lt;h3 id="_7"&gt;开机自启&lt;/h3&gt;
&lt;p&gt;使用&lt;code&gt;supervisor&lt;/code&gt;管理&lt;code&gt;./codelab-adapter --mode cli&lt;/code&gt;就能实现开机自启。&lt;/p&gt;
&lt;p&gt;参考&lt;a href="https://blog.just4fun.site/raspberrypi-install-and-config.html#supervisor"&gt;supervisor&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="_8"&gt;默认加载插件&lt;/h3&gt;
&lt;p&gt;通过配置&lt;code&gt;user_settings&lt;/code&gt;, 允许自定义默认启动的extension。&lt;/p&gt;
&lt;p&gt;新建&lt;code&gt;~/codelab_adapter/user_settings.py&lt;/code&gt;， 添加:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;cli_load_extension_threads = ["extension_iot_rpi"]&lt;/code&gt;&lt;/p&gt;
&lt;h3 id="_9"&gt;网络问题&lt;/h3&gt;
&lt;p&gt;注意网络问题，确认网络通畅后，才启动插件，因为MQTT需要联网。这块可以在插件内部写, 联网之后再启动插件主体。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;socket&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;is_network_alive&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="c1"&gt;# connect to the host&lt;/span&gt;
        &lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;www.baidu.com&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create_connection&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;www.baidu.com&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;
    &lt;span class="k"&gt;except&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;pass&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在插件的下个版本，我会内置这些特性，先放出思路，心急的开发者一起来改进它。&lt;/p&gt;
&lt;!--
# 开了mqtt可能失败
突然断网 如何重连 mqtt 就让它失败，然后有外部进程重启。 所以需要捕获状态。做实验。
--&gt;

&lt;h1 id="_10"&gt;接下来&lt;/h1&gt;
&lt;h3 id="_11"&gt;工具链&lt;/h3&gt;
&lt;p&gt;我们会继续打造好用的工具链，用于支持开发者生态, 诸如设备和数据统计的页面。正如我们之前提到的:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;CodeLab之后除了对外提供基础工具，也希望能对外提供基础服务。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="_12"&gt;定制积木&lt;/h3&gt;
&lt;p&gt;与EIM一样 我们目前提供的MQTT积木也是一组通用积木， 对于每个教育硬件(如树莓派小车)，可能需要定制出相应积木。思路与我们之前在EIM所做的讨论完全相同。&lt;/p&gt;
&lt;p&gt;欢迎交流讨论：）&lt;/p&gt;
&lt;h1 id="_13"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/codelab-adapter-love-Raspberry%20Pi.html"&gt;codelab-adapter ❤️ Raspberry Pi&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/codelab-love-iot.html"&gt;CodeLab ❤️ IoT&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/raspberrypi-install-and-config.html"&gt;树莓派折腾笔记之系统安装与配置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/understand-permission.html"&gt;理解权限系统&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Tue, 26 Feb 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-02-26:codelab-rpi-mqtt-solution.html</guid><category>codelab</category></item><item><title>一辆树莓派可编程小车的问题</title><link>/rpi-car-difficult.html</link><description>&lt;p&gt;在&lt;a href="https://blog.just4fun.site/codelab-love-iot.html"&gt;上一篇文章&lt;/a&gt;里，我们提到&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;本周，我会给出一个具体例子: 在树莓派中使用extension_iot.py，定制出extension_iot_rpi.py， 而后者是可以实际服务于硬件教学的插件。 在这个例子中我们将展示，如何在几天内快速构建一个教学产品，可以直接推向最终用户，它甚至包括了管理功能(如远程故障处理和升级)!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id="_1"&gt;问题是什么&lt;/h1&gt;
&lt;p&gt;在给出解决方案是什么之前，我们先来问一下: 问题是什么呢?&lt;/p&gt;
&lt;h3 id="_2"&gt;树莓派作为编程教育平台&lt;/h3&gt;
&lt;p&gt;我们在 &lt;a href="https://blog.just4fun.site/codelab-adapter-love-Raspberry%20Pi.html"&gt;codelab-adapter ❤️ Raspberry Pi&lt;/a&gt;，写到:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;就编程教育而言，树莓派是非常理想的开源硬件。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这句话是含混的。树莓派是一台电脑，这意味这它可以胜任无数工作，即便就编程教育而言，它的生态里也有数不清的工具，其中有好有坏。当我们说&lt;code&gt;就编程教育而言，树莓派是非常理想的开源硬件。&lt;/code&gt; 我们实际是想说，树莓派是个开放的平台，充满了无限可能，无论你想做怎样的编程教育，它可能都是不错的选择。&lt;/p&gt;
&lt;p&gt;树莓派生态里，有数不清的优秀项目用以支持编程。在&lt;a href="https://blog.just4fun.site/codelab-love-iot.html"&gt;CodeLab ❤️ IoT&lt;/a&gt;列出了我们尤其喜欢的两个项目:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/RPi-Distro/python-gpiozero"&gt;python-gpiozero&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.adafruit.com/product/3957"&gt;Adafruit CRICKIT HAT&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;自由有时候是一种负担&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;问题来了，现在有一群学生，一堆树莓派，有这么多的编程工具可供选择，你来说说要怎么开始编程吧？&lt;/p&gt;
&lt;p&gt;这取决于你是谁，你的用户是谁，你构想的编程场景是怎样的。这些是很个性化的问题，并不存在通用的最佳实践。&lt;/p&gt;
&lt;p&gt;让我们讨论一个具体的案例。在这个典型案例中，我们会看到一些常见的问题模式。&lt;/p&gt;
&lt;p&gt;这个案例是这样的: 你将树莓派作为驱动小车的硬件平台，它是小车的大脑，你构建的产品是一辆编程小车，树莓派是你的项目的一部分。&lt;/p&gt;
&lt;p&gt;它大约长这样:&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/gopiogo_0e097325.png" width=500&gt;&lt;/p&gt;
&lt;p&gt;你当然不会只是想卖出一辆可由树莓派驱动的小车，那样是没什么人想买的。它向左走两步，接着向右走两步就完事了，程序固化其中，这不是你想要的。你希望它是可编程的。&lt;/p&gt;
&lt;h3 id="_3"&gt;一辆可编程小车&lt;/h3&gt;
&lt;p&gt;一辆可编程小车，这么简单的问题用得着专门讨论吗？&lt;/p&gt;
&lt;p&gt;Google/Github搜一下树莓派小车，不是有一堆教程和开源项目吗？淘宝上随便买个小车底盘，买几个电机，加上一些开源的驱动，不就好了吗？&lt;/p&gt;
&lt;p&gt;外形不好看？3D打印一个。3D打印不够细腻？激光树脂了解一下。要批量生产？为外形开个模吧。&lt;/p&gt;
&lt;p&gt;好的，你很快做出了一个可编程的小车，只需要&lt;code&gt;ssh pi@raspberrypi.local&lt;/code&gt;，写几行Python，小车就按你的代码逻辑移动啦！&lt;/p&gt;
&lt;p&gt;等等，命令行？对编程入门者不够友好吧。如果不用ssh，用户怎么为小车编程呢？&lt;/p&gt;
&lt;p&gt;更简单的问题是: 用户怎么与小车上的树莓派建立连接呢? 只要连接能顺利建立，编程过程可以看作在信道上来回传递信息。&lt;/p&gt;
&lt;p&gt;好的，我们似乎得关注"怎么建立连接"这个问题。&lt;/p&gt;
&lt;h1 id="_4"&gt;怎么建立连接&lt;/h1&gt;
&lt;p&gt;有许多方式建立用户与树莓派的连接。最新的树莓派自带了蓝牙(4.2)和wifi芯片。&lt;/p&gt;
&lt;p&gt;所以在不添加任何模块的情况下，我们可以利用蓝牙或wifi与树莓派建立连接。&lt;/p&gt;
&lt;h3 id="_5"&gt;蓝牙&lt;/h3&gt;
&lt;p&gt;树莓派里的蓝牙是可编程的，当你希望利用树莓派自带的蓝牙与用户建立连接时，社区里有很多种实现方案，常规的思路是你可以在树莓派里运行蓝牙服务。用户的客户端主动连接树莓派的蓝牙。需要注意的事，目前操作系统对ble的兼容还不够好，所以你将蓝牙运行为什么模式是需要考虑的，视你的用户和场景而定。&lt;/p&gt;
&lt;p&gt;但你依然需要考虑一些问题，小车树莓派的镜像是用同一个吗？小车的蓝牙服务名字是随机生成的吗？一个教室中有十个小车的话，学生怎么找到那个蓝牙服务对应自己的小车？&lt;/p&gt;
&lt;p&gt;这个问题追问的是如何添加clientid，让用户容易发现它。&lt;/p&gt;
&lt;h3 id="wifi"&gt;wifi&lt;/h3&gt;
&lt;p&gt;树莓派内置了wifi芯片。所以我们可以将树莓派接入无线热点。当然也可以将树莓派用作无线热点。&lt;/p&gt;
&lt;p&gt;需要提醒的是，将树莓派用作热点，会强迫客户端接入它，如果没有双网卡，用户就失去了接入互联网的能力，而你的编程平台很可能在公网上。&lt;/p&gt;
&lt;p&gt;于是我们只讨论&lt;code&gt;将树莓派接入无线热点&lt;/code&gt;的方案。首先我们就会遭遇一个棘手的问题，如何将树莓派接入wifi？树莓派出产时并不知道用户的wifi信息。这意味着配置wifi的工作只能交给用户。&lt;/p&gt;
&lt;p&gt;社区里有很多做法，诸如&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在&lt;code&gt;/boot&lt;/code&gt;目录下常见wpa_supplicant.conf，写入wifi配置信息。&lt;/li&gt;
&lt;li&gt;初始化时，接入显示屏，在图形桌面里配置wifi。&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/balena-io/wifi-connect"&gt;wifi-connect&lt;/a&gt;: Easy WiFi setup for Linux devices from your mobile phone or laptop&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="https://github.com/balena-io/wifi-connect"&gt;wifi-connect&lt;/a&gt;做了非常出色工作，允许你用手机来配置树莓派。就像主流的智能家居网关和智能音箱那样。它可能是个不错的起步！&lt;/p&gt;
&lt;p&gt;接入wifi还只是第一步，它只意味着你有网络了，那么你要如何与用户的客户端通信呢？&lt;/p&gt;
&lt;p&gt;有很多种做法，无论那种做法，都会遇到前头提到的clientid问题。设备需要有标识。尤其是当多个设备在一个网络下使用时（课堂/活动场景）。&lt;/p&gt;
&lt;p&gt;在局域网内，hostname(默认是&lt;code&gt;raspberrypi.local&lt;/code&gt;)是个不错的标识，和大多数情况一样，windows系统负责拖后腿，默认并不支持它(需要mDNS的支持)，如果你采用hostname来发现设备，那么windows需要安装&lt;a href="https://support.apple.com/kb/DL999?viewlocale=zh_CN&amp;amp;locale=zh_CN"&gt;Bonjour Print Services (Windows)&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;我们也可以把树莓派视为一个物联网设备，使用mqtt来连接它。这是我目前比较喜欢的方案，至于mqtt server在云端还是在局域网内(诸如跑在某个树莓派上)，都没问题。&lt;/p&gt;
&lt;p&gt;无论是基于局域网内hostname的连接策略还是基于mqtt的连接策略。&lt;a href="https://codelab-adapter-docs.codelab.club"&gt;codelab-adapter&lt;/a&gt;都将提供支持。&lt;/p&gt;
&lt;h3 id="_6"&gt;小车&lt;/h3&gt;
&lt;p&gt;我们想干嘛来着？我们希望提供的是一个可编程小车！好的，终于想起我们最初要做的事情了。&lt;/p&gt;
&lt;p&gt;莫忘初心啊同学们！&lt;/p&gt;
&lt;p&gt;想想一个典型的使用场景。一群学生在教室里使用Scratch3.0对小车编程。&lt;/p&gt;
&lt;p&gt;他们使用无线网将小车接入了wifi中。我们也做到了每辆小车有个clientid，我们还构建了一个mqtt server，用以把信息从用户编程界面推到小车上。学生在积木里输入clientid，点击连接，之后就可以使用积木给小车发送信息了。&lt;/p&gt;
&lt;p&gt;好的，截至倒目前，我们好像没有构建任何教学相关的内容！我们只是让消息可以从客户端抵达小车。甚至都还不包括如何升级和维护它！&lt;/p&gt;
&lt;h1 id="_7"&gt;一起来解决问题&lt;/h1&gt;
&lt;p&gt;这里边有大量工作是不必要的重复劳动，这正式CodeLab在做的事:&lt;a href="https://blog.just4fun.site/codelab-love-iot.html"&gt;CodeLab ❤️ IoT&lt;/a&gt;，我们希望开发者们一起来完善树莓派平台。将其打造为一个易用的环境。我们开放了围绕树莓派在做的所有工作。&lt;/p&gt;
&lt;p&gt;下一篇文章里，我们会展示一个服务于编程教育的整体解决方案。&lt;/p&gt;
&lt;h1 id="_8"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/codelab-adapter-love-Raspberry%20Pi.html"&gt;codelab-adapter ❤️ Raspberry Pi&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/codelab-love-iot.html"&gt;CodeLab ❤️ IoT&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.dexterindustries.com/gopigo3/"&gt;gopigo3&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Mon, 25 Feb 2019 17:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-02-25:rpi-car-difficult.html</guid><category>scratch</category></item><item><title>CodeLab ❤️ IoT</title><link>/codelab-love-iot.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/codelab-iot_fb0dc4a1.png" /&gt;&lt;/p&gt;
&lt;p&gt;近期CodeLab在IoT方向构建了一些工具。和大多数IoT项目相似，我们的工作也围绕&lt;a href="https://zh.wikipedia.org/zh-hans/MQTT"&gt;MQTT&lt;/a&gt;协议展开。&lt;/p&gt;
&lt;p&gt;CodeLab之后除了对外提供基础工具，也希望能对外提供基础服务。我们的工具链和服务都基于开源项目构建。&lt;/p&gt;
&lt;p&gt;我们近期的工作包括:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Scratch IoT Extension&lt;/li&gt;
&lt;li&gt;codelab-adapter iot extension&lt;/li&gt;
&lt;li&gt;IoT server: iot.codelab.club&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="scratch-iot-extension"&gt;Scratch IoT Extension&lt;/h1&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/scratch-iot_ae44c674.png" width=600&gt;&lt;/p&gt;
&lt;p&gt;Scratch IoT Extension允许接入所有支持wss的mqtt服务。Scratch IoT Extension基于&lt;a href="https://github.com/mqttjs/MQTT.js"&gt;MQTT.js&lt;/a&gt;构建。&lt;/p&gt;
&lt;p&gt;在积木设计上，我们希望IoT积木尽量与EIM积木保持一致。原先想把publish替换为broadcast，后来还是决定保留mqtt用户习惯的词汇。 关于这一点，我们还没有想清楚，欢迎交流和吐槽。&lt;/p&gt;
&lt;p&gt;Scratch IoT Extension是通用的。 你可以使用CodeLab提供的mqtt服务，也可以使用自建的mqtt服务(或第三方服务)来替代积木里默认的地址:&lt;code&gt;wss://guest:test@iot.codelab.club:8084/mqtt&lt;/code&gt;, 关于这串地址的含义参考&lt;a href="https://github.com/mqtt/mqtt.github.io/wiki/URI-Scheme"&gt;mqtt url&lt;/a&gt;。 guest/test分别是测试用户名和密码。&lt;/p&gt;
&lt;p&gt;如果你需要独立的用户而不是公共测试用户，欢迎与我们联系，它是免费的。&lt;/p&gt;
&lt;h3 id="_1"&gt;测试&lt;/h3&gt;
&lt;p&gt;我们来测试一下Scratch IoT Extension，让它与外部程序协同使用。有很多mqtt的测试工具可以选择，诸如&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/mqttjs/MQTT.js#command-line-tools"&gt;nodejs mqtt client&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://hbmqtt.readthedocs.io/en/latest/quickstart.html#quickstart"&gt;python mqtt client&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我选择python社区的工具hbmqtt。&lt;/p&gt;
&lt;p&gt;首先安装它: &lt;code&gt;pip3 install hbmqtt&lt;/code&gt;    &lt;/p&gt;
&lt;h5 id="scratch"&gt;订阅从Scratch发来的消息&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;hbmqtt_sub --url mqtt://guest:test@iot.codelab.club -t "/scratch3_pub"&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-io_98759a24.png" /&gt;&lt;/p&gt;
&lt;h5 id="scratch30"&gt;发布消息给Scratch3.0&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;hbmqtt_pub --url mqtt://guest:test@iot.codelab.club -t "/scratch3_sub" -m "hello from hbmqtt_pub"&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-iot_fe9b195d.png" /&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;当然你可以选择任意的mqtt client与Scratch IoT Extension通信，无论它来自树莓派还是来自esp8266，都没有问题。&lt;/p&gt;
&lt;p&gt;CodeLab关注开放性和通用性。&lt;/p&gt;
&lt;h1 id="codelab-adapter-iot-extension"&gt;codelab-adapter iot extension&lt;/h1&gt;
&lt;p&gt;&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/extension_iot.py"&gt;extension_iot.py&lt;/a&gt;的源代码已经放出。 它将在codelab-adapter 0.8.0中作为内置插件。&lt;/p&gt;
&lt;p&gt;目前它已经能够与&lt;code&gt;Scratch IoT Extension&lt;/code&gt;协同工作:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-iot_90a8317e.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/extension_iot.py"&gt;extension_iot.py&lt;/a&gt;不是开箱即用的那类插件(Cozmo/usbMicrobit是开箱即用的)，我们在其中构建了pub/sub的基本例程。只需微调。加入你自己的业务代码(一般和硬件或本地服务有关)，处理收发的消息。你可以将任何设备消息化，进而将其积木化。&lt;/p&gt;
&lt;p&gt;添加业务代码的位置，我已经在源码中注释了。&lt;/p&gt;
&lt;p&gt;你可以把&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/extension_iot.py"&gt;extension_iot.py&lt;/a&gt;当作类似&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/extension_eim.py"&gt;extension_eim.py&lt;/a&gt;的插件，它本身只是处理消息，没有实际用途，但通过微调，它可以成为任何东西，我们在&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/extension_python_kernel.py"&gt;extension_python_kernel.py&lt;/a&gt;和&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/extension_vector.py"&gt;extension_vector.py&lt;/a&gt;展示了EIM(Everything Is Message)概念的威力。 我们将MQTT视为一个信道，在编程方面，我们会延续EIM的风格。&lt;/p&gt;
&lt;p&gt;本周，我会给出一个具体例子: 在树莓派中使用&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/extension_iot.py"&gt;extension_iot.py&lt;/a&gt;，定制出extension_iot_rpi.py， 而后者是可以实际服务于硬件教学的插件。 在这个例子中我们将展示，如何在几天内快速构建一个教学产品，可以直接推向最终用户，它甚至包括了管理功能(如远程故障处理和升级)!&lt;/p&gt;
&lt;p&gt;目前有两家公司会与我们一起推进树莓派方向的工作。也欢迎更多人一起加入，把树莓派改造为一个开放、通用、可扩展的硬件教学平台。&lt;/p&gt;
&lt;p&gt;这些工作充分展示了adapter的开放架构如何帮助构建生态。&lt;/p&gt;
&lt;h1 id="iot-server"&gt;IoT server&lt;/h1&gt;
&lt;p&gt;CodeLab构建了自己的server: iot.codelab.club&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-iot_072d531a.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/codelab-iot_3e6aadba.png" /&gt;&lt;/p&gt;
&lt;p&gt;原本想找一个公开可用的mqtt server(MQTT Messaging Broker)，却没有找到合适的，要么就是注册很烦，要么就是限制很多，要么就是不兼容开放标准，要么就是服务器在国外，访问不方便，不得已，只好自建了一个。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;iot.codelab.club&lt;/code&gt;提供了mqtt测试用户:&lt;/p&gt;
&lt;p&gt;用户名: &lt;code&gt;guest&lt;/code&gt;， 密码: &lt;code&gt;test&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;完整的mqtt url为:&lt;code&gt;mqtt://guest:test@iot.codelab.club&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;你可以使用任何mqtt client连接它, mqtt python client的例子在&lt;a href="https://gist.github.com/wwj718/1d22f96880f27a43495af0b78ac545a8"&gt;这里&lt;/a&gt;: &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;logging&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;asyncio&lt;/span&gt;

&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;hbmqtt.client&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;MQTTClient&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ClientException&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;hbmqtt.mqtt.constants&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;QOS_0&lt;/span&gt;

&lt;span class="n"&gt;username&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;guest&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;test&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;mqtt_url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;mqtt://{}:{}@iot.codelab.club&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;async&lt;/span&gt; &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;uptime_coro&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;C&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;MQTTClient&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="c1"&gt;# todo: clientid&lt;/span&gt;
    &lt;span class="n"&gt;await&lt;/span&gt; &lt;span class="n"&gt;C&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mqtt_url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;await&lt;/span&gt; &lt;span class="n"&gt;C&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subscribe&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;
            &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/scratch3_pub&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;QOS_0&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
         &lt;span class="p"&gt;])&lt;/span&gt;
    &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;await&lt;/span&gt; &lt;span class="n"&gt;C&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deliver_message&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
            &lt;span class="n"&gt;topic&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;topic&lt;/span&gt;
            &lt;span class="n"&gt;payload&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
            &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt; =&amp;gt; &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;topic&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;payload&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
        &lt;span class="n"&gt;await&lt;/span&gt; &lt;span class="n"&gt;C&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;unsubscribe&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/scratch3_sub&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
        &lt;span class="n"&gt;await&lt;/span&gt; &lt;span class="n"&gt;C&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;disconnect&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="n"&gt;ClientException&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;ce&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;logging&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Client exception: &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;ce&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vm"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;asyncio&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_event_loop&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run_until_complete&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uptime_coro&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如果你想在micropython的兼容板中接入它，使用&lt;a href="https://github.com/micropython/micropython-lib/tree/master/umqtt.simple"&gt;umqtt&lt;/a&gt;即可。&lt;/p&gt;
&lt;p&gt;如果你需要&lt;code&gt;iot.codelab.club&lt;/code&gt;的独立用户，可以向我们免费申请。&lt;/p&gt;
&lt;p&gt;enjoy it~&lt;/p&gt;
&lt;h1 id="_2"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/zh-hans/MQTT"&gt;MQTT&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://mitsuruog.github.io/what-mqtt/"&gt;what-mqtt&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Mon, 25 Feb 2019 12:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-02-25:codelab-love-iot.html</guid><category>codelab</category></item><item><title>CodeLab近况与未来</title><link>/Codelab-Recent-situation-and-future.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/codelab_6ddcff11.png" /&gt;&lt;/p&gt;
&lt;p&gt;CodeLab近期有很多有趣的进展，我试着梳理CodeLab近况，让关心我们的人及时获取信息，以便了解如何参与其中。&lt;/p&gt;
&lt;p&gt;目前CodeLab的&lt;a href="https://blog.just4fun.site/codelab-club-recent-situation.html"&gt;两个里程碑&lt;/a&gt;仍在推进中,所以我们暂时没有大规模动作。许多热心的志愿者来邮件问目前有什么事可以帮上忙。大家不必着急，三月份我们的两个里程碑都将达成，之后需要大家一起推进的事多着呢。&lt;/p&gt;
&lt;p&gt;今晚坐动卧去杭州，明天一早到，往后的几天将会在江浙一带，与几个团队碰面。陆续有公司希望与我们建立合作。&lt;/p&gt;
&lt;p&gt;明天的行程里，上午与杭州地区热心的CodeLab志愿者碰面，下午与网易团队碰面。&lt;/p&gt;
&lt;p&gt;我平时出行喜欢挑在夜间。夜间随火车穿梭在荒山野岭，手机信号不好，网络接近于无。周围无一物熟悉，无一人熟悉，窗外灯火与乡村变幻不定。日常被远远甩在身后。车上的这段时间，无事处理，无所挂怀，于是心境澄明得很。再适合写作不过了。&lt;/p&gt;
&lt;p&gt;废话不说，开始我们的梳理。&lt;/p&gt;
&lt;h1 id="_1"&gt;未来&lt;/h1&gt;
&lt;p&gt;在梳理近况之前，先来鸟瞰一番CodeLab的未来。&lt;/p&gt;
&lt;p&gt;随着对手头事物的推进，我们逐渐看清了Codelab的未来。关于它将走向何方，我们将做什么，以及不做什么。&lt;/p&gt;
&lt;p&gt;CodeLab志愿者@Finn帮忙梳理的这张图，包含了我们未来将要做的事情。&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://scratch3-files.just4fun.site/codelab_plan.png" /&gt;&lt;/p&gt;
&lt;p&gt;这张图中的很多计划，此前在&lt;a href="https://blog.just4fun.site/about-codelab-club.html"&gt;关于codelab.club&lt;/a&gt;做了阐述。&lt;/p&gt;
&lt;p&gt;我将规划的内部版本也放出来。&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://scratch3-files.just4fun.site/codelab_branch.png" /&gt;&lt;/p&gt;
&lt;p&gt;这个版本包含了许多代号，除非你是CodeLab铁杆粉，且时间充裕，一直在跟进我们的所有进展，否则里边名词太多，看起来不如上边一张图容易理解。能将更多信息透明总是好事，所以一并开放出来。以后我们谈论具体事务，还要经常用到这两张图。&lt;/p&gt;
&lt;p&gt;下边我们将围绕图中板块，来介绍CodeLab的近况。&lt;/p&gt;
&lt;h1 id="codelab-adapter"&gt;codelab-adapter&lt;/h1&gt;
&lt;p&gt;codelab-adapter截止到目前(2019.02.18)已经推出了&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/install/"&gt;第七个大版本&lt;/a&gt;。在近期的更新中，我们对其做了大量改进，我们从Smalltalk和Bret那儿学习设计原则，也从他们那儿学会思考，关于什么是好的创造工具。&lt;/p&gt;
&lt;p&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/changelog/"&gt;changelog&lt;/a&gt;记录了codelab-adapter近期所有的改进。&lt;/p&gt;
&lt;p&gt;近期我们增加了许多有趣的特性，包括:&lt;/p&gt;
&lt;h3 id="_2"&gt;内置微信插件&lt;/h3&gt;
&lt;p&gt;相信这是个killer app级的extension。我们已经将其做到了开箱即用，削减了所有不必要的复杂度。&lt;/p&gt;
&lt;p&gt;它可以用于以下场景&lt;/p&gt;
&lt;h5 id="_3"&gt;说声晚安&lt;/h5&gt;
&lt;p&gt;codelab-adapter已经接入了主流的智能家居设备，在微信插件加持下，我们可以做到用微信控制家庭设备，睡前关灯再也不用喊天猫精灵，一喊睡意全没了，给自己的账号发条晚安就行:)&lt;/p&gt;
&lt;p&gt;下雪天不想起床关灯？ 读书困了不想起床关灯？ 我就是懒不想起床关灯？ 没关系的，懒惰是创造者的美德:)&lt;/p&gt;
&lt;p&gt;发一条晚安信息，房间与你一同进入睡眠模式。&lt;/p&gt;
&lt;h5 id="_4"&gt;芝麻开门&lt;/h5&gt;
&lt;p&gt;codelab-adapter正在接入智能门锁(深圳绿米公司赠与了我们智能门锁，希望一起探索这块的合作可能)。&lt;/p&gt;
&lt;p&gt;设想你组织了个party，每次有人按门铃都得去开门，是不是很烦躁？&lt;/p&gt;
&lt;p&gt;把参与者拉到一个微信群，他们一到门口，在群里吼一身芝麻开门, 门即刻自动打开。 codelab-adapter一端连接微信，一端连接智能门锁。要做到这点，只需在Scratch中拖几块积木，将它们拼一起即可。 这便是我们期待的编程教育。&lt;/p&gt;
&lt;h5 id="_5"&gt;想你的夜&lt;/h5&gt;
&lt;p&gt;我们正在接入脑电波传感器。当你想念某个人的时候，脑电波传感器一旦捕获到你的情绪，立刻触发微信积木块，给心上人发送一条来自远方的惦念。&lt;/p&gt;
&lt;p&gt;来看个简单的演示：&lt;/p&gt;
&lt;video width="600px" src="http://scratch3-files.just4fun.site/wechat_extension.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;h3 id="web"&gt;支持在web页面启停插件&lt;/h3&gt;
&lt;p&gt;通过支持在web页面启停插件，开发者可以自己构建插件管理UI！如此一来，你可以将codelab-adapter当作后台服务。这能够避免用户在多个工具中来回切换，减少不必要的认知负担。&lt;/p&gt;
&lt;p&gt;任何能够降低用户使用门槛的改进，我们都将竭力去做。&lt;/p&gt;
&lt;h3 id="_6"&gt;提高开放性&lt;/h3&gt;
&lt;p&gt;codelab-adapter希望构建开发者生态。&lt;/p&gt;
&lt;p&gt;所以我们关注开放性, 在这方面我们做了不少工作:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/scratch3-adapter-open-plan.html"&gt;支持第三方平台&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/scratch3-adapter-web-extension-control.html"&gt;支持在web页面启停插件&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;开放插件源码: &lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions"&gt;codelab_adapter_extensions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/codelab-adapter-rest-api.html"&gt;增加REST API&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;...&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;CodeLab相信一个好的工具，应该是灵活的，工具的作者无法穷尽使用场景，尤其当它是一个创造性工具的时候。如果我们我们宣称已经打造了一个完整的封闭生态，意味着这个工具支持的创造也十分有限。&lt;/p&gt;
&lt;p&gt;有黑客精神的开发者要问了: "说了半天开放性，那你们源码究竟什么时候开源? 对于我们这些黑客来说，破解它虽不难吧，但你知道的，麻烦多在破解之后，读一堆注释不清晰的源码，不是什么愉快的经历，尤其是它还一直在迭代更新。如果codelab-adapter能主动公开源代码，并附以清晰的注释和文档，将更容易赢得我们尊重"&lt;/p&gt;
&lt;p&gt;别急别急，我们也认同开源不是甩出一堆糟糕的源码，它需要清晰的注释、完整的文档，以及一群热情的开发者。就像&lt;a href="https://github.com/django/django"&gt;Django&lt;/a&gt;/&lt;a href="https://github.com/keras-team/keras"&gt;Keras&lt;/a&gt;/&lt;a href="https://github.com/home-assistant/home-assistant"&gt;Home Assistant&lt;/a&gt;这些社区所做的，而Scratch在开源这块做得并不理想。&lt;/p&gt;
&lt;p&gt;codelab-adapter目前迭代更新很快，在&lt;a href="https://dynamicland.org"&gt;realktalk&lt;/a&gt;协议发布之后,我们将迎来一次大更新，以实现该协议，因为&lt;a href="https://dynamicland.org"&gt;dynamicland&lt;/a&gt;试图打造的用以支持创造的环境，也正是codelab所追求的星辰大海。在这个里程碑之后，codelab-adapter将正式发布v1.0版本，此后codelab-adapter将趋于稳定，那时我们将开源所有的源代码。&lt;/p&gt;
&lt;p&gt;CodeLab是一个非营利组织，开放是我们追求的目标之一。&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;其他的重要改进包括:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;添加web调试(Debug)页面&lt;/li&gt;
&lt;li&gt;内置Python kernel插件&lt;/li&gt;
&lt;li&gt;内置树莓派(Raspberry Pi)插件&lt;/li&gt;
&lt;li&gt;支撑多个client并行作为UI&lt;/li&gt;
&lt;li&gt;将消息用作内部管理机制&lt;/li&gt;
&lt;li&gt;允许跨域访问websocket/REST API&lt;/li&gt;
&lt;li&gt;...&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;所有改进列表参考&lt;a href="https://codelab-adapter-docs.codelab.club/changelog/"&gt;changelog&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="_7"&gt;谍照&lt;/h3&gt;
&lt;p&gt;这部分的最后一节，我们放出codelab-adapter下个版本的谍照。&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/pyqt-adapter_6e758269.png" width=300 /&gt;&lt;/p&gt;
&lt;p&gt;codelab-adapter的下一次大更新中，将使用pyqt5作为UI库。目前已经完成了90%的迁移工作，一旦测试完成, 确保了稳定性，我们就会发布。&lt;/p&gt;
&lt;h1 id="_8"&gt;在线社区&lt;/h1&gt;
&lt;p&gt;CodeLab正基于Scratch3.0构建在线社区。&lt;/p&gt;
&lt;p&gt;我们致力于实现以下目标：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;理解Scratch3.0的架构设计&lt;/li&gt;
&lt;li&gt;理解Scratch拥有强大兼容性的原因&lt;/li&gt;
&lt;li&gt;梳理Scratch3.0产品背后使用的一些设计原则&lt;ul&gt;
&lt;li&gt;表现与实现的分离&lt;/li&gt;
&lt;li&gt;事件驱动&lt;/li&gt;
&lt;li&gt;面相对象&lt;/li&gt;
&lt;li&gt;everything is message&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;按照Scratch一贯的设计原则，独立实现Scratch并未开源的部分。确保之后能随着Scratch一同升级，架构上保证向后兼容。&lt;/li&gt;
&lt;li&gt;顺着Scratch的思路，对Scratch作出改进。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;总而言之，我们希望通过这些分析，获得定制scratch的能力，但同时又能与上游的官方版本保持兼容。我们重视官方对Scratch的改进。与其说我们重视他们技术能力，不如说我们重视他们对教育和社区的深刻理解，这些是极为稀缺的，它不是技术问题，也不是资金问题。我们希望能随时将官方的改进merge回我们调整后的项目中。我们不希望做出硬分叉。&lt;/p&gt;
&lt;p&gt;为了实现这个目标，我们付出了很多努力，写了不少技术文章：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/Scratch3_api_analysis.html"&gt;Scratch3.0技术分析之后端API(第0篇)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/Scratch3_api_analysis_1.html"&gt;Scratch3技术分析之创作平台API(第1篇)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/Scratch3_asset_analysis_2.html"&gt;Scratch3技术分析之静态资源API(第2篇)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/Scratch3_project_homepage_analysis_3.html"&gt;Scratch3技术分析之项目主页API(第3篇)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/Scratch3_user_api_analysis_4.html"&gt;Scratch3技术分析之User API(第4篇)
&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/Scratch3_community_analysis_5.html"&gt;Scratch3技术分析之社区 API(第5篇)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/Scratch3_project_json_analysis_6.html"&gt;Scratch3技术分析之项目内部数据(第6篇）&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;所有的这些工作，都分享给了技术社区。&lt;/p&gt;
&lt;p&gt;截至目前，我们已经完成了主要后端API，线上社区将全面接入codelab-adapter，技术层面，它将会是全球连接能力最强大的积木化编程社区之一，我们私底下觉得没有之一，哈哈，我们就私底下说说，大家别外传。希望3月份，新社区能与大家见面。&lt;/p&gt;
&lt;p&gt;4月8号，我们将赴MIT，向Scratch团队展示我们取得的进展，试图推进工具链的整合，也希望将我们在技术上的许多探索，能够合并到全球社区中。&lt;/p&gt;
&lt;h1 id="neverland"&gt;Neverland&lt;/h1&gt;
&lt;p&gt;抛开线上社区，另一个里程碑是Neverland。&lt;/p&gt;
&lt;p&gt;Neverland目前还在装修中，按计划，它将三月中旬投入使用。&lt;/p&gt;
&lt;p&gt;我们尽可能避免甲醛材料的使用，在投入使用前，将做一次去甲醛处理，测试有害物质合格之后再投入使用。&lt;/p&gt;
&lt;h1 id="_9"&gt;新的探索方向&lt;/h1&gt;
&lt;p&gt;CodeLab目前做了大量有趣的技术探索，仿佛是一个由技术驱动的组织，我们的确关注技术，但我们更关注教育，CodeLab将制作内容，但我们不会制作code.org或者Tynker正在做的东西，目前的内容已经高度同质化，我们会追随使命去探索。CodeLab在内容上的探索，将如同我们在技术上的探索一样独特。&lt;/p&gt;
&lt;p&gt;目前CodeLab志愿者@MT和@Eric正在探索两个方向，我们暂时将其命名为&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CodeLab Mindstorms&lt;/li&gt;
&lt;li&gt;CodeLab 未来社&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;最终采用的名字将由两位发起人来确定,他们目前还没有想好名字。&lt;/p&gt;
&lt;p&gt;CodeLab Mindstorms将关注编程教育，但不准备发表“编程有助于提高逻辑思维能力”之类的陈词滥调。CodeLab Mindstorms关注认知论、学习者的心理模型、建构主义、面向对象、设计原则，CodeLab Mindstorms将翻译和解读这个领域最优秀的探索者所做的工作，这些工作中的大多数已经被遗忘，有一部分正在被复活(如Dynamicland、Scratch Team和艾伦凯正在做的事情)，但关注者寥寥，CodeLab Mindstorms将解读&lt;a href="https://zh.wikipedia.org/zh/%E7%BA%A6%E7%BF%B0%C2%B7%E6%9D%9C%E5%A8%81"&gt;约翰·杜威(John Dewey)&lt;/a&gt; 、&lt;a href="https://zh.wikipedia.org/zh-hans/%E4%BC%AF%E7%89%B9%E5%85%B0%C2%B7%E7%BD%97%E7%B4%A0"&gt;罗素&lt;/a&gt;、&lt;a href="https://zh.wikipedia.org/zh-hans/%E8%AE%93%C2%B7%E7%9A%AE%E4%BA%9E%E5%82%91"&gt;皮亚杰(Jean Piaget)&lt;/a&gt;、&lt;a href="https://zh.wikipedia.org/zh-hans/%E8%89%BE%E4%BC%A6%C2%B7%E5%87%AF"&gt;艾伦·凯(Alan Curtis Kay)&lt;/a&gt;、&lt;a href="https://en.wikipedia.org/wiki/Seymour_Papert"&gt;派普特(Seymour Papert)&lt;/a&gt;和&lt;a href="https://en.wikipedia.org/wiki/Mitchel_Resnick"&gt;密契尔(Mitchel Resnick)&lt;/a&gt;等人的工作，目前@MT正带着他的学生在推进这块的工作。&lt;/p&gt;
&lt;p&gt;CodeLab未来社 由@Eric负责推进，Eric钟情于哲学、禅与科幻小说，居于加拿大，是两个孩子的奶爸。Eric一直热衷于教育事业。&lt;/p&gt;
&lt;p&gt;CodeLab未来社 将围绕Neverland这个实体空间，创作关于未来的情景剧。CodeLab未来社将围绕Neverland发生的事，制作有趣的情景故事（想想《生活大爆炸》）。科幻有时候比科普更容易打动人心，关于未来的各种可能性、未来的人们将与怎样的智能机器相处、未来的计算机如何逃出方形盒子成为现实世界的一部分、什么是人们从小应该接受的教育、什么是人性化的技术(Bret正在做这方面的探索)，我们希望通过关于未来的故事展示出来。希望那些热爱故事的孩子，燃起对技术的热情。我们描述未来，因为我们准备与你一起抵达它，CodeLab帮助你做好准备，这正是你为何加入其中的原因。&lt;/p&gt;
&lt;p&gt;此前在&lt;a href="https://blog.just4fun.site/about-codelab-club.html"&gt;关于codelab.club&lt;/a&gt;表述到:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;《理想国》里说:"言语是一种比蜡还容易随意捏造的材料", 它如此灵活，能够用来与朋友逗乐，用来表达你的思想，用来创造诗歌与小说；编程就像言语，它同样可以用来表达你的想法，用来与朋友逗乐，以及，用来创造。它让你与世间的万物沟通，你可以用它创造一个飞行器，制作一个体感游戏,或是让自己的房间变得智能。你可以在朋友生日那天，在Ta进门的一刻，将手中的魔杖一挥，在空中划一个字母L的轨迹，瞬间，点亮房间里五彩的灯光。在codelab.club，你将轻松做出这样的魔杖。如果你愿意，你可以将codelab.club看作霍格沃茨(Hogwarts)。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;CodeLab未来社 不准备说教，我们展示一个未来，这里充满魔法，如你所见，但它们都是现实，没有任何特效和后期。任何先进的技术，都接近魔法。&lt;/p&gt;
&lt;p&gt;此前一直困于找不到理想的内容创作团队，对于舞台表演，对于如何抓住观众的兴趣，我们毫无经验，如何招到充满创意创作者，我们也没有头绪，近期，已经很大有了突破，我们跨界找到了理想中的一群人 :)&lt;/p&gt;
&lt;p&gt;让未来到来。&lt;/p&gt;
&lt;h1 id="_10"&gt;尾声&lt;/h1&gt;
&lt;p&gt;搞不懂动卧列车为何没有电脑插座，快没电了，吓得我赶紧进入尾声部分。&lt;/p&gt;
&lt;h3 id="_11"&gt;来自社区的鼓励&lt;/h3&gt;
&lt;p&gt;目前技术社区慷慨地给予我们鼓励，包括教育社区、机器人社区以及黑客社区。&lt;/p&gt;
&lt;p&gt;国外技术社区，有不少用户在使用CodeLab的东西，包括非营利组织成员、流行电脑杂志专栏作者、孩子他爸、高中老师...&lt;/p&gt;
&lt;p&gt;使用CodeLab工具的Scratch用户则他们希望我们在扩展Scratch这块的工作，能合并到官方社区中。&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/adapter_4d119772.png" width=500 /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/adapter_479bbae1.png" width=500 /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/adapter_6688a5fe.png" width=500 /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/adapter_f0f699d4.png" width=500 /&gt;&lt;/p&gt;
&lt;h3 id="_12"&gt;来自硬件公司的赠与&lt;/h3&gt;
&lt;p&gt;有不少硬件公司试图与CodeLab建立合作，在我们完成手头的里程碑之前，我们无法支出太多时间在合作事项上。在我们无法给出任何承诺的情况下，他们依然赠与我们全套的最新设备（其中有一些价格不菲），他们还建立了技术小组推进对接事项。&lt;/p&gt;
&lt;p&gt;即便如此，我们还是需要在此声明CodeLab是非营利组织，对我们来说，使命比建立合作要重要，当然，两者并不是经常冲突，但在早期阶段，时间是我们的稀缺资源，所以我们会优先关注使命而不是合作，有不周之处，望大家见谅。&lt;/p&gt;
&lt;p&gt;但我们不希望伤了社区的热心，所以我们努力去构建开放的接入机制，允许任何组织/公司或个人接入我们的项目，我们乐意将万物积木化的能力分享给大家。关于开放机制有任何问题，大家都可以随时邮件联系我们。&lt;/p&gt;
&lt;p&gt;感谢目前所有赠送硬件给CodeLab的企业。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Mon, 18 Feb 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-02-18:Codelab-Recent-situation-and-future.html</guid><category>codelab</category></item><item><title>Scratch3.0 Generate Python Code</title><link>/Scratch3-Generate-Python-Code.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-python_0c1dd7cc.png" /&gt;&lt;/p&gt;
&lt;h1 id="_1"&gt;前言&lt;/h1&gt;
&lt;p&gt;有不少开发者来信问，如何从Scratch3.0的积木中生成Python代码。&lt;/p&gt;
&lt;p&gt;我此前在&lt;a href="https://github.com/wwj718/blockly_dev/blob/master/src/scratch-blocks_hello_world/readme.md#%E5%85%B3%E4%BA%8Escratch-blocks%E6%98%AF%E5%A4%9F%E5%8F%AF%E4%BB%A5generate-python-code"&gt;wwj718/blockly_dev scratch-blocks_hello_world&lt;/a&gt;项目中给出了示例。&lt;/p&gt;
&lt;h1 id="_2"&gt;思路&lt;/h1&gt;
&lt;p&gt;思路很简单，Scratch3.0的积木(&lt;a href="https://github.com/LLK/scratch-blocks"&gt;scratch-blocks&lt;/a&gt;)基于&lt;a href="https://github.com/google/blockly"&gt;Blockly&lt;/a&gt;, 所以它拥有Blockly积木的功能，Blockly积木可以生成代码，官方文档在这里写得很清晰: &lt;a href="https://developers.google.com/blockly/guides/create-custom-blocks/generating-code"&gt;Blockly Generating Code&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Python是Blockly原生支持的语言之一。对于许多通用的积木(如if/while/math)直接引用&lt;code&gt;python_compressed.js&lt;/code&gt; 就可以直接生成相应代码，对于Scratch自定义的积木，则需要自定义相应的代码，自定义的策略，我在&lt;a href="https://github.com/wwj718/blockly_dev/blob/master/src/scratch-blocks_hello_world/readme.md#%E5%85%B3%E4%BA%8Escratch-blocks%E6%98%AF%E5%A4%9F%E5%8F%AF%E4%BB%A5generate-python-code"&gt;wwj718/blockly_dev scratch-blocks_hello_world&lt;/a&gt;里已经给出例子。&lt;/p&gt;
&lt;p&gt;混用代码和积木是有风险的，你可能要为此引入很多"智能"的check来防止错误的产生，可能还会把用户搞得一头雾水。慎用。关于这部分的讨论，参考我之前的文章: &lt;a href="https://blog.just4fun.site/Hardware-Programming-style.html#_11"&gt;两种硬件编程风格的比较&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="scratch30python"&gt;Scratch3.0与Python&lt;/h1&gt;
&lt;p&gt;Scratch3.0和Python同为少儿编程领域的重点，如何连接它们，彼此增强，CodeLab在&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;中做了不少有趣的探索: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/scratch3-adapter-as-python-interpreter.html"&gt;将codelab-adapter用作Python解释器&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/scratch3-adapter-presentation.html"&gt;使用Scratch3.0制作幻灯片&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/scratch-adapter-eim-script.html"&gt;使用Python拓展Scratch的能力&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/python-scratch-with-adapter.html"&gt;Python与Scratch的双向通信&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="_3"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://developers.google.com/blockly/guides/create-custom-blocks/generating-code"&gt;Blockly Generating Code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/wwj718/blockly_dev/blob/master/src/scratch-blocks_hello_world/readme.md#%E5%85%B3%E4%BA%8Escratch-blocks%E6%98%AF%E5%A4%9F%E5%8F%AF%E4%BB%A5generate-python-code"&gt;wwj718/blockly_dev scratch-blocks_hello_world&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/Hardware-Programming-style.html#_11"&gt;两种硬件编程风格的比较&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Mon, 18 Feb 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-02-18:Scratch3-Generate-Python-Code.html</guid><category>codelab</category></item><item><title>codelab-adapter ❤️ Raspberry Pi</title><link>/codelab-adapter-love-Raspberry%20Pi.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-rpi_6231ebfe.png" /&gt;&lt;/p&gt;
&lt;p&gt;我们一直对树莓派(&lt;a href="https://www.raspberrypi.org/"&gt;Raspberry Pi&lt;/a&gt;)偏爱有加，之前写了很多与树莓派有关的文章:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/adapter-opencv.html"&gt;运行在树莓派中的 scratch3-adapter opencv 插件&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/adapter-tensorflow.html"&gt;运行在树莓派中的scratch3-adapter tensorflow插件&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/notes-from-dynamicland-programming-raspberry-pis.html"&gt;来自Dynamicland的笔记: 为树莓派(Raspberry Pi)编程&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/rpi_sense_hat.html"&gt;在树莓派中玩转Sense HAT&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/awesome-raspberry-pi-zh.html"&gt;周末、填坑与树莓派资源大全&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/raspberrypi-tensowflow-robot-speaker.html"&gt;基于树莓派和Tensowflow的物体识别-speaker&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/raspberrypi-tensowflow-robot.html"&gt;基于树莓派和Tensowflow的物体识别-brain&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/raspberrypi-lirc.html"&gt;用树莓派给家用电器加上智能（红外篇）&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/pi-guardian.html"&gt;树莓派守护者!&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/install/"&gt;codelab-adapter的最新版本&lt;/a&gt;内置了树莓派插件。&lt;/p&gt;
&lt;h1 id="raspberry-pi"&gt;树莓派(Raspberry Pi)&lt;/h1&gt;
&lt;p&gt;就编程教育而言，树莓派是非常理想的开源硬件。&lt;/p&gt;
&lt;p&gt;它也深受黑客们的喜欢。如果你不知道技术社区有什么好东西，一种聪明的技巧是，看看黑客们都喜欢什么，此处的黑客是&lt;a href="https://blog.just4fun.site/Hackers-Heroes-of-the-Computer-Revolution.html"&gt;黑客: 计算机革命的英雄&lt;/a&gt;一书定义的那种黑客，不是盗取QQ号那种。&lt;/p&gt;
&lt;p&gt;近年，我们看到树莓派社区涌现了非常多优秀的软硬件，它们致力于降低编程的门槛，但不降低编程这件事的天花板。&lt;/p&gt;
&lt;p&gt;其中&lt;a href="https://github.com/RPi-Distro/python-gpiozero"&gt;python-gpiozero&lt;/a&gt;和&lt;a href="https://www.adafruit.com/product/3957"&gt;Adafruit CRICKIT HAT&lt;/a&gt;极为突出。&lt;/p&gt;
&lt;p&gt;使用过&lt;a href="https://sourceforge.net/projects/raspberry-gpio-python/"&gt;RPi.GPIO&lt;/a&gt;的老用户，可能和我一样，觉得它用起来挺烦人的，需要接触很多底层概念，颗粒太细。于是&lt;a href="https://github.com/RPi-Distro/python-gpiozero"&gt;python-gpiozero&lt;/a&gt;应运而生，提供了许多易用的API，难怪连Python之父&lt;a href="https://twitter.com/gvanrossum"&gt;Guido van Rossum&lt;/a&gt;都在twitter表白说:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;GPIOzero I love you!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;如果你希望将树莓派用于编程教育，&lt;a href="https://github.com/RPi-Distro/python-gpiozero"&gt;python-gpiozero&lt;/a&gt;不容错过。&lt;/p&gt;
&lt;p&gt;同样地，&lt;a href="https://www.adafruit.com/product/3957"&gt;Adafruit CRICKIT HAT&lt;/a&gt;也大大降低了硬件编程的复杂性。或者说，它剔除了那些不必要的复杂性。&lt;/p&gt;
&lt;h1 id="raspberrypi"&gt;使用raspberrypi插件&lt;/h1&gt;
&lt;p&gt;codelab-adapter自带的&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/extension_raspberrypi.py"&gt;树莓派插件&lt;/a&gt;便基于&lt;a href="https://github.com/RPi-Distro/python-gpiozero"&gt;python-gpiozero&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;为了使用raspberrypi插件，你需要本地有Python3(Mac/Linux用户已经系统自带了)，然后安装相关依赖: &lt;code&gt;pip3 install gpiozero pigpio pyzmq --user&lt;/code&gt;(windows用户则是:&lt;code&gt;pip install gpiozero pigpio --user&lt;/code&gt;)&lt;/p&gt;
&lt;p&gt;然后就可以使用了。&lt;/p&gt;
&lt;p&gt;注意，我们目前只是开了个头，给出了基本架构，这个插件目前没有具体功能，为了增强它，需要完善:&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/servers/raspberrypi_server.py"&gt;raspberrypi_server.py&lt;/a&gt;，欢迎开发者社区一起来改进它。&lt;/p&gt;
&lt;h1 id="cs"&gt;C/S架构&lt;/h1&gt;
&lt;p&gt;这里我们以树莓派插件为例，单独提一下codelab-adapter中C/S架构类型的插件。目前这类插件在: &lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/tree/master/servers"&gt;codelab_adapter_extensions servers&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;C指Client, S指Server, 之所以存在C/S架构风格的插件，是因为，codelab-adapter不可能包含所有第三方Python库。原因有很多，其一是技术上不可能，比如说有Vector官方库需要在shell进行认证。其二是我们想保持内核的精简，除非这个依赖非常通用，比如&lt;a href="https://github.com/pyserial/pyserial"&gt;pyserial&lt;/a&gt;，否则我们就不打包。&lt;/p&gt;
&lt;p&gt;目前codelab-adapter内置的所有第三方库，参考: &lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/wiki"&gt;wiki&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;chardet==3.0.4&lt;/li&gt;
&lt;li&gt;pyserial==3.4&lt;/li&gt;
&lt;li&gt;pyzmq==17.0.0&lt;/li&gt;
&lt;li&gt;requests==2.21.0&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;但我们又希望，尽可能支持更多功能。所以解决方案是C/S架构。C/S架构之下，外部库实际由本地Python驱动，codelab-adapter中的对应插件负责调度。具体代码参考&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/tree/master/servers"&gt;codelab_adapter_extensions servers&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;这正是使用ZeroMQ的典型场景。&lt;/p&gt;
&lt;p&gt;如此一来，我们就可以支持Python生态的所有库。&lt;/p&gt;
&lt;h1 id="_1"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/RPi-Distro/python-gpiozero"&gt;python-gpiozero&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/extension_raspberrypi.py"&gt;extension_raspberrypi.py&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/servers/raspberrypi_server.py"&gt;raspberrypi_server.py&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.adafruit.com/product/3957"&gt;Adafruit CRICKIT HAT&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Mon, 18 Feb 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-02-18:codelab-adapter-love-Raspberry Pi.html</guid><category>codelab</category></item><item><title>codelab-adapter增加REST API</title><link>/codelab-adapter-rest-api.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/adapter-rest-api_8f7dac82.png" /&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Built By Developers, For Developers.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id="_1"&gt;前言&lt;/h1&gt;
&lt;p&gt;codelab-adapter希望构建开发者生态。&lt;/p&gt;
&lt;p&gt;所以我们关注开放性, 在这方面我们做了不少工作:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/scratch3-adapter-open-plan.html"&gt;scratch3-adapter支持第三方平台&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/scratch3-adapter-web-extension-control.html"&gt;scratch3-adapter将支持在web页面启停插件&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions"&gt;Scratch3Lab/codelab_adapter_extensions&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;增加REST API正是出于提高开放性的考虑，以适应更多使用场景。&lt;/p&gt;
&lt;p&gt;codelab相信一个好的工具，应该是灵活的，工具的作者无法穷尽使用场景，尤其当它是一个创造性工具的时候。如果我们我们宣称我们已经打造了一个完整的封闭生态，意味着这个工具支持的创造也十分有限。&lt;/p&gt;
&lt;p&gt;有黑客精神的开发者要问了: "说了半天开放性，那你们源码究竟什么时候开源? 对于我们这些黑客来说，破解它虽不难吧，但你知道的，麻烦多在破解之后，读一堆注释不清晰的源码，不是什么愉快的经历，尤其是它还一直在迭代更新。如果codelab-adapter能主动公开源代码，并附以清晰的注释和文档，将更容易赢得我们尊重"&lt;/p&gt;
&lt;p&gt;别急别急，我们也认同开源不是甩出一堆糟糕的源码，它需要清晰的注释、完整的文档，以及一群热情的开发者。就像&lt;a href="https://github.com/django/django"&gt;Django&lt;/a&gt;/&lt;a href="https://github.com/keras-team/keras"&gt;Keras&lt;/a&gt;/&lt;a href="https://github.com/home-assistant/home-assistant"&gt;Home Assistant&lt;/a&gt;这些社区所做的，而Scratch在开源这块做得并不理想。&lt;/p&gt;
&lt;p&gt;codelab-adapter目前迭代更新很快，在&lt;a href="https://dynamicland.org"&gt;realktalk&lt;/a&gt;协议发布之后,我们将迎来一次大更新，以实现该协议，因为&lt;a href="https://dynamicland.org"&gt;dynamicland&lt;/a&gt;试图打造的用以支持创造的环境，也正是codelab所追求的星辰大海。在这个里程碑之后，codelab-adapter将正式发布v1.0版本，此后codelab-adapter将趋于稳定，那时我们将开源所有的源代码。&lt;/p&gt;
&lt;p&gt;codelab是一个非营利组织，开放是我们追求的目标之一。&lt;/p&gt;
&lt;h1 id="rest-api"&gt;REST API&lt;/h1&gt;
&lt;p&gt;REST API已经内置于&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/install/"&gt;codelab-adapter最新版本&lt;/a&gt;中。&lt;/p&gt;
&lt;p&gt;从&lt;a href="https://codelab-adapter-docs.codelab.club/dev_guide/Architecture/"&gt;架构图&lt;/a&gt;说起。从架构可以看出，codelab-adapter此前对外只提供一个服务: websocket服务, 意味着与codelab-adapter的所有通信，都需要构建websocket通道。&lt;/p&gt;
&lt;p&gt;如果开发者只是想从网页或本地应用给codelab-adapter发送一条信息，以控制硬件/IoT/AI，http请求有时候是更轻量和简易的选择。这是&lt;a href="https://developers.home-assistant.io/docs/en/external_api_rest.html"&gt;Home Assistant&lt;/a&gt;给我们的启发。&lt;/p&gt;
&lt;p&gt;于是我们构建了REST API。&lt;/p&gt;
&lt;h3 id="_2"&gt;使用方式&lt;/h3&gt;
&lt;p&gt;由于codelab-adapter围绕消息设计，所以我们只要提供一个用以发送消息的API即可支持强大的交互。&lt;/p&gt;
&lt;p&gt;我们演示一个最简单的例子。&lt;/p&gt;
&lt;p&gt;运行codelab-adapter的extension_eim插件，观察来自外部的eim消息:&lt;code&gt;tail -f ~/codelab_adapter/info.log|grep extension_eim&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;发送一条eim消息&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;curl -X POST -H &lt;span class="s2"&gt;&amp;quot;Content-Type: application/json&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    -d &lt;span class="s1"&gt;&amp;#39;{&amp;quot;topic&amp;quot;: &amp;quot;eim&amp;quot;,&amp;quot;payload&amp;quot;:&amp;quot;hello world&amp;quot;}&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    https://codelab-adapter.codelab.club:12358/api/message
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/adapter-rest-api_8f7dac82.png" /&gt;&lt;/p&gt;
&lt;p&gt;当然你也可以使用任何编程语言(Python/Nodejs/Java/C++) 来发送http请求,展示一个Python的例子:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;requests&lt;/span&gt;
&lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://codelab-adapter.codelab.club:12358/api/message&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topic&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;eim&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;payload&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;hello world&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;verify&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/adapter-rest-api_d8d810e8.png" /&gt;&lt;/p&gt;
&lt;h3 id="_3"&gt;注意消息的方向&lt;/h3&gt;
&lt;p&gt;使用REST API，消息从&lt;code&gt;website(blockly/Scratch) / local app(Python/Nodejs/Java/C++)&lt;/code&gt; 流向 &lt;code&gt;codelab-adapter&lt;/code&gt;&lt;/p&gt;
&lt;h3 id="_4"&gt;在网站中使用&lt;/h3&gt;
&lt;p&gt;开发者可以使用Ajax与codelab-adapter交互！&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;xhr&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;XMLHttpRequest&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://codelab-adapter.codelab.club:12358/api/message&amp;quot;&lt;/span&gt;
&lt;span class="nx"&gt;xhr&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;POST&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;sendData&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;topic&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;eim&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;payload&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hello&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="nx"&gt;xhr&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setRequestHeader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;content-type&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;application/json&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="nx"&gt;xhr&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;stringify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;sendData&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/adapter-rest-api_4ddf0ea0.png" /&gt;&lt;/p&gt;
&lt;p&gt;codelab-adapter的最新版本(0.7.0)已支持跨域访问REST API，开发者可以在web应用里同时使用websocket/Ajax与codelab-adapter交互！&lt;/p&gt;
&lt;h1 id="_5"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://developers.home-assistant.io/docs/en/external_api_rest.html"&gt;Home Assistant REST API&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/scratch3-adapter-open-plan.html"&gt;scratch3-adapter支持第三方平台&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/scratch3-adapter-web-extension-control.html"&gt;scratch3-adapter将支持在web页面启停插件&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions"&gt;Scratch3Lab/codelab_adapter_extensions&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Sat, 16 Feb 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-02-16:codelab-adapter-rest-api.html</guid><category>codelab</category></item><item><title>codelab-adapter内置微信(wechat)插件</title><link>/adapter-wechat-extension.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/eextension-wechat_f232e4a1.png" /&gt;&lt;/p&gt;
&lt;p&gt;codelab-adapter&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/install/"&gt;最新版本(0.6.2)&lt;/a&gt;内置了微信(wechat)插件。&lt;/p&gt;
&lt;p&gt;我们此前在&lt;a href="https://blog.just4fun.site/about-codelab-club.html"&gt;关于codelab.club&lt;/a&gt;里提到&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我们希望让创造成为一种运动、一种生活方式，我们喜欢约翰·杜威提倡的:&lt;/p&gt;
&lt;p&gt;Education as life.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;微信是国内用户量最大的社交软件，人们的人际网络多在其中。通过接入微信，我们希望能支持更广泛的创造, 让周围的人与事物激起创造者的创作热情。我们当然不会止步于微信，接下来将为海外用户接入 Telegram/Line。&lt;/p&gt;
&lt;p&gt;codelab试图践行《终身幼儿园》的理念，我们此前提到:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;弗兰西斯·培根在17世纪说: "知识就是力量"(Knowledge is power)。今天，应该没什么人会反对这句话了。但问题是我们如何有效获得这种力量呢?教科书式的知识罗列多半是枯燥无味的，我们努力去记忆，却收效甚微，当然，通过努力记忆和练习往往可以考得不错成绩，但你希望得到的是知识，而不是考试成绩，这两者的不同，杜威论述了很多。知识、逻辑和理性都不具有主动性。不排除一些人天生对微积分、形式系统和康德感兴趣，但更多的人，热情可能来自于帮助家人与朋友、恶作剧以及制作有趣的东西。codelab.club希望做的，便是与你一起去寻找热情所在，一旦找到那些让你热血沸腾之事，你便会开始对知识感兴趣，因为知识能帮你更好地实现目标，接下来你将愉快且高效地掌握所需的知识。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id="_1"&gt;一些有趣的场景&lt;/h1&gt;
&lt;h3 id="_2"&gt;说声晚安&lt;/h3&gt;
&lt;p&gt;codelab-adapter已经接入了主流的智能家居设备，在微信插件加持下，我们可以做到用微信控制家庭设备，睡前关灯再也不用喊天猫精灵，一喊睡意全没了，给自己的账号发条晚安就行:)&lt;/p&gt;
&lt;p&gt;下雪天不想起床关灯？ 读书困了不想起床关灯？ 我就是懒不想起床关灯？ 没关系的，懒惰是创造者的美德:) &lt;/p&gt;
&lt;p&gt;发一条晚安信息，房间与你一同进入睡眠模式。&lt;/p&gt;
&lt;h3 id="_3"&gt;芝麻开门&lt;/h3&gt;
&lt;p&gt;codelab-adapter正在接入智能门锁(深圳绿米公司赠与了我们智能门锁，希望一起探索这块的合作可能)。&lt;/p&gt;
&lt;p&gt;设想你组织了个party，每次有人按门铃都得去开门，是不是很烦躁？&lt;/p&gt;
&lt;p&gt;把参与者拉到一个微信群，他们一到门口，在群里吼一身&lt;code&gt;芝麻开门&lt;/code&gt;, 门即刻自动打开。 codelab-adapter一端连接微信，一端连接智能门锁。要做到这点，只需在Scratch中拖几块积木，将它们拼一起即可。 这便是我们期待的编程教育。&lt;/p&gt;
&lt;h3 id="_4"&gt;想你的夜&lt;/h3&gt;
&lt;p&gt;我们正在接入脑电波传感器。当你想念某个人的时候，脑电波传感器一旦捕获到你的情绪，立刻触发微信积木块，给心上人发送一条来自远方的惦念。&lt;/p&gt;
&lt;h1 id="_5"&gt;使用&lt;/h1&gt;
&lt;h3 id="codelab-adapter"&gt;运行codelab-adapter 微信插件&lt;/h3&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/wechat_extension_qr_957e2a99.png" width=400 &gt;&lt;/p&gt;
&lt;p&gt;用微信扫码即可登陆&lt;/p&gt;
&lt;h3 id="scratch30"&gt;在Scratch3.0中使用微信插件&lt;/h3&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/eextension-wechat_f232e4a1.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/wechat_extension_25bf1b48.png" /&gt;&lt;/p&gt;
&lt;h3 id="_6"&gt;群消息&lt;/h3&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/groupwechat_d7336886.png" /&gt;&lt;/p&gt;
&lt;h1 id="_7"&gt;演示&lt;/h1&gt;
&lt;p&gt;&lt;video width=600px src="http://scratch3-files.just4fun.site/wechat_extension.mp4" controls="controls"&gt;&lt;/video&gt;&lt;/p&gt;
&lt;h1 id="_8"&gt;开始创作&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.codelab.club/"&gt;codelab.club&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="_9"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/extension_guide/wechat/"&gt;extension 微信(wechat)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/about-codelab-club.html"&gt;关于codelab.club&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Fri, 15 Feb 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-02-15:adapter-wechat-extension.html</guid><category>codelab</category></item><item><title>codelab-adapter与应答模式</title><link>/codelab-adapter-req-rep.html</link><description>&lt;p&gt;从&lt;a href="https://codelab-adapter-docs.codelab.club/dev_guide/Architecture/"&gt;架构图&lt;/a&gt;中可以看出&lt;a href="https://codelab-adapter-docs.codelab.club"&gt;codelab-adapter&lt;/a&gt;中的消息是异步的，无论是websocket还是ZeroMQ pub/sub,都是异步的。&lt;/p&gt;
&lt;p&gt;有开发者希望codelab-adapter能支持应答模式: client(Scratch3.0/Blockly)发出request message，server回应reply message. 应答模式的逻辑由下图展现:&lt;/p&gt;
&lt;p&gt;&lt;img width=300 src="http://wwj-fig-bed.just4fun.site/req-rep_e2fd951a.png"&gt;&lt;/p&gt;
&lt;h1 id="_1"&gt;应答模式在积木块上的表现&lt;/h1&gt;
&lt;p&gt;使用应答模式的积木块，表现为运行的积木块，往codelab-adapter发出request message之后进入阻塞状态，直到codelab-adapter返回reply message，得到结果之后，才继续往下运行。&lt;/p&gt;
&lt;h1 id="_2"&gt;应答模式的应用场景&lt;/h1&gt;
&lt;p&gt;应答模式有很多应用场景，web开发者对http很熟悉，http便是典型的应答模式，想想你能用http做的事，便知道哪些事情适合用应答模式来做。&lt;/p&gt;
&lt;p&gt;接触过&lt;a href="http://www.ros.org/"&gt;ROS&lt;/a&gt;的开发者, 对异步消息和应答模式的使用场景应该很熟悉。&lt;a href="http://www.ros.org/"&gt;ROS&lt;/a&gt;的核心便是消息系统。&lt;/p&gt;
&lt;p&gt;我们举个具体例子，它来自codelab-adapter开发者的真实应用场景。 他需要一个&lt;code&gt;REPORTER&lt;/code&gt;类型的积木块，该积木块的功能是获取电位计的值。&lt;/p&gt;
&lt;p&gt;当然对于这个需求，我们可能会建议采用这种模式:源源不断发送电位计的值到scratch3.0中，诸如我们在&lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/extension_microbit.py"&gt;extension_microbit&lt;/a&gt;采用的策略。但对于一些传感器或固件(如&lt;a href="https://www.arduino.cc/en/reference/firmata"&gt;Firmata&lt;/a&gt;)，采用同步模式可能是更经济简易的做法。&lt;/p&gt;
&lt;h1 id="_3"&gt;基于异步消息实现&lt;/h1&gt;
&lt;p&gt;由于异步消息是codelab-adapter基础架构的一部分，所以我们准备采用异步消息来实现应答模式。&lt;/p&gt;
&lt;p&gt;我们写个简单的例子，来展示如何使用应答模式，积木块发出消息后，codelab-adapter的req-rep插件将消息反转，休眠1秒，再返回反转后的消息，以下是相应的源代码.&lt;/p&gt;
&lt;h3 id="scratch3_req_rep"&gt;scratch3_req_rep&lt;/h3&gt;
&lt;p&gt;Scratch3.0中的插件源码见: &lt;a href="https://github.com/Scratch3Lab/scratch3_req_rep"&gt;scratch3_req_rep&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;核心是利用promise。在消息层面，为每条消息添加messageID.&lt;/p&gt;
&lt;h3 id="extension_req_rep"&gt;extension_req_rep&lt;/h3&gt;
&lt;p&gt;codelab-adapter插件源码见: &lt;a href="https://github.com/Scratch3Lab/codelab_adapter_extensions/blob/master/extension_req_rep.py"&gt;extension_req_rep&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="_4"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/LLK/scratch-vm/blob/develop/src/util/jsonrpc.js"&gt;jsonrpc.js&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Thu, 07 Feb 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-02-07:codelab-adapter-req-rep.html</guid><category>codelab</category></item><item><title>codelab-adapter增加调试功能</title><link>/codelab-adapter-debug.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-debug_46c1c614.png" /&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Built By Developers, For Developers. &lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id="_1"&gt;前言&lt;/h1&gt;
&lt;p&gt;昨晚发布了&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/install/"&gt;codelab-adapter的第5个主版本&lt;/a&gt;，睡前洗澡的时候，一直在想什么是好的创造工具，如何找到那些设计原则。找到这些指导原则之后，如何将它用于增强手边这些服务于创造的项目: codelab-adapter/scratch/neverland.&lt;/p&gt;
&lt;p&gt;喜欢在洗澡的时候胡思乱想，水雾弥漫，精神自由。回想做过的所有重要决定，几乎都发生在洗澡的时刻。&lt;/p&gt;
&lt;p&gt;Paul Graham曾说，如果你洗澡时候没有想到你日常做的东西，说明你并不热爱它。&lt;/p&gt;
&lt;p&gt;"什么是好的创造工具"是个好问题吗？按&lt;a href="https://blog.just4fun.site/asking-the-right-question-is-more-important-than-getting-the-right-answer.html"&gt;提出正确的问题比得到正确答案更重要&lt;/a&gt;的看法，这问题有些大而无当，它能带着我前进吗？还是带着我兜圈？这问题困扰了我很久，我想换一个更清晰的、更易于处理的问题，却一直没找到。&lt;/p&gt;
&lt;p&gt;热衷于回答这个问题的人并不多，为它所扰的人似乎也不多，Bret Victor是其中最有名的一个。他提到的很多有价值的意见，诸如:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;创造者需要即时的反馈&lt;/p&gt;
&lt;p&gt;如果你无法即时看到东西，就无法找到你要的灵感&lt;/p&gt;
&lt;p&gt;你应该看到你做出的改变对系统的即时影响&lt;/p&gt;
&lt;p&gt;想法需要一个环境，创作者可以培育它们&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;对&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;而言，谁是创造者？Ta们用它做什么？目前所做的设计易用性如何？是否过度设计了？它要怎么生长？如何收集用户反馈？什么是好的改良建议？&lt;/p&gt;
&lt;p&gt;洗澡/散步和阅读的时候，似乎是我思维最发散的时候；写作和工作时，思维是聚焦的。所以我把问问题的时间一般都留在洗澡/散步和阅读上，提出问题，能否解答并不重要。洗澡/散步和阅读花了我大多数闲暇时间。&lt;/p&gt;
&lt;p&gt;在考虑“谁是创造者？”的时候，我顺便问了句，开发者是不是创造者？是的，他们为&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;构建插件，他们当时是需要被考虑的一类创造者。&lt;/p&gt;
&lt;p&gt;应该为他们做些什么？什么问题能引导我们找到开发者所需要的改进？&lt;/p&gt;
&lt;p&gt;引导我们的依然是Bret Victor的建议&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;think about what matters to you&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我自己就是很典型的插件开发者，我写了很多个插件。所以&lt;code&gt;what matters to you&lt;/code&gt;，&lt;/p&gt;
&lt;p&gt;增加调试工具！我厌倦了每次在console.log和tail info log(&lt;a href="https://codelab-adapter-docs.codelab.club/dev_guide/debug/"&gt;codelab-adapter-docs debug&lt;/a&gt;)中来回切换，只为搞懂系统中发生了什么。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;创造者需要即时的反馈&lt;/p&gt;
&lt;p&gt;如果你无法即时看到东西，就无法找到你要的灵感&lt;/p&gt;
&lt;p&gt;你应该看到你做出的改变对系统的即时影响&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我非常喜欢Bret Victor提出的上述几条指导原则。之前在&lt;a href="https://blog.just4fun.site/Hardware-Programming-style.html"&gt;两种硬件编程风格的比较&lt;/a&gt;中也提到类似的观点。&lt;/p&gt;
&lt;h1 id="_2"&gt;调试功能&lt;/h1&gt;
&lt;p&gt;想清楚了之后，今天一早，我就开始用代码实现实现我自己需要调试功能：让开发者能即时看到发生的事情。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;创造者需要即时的反馈&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;的开发者需要什么反馈呢？&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;的设计原则之一是&lt;code&gt;everything is message&lt;/code&gt;（EIM），所以让开发者看到所有的message就是很重要的事情。&lt;/p&gt;
&lt;p&gt;为了获得创造能力，理解系统当然是很重要的，通过展示所有消息，可以帮助开发者做到这点。但能够对系统施加影响以实现目标，也是至关重要的，所以调试工具要能支持开发者发送任何消息，于是我们给出最原始的message输入框，允许开发者发送任何消息，包括发送改变系统内部行为的消息。&lt;/p&gt;
&lt;p&gt;除此之外的其他的复杂性，应该屏蔽在工具之下，界面从简，尽可能符合直觉，不要增加认知负担和分散注意力。&lt;/p&gt;
&lt;p&gt;调试功能随着&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/install/"&gt;codelab-adapter v0.5.1&lt;/a&gt;一同发布。&lt;/p&gt;
&lt;p&gt;需要改进的地方，欢迎大家发邮件讨论。&lt;/p&gt;
&lt;h1 id="_3"&gt;使用&lt;/h1&gt;
&lt;p&gt;打开&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/install/"&gt;codelab-adapter v0.5.1&lt;/a&gt;， 点击&lt;code&gt;帮助&amp;gt;调试(Debug)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/scratch-debug_7027676a.png" width=300 /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-debug_46c1c614.png" /&gt;&lt;/p&gt;
&lt;h3 id="python-kernel"&gt;调试Python kernel&lt;/h3&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-python-debug_080d8630.png" /&gt;&lt;/p&gt;
&lt;h1 id="_4"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/dev_guide/debug/"&gt;codelab-adapter-docs debug&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Wed, 30 Jan 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-01-30:codelab-adapter-debug.html</guid><category>scratch</category></item><item><title>Scratch3.0与物理引擎</title><link>/scratch3-physics-engine.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-box2d_bf6c4630.png" /&gt;&lt;/p&gt;
&lt;h1 id="_1"&gt;前言&lt;/h1&gt;
&lt;p&gt;由于@griffpatch的出色工作, 我们可以在Scratch3.0中使用&lt;a href="https://box2d.org/"&gt;box2d&lt;/a&gt;作为物理引擎。 大家可以在&lt;a href="https://scratch3.codelab.club/"&gt;scratch3.codelab.club&lt;/a&gt;体验它，选择box2d插件即可。&lt;/p&gt;
&lt;p&gt;来看个演示:&lt;/p&gt;
&lt;video width=300 src="http://scratch3-files.just4fun.site/physics_leapmotion.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;这个演示结合了box2d插件和Leap Motion。&lt;/p&gt;
&lt;h1 id="_2"&gt;物理引擎&lt;/h1&gt;
&lt;p&gt;维基百科对&lt;a href="https://zh.wikipedia.org/wiki/%E7%89%A9%E7%90%86%E5%BC%95%E6%93%8E"&gt;物理引擎&lt;/a&gt;的解释非常清晰:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;物理引擎是一个计算机程序模拟牛顿力学模型，使用质量、速度、摩擦力和空气阻力等变量。可以用来预测这种不同情况下的效果。它主要用在计算物理学和电子游戏以及计算机动画当中。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;以大家熟悉的《塞尔达传说 旷野之息》为例，它拥有极高的自由度，物理引擎功不可没，这款游戏&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;添加了名为“化学引擎”（Chemistry Engine）的游戏机制，允许游戏中的物体相互影响和引发类似现实世界中的交互反应；例如林克可以使用火把点燃草丛，而风可以使火蔓延到更广的地方，燃烧的草丛产生的热空气能让林克使用滑翔翼飞起来。这种元素之间的叠加会让玩家在探索游戏世界时有更多的选择、可能性和自由度。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id="box2d"&gt;&lt;a href="https://box2d.org/"&gt;box2d&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Box2D是一款免费的开源二维物理引擎。&lt;/p&gt;
&lt;h1 id="scratch30"&gt;为Scratch3.0添加物理引擎的思路&lt;/h1&gt;
&lt;p&gt;如果把运动看作时间序列上的位置变化，那么为Scratch3.0添加物理引擎就不困难。并不需要hack底层的东西，通过runtime，我们可以set和get到target的舞台位置数据，于是就可以创建一个extension来负责计算这些数据的变化，从而赋予target物理属性。&lt;/p&gt;
&lt;h1 id="_3"&gt;后话&lt;/h1&gt;
&lt;p&gt;从Scratch的这个用例中，我们可以看到这个Scratch强大的可扩展性。&lt;/p&gt;
&lt;h1 id="_4"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/wiki/%E7%89%A9%E7%90%86%E5%BC%95%E6%93%8E"&gt;物理引擎&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/zh-hans/Box2D"&gt;Box2D&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/zh-hans/%E5%A1%9E%E5%B0%94%E8%BE%BE%E4%BC%A0%E8%AF%B4_%E6%97%B7%E9%87%8E%E4%B9%8B%E6%81%AF"&gt;塞尔达传说 旷野之息&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://box2d.org/"&gt;box2d&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/kripken/box2d.js/"&gt;box2d.js&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Wed, 30 Jan 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-01-30:scratch3-physics-engine.html</guid><category>scratch</category></item><item><title>scratch3-adapter将支持在web页面启停插件</title><link>/scratch3-adapter-web-extension-control.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-web-control_61989166.png" /&gt;&lt;/p&gt;
&lt;p&gt;假期前，我们将推出&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;的第5个主要版本:&lt;code&gt;v0.5.0&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;届时它将改名为codelab-adapter(CodeLab Adapter). 改名的原因，我们在&lt;a href="https://blog.just4fun.site/Scratch3-adapter-with-blockly.html"&gt;scratch3-adapter ❤️ blockly&lt;/a&gt;有提到，Scratch3.0只是它的client之一，并不具有特殊性。codelab-adapter可以用于任何web平台。事实上也可以与任何编程语言对接。&lt;/p&gt;
&lt;p&gt;下文中(以及此后)，我们将称其为codelab-adapter。&lt;/p&gt;
&lt;h1 id="_1"&gt;前端启停插件&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;前端启停插件&lt;/code&gt;是&lt;a href="https://www.codelab.club/"&gt;codelab.club&lt;/a&gt;的合作者十分关心的特性。codelab-adapter支持&lt;code&gt;前端启停插件&lt;/code&gt;之后，易用性将得到提高。使用体验与Scratch Link十分相似。用户打开软件之后，就可以无视它，专心在web界面中编程。codelab-adapter将安静地在幕后运行，将积木编程平台接入任何开源硬件/AI/IoT中。学习者不必在积木编程界面与codelab-adapter中来回切换。对于入门用户，这将减少他们的困惑和学习成本。&lt;/p&gt;
&lt;video width=800  src="http://scratch3-files.just4fun.site/web_extension_control.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;从演示视频中可以看到，用户无需对codelab-adapter做任何操作。&lt;/p&gt;
&lt;p&gt;另外有趣的一点是，插件的启停本身也是普通积木，它们也是可编程的！这点比Scratch Link更为灵活。&lt;/p&gt;
&lt;p&gt;如果你更喜欢Scratch官方采用前端UI启停插件的方式，而不是用积木来启停插件，当然也是没问题的，你可以自己构建控制插件的UI。我们都支持。&lt;/p&gt;
&lt;h1 id="_2"&gt;扯扯其他的&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;v0.5.0&lt;/code&gt;是近期的第二次大规模重构。利用消息机制已经成功构建出了插件管理积木！(everything is message)。adapter 现在是这种东西: 它同时拥有tk和scratch3两个图形界面(并行)，我们正在使用Smalltalk为它构建新的UI; ZeroMQ作为通信介质(ZeroMQ一直试图进入Linux内核，替代socket);Python作为实现语言;允许用户添加自定义硬件驱动(四轴飞行器、眼动仪、脑电波传感器)，我们可能在做一个新的操作系统😄，等MicroPython社区移植完ZeroMQ，我们就将codelab-adapter移植到MicroPython板子上，不必再运行在linux之上，届时就是名正言顺的操作系统了。&lt;/p&gt;
&lt;p&gt;再来看一个演示视频.&lt;/p&gt;
&lt;video width=600 src="http://scratch3-files.just4fun.site/web-control-vector.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;演示视频中，adapter 完全成为后台服务，用户不需要对它做任何操作，所做的一切都在网页(UI)中。&lt;/p&gt;
&lt;p&gt;我们受&lt;a href="http://worrydream.com/"&gt;Bret Victor&lt;/a&gt;、&lt;a href="https://zh.wikipedia.org/zh-hans/%E8%89%BE%E4%BC%A6%C2%B7%E5%87%AF"&gt;艾伦·凯&lt;/a&gt;、&lt;a href="https://zh.wikipedia.org/zh-hans/Smalltalk"&gt;Smalltalk&lt;/a&gt;和realtalk的影响很深&lt;/p&gt;
&lt;p&gt;&lt;a href="https://zh.wikipedia.org/zh-hans/Smalltalk"&gt;Smalltalk&lt;/a&gt;和realtalk对我们的第一个影响是，把积木看作承载了所有功能的message。这样一来内核里不需要存在功能代码，积木的组合就是系统本身，它是动态的，任何创造都将可能，用户在这种界面里得到了所有的表达能力。&lt;/p&gt;
&lt;p&gt;第二个影响是将系统功能(驱动管理)本身也看作消息，这就是0.5.0采用的设计。&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;2019.1.29更新&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;已发布: &lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/install/"&gt;codelab-adapter v0.5.0&lt;/a&gt;&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Mon, 28 Jan 2019 17:30:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-01-28:scratch3-adapter-web-extension-control.html</guid><category>tools</category></item><item><title>Scratch增强计划</title><link>/Enhance-Scratch3.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/create_2767ae26.png" /&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;There are many ways to live your life. That's may be the most important thing you can realize in your life is that every aspect of your life is a choice...&lt;br /&gt;
You can choose to accept the world as it is but you don't have to.&lt;br /&gt;
If there is something in the world you feel the wrong and you have a vision for what a better world could be, you can find your guiding principle and you can fight for a cause.&lt;br /&gt;
So after the talk I'd like you to take a little time and think about what matters to you？what you believe in？ what you might fight for？ -- Bret Victor《Inventing on Principle》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id="_1"&gt;前言&lt;/h1&gt;
&lt;p&gt;上周六，我一直在看&lt;a href="http://worrydream.com/"&gt;Bret Victor&lt;/a&gt;的博客，他的工作给我极大的震撼，几乎是叹为观止。&lt;/p&gt;
&lt;p&gt;看了他的演讲和文章，夜里和朋友聊了很久，他让我们觉得自己生活在原始时代，刀耕火种，难以忍受。周日下午走街串巷，漫无目的的徒步，一直在想&lt;a href="http://worrydream.com/"&gt;Bret Victor&lt;/a&gt;说的一些东西，下午的阳光很好，走在广州的老街道，树木盈抱，墙面斑驳，傍晚时候，一切看起来都像90年代，从&lt;a href="http://worrydream.com/"&gt;Bret Victor&lt;/a&gt;的演讲回到现实，好像穿越到了过去，周围的一切都显得那么原始。&lt;/p&gt;
&lt;p&gt;关于什么是好的编程环境，什么是好的创造工具，我从前对此一无所知，觉得目前手头的工具基本够用。&lt;a href="http://worrydream.com/"&gt;Bret Victor&lt;/a&gt;使我相信，我完全不懂编程是什么。&lt;/p&gt;
&lt;h1 id="smalltalk"&gt;Smalltalk&lt;/h1&gt;
&lt;p&gt;一直没有痛下决心将&lt;a href="https://zh.wikipedia.org/zh-hans/Smalltalk"&gt;Smalltalk&lt;/a&gt;作为我的主要语言。此前玩了段时间&lt;a href="https://zh.wikipedia.org/zh-hans/Squeak"&gt;squeak&lt;/a&gt;(Smalltalk的一个方言)，在上边很轻松写出了scratch的原型，&lt;a href="https://github.com/LLK/Scratch_1.4"&gt;scratch的第一代&lt;/a&gt;就是用&lt;a href="https://zh.wikipedia.org/zh-hans/Squeak"&gt;squeak&lt;/a&gt;写的，scratch与创造有关的核心设计似乎都来自&lt;a href="https://zh.wikipedia.org/zh-hans/Squeak"&gt;squeak&lt;/a&gt;。正如scratch之父所言scratch的主要创造是社区。这是很中肯的描述。&lt;/p&gt;
&lt;p&gt;之后又玩了段时间&lt;a href="https://en.wikipedia.org/wiki/Etoys_(programming_language)"&gt;Etoys&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;最近有一搭没一搭地使用&lt;a href="https://pharo.org/"&gt;Pharo&lt;/a&gt; ，&lt;a href="https://pharo.org/"&gt;Pharo&lt;/a&gt;是现代Smalltalk方言。&lt;/p&gt;
&lt;p&gt;&lt;a href="http://worrydream.com/"&gt;Bret Victor&lt;/a&gt;给了我最后一根稻草，让我确信切换到&lt;a href="https://zh.wikipedia.org/zh-hans/Smalltalk"&gt;Smalltalk&lt;/a&gt;是极为重要的一件事，它是绝佳的创造工具。&lt;/p&gt;
&lt;h1 id="new-scratch30-virtual-machine"&gt;New Scratch3.0 Virtual Machine&lt;/h1&gt;
&lt;p&gt;我准备在&lt;a href="https://pharo.org/"&gt;Pharo&lt;/a&gt;中实现Scratch3.0 Virtual Machine，把scratch重新带回Smalltalk。它既作为我驱动自己学习&lt;a href="https://pharo.org/"&gt;Pharo&lt;/a&gt;的项目，又作为探索scratch未来可能性的尝试。尽管最终可能实现出JavaScript版本(考虑到对用户友好)，但正如&lt;a href="http://worrydream.com/"&gt;Bret Victor&lt;/a&gt;所言，JavaScript和processing都不是好的语言，它并不适合用于探索。今天有许多公司，用JavaScript(Blockly)去重新抄一遍scratch，除了换一个UI，源代码更为草率，扩展性更糟之外，在编程和创造性这件事上，几乎没有任何改进（事实上基本都是倒退）。有那么多有意思的事情值得做，换一个皮肤的事，竟吸引了那么多公司动则千万的投入。&lt;/p&gt;
&lt;p&gt;一旦在&lt;a href="https://pharo.org/"&gt;Pharo&lt;/a&gt;中实现了Scratch的解释器，我们就可以轻松使用&lt;a href="http://worrydream.com/"&gt;Bret Victor&lt;/a&gt;的创造原则去增强它。&lt;/p&gt;
&lt;p&gt;我希望让新的vm(Virtual Machine)能够解释运行sb3文件。sb3文件结构的设计是很优秀的,我在&lt;a href="https://blog.just4fun.site/Scratch3_project_json_analysis_6.html"&gt;Scratch3技术分析之项目内部数据(第6篇）&lt;/a&gt;做了阐述。&lt;/p&gt;
&lt;h1 id="_2"&gt;副产品&lt;/h1&gt;
&lt;p&gt;在实现这个目标的途中可能会顺便得到一些有趣的副产品，有些可能是目前Scratch3.0的用户和开发者所关心的，我大致列一些，目前能想到的一些有趣副产品包括:&lt;/p&gt;
&lt;h3 id="1scratch"&gt;1.将scratch项目导出为本地应用&lt;/h3&gt;
&lt;p&gt;scratch社区的用户似乎一直有一个需求: 将scratch项目导出为本地应用(exe/app). 要做到这点，按目前scratch3.0的架构也能做到，诸如直接导出一个electron应用，不过这实在有点笨重。&lt;/p&gt;
&lt;p&gt;新的解释器接受sb3文件作为输入，然后解释运行它，所以我们可以做得非常精简。&lt;/p&gt;
&lt;h3 id="2scratch30"&gt;2.离线运行scratch3.0项目&lt;/h3&gt;
&lt;p&gt;Scratch3.0目前运行在浏览器中，总是需要GUI支持，如果导出的程序并不是视觉动画，例如程序用来将家庭自动化(我在&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/gallery/"&gt;这里展示了很多例子&lt;/a&gt;)，我们能否让它离线运行，不用总开着浏览器，让它跑在云端，或跑在没有屏幕的树莓派上。&lt;/p&gt;
&lt;h3 id="3computational-thinking"&gt;3.评估用户的计算思维(computational thinking)&lt;/h3&gt;
&lt;p&gt;做新的解释器过程中，我们需要深入到scratch程序的所有细节里，这就逼着我们做出类似静态分析器的东西，我们自然会理解用户用到的所有程序元素，我们可以据此评估他在程序中展现的计算思维(computational thinking)。评估的教育框架会采用Scratch之父(Mitchel Resnick)早年的论文。&lt;/p&gt;
&lt;h3 id="4sb3"&gt;4.一些通用的sb3文件处理工具&lt;/h3&gt;
&lt;p&gt;由于需要解析sb3文件，所以会顺手打造一些通用的小工具。&lt;/p&gt;
&lt;p&gt;今天就简单写了一个脚本, 允许用户解压sb3文件，本地编辑之后，再重新生成sb3，之后在scratch3.0编辑器中依然能加载它. 这有什么用呢？还挺有用的，比如说我目前的一个用例: 之前保存的一些sb3项目在新的scratch3.0编辑器中打不开了(可能是新的平台不存在旧的extension)，我通过移除sb3中对应的extension block就可以重新加载项目。&lt;/p&gt;
&lt;p&gt;脚本源码和使用方法在这里:&lt;a href="https://gist.github.com/wwj718/cd2447e68409a0f36141f4d1d7698fd9"&gt;sb3_compress.py&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="codelab-adapter"&gt;关于&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;新的虚拟机依然能够与&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;通信，我目前计划采用ZeroMQ来实现。事实上&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;会采用越来越多&lt;a href="http://worrydream.com/"&gt;Bret Victor&lt;/a&gt;建议的设计原则。&lt;/p&gt;
&lt;h1 id="_3"&gt;进展与笔记&lt;/h1&gt;
&lt;p&gt;近期，我刚开始着手做这件事，&lt;a href="https://blog.just4fun.site/Scratch3_project_json_analysis_6.html"&gt;对项目数据的分析&lt;/a&gt;已经完成了。将项目保存为本地文件(sb3)由&lt;a href="https://github.com/LLK/scratch-vm/blob/98b92be2d74ba868d876feaf00a02ceb11dbf311/src/virtual-machine.js#L356"&gt;以下代码&lt;/a&gt;驱动:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="cm"&gt;/**&lt;/span&gt;
&lt;span class="cm"&gt;     * @returns {string} Project in a Scratch 3.0 JSON representation.&lt;/span&gt;
&lt;span class="cm"&gt;     */&lt;/span&gt;
    &lt;span class="nx"&gt;saveProjectSb3&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;soundDescs&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;serializeSounds&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;runtime&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;costumeDescs&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;serializeCostumes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;runtime&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;projectJson&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;toJSON&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;

        &lt;span class="c1"&gt;// TODO want to eventually move zip creation out of here, and perhaps&lt;/span&gt;
        &lt;span class="c1"&gt;// into scratch-storage&lt;/span&gt;
        &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;zip&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;JSZip&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;

        &lt;span class="c1"&gt;// Put everything in a zip file&lt;/span&gt;
        &lt;span class="nx"&gt;zip&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;file&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;project.json&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;projectJson&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_addFileDescsToZip&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;soundDescs&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;concat&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;costumeDescs&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="nx"&gt;zip&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;zip&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;generateAsync&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
            &lt;span class="nx"&gt;type&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;blob&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="nx"&gt;compression&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;DEFLATE&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="nx"&gt;compressionOptions&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                &lt;span class="nx"&gt;level&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt; &lt;span class="c1"&gt;// Tradeoff between best speed (1) and best compression (9)&lt;/span&gt;
            &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="p"&gt;});&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="nx"&gt;_addFileDescsToZip&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;fileDescs&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;zip&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;let&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="nx"&gt;fileDescs&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;currFileDesc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;fileDescs&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
            &lt;span class="nx"&gt;zip&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;file&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;currFileDesc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;fileName&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;currFileDesc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;fileContent&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;由此可以看出项目的数据是扁平的。这个分析帮助我们构建了小工具:&lt;a href="https://gist.github.com/wwj718/cd2447e68409a0f36141f4d1d7698fd9"&gt;sb3_compress.py&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;春节假期将近，在假期里与家人朋友小聚之余，如果能抽出时间，我就到阳台晒晒太阳，熟悉熟悉&lt;a href="https://pharo.org/"&gt;Pharo&lt;/a&gt;，并顺手构建早期的原型。&lt;/p&gt;
&lt;h1 id="_4"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://worrydream.com/"&gt;Bret Victor&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Mon, 28 Jan 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-01-28:Enhance-Scratch3.html</guid><category>scratch</category></item><item><title>scratch3-adapter ❤️ blockly</title><link>/Scratch3-adapter-with-blockly.html</link><description>&lt;p&gt;本文将介绍如何通过&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;将&lt;a href="https://github.com/google/blockly"&gt;blockly&lt;/a&gt;应用接入到开源硬件/AI/IoT中。&lt;/p&gt;
&lt;p&gt;有大量的编程教育平台是基于blockly构建的，如&lt;a href="https://code.org/"&gt;code.org&lt;/a&gt;、&lt;a href="https://www.tynker.com/"&gt;Tynker&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;通过&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;，可以赋予他们与万物连接的能力。&lt;/p&gt;
&lt;h1 id="_1"&gt;思路&lt;/h1&gt;
&lt;p&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;这个名字有误导性，我们近期准备将其更名为codelab-adapter. 更名之前暂时还是叫它&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;可以用于任何web平台，远不限于Scratch3.0，Scratch3.0只是它的一个典型client，任何前端都可以是它的client，通过架构图我们容易看清这一点:&lt;/p&gt;
&lt;p&gt;&lt;img alt="架构图" src="http://wwj-tmp-video2.just4fun.site/%E6%8F%92%E4%BB%B6%E7%B3%BB%E7%BB%9F.png" /&gt;&lt;/p&gt;
&lt;p&gt;将blockly应用接入&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;是非常简单的，在每个积木运行的时候，触发对应的JavaScript函数，函数中发送相应消息(everything is message)即可。这个模式和Scratch3.0极为相似。&lt;/p&gt;
&lt;h1 id="demo"&gt;demo&lt;/h1&gt;
&lt;p&gt;我们来看一个具体的demo。&lt;/p&gt;
&lt;p&gt;我已经将源代码放到了Github:&lt;a href="https://github.com/wwj718/blockly_dev/tree/master/src/scratch3-adapter-4-blockly"&gt;scratch3-adapter-4-blockly&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;运行该项目的教程，我也放在链接里了，操作过程中有任何疑惑，欢迎提issue :)&lt;/p&gt;
&lt;p&gt;该项目展示了一个最小原型，&lt;a href="https://github.com/Scratch3Lab/scratch3_eim"&gt;scratch3_eim&lt;/a&gt;展示了与&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;交互更为完整的通信例子。scratch3.0也是基于blockly构建，所以例子中的原理完全可以迁移到blockly中。&lt;/p&gt;
&lt;p&gt;当然，由于一切都是消息，你可以在任何web平台使用它：）&lt;/p&gt;
&lt;h1 id="_2"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/scratch3_adapter-blockly.html"&gt;使用scratch3_adapter连接blockly与硬件&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/wwj718/blockly_dev/tree/master/src/scratch3-adapter-4-blockly"&gt;scratch3-adapter-4-blockly&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Mon, 28 Jan 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-01-28:Scratch3-adapter-with-blockly.html</guid><category>scratch</category></item><item><title>Arduino与Scratch3.0</title><link>/Scratch3-adapter-Arduino-scratch.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch3-ardoino_571b6e49.png" /&gt;&lt;/p&gt;
&lt;p&gt;陆续有开发者问到，如何使用&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;将Arduino接入到Scratch3.0中?&lt;/p&gt;
&lt;h1 id="_1"&gt;思路&lt;/h1&gt;
&lt;p&gt;有许多种方法能做到这点，但我比较偏好在arduino中烧入Firmata固件。之后与固件交互，我在&lt;a href="https://blog.just4fun.site/Hardware-Programming-style.html"&gt;两种硬件编程风格的比较&lt;/a&gt;论述了这样做的好处。&lt;/p&gt;
&lt;p&gt;之后使用Firmata python client与Arduino交互。&lt;/p&gt;
&lt;p&gt;推荐的Firmata python client有:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/tino/pyFirmata"&gt;pyFirmata&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/MrYsLab/PyMata"&gt;PyMata&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/MrYsLab/pymata-aio"&gt;pymata-aio&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如何设计出合理的积木是个非常有趣的话题，它本质上是个设计工作，而不是技术工作。我推荐采用"单一入口原则"（来自realtalk的建议）。这个原则对于构建创造性工具极有帮助。 在本文中展示如何使用这个原则来将Arduino接入到Scratch3.0。&lt;/p&gt;
&lt;p&gt;我对Firmata并不熟悉，所以后文里，直接使用&lt;a href="https://github.com/pyserial/pyserial"&gt;pyserial&lt;/a&gt;与arduino通信。Firmata python client包转了pyserial。&lt;/p&gt;
&lt;h1 id="_2"&gt;技术视角&lt;/h1&gt;
&lt;p&gt;让我们切换到技术视角，看看按照上边的思路，我们具体要做些什么。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;在Scratch3.0中创建Arduino extension&lt;/li&gt;
&lt;li&gt;在&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;中构建extension_arduino&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;如果你没有在Scratch3.0中创建过插件，请先阅读&lt;a href="https://blog.just4fun.site/create-first-Scratch3-Extension.html"&gt;创建你的第一个Scratch3.0 Extension&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;本文准备采用"单一入口原则"，所以Scratch3.0中的Arduino extension与&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;之间将直接传递Python代码，语义的传递过程为:&lt;code&gt;积木&lt;/code&gt;-&amp;gt;&lt;code&gt;Python代码&lt;/code&gt;, 之后由extension_arduino负责运行代码。&lt;/p&gt;
&lt;h3 id="scratch30arduino-extension"&gt;在Scratch3.0中创建Arduino extension&lt;/h3&gt;
&lt;p&gt;我目前只构建了一个控制led的积木，作为演示，添加更多积木，依葫芦画瓢便可。&lt;/p&gt;
&lt;p&gt;源码在&lt;a href="https://github.com/Scratch3Lab/scratch3_arduino"&gt;scratch3_arduino&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="codelab-adapterextension_arduino"&gt;在&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;中构建extension_arduino&lt;/h3&gt;
&lt;p&gt;源码见&lt;a href="https://github.com/Scratch3Lab/scratch3_adapter_extensions/blob/master/extension_arduino.py"&gt;extension_arduino.py&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;与Arduino的连接，我只写了在Ubuntu下如何建立，如果你希望在windows下使用它，需要修改一下代码，去发现你的arduino设备。&lt;/p&gt;
&lt;h3 id="_3"&gt;演示&lt;/h3&gt;
&lt;p&gt;&lt;video width=600px src="http://scratch3-files.just4fun.site/arduino.mp4" controls="controls"&gt;&lt;/video&gt;&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Wed, 23 Jan 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-01-23:Scratch3-adapter-Arduino-scratch.html</guid><category>scratch</category></item><item><title>[译]提出正确的问题比得到正确答案更重要</title><link>/asking-the-right-question-is-more-important-than-getting-the-right-answer.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/question_7b050616.png" /&gt;&lt;/p&gt;
&lt;p&gt;原文: &lt;a href="https://lemire.me/blog/2018/12/06/asking-the-right-question-is-more-important-than-getting-the-right-answer/"&gt;Asking the right question is more important than getting the right answer&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;原文以&lt;a href="https://creativecommons.org/licenses/by/3.0/"&gt;Creative Commons license&lt;/a&gt;发布。&lt;/p&gt;
&lt;p&gt;科技和教育是我同时关注的方向，除了翻译技术相关的文章，也会陆续翻译教育相关的文章。&lt;/p&gt;
&lt;h1 id="_1"&gt;译文&lt;/h1&gt;
&lt;p&gt;学校训练我们为预先定义的问题找出正确的答案。然而，任何有现实世界经验的人都知道，困难的部分往往在于如何找到正确的问题。&lt;/p&gt;
&lt;p&gt;要做出出色的贡献，你需要先提出正确的问题。我会更进一步：你问的问题可能会定义你是谁。&lt;/p&gt;
&lt;p&gt;什么是好问题？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;伟大的问题是易于处理和卓有成效的。他们带领你走上发现之路。提出如何治愈癌症这个问题是容易的，但这不是一个好问题，因为它无助于任何人进行医学研究。&lt;/li&gt;
&lt;li&gt;隐秘的问题是最好的：如果你是唯一一个知道这个问题的人，那么你可能就找到了一座金矿。每个人都有的问题在比例上毫无价值。（例如，参见Peter Thiel的&lt;a href="http://a-fwd.com/asin-com=0804139296&amp;amp;com=daniellemires-20&amp;amp;ca=danilemisblog-20&amp;amp;uk=danilemisblog-21&amp;amp;de=danilemisbl05-21&amp;amp;fr=danilemisbl0e-21&amp;amp;it=danilemisbl02-21&amp;amp;jp=danilemisblog-22&amp;amp;cn=danilemisblog-23&amp;amp;fb=com&amp;amp;sc=w"&gt;Zero to One&lt;/a&gt;）。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;你可能会认为通过努力学习，通过学习所有的答案，你会更好地提出很多问题。我不确定它是否有效。&lt;/p&gt;
&lt;p&gt;事实上，了解太多会伤害你。我偏好带有新鲜问题的B学生作为博士生，而不是带一个过度训练的担心一切都是正确的A+学生。有一个糟糕的秘密: 一些最优秀的研究人员和创新者都是普通学生。&lt;/p&gt;
&lt;p&gt;做以下实验。选择一个学术领域，任何领域都行，然后花两个星期阅读你可能读到的有关它的一切。接下来，写下5个问题。我几乎可以向你保证，你阅读的资料已经涵盖了这5个问题。它们将是“已知”的问题。&lt;/p&gt;
&lt;p&gt;因此，要找到好的问题，你必须与材料保持一定距离。如果你认为我将“好问题”定义为“秘密”或“高度原创”的问题，这应该是没有争议的。&lt;/p&gt;
&lt;p&gt;我们的思维倾向于根据我们学到的模式来构建一切。花两年时间学习马克思主义，每一个问题对你来说都会成为马克思主义的问题。你很难在框架之外提出新的问题。&lt;/p&gt;
&lt;p&gt;不要误会我的意思：聪明的人往往更有创造力，其他一切都是平等的......但是，在知识渊博和被锁在思维的框架里之间存在差异。&lt;/p&gt;
&lt;p&gt;然而，这里有多少研究人员在工作。他们调查了他们所在领域上一次重大会议或期刊的最佳论文。重要的是，他们确保阅读每个人正在阅读的内容，并确保让他们成为最优秀人才的思维框架。他们确保他们可以重复最流行的问题和答案。他们看文件，寻找漏洞或改进的可能性， 并从那里开始工作。这确保了少数领导者（写下真正的新颖观点的人），然后是一长串而且无穷无尽的“我也是”的论文，这些论文提供了微小而无关紧要的差异。&lt;/p&gt;
&lt;p&gt;回顾历史，你就更容易判断这些事情。在计算机科学中，我们在世纪之交就拥有了XML热潮。每年在每个顶级数据库会议上都会出现数十篇XML论文。&lt;a href="https://lemire.me/blog/2013/01/14/xml-for-databases-a-dead-idea/"&gt;我写了关于这个想法的死亡的不为人知的故事&lt;/a&gt;。怎么会有这么多人同时为一个死胡同而变得如此兴奋呢？&lt;/p&gt;
&lt;p&gt;我相信人们很乐意分发问题，并且经常会急于提供高度复杂而艰深的答案......无论问题是否正确。&lt;/p&gt;
&lt;p&gt;我的主张是领袖并不是天生的聪明，知识渊博或拥有创造性。那些回答别人问题的人也并不愚蠢或缺乏想象力。他们之间主要区别在于: 你要么专注于提出好的问题，要么专注于提供好的答案。&lt;/p&gt;
&lt;p&gt;如果有更多的人提出更好的问题，世界会更好。&lt;/p&gt;
&lt;p&gt;我们怎么能问更好的问题呢？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;注意周围的事物并改变你的世界观(看待世界的方式)。弗莱明(Fleming)是如何发现青霉素的？他注意到一些侵入他肮脏的实验室的霉菌似乎会杀死细菌。他当时问了正确的问题。&lt;/li&gt;
&lt;li&gt;耐心点。据报道，爱因斯坦曾经说过，“并不是我多聪明，只不过是因为我在问题里待了更久。” 你在一个问题上花的时间越长，就越有可能找到有趣的问题。（参见&lt;a href="https://onlinelibrary.wiley.com/doi/abs/10.1002/jocb.350"&gt;Forthmann et al. 2018&lt;/a&gt;）错过这些重要问题的最简单方法是将它们视为无趣的并且继续过快前进。&lt;/li&gt;
&lt;li&gt;保持身体活跃，去散步。将自己束缚在桌子上可能会适得其反。我曾经认为，作为一个全力以赴的知识分子是最好的路线，但我现在相信我是非常错误的。我平日几乎每天早上都在外面散步。（见&lt;a href="http://psycnet.apa.org/buy/2014-14435-001"&gt;Oppezzo and Schwartz，2014&lt;/a&gt;）。&lt;/li&gt;
&lt;li&gt;不要太社交。对顺从的社会压力会引发强烈的本能反应。对抗牛群是艰难的。因此，你最好不要过多地了解牛群的位置。具体而言，花几天独处。 &lt;a href="https://www.pnas.org/content/pnas/115/35/8734.full.pdf"&gt;Bernstein et al.&lt;/a&gt;（2018）建议间歇性的社交互动，而不是持续的互动，以避免个人探索的减少。&lt;/li&gt;
&lt;li&gt;多问问题。如果你想善于提供正确的答案，训练自己多回答问题。如果你想善于提问，那就多问问题。&lt;/li&gt;
&lt;li&gt;总是质疑自己的想法和工作。&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;在提出正确的问题前，科学的头脑并不知道正确的答案 -- Levi-Strauss&lt;/p&gt;
&lt;/blockquote&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Wed, 23 Jan 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-01-23:asking-the-right-question-is-more-important-than-getting-the-right-answer.html</guid><category>edu</category></item><item><title>蓝牙设备与Scratch3.0</title><link>/bluetooth-device-scratch3.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-bt_911afda4.png" /&gt;&lt;/p&gt;
&lt;h1 id="_1"&gt;前言&lt;/h1&gt;
&lt;p&gt;本文的目标是帮助开发者将任意的蓝牙设备接入Scratch3.0，当然前提是你了解该设备的蓝牙协议细节。如果它没有开放协议，你又想接入，需要做些破解工作，这块当然也非常有趣，但不是本文关注的话题，有兴趣的话可以读我之前关于BLE的文章, Bleah是个非常好的攻击工具，值得了解:)&lt;/p&gt;
&lt;h1 id="_2"&gt;蓝牙&lt;/h1&gt;
&lt;p&gt;我们讨论两类蓝牙设备:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;传统蓝牙(2.0) &lt;/li&gt;
&lt;li&gt;低功耗蓝牙(4.0/5.0)&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="20"&gt;传统蓝牙(2.0)&lt;/h1&gt;
&lt;p&gt;对于传统蓝牙，一般使用串口与之通信，连接之后，当作普通串口使用即可。&lt;/p&gt;
&lt;p&gt;希望将传统蓝牙设备接入Scratch3.0，推荐使用&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;。&lt;/p&gt;
&lt;h3 id="_3"&gt;例子&lt;/h3&gt;
&lt;p&gt;我们此前使用&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;将优必选 Alpha系列机器人接入到Scratch3.0中，源码已经开放:&lt;a href="https://github.com/Scratch3Lab/scratch3_adapter_extensions/blob/master/extension_ubtrobot.py"&gt;extension_ubtrobot&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;同时支持Windows/MacOS/Linux，Windows支持windows7/windows8/windows10.&lt;/p&gt;
&lt;p&gt;如果大家需要将传统蓝牙(2.0)设备接入Scratch3.0，可以参考这个例子。&lt;/p&gt;
&lt;h1 id="4050"&gt;低功耗蓝牙(4.0/5.0)&lt;/h1&gt;
&lt;p&gt;我个人非常偏好低功耗蓝牙(BLE)设备，我相信它是教器的未来，席卷而来的bluetooth5.0更是为物联网带来了许多令人振奋的特性。&lt;/p&gt;
&lt;p&gt;micro:bit便支持蓝牙4.0, 树莓派3也支持。新设备的蓝牙几乎都是4.0以上了。&lt;/p&gt;
&lt;p&gt;将BLE设备接入Scratch3.0，目前的最佳方式是采用官方的&lt;a href="https://scratch.mit.edu/microbit"&gt;Scratch Link&lt;/a&gt;。&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;在未来也可能支持BLE设备(通过一个通用的插件来实现这些)，但我们希望等到系统对BLE的支持更好之后来做。&lt;/p&gt;
&lt;p&gt;Scratch Link对系统环境要求比较严苛，需要Windows10的某个版本以上，对MacOS的版本也有要求，这不能怪Scratch Link，当前操作系统对BLE的支持程度参差不齐，只能等时间淘汰旧系统。BLE是未来，我相信是很清晰的。&lt;/p&gt;
&lt;p&gt;我们假设&lt;a href="https://scratch.mit.edu/microbit"&gt;Scratch Link&lt;/a&gt;运行正常，那么要如何通过&lt;a href="https://scratch.mit.edu/microbit"&gt;Scratch Link&lt;/a&gt;将BLE设备接入Scratch3.0呢，这块已经有很多例子了:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/LLK/scratch-vm/blob/develop/src/extensions/scratch3_microbit/index.js"&gt;scratch3_microbit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/LLK/scratch-vm/blob/develop/src/extensions/scratch3_wedo2/index.js"&gt;scratch3_wedo2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/LLK/scratch-vm/blob/develop/src/extensions/scratch3_gdx_for/index.js"&gt;scratch3_gdx_for&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;原理上，你可以把&lt;a href="https://scratch.mit.edu/microbit"&gt;Scratch Link&lt;/a&gt;看作Scratch3.0与BLE设备通信的透明代理。&lt;/p&gt;
&lt;p&gt;如果你对通信的细节和原理有更多兴趣，可以参考我之前对micro:bit与Scratch3.0通信细节的分析:&lt;a href="https://blog.just4fun.site/scratch3-microbit-analysis.html"&gt;分析scratch3.0与micro:bit的通信&lt;/a&gt;, 理解这些细节后，你就可以做任何改造了。&lt;/p&gt;
&lt;h1 id="_4"&gt;我的建议&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;推荐使用NRF的调试工具。&lt;/li&gt;
&lt;li&gt;推荐使用UART Service(micro:bit就是这样做的)&lt;/li&gt;
&lt;/ol&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Tue, 22 Jan 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-01-22:bluetooth-device-scratch3.html</guid><category>scratch</category></item><item><title>scratch3-adapter支持第三方平台</title><link>/scratch3-adapter-open-plan.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch3-adapter-eim_3f5fd3d8.png" /&gt;&lt;/p&gt;
&lt;h1 id="_1"&gt;开放连接&lt;/h1&gt;
&lt;p&gt;我们在上周发布了&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;的0.4.0版本， 在这个版本中，我们做了大量重构，采用了许多realtalk的架构思路。&lt;/p&gt;
&lt;p&gt;从这个版本开始，我们将允许&lt;a href="https://www.codelab.club/"&gt;codelab.club&lt;/a&gt;的合作方将&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;接入到自己的平台。从而让平台获得与开源硬件/AI/IoT交互的能力，同时他们也可以将&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;用作真实的Python解释器(可以与本地文件系统/网络交互)。&lt;/p&gt;
&lt;p&gt;本周末，我们将在这篇文章中展示如何将&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;接入到任何Scratch3.0平台中。事实上，你可以将它接入任何平台中。&lt;/p&gt;
&lt;p&gt;在本文中我们将放出EIM相关的所有源代码: scratch3_eim extension的源代码以及scratch3-adapter extension_eim的源代码。&lt;/p&gt;
&lt;h1 id="_2"&gt;教程&lt;/h1&gt;
&lt;p&gt;我们假设你已经读了&lt;a href="https://blog.just4fun.site/create-first-Scratch3-Extension.html"&gt;创建你的第一个Scratch3.0 Extension&lt;/a&gt;，如果没有，阅读完再回来。最好跟着文章操作一遍。&lt;/p&gt;
&lt;h2 id="scratch30eim-extension"&gt;在Scratch3.0中创建EIM Extension&lt;/h2&gt;
&lt;h3 id="scratch30"&gt;Scratch3.0插件源码&lt;/h3&gt;
&lt;p&gt;在&lt;code&gt;scratch-vm/src/extensions&lt;/code&gt;目录创建&lt;code&gt;scratch3_eim/index.js&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Scratch3.0 eim插件的源码我们已经放到Github上了:&lt;a href="https://github.com/Scratch3Lab/scratch3_eim"&gt;scratch3_eim&lt;/a&gt;，源码本身不做过多解释，对照着它的功能，很容易搞懂。&lt;/p&gt;
&lt;p&gt;值得注意的是，&lt;a href="https://github.com/Scratch3Lab/scratch3_eim"&gt;scratch3_eim&lt;/a&gt;依赖于&lt;code&gt;socket.io-client&lt;/code&gt;, 你需要在scratch-vm中先按照依赖:&lt;code&gt;yarn add socket.io-client&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Scratch3.0与&lt;a href="https://codelab-adapter-docs.codelab.club"&gt;scratch3-adapter&lt;/a&gt;建立连接，最关键的部分是:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;socket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;io&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sb"&gt;`//&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nx"&gt;adapterHost&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="sb"&gt;:12358`&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/test&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;transports&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;websocket&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;从架构图中，你可以更好地理解它们的交互:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/codelab-adapter_35cfa251.png" /&gt;&lt;/p&gt;
&lt;p&gt;从架构途图中也可以看出，&lt;a href="https://codelab-adapter-docs.codelab.club"&gt;scratch3-adapter&lt;/a&gt;支持任何平台。Scratch3.0只是它的一个client，但并没有特殊性，你完全可以在blockly app或者任何其他什么地方接入&lt;a href="https://codelab-adapter-docs.codelab.club"&gt;scratch3-adapter&lt;/a&gt;。&lt;/p&gt;
&lt;h3 id="scratch3-adapter-extension_eim"&gt;scratch3-adapter extension_eim源码&lt;/h3&gt;
&lt;p&gt;scratch3-adapter extension_eim的源码，我们也已经更新到Github上: &lt;a href="https://github.com/Scratch3Lab/scratch3_adapter_extensions/blob/master/extension_eim.py"&gt;extension_eim.py&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;此外，&lt;a href="https://github.com/Scratch3Lab/scratch3_adapter_extensions/blob/master/extension_python_kernel.py"&gt;extension_python_kernel.py&lt;/a&gt;也是与Scratch3.0 eim插件配合使用的.&lt;/p&gt;
&lt;h1 id="_3"&gt;开发者优先&lt;/h1&gt;
&lt;p&gt;目前我们允许开发者在本地(&lt;code&gt;127.0.0.1&lt;/code&gt;)将&lt;a href="https://codelab-adapter-docs.codelab.club"&gt;scratch3-adapter&lt;/a&gt;接入到任何平台中。&lt;/p&gt;
&lt;p&gt;需要注意的是，你需要将网站运行为安全模式(&lt;code&gt;https&lt;/code&gt;)来与&lt;a href="https://codelab-adapter-docs.codelab.club"&gt;scratch3-adapter&lt;/a&gt;通信。&lt;/p&gt;
&lt;p&gt;&lt;a href="https://codelab-adapter-docs.codelab.club"&gt;scratch3-adapter&lt;/a&gt;目前接受以下http origin与它通信:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;127.0.0.1&lt;/li&gt;
&lt;li&gt;localhost&lt;/li&gt;
&lt;li&gt;0.0.0.0&lt;/li&gt;
&lt;li&gt;scratch.mit.edu&lt;/li&gt;
&lt;li&gt;scratch3.codelab.club&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;第三方平台接入的条款我们正在制定中。目前大家可以现在本地测试。&lt;/p&gt;
&lt;h1 id="scratch3-adapter"&gt;scratch3-adapter可以支持其他平台吗？&lt;/h1&gt;
&lt;p&gt;如果有公司和组织希望将scratch3-adapter接入到自己的平台，请阅读&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/FAQ/#scratch3-adapter"&gt;scratch3-adapter可以支持其他平台吗？&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="_4"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/create-first-Scratch3-Extension.html"&gt;创建你的第一个Scratch3.0 Extension&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/FAQ/#scratch3-adapter"&gt;scratch3-adapter可以支持其他编程平台吗？&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Sat, 19 Jan 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-01-19:scratch3-adapter-open-plan.html</guid><category>scratch</category></item><item><title>创建你的第一个Scratch3.0 Extension</title><link>/create-first-Scratch3-Extension.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-extension_27085782.png" /&gt;&lt;/p&gt;
&lt;p&gt;我们近期刚写完&lt;a href="https://blog.just4fun.site/Scratch3_api_analysis.html"&gt;Scratch3.0技术分析&lt;/a&gt;系列文章，接下来准备围绕Scratch3.0编辑器写一系列文章，这一系列的文章关注如何构建自己的Extension，如何接入&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;， 此外，我们也计划将EIM的源码开放出来。&lt;/p&gt;
&lt;p&gt;对于你希望在自己的平台中接入&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;, 请阅读&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/FAQ/#scratch3-adapter"&gt;scratch3-adapter可以支持其他编程平台吗？&lt;/a&gt;。&lt;/p&gt;
&lt;h1 id="_1"&gt;说明&lt;/h1&gt;
&lt;p&gt;文章更新于: 2019.01.20&lt;/p&gt;
&lt;p&gt;官方的&lt;a href="https://github.com/LLK"&gt;源码仓库&lt;/a&gt;一直在变化，我们希望即时更新到最新状态。如果你发现有任何部分不能工作，及时通知我:)&lt;/p&gt;
&lt;p&gt;项目的源码我们已经放到github: &lt;a href="https://github.com/Scratch3Lab/scratch3_hello_world"&gt;Scratch3Lab/scratch3_hello_world&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="scratch-gui"&gt;运行scratch-gui&lt;/h1&gt;
&lt;p&gt;我的开发环境为MacOS 10.13.5，确保你在本地按照了git和nodejs。&lt;/p&gt;
&lt;h3 id="windows"&gt;windows用户&lt;/h3&gt;
&lt;p&gt;有读者在邮件里反馈说，在Windows下遇到一些问题。我在Windows 10里做了测试，把注意事项补充进来。&lt;/p&gt;
&lt;!--
安装[chocolatey](https://chocolatey.org/install): 以管理员身份运行powershell:  `Set-ExecutionPolicy Bypass -Scope Process -Force; iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))`

完成之后，就可以使用choco安装其他依赖，安装其他依赖:


wzxhzdk:0

--&gt;

&lt;p&gt;安装nodejs.&lt;/p&gt;
&lt;p&gt;使用&lt;a href="http://cmder.net/"&gt;cmder&lt;/a&gt;，而不是cmd。&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/sscratch3-windows_521baf16.png" /&gt;&lt;/p&gt;
&lt;h3 id="_2"&gt;开始&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;node -v &lt;span class="c1"&gt;# v10.15.0. v11.7.0也没问题 , 推荐使用n来管理nodejs版本&lt;/span&gt;
npm install -g yarn
npm install -g webpack
npm install -g webpack-dev-server
mkdir Scratch3 &lt;span class="c1"&gt;# &lt;/span&gt;
&lt;span class="nb"&gt;cd&lt;/span&gt; Scratch3
git clone https://github.com/LLK/scratch-gui

&lt;span class="nb"&gt;cd&lt;/span&gt; scratch-gui
yarn install
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;现在你就得到了一个可在本地运行Scratch3.0编辑器。&lt;/p&gt;
&lt;p&gt;运行&lt;code&gt;webpack-dev-server --https&lt;/code&gt;，打开:&lt;code&gt;https://127.0.0.1:8601/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-extension_57c1dcb7.png" /&gt;&lt;/p&gt;
&lt;p&gt;我们统一采用https来运行scratch-gui，因为以后接入&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;需要使用https。&lt;/p&gt;
&lt;h1 id="scratch-vm"&gt;运行scratch-vm&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; Scratch3
git clone https://github.com/LLK/scratch-vm
&lt;span class="nb"&gt;cd&lt;/span&gt; scratch-vm
yarn install
yarn link
yarn add uglifyjs-webpack-plugin
yarn run watch

&lt;span class="c1"&gt;# 新开一个shell&lt;/span&gt;
&lt;span class="nb"&gt;cd&lt;/span&gt; scratch-gui
yarn link scratch-vm
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;完成&lt;code&gt;yarn link scratch-vm&lt;/code&gt;之后，scratch-gui就会采用我们开发环境里的scratch-vm，而不是默认的scratch-vm. 这样一来我们就可以定制scratch-vm了。&lt;/p&gt;
&lt;p&gt;scratch-vm是什么呢?&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Virtual Machine used to represent, run, and maintain the state of programs for Scratch 3.0.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;可见 Scratch 3.0由scratch-vm提供动力支持。你可以把它理解为运行scratch3.0积木代码的引擎/解释器。&lt;/p&gt;
&lt;p&gt;Scratch3.0 Extension便是在scratch-vm中写的。&lt;/p&gt;
&lt;h1 id="scratch30-extension"&gt;第一个Scratch3.0 Extension&lt;/h1&gt;
&lt;p&gt;先不解释过多的概念。&lt;/p&gt;
&lt;p&gt;Learning by using， 开始创建我们的第一个Scratch3.0 Extension。&lt;/p&gt;
&lt;h3 id="_3"&gt;插件源码&lt;/h3&gt;
&lt;p&gt;在&lt;code&gt;scratch-vm/src/extensions&lt;/code&gt;目录创建&lt;code&gt;scratch3_hello_world/index.js&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;直接把hello world插件的代码贴上来，对照插件的实际功能和源码，应该能很快理解每一部分，语义还是非常清晰的。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;ArgumentType&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;require&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;../../extension-support/argument-type&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;BlockType&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;require&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;../../extension-support/block-type&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;formatMessage&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;require&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;format-message&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="c1"&gt;// const MathUtil = require(&amp;#39;../../util/math-util&amp;#39;);&lt;/span&gt;

&lt;span class="cm"&gt;/**&lt;/span&gt;
&lt;span class="cm"&gt; * Icon svg to be displayed at the left edge of each extension block, encoded as a data URI.&lt;/span&gt;
&lt;span class="cm"&gt; * @type {string}&lt;/span&gt;
&lt;span class="cm"&gt; */&lt;/span&gt;
&lt;span class="c1"&gt;// eslint-disable-next-line max-len&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;blockIconURI&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48dGl0bGU+cGVuLWljb248L3RpdGxlPjxnIHN0cm9rZT0iIzU3NUU3NSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxwYXRoIGQ9Ik04Ljc1MyAzNC42MDJsLTQuMjUgMS43OCAxLjc4My00LjIzN2MxLjIxOC0yLjg5MiAyLjkwNy01LjQyMyA1LjAzLTcuNTM4TDMxLjA2NiA0LjkzYy44NDYtLjg0MiAyLjY1LS40MSA0LjAzMi45NjcgMS4zOCAxLjM3NSAxLjgxNiAzLjE3My45NyA0LjAxNUwxNi4zMTggMjkuNTljLTIuMTIzIDIuMTE2LTQuNjY0IDMuOC03LjU2NSA1LjAxMiIgZmlsbD0iI0ZGRiIvPjxwYXRoIGQ9Ik0yOS40MSA2LjExcy00LjQ1LTIuMzc4LTguMjAyIDUuNzcyYy0xLjczNCAzLjc2Ni00LjM1IDEuNTQ2LTQuMzUgMS41NDYiLz48cGF0aCBkPSJNMzYuNDIgOC44MjVjMCAuNDYzLS4xNC44NzMtLjQzMiAxLjE2NGwtOS4zMzUgOS4zYy4yODItLjI5LjQxLS42NjguNDEtMS4xMiAwLS44NzQtLjUwNy0xLjk2My0xLjQwNi0yLjg2OC0xLjM2Mi0xLjM1OC0zLjE0Ny0xLjgtNC4wMDItLjk5TDMwLjk5IDUuMDFjLjg0NC0uODQgMi42NS0uNDEgNC4wMzUuOTYuODk4LjkwNCAxLjM5NiAxLjk4MiAxLjM5NiAyLjg1NU0xMC41MTUgMzMuNzc0Yy0uNTczLjMwMi0xLjE1Ny41Ny0xLjc2NC44M0w0LjUgMzYuMzgybDEuNzg2LTQuMjM1Yy4yNTgtLjYwNC41My0xLjE4Ni44MzMtMS43NTcuNjkuMTgzIDEuNDQ4LjYyNSAyLjEwOCAxLjI4Mi42Ni42NTggMS4xMDIgMS40MTIgMS4yODcgMi4xMDIiIGZpbGw9IiM0Qzk3RkYiLz48cGF0aCBkPSJNMzYuNDk4IDguNzQ4YzAgLjQ2NC0uMTQuODc0LS40MzMgMS4xNjVsLTE5Ljc0MiAxOS42OGMtMi4xMyAyLjExLTQuNjczIDMuNzkzLTcuNTcyIDUuMDFMNC41IDM2LjM4bC45NzQtMi4zMTYgMS45MjUtLjgwOGMyLjg5OC0xLjIxOCA1LjQ0LTIuOSA3LjU3LTUuMDFsMTkuNzQzLTE5LjY4Yy4yOTItLjI5Mi40MzItLjcwMi40MzItMS4xNjUgMC0uNjQ2LS4yNy0xLjQtLjc4LTIuMTIyLjI1LjE3Mi41LjM3Ny43MzcuNjE0Ljg5OC45MDUgMS4zOTYgMS45ODMgMS4zOTYgMi44NTYiIGZpbGw9IiM1NzVFNzUiIG9wYWNpdHk9Ii4xNSIvPjxwYXRoIGQ9Ik0xOC40NSAxMi44M2MwIC41LS40MDQuOTA1LS45MDQuOTA1cy0uOTA1LS40MDUtLjkwNS0uOTA0YzAtLjUuNDA3LS45MDMuOTA2LS45MDMuNSAwIC45MDQuNDA0LjkwNC45MDR6IiBmaWxsPSIjNTc1RTc1Ii8+PC9nPjwvc3ZnPg==&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;menuIconURI&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;blockIconURI&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; 

&lt;span class="kr"&gt;class&lt;/span&gt; &lt;span class="nx"&gt;Scratch3HelloBlocks&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;constructor&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;runtime&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="cm"&gt;/**&lt;/span&gt;
&lt;span class="cm"&gt;         * The runtime instantiating this block package.&lt;/span&gt;
&lt;span class="cm"&gt;         * @type {Runtime}&lt;/span&gt;
&lt;span class="cm"&gt;         */&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;runtime&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;runtime&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;


    &lt;span class="cm"&gt;/**&lt;/span&gt;
&lt;span class="cm"&gt;     * The key to load &amp;amp; store a target&amp;#39;s pen-related state.&lt;/span&gt;
&lt;span class="cm"&gt;     * @type {string}&lt;/span&gt;
&lt;span class="cm"&gt;     */&lt;/span&gt;
    &lt;span class="kr"&gt;static&lt;/span&gt; &lt;span class="nx"&gt;get&lt;/span&gt; &lt;span class="nx"&gt;STATE_KEY&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Scratch.helloWorld&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="cm"&gt;/**&lt;/span&gt;
&lt;span class="cm"&gt;     * @returns {object} metadata for this extension and its blocks.&lt;/span&gt;
&lt;span class="cm"&gt;     */&lt;/span&gt;
    &lt;span class="nx"&gt;getInfo&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;id&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;helloWorld&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;formatMessage&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
                &lt;span class="nx"&gt;id&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;helloWorld.categoryName&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                &lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;hello World&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                &lt;span class="nx"&gt;description&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Label for the hello world extension category&amp;#39;&lt;/span&gt;
            &lt;span class="p"&gt;}),&lt;/span&gt;
            &lt;span class="c1"&gt;// menuIconURI: menuIconURI,&lt;/span&gt;
            &lt;span class="nx"&gt;blockIconURI&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;blockIconURI&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="c1"&gt;// showStatusButton: true,&lt;/span&gt;
            &lt;span class="nx"&gt;blocks&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
                &lt;span class="p"&gt;{&lt;/span&gt;
                    &lt;span class="nx"&gt;opcode&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;say&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="nx"&gt;blockType&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;BlockType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;COMMAND&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="nx"&gt;text&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;formatMessage&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
                        &lt;span class="nx"&gt;id&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;helloWorld.say&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                        &lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;say [TEXT]&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                        &lt;span class="nx"&gt;description&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;say something&amp;#39;&lt;/span&gt;
                    &lt;span class="p"&gt;}),&lt;/span&gt;
                    &lt;span class="nx"&gt;arguments&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                        &lt;span class="nx"&gt;TEXT&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                            &lt;span class="nx"&gt;type&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;ArgumentType&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;STRING&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                            &lt;span class="nx"&gt;defaultValue&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;formatMessage&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
                                &lt;span class="nx"&gt;id&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;helloWorld.defaultTextToSay&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                                &lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;hello world&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                                &lt;span class="nx"&gt;description&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;default text to say.&amp;#39;&lt;/span&gt;
                            &lt;span class="p"&gt;})&lt;/span&gt;
                        &lt;span class="p"&gt;}&lt;/span&gt;
                    &lt;span class="p"&gt;}&lt;/span&gt;
                &lt;span class="p"&gt;}&lt;/span&gt;
            &lt;span class="p"&gt;],&lt;/span&gt;
            &lt;span class="nx"&gt;menus&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;
        &lt;span class="p"&gt;};&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="nx"&gt;say&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;util&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;args&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;message&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;runtime&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;emit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;SAY&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;util&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;target&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;say&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;message&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nx"&gt;module&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;exports&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;Scratch3HelloBlocks&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="_4"&gt;配置&lt;/h3&gt;
&lt;p&gt;为了将插件挂载到scratch-gui的插件区，我们需要做一些配置工作。&lt;/p&gt;
&lt;p&gt;编辑&lt;code&gt;scratch-vm/src/extension-support/extension-manager.js&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;展示一下编辑前后的&lt;code&gt;git diff&lt;/code&gt;信息:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt; const Scratch3MakeyMakeyBlocks = require(&amp;#39;../extensions/scratch3_makeymakey&amp;#39;);
 const Scratch3GdxForBlocks = require(&amp;#39;../extensions/scratch3_gdx_for&amp;#39;);
+// hello world
+const Scratch3HelloWorldBlocks = require(&amp;#39;../extensions/scratch3_hello_world&amp;#39;);

 const builtinExtensions = {
     pen: Scratch3PenBlocks,
@@ -30,7 +32,8 @@ const builtinExtensions = {
     speech2text: Scratch3Speech2TextBlocks,
     ev3: Scratch3Ev3Blocks,
     makeymakey: Scratch3MakeyMakeyBlocks,
-    gdxfor: Scratch3GdxForBlocks
+    gdxfor: Scratch3GdxForBlocks,
+    helloWorld: Scratch3HelloWorldBlocks
 };

 /**
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;接着我们将插件的封面图和小图标放到&lt;code&gt;scratch-gui/src/lib/libraries/extensions/&lt;/code&gt;目录里png图片尺寸推荐&lt;code&gt;600x372&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;编辑&lt;code&gt;scratch-gui/src/lib/libraries/extensions/index.jsx&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;展示一下编辑前后的&lt;code&gt;git diff&lt;/code&gt;信息:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt; import makeymakeyInsetImage from &amp;#39;./makeymakey-small.svg&amp;#39;;

+import helloworldImage from &amp;#39;./helloworld.png&amp;#39;;
+import helloworldInsetImage from &amp;#39;./helloworld-small.svg&amp;#39;;
+
 import microbitPeripheralImage from &amp;#39;./peripheral-connection/microbit/microbit-illustration.svg&amp;#39;;
 import microbitMenuImage from &amp;#39;./peripheral-connection/microbit/microbit-small.svg&amp;#39;;
 import ev3PeripheralImage from &amp;#39;./peripheral-connection/ev3/ev3-hub-illustration.svg&amp;#39;;
@@ -233,5 +236,25 @@ export default [
         ),
         helpLink: &amp;#39;https://scratch.mit.edu/wedo&amp;#39;

-    }
+    },
+    {
+        name: (
+            &amp;lt;FormattedMessage
+                defaultMessage=&amp;quot;hello world&amp;quot;
+                description=&amp;quot;Name for the &amp;#39;hello world&amp;#39; extension&amp;quot;
+                id=&amp;quot;gui.extension.helloworld.name&amp;quot;
+            /&amp;gt;
+        ),
+        extensionId: &amp;#39;helloWorld&amp;#39;,
+        iconURL: helloworldImage,
+        insetIconURL: helloworldInsetImage,
+        description: (
+            &amp;lt;FormattedMessage
+                defaultMessage=&amp;quot;hello world.&amp;quot;
+                description=&amp;quot;Description for the &amp;#39;hello world&amp;#39; extension&amp;quot;
+                id=&amp;quot;gui.extension.helloworld.description&amp;quot;
+            /&amp;gt;
+        ),
+        featured: true
+    },
 ];
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="_5"&gt;完成&lt;/h3&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-extension_27085782.png" /&gt;&lt;/p&gt;
&lt;p&gt;使用插件:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-extension_f1e97885.png" /&gt;&lt;/p&gt;
&lt;h1 id="_6"&gt;进阶&lt;/h1&gt;
&lt;p&gt;阅读已有的例子: &lt;a href="https://github.com/LLK/scratch-vm/tree/develop/src/extensions"&gt;scratch-vm/src/extensions&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="_7"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/LLK/scratch-gui"&gt;LLK/scratch-gui&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/LLK/scratch-gui/wiki/Getting-Started"&gt;Getting Started&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/LLK/scratch-gui/wiki/Publishing-to-GitHub-Pages"&gt;Publishing to GitHub Pages&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/LLK/scratch-gui/wiki/Localization"&gt;Localization&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/LLK/scratch-vm"&gt;LLK/scratch-vm&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/LLK/scratch-vm/wiki/Scratch-3.0-Extensions-Specification"&gt;Scratch 3.0 Extensions Specification&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/LLK/scratch-vm/tree/develop/src/extensions"&gt;scratch-vm/src/extensions&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Wed, 16 Jan 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-01-16:create-first-Scratch3-Extension.html</guid><category>scratch</category></item><item><title>Scratch3技术分析之项目内部数据(第6篇）</title><link>/Scratch3_project_json_analysis_6.html</link><description>&lt;p&gt;我们在&lt;a href="https://blog.just4fun.site/Scratch3_api_analysis_1.html"&gt;Scratch3技术分析之创作平台API(第1篇)&lt;/a&gt;定义了以下两个名词:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;项目的内部数据(https://projects.scratch.mit.edu/[project_id])&lt;/li&gt;
&lt;li&gt;项目的外部数据(https://api.scratch.mit.edu/projects/[project_id])&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;本文将详细讨论&lt;code&gt;项目的内部数据&lt;/code&gt;，看看Scratch是如何精心设计这个数据结构了。&lt;/p&gt;
&lt;p&gt;Scratch项目兼容性和可扩展性的秘诀就是精心设计了这个数据结构。&lt;/p&gt;
&lt;h1 id="_1"&gt;项目的内部数据&lt;/h1&gt;
&lt;p&gt;我们从一个简单的项目开始。拖动两个积木，拼在一起，保存这个项目，看看提交的项目数据是怎样的。&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_703e7f8c.png" /&gt;&lt;/p&gt;
&lt;p&gt;完整的数据为:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;targets&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;isStage&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="nb"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Stage&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;variables&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;`jEk@4|i[#Fk?(8x)AV.-my variable&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;我的变量&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;lists&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;broadcasts&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;blocks&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;comments&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;currentCostume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;costumes&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;cd21514d0531fdffb22204e0ec5ed84a&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;背景1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;cd21514d0531fdffb22204e0ec5ed84a.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;240&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;180&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;sounds&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;83a9787d4cb6f3b7632b4ddfebf74367&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;啵&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;format&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;rate&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;44100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;sampleCount&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1032&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;83a9787d4cb6f3b7632b4ddfebf74367.wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;volume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;layerOrder&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;tempo&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;60&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;videoTransparency&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;videoState&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;on&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;textToSpeechLanguage&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;null&lt;/span&gt;&lt;span class="p"&gt;},{&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;isStage&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="nb"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;角色1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;variables&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;lists&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;broadcasts&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;blocks&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;y8OmdQT3.?wg0.n|3Kbc&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;event_whenflagclicked&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;aJ5Pz#xv?_clQ9dxV#c5&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="nb"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="nb"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;184&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;149&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;aJ5Pz#xv?_clQ9dxV#c5&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;motion_movesteps&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;y8OmdQT3.?wg0.n|3Kbc&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;STEPS&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]]},&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="nb"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="nb"&gt;false&lt;/span&gt;&lt;span class="p"&gt;}},&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;comments&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;currentCostume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;costumes&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;b7853f557e4426412e64bb3da6531a99&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;造型1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;bitmapResolution&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;b7853f557e4426412e64bb3da6531a99.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;48&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;},{&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;e6ddc55a6ddd9cc9d84fe0b4c21e016f&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;造型2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;bitmapResolution&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;e6ddc55a6ddd9cc9d84fe0b4c21e016f.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;46&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;53&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;sounds&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;83c36d806dc92327b9e7049a565c6bff&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;喵&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;format&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;rate&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;44100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;sampleCount&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;37376&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;83c36d806dc92327b9e7049a565c6bff.wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;volume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;layerOrder&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;visible&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="nb"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;size&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;direction&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;90&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;draggable&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="nb"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;rotationStyle&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;all around&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;monitors&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[],&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;extensions&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[],&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;meta&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;semver&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;3.0.0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;vm&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;0.2.0-prerelease.20190109200835&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;agent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;为了获得好的阅读效果，你可以将它们复制到&lt;code&gt;https://jsoneditoronline.org/&lt;/code&gt;&lt;/p&gt;
&lt;h3 id="_2"&gt;顶层结构&lt;/h3&gt;
&lt;p&gt;最外层的四个key为:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;extensions&lt;/li&gt;
&lt;li&gt;meta&lt;/li&gt;
&lt;li&gt;monitors&lt;/li&gt;
&lt;li&gt;targets&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我们逐一分析&lt;/p&gt;
&lt;h3 id="extensions"&gt;extensions&lt;/h3&gt;
&lt;p&gt;稍后再说&lt;/p&gt;
&lt;h3 id="meta"&gt;meta&lt;/h3&gt;
&lt;p&gt;顾名思义，meta保留了元信息。包括以下信息:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;{
    &amp;quot;semver&amp;quot;: &amp;quot;3.0.0&amp;quot;,
    &amp;quot;vm&amp;quot;: &amp;quot;0.2.0-prerelease.20190109200835&amp;quot;,
    &amp;quot;agent&amp;quot;: &amp;quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36&amp;quot;
}
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;semver描述构建当前项目数据的scratch编辑器的语义版本是3.0.0&lt;/p&gt;
&lt;p&gt;vm字段保留了当前项目所用的&lt;a href="https://github.com/LLK/scratch-vm"&gt;scratch-vm&lt;/a&gt;版本号,有了这个信息，我们就知道项目所依赖的虚拟机(vm)版本，而vm决定了执行项目的环境(支持什么功能/硬件)。有了这些数据，我们就容易平滑升级和追踪问题。&lt;/p&gt;
&lt;p&gt;agent描述了客户端的环境。&lt;/p&gt;
&lt;h3 id="monitors"&gt;monitors&lt;/h3&gt;
&lt;p&gt;暂不讨论&lt;/p&gt;
&lt;h3 id="targets"&gt;targets&lt;/h3&gt;
&lt;p&gt;targets是scratch中非常核心的一个概念，我们所做的编程，都是针对targets的编程。这也是Scratch面向对象的地方。Scratch从面向对象语言Smalltalk中学了许多东西。&lt;/p&gt;
&lt;p&gt;有两类target: 舞台和角色。&lt;/p&gt;
&lt;p&gt;我们前头的积木是针对角色的，所以我们接下来关心角色target。&lt;/p&gt;
&lt;h5 id="blocks"&gt;blocks&lt;/h5&gt;
&lt;p&gt;积木属于角色，换句话说，角色拥有定义它行为的积木。&lt;/p&gt;
&lt;p&gt;我们刚才拖动的2块积木，在项目数据中表示如下&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_12a50e4a.png" /&gt;&lt;/p&gt;
&lt;p&gt;积木的key(id)是随机生成的(由blockly支持)&lt;/p&gt;
&lt;p&gt;&lt;code&gt;opcode&lt;/code&gt;是积木关联到vm中功能代码(js代码)的钩子。&lt;/p&gt;
&lt;p&gt;这是一个展示以下原则的绝佳例子: &lt;code&gt;表现与实现分离&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;这个设计是极为聪明的，项目对实际执行它的虚拟机(vm)一无所知，如此一来升级就容易了。&lt;/p&gt;
&lt;p&gt;积木直接的连接关系，从上图的属性中，容易看出来。&lt;/p&gt;
&lt;h1 id="_3"&gt;加了扩展&lt;/h1&gt;
&lt;p&gt;我们再来看看添加了拓展之后是怎样的。&lt;/p&gt;
&lt;p&gt;我们加一个microbit扩展。&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_4795d59c.png" /&gt;&lt;/p&gt;
&lt;p&gt;可以看到，顶部的extensions里加上了"microbit"。&lt;/p&gt;
&lt;p&gt;值得注意的是，这个积木的输入很有趣，允许用户绘制5x5的矩阵来控制microbit的点阵屏。&lt;/p&gt;
&lt;p&gt;这种特殊输入的定义在&lt;a href="https://github.com/LLK/scratch-blocks"&gt;scratch-blocks&lt;/a&gt;中, 参考: &lt;a href="https://github.com/LLK/scratch-blocks/blob/42abd6ecb505cf9b832b9be2315e6a099bddda90/core/field_matrix.js#L38"&gt;Blockly.FieldMatrix = function(matrix)&lt;/a&gt;&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Tue, 15 Jan 2019 17:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-01-15:Scratch3_project_json_analysis_6.html</guid><category>scratch</category></item><item><title>Scratch3技术分析之社区 API(第5篇)</title><link>/Scratch3_community_analysis_5.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/[Ascratch=api_ab098d7e.png" /&gt;&lt;/p&gt;
&lt;p&gt;我们主要关心以下页面的API:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;社区主页: &lt;code&gt;https://scratch.mit.edu/&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;发现页: &lt;code&gt;https://scratch.mit.edu/explore/projects/all&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我们可以把这些API视为项目查询接口，查询社区用户已创建的项目(Projects), 这些接口的不同只是查询的条件不同。&lt;/p&gt;
&lt;h1 id="_1"&gt;社区主页&lt;/h1&gt;
&lt;p&gt;已登陆用户和未登录用户看到的社区主页，略有不同，我们分别分析。&lt;/p&gt;
&lt;h3 id="_2"&gt;未登录用户&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;GET https://api.scratch.mit.edu/proxy/featured&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_4802bb5c.png" /&gt;&lt;/p&gt;
&lt;h3 id="_3"&gt;已登陆用户&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;GET https://api.scratch.mit.edu/proxy/featured&lt;/code&gt; &lt;/p&gt;
&lt;p&gt;返回数据相同。&lt;/p&gt;
&lt;p&gt;已登陆用户会请求更多的API:&lt;/p&gt;
&lt;h5 id="_4"&gt;新闻接口:&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;GET https://api.scratch.mit.edu/news?limit=3&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;返回:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;
  &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;181868395058&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;stamp&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2019-01-09T13:53:40.000Z&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;headline&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Updates and Bug Fixes!&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;url&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://scratch.mit.edu/discuss/topic/331439/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;image&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://66.media.tumblr.com/2bbe2bc9317585c1de96c91f56bb061b/tumblr_inline_pad1ik8d2k1tqsk9m_540.png&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;copy&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;We have some updates and bug fixes for you! See here for more information…&amp;quot;&lt;/span&gt;
  &lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;181645899223&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;stamp&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2019-01-02T14:49:48.000Z&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;headline&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Scratch 3.0 is here!&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;url&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://scratch.mit.edu/discuss/topic/326861/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;image&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://66.media.tumblr.com/2bbe2bc9317585c1de96c91f56bb061b/tumblr_inline_pad1ik8d2k1tqsk9m_540.png&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;copy&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Scratch 3.0 has launched! See here for more information…&amp;quot;&lt;/span&gt;
  &lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;181645869948&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;stamp&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2019-01-02T14:48:22.000Z&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;headline&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;First Scratch Design Studio in 3.0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;url&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://scratch.mit.edu/studios/5801323/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;image&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://66.media.tumblr.com/ee9c9705a8c0334c07c6a32303ec0748/tumblr_inline_p7in9yfrIU1tqsk9m_540.png&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;copy&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Have you ever wondered what life might be like in the year 3000? Here is your chance to share your dreams and wishes for the future!  &amp;quot;&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h5 id="_5"&gt;关注者赞过的项目&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;GET https://api.scratch.mit.edu/users/wwj718/following/users/loves&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;返回:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_180455c6.png" /&gt;&lt;/p&gt;
&lt;h5 id="_6"&gt;关注的工作室的项目&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;GET https://api.scratch.mit.edu/users/wwj718/following/studios/projects&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;返回:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_b6bc3beb.png" /&gt;&lt;/p&gt;
&lt;h1 id="_7"&gt;发现页&lt;/h1&gt;
&lt;p&gt;发现页可以用于发现&lt;code&gt;项目&lt;/code&gt;和&lt;code&gt;工作室&lt;/code&gt;。工作室(Studio)目前官方还没有迁移完，我们暂时不关心。（工作室非常接近知乎&lt;code&gt;收藏夹&lt;/code&gt;的概念）。&lt;/p&gt;
&lt;h3 id="_8"&gt;默认请求&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;GET https://api.scratch.mit.edu/explore/projects?limit=16&amp;amp;offset=0&amp;amp;language=zh-cn&amp;amp;mode=trending&amp;amp;q=*&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_7096b7d1.png" /&gt;&lt;/p&gt;
&lt;p&gt;默认情况下，选择了&lt;code&gt;全部&lt;/code&gt;、&lt;code&gt;热门的&lt;/code&gt;、&lt;code&gt;简体中文&lt;/code&gt;(页底)，从url参数你可以看到这些。&lt;/p&gt;
&lt;h3 id="_9"&gt;最受欢迎的动画&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;GET https://api.scratch.mit.edu/explore/projects?limit=16&amp;amp;offset=0&amp;amp;language=zh-cn&amp;amp;mode=popular&amp;amp;q=animations&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;观察URL参数，我们便搞懂了发现页的API细节了。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Tue, 15 Jan 2019 16:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-01-15:Scratch3_community_analysis_5.html</guid><category>scratch</category></item><item><title>Scratch3技术分析之User API(第4篇)</title><link>/Scratch3_user_api_analysis_4.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_2a5ba63a.png" /&gt;&lt;/p&gt;
&lt;p&gt;我们关心以下User API:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;注册&lt;/li&gt;
&lt;li&gt;登陆&lt;/li&gt;
&lt;li&gt;验证邮件&lt;/li&gt;
&lt;li&gt;用户消息&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="_1"&gt;注册&lt;/h1&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_a0dab332.png" /&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;api_test2&lt;/span&gt;
&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;api_test2llk&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="1"&gt;第1步&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;GET https://scratch.mit.edu/accounts/check_username/api_test2/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;返回:  &lt;code&gt;[{"username": "api_test2", "msg": "valid username"}]&lt;/code&gt;&lt;/p&gt;
&lt;h3 id="2"&gt;第2步&lt;/h3&gt;
&lt;p&gt;没有数据交互&lt;/p&gt;
&lt;h3 id="3"&gt;第3步&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;接收来自 Scratch 团队的更新通知&lt;/code&gt;可勾选。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;GET https://scratch.mit.edu/accounts/check_email/?email=wuwenjie718%40gmail.com
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;返回&lt;code&gt;[{"msg": "valid email", "email": "wuwenjie718@gmail.com"}]&lt;/code&gt;&lt;/p&gt;
&lt;h3 id="4"&gt;第4步&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;POST  https://scratch.mit.edu/accounts/register_new_user/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;以Form Data提交&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;username=api_test2&amp;amp;password=api_test2llk&amp;amp;birth_month=1&amp;amp;birth_year=2001&amp;amp;gender=male&amp;amp;country=China&amp;amp;email=wuwenjie718%40gmail.com&amp;amp;subscribe=true&amp;amp;is_robot=false&amp;amp;csrfmiddlewaretoken=f33VDWVgfOhFVK3nwDK4hNEDVFmjHOO3
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;其中csrfmiddlewaretoken是通过&lt;code&gt;GET https://scratch.mit.edu/csrf_token/&lt;/code&gt;请求得到(set-cookie)&lt;/p&gt;
&lt;h1 id="_2"&gt;验证邮件&lt;/h1&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-emil_073b6139.png" /&gt;&lt;/p&gt;
&lt;p&gt;邮件验证链接为:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;https://scratch.mit.edu/accounts/email_verify/WzQwNDQ2ODAxLCJ3dXdlbmppZTcxOEBnbWFpbC5jb20iLHRydWVd:1gjHzZ:N5Rkcd9rnux1qFAVQtExCFV06gw/?isRegistration=true&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;验证完成之后:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-emial_f6a80289.png" /&gt;&lt;/p&gt;
&lt;p&gt;Scratch的易用性做得非常好。整个产品逻辑很清晰。点击&lt;code&gt;ok,let's go&lt;/code&gt; 则进入&lt;code&gt;https://scratch.mit.edu/&lt;/code&gt;社区。&lt;/p&gt;
&lt;p&gt;验证完邮件后，我们还会收到一封邮件:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_88550923.png" /&gt;&lt;/p&gt;
&lt;h1 id="_3"&gt;登陆&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;POST https://scratch.mit.edu/accounts/login/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;请求的json数据为:&lt;code&gt;{"username":"api_test2","password":"api_test2llk","useMessages":true}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;后端返回: &lt;code&gt;[{"username": "api_test2", "num_tries": 1, "success": 1, "msg": "", "messages": [], "id": 40446801}]&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;登陆之后会立刻请求&lt;code&gt;GET https://scratch.mit.edu/session/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;返回:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;user&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;40446801&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;banned&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;  &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;username&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;api_test2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;token&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;12b89f5b950549ef927c2df5f5ee6fa3:u1PE_y4qIYis1GA2VY_D-RWWndw&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;thumbnailUrl&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;//cdn2.scratch.mit.edu/get_image/user/default_32x32.png&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;dateJoined&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2019-01-15T06:14:28&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;email&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;wuwenjie718@gmail.com&amp;quot;&lt;/span&gt;

  &lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;permissions&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;scratcher&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;new_scratcher&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;social&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;educator&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;educator_invitee&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;student&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;
  &lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;flags&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;must_reset_password&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;must_complete_registration&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;has_outstanding_email_confirmation&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;show_welcome&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;confirm_email_banner&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;unsupported_browser_banner&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这里包含了更为全面的用户画像信息。&lt;/p&gt;
&lt;p&gt;如果登陆失败，则返回403错误:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[{"username": "api_test2", "num_tries": 1, "success": 0, "msg": "\u8d26\u53f7\u6216\u5bc6\u7801\u9519\u8bef\u3002", "messages": [], "id": null}]&lt;/code&gt;&lt;/p&gt;
&lt;h1 id="_4"&gt;用户消息&lt;/h1&gt;
&lt;p&gt;Scratch的新用户引导是做得非常好的。&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_5af8ba54.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;欢迎来到Scratch!&lt;/code&gt;标签栏给出了新用户入门引导链接。&lt;/p&gt;
&lt;p&gt;新用户会收到一条消息：&lt;code&gt;GET https://api.scratch.mit.edu/users/api_test2/messages/count&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;后台返回: &lt;code&gt;{"count":1}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;消息接口目前是定时轮询。&lt;/p&gt;
&lt;h3 id="_5"&gt;消息详情&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;GET https://api.scratch.mit.edu/users/api_test2/messages?limit=40&amp;amp;offset=0&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;后台返回:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[{&amp;quot;id&amp;quot;:20423966,&amp;quot;datetime_created&amp;quot;:&amp;quot;2019-01-15T06:14:28.000Z&amp;quot;,&amp;quot;actor_username&amp;quot;:&amp;quot;api_test2&amp;quot;,&amp;quot;actor_id&amp;quot;:40446801,&amp;quot;type&amp;quot;:&amp;quot;userjoin&amp;quot;}]
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;目前我们的消息还很少，不好分析，之后我们再来专门分析这部分。&lt;/p&gt;
&lt;h1 id="api"&gt;用户相关的其他API&lt;/h1&gt;
&lt;p&gt;由于个人中心之类的页面，Scratch团队还没有迁移到新版的前端中，所以我们暂不分析。为了追求接口稳定性，我们待官方完成这部分工作后，再做分析。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Tue, 15 Jan 2019 15:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-01-15:Scratch3_user_api_analysis_4.html</guid><category>scratch</category></item><item><title>Scratch3技术分析之项目主页API(第3篇)</title><link>/Scratch3_project_homepage_analysis_3.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_6b1407e4.png" /&gt;&lt;/p&gt;
&lt;p&gt;本文将关心项目主页涉及的API。&lt;/p&gt;
&lt;p&gt;相关的API包括:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;拉取项目数据&lt;ul&gt;
&lt;li&gt;项目的内部数据(https://projects.scratch.mit.edu/[project_id])&lt;/li&gt;
&lt;li&gt;项目的外部数据(https://api.scratch.mit.edu/projects/[project_id])&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;更新项目信息&lt;ul&gt;
&lt;li&gt;更新项目名&lt;/li&gt;
&lt;li&gt;更新操作说明&lt;/li&gt;
&lt;li&gt;更新备注与谢志&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;点赞(❤️/⭐️)&lt;/li&gt;
&lt;li&gt;被改编/浏览的次数&lt;/li&gt;
&lt;li&gt;评论&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我们以测试项目&lt;code&gt;https://scratch.mit.edu/projects/277117877&lt;/code&gt;为例, 打开页面，加载的数据还真不少。&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_88c80b60.png" /&gt;&lt;/p&gt;
&lt;p&gt;其中&lt;code&gt;https://scratch.mit.edu/js/projects.bundle.js&lt;/code&gt;足有4.7M，下载时间就用了9.3s。&lt;/p&gt;
&lt;h1 id="_1"&gt;拉取项目数据&lt;/h1&gt;
&lt;p&gt;我们回到正题，开始关心各个API。既然是项目主页，首先得把整个项目的数据拉进页面，供用户浏览。我们便从这个说起。&lt;/p&gt;
&lt;p&gt;项目数据包括&lt;code&gt;项目的内部数据&lt;/code&gt;和&lt;code&gt;项目的外部数据&lt;/code&gt;（在&lt;a href="https://blog.just4fun.site/Scratch3_api_analysis_1.html#get"&gt;Scratch3技术分析之创作平台API(第1篇)&lt;/a&gt;定义了这两个概念）&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;GET https://projects.scratch.mit.edu/277117877 # 项目的内部数据
GET https://api.scratch.mit.edu/projects/277117877 # 项目的外部数据
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="_2"&gt;项目的内部数据&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;GET https://projects.scratch.mit.edu/277117877&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;targets&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;isStage&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Stage&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;variables&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;`jEk@4|i[#Fk?(8x)AV.-my variable&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;æçåé&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;lists&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;broadcasts&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;blocks&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;comments&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;currentCostume&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;costumes&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;cd21514d0531fdffb22204e0ec5ed84a&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;èæ¯1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;cd21514d0531fdffb22204e0ec5ed84a.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;240&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;180&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sounds&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83a9787d4cb6f3b7632b4ddfebf74367&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;åµ&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;format&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rate&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;44100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sampleCount&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1032&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83a9787d4cb6f3b7632b4ddfebf74367.wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;volume&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;layerOrder&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;tempo&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;60&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;videoTransparency&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;videoState&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;on&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;textToSpeechLanguage&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:null&lt;/span&gt;&lt;span class="p"&gt;},{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;isStage&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;è§è²1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;variables&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;lists&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;broadcasts&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;blocks&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;#ez$qP+47m]1?FAkK7EQ&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;event_whenflagclicked&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;4(Rs_W.WmWf$u^fquvr=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;249&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:-&lt;/span&gt;&lt;span class="mi"&gt;313&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;4(Rs_W.WmWf$u^fquvr=&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;motion_movesteps&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;l]Zt{~YW17*uEI[V*-ru&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;#ez$qP+47m]1?FAkK7EQ&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;STEPS&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;l]Zt{~YW17*uEI[V*-ru&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;microbit_displaySymbol&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;4(Rs_W.WmWf$u^fquvr=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;MATRIX&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;t2p#3HOI[w=AQ2`(S:@O&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;t2p#3HOI[w=AQ2`(S:@O&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;matrix&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;l]Zt{~YW17*uEI[V*-ru&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;MATRIX&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;0101010101100010101000100&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:false&lt;/span&gt;&lt;span class="p"&gt;}},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;comments&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;currentCostume&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;costumes&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;b7853f557e4426412e64bb3da6531a99&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;é å1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;bitmapResolution&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;b7853f557e4426412e64bb3da6531a99.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;48&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;},{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;e6ddc55a6ddd9cc9d84fe0b4c21e016f&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;é å2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;bitmapResolution&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;e6ddc55a6ddd9cc9d84fe0b4c21e016f.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;46&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;53&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sounds&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83c36d806dc92327b9e7049a565c6bff&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;åµ&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;format&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rate&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;44100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sampleCount&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;37376&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83c36d806dc92327b9e7049a565c6bff.wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;volume&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;layerOrder&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;visible&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;size&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;direction&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;90&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;draggable&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationStyle&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;all around&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;monitors&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;extensions&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;microbit&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;meta&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;semver&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;3.0.0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;vm&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;0.2.0-prerelease.20190102175344&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;agent&amp;quot;&lt;/span&gt;&lt;span class="s s-Atom"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.110 Safari/537.36&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;为了获得好的阅读效果，你可以将它们复制到&lt;code&gt;https://jsoneditoronline.org/&lt;/code&gt;&lt;/p&gt;
&lt;h3 id="_3"&gt;项目的外部数据&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;GET https://api.scratch.mit.edu/projects/277117877&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;277117877&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;title&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;test-api&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;description&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;instructions&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;操作说明&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;visibility&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;visible&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;public&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;comments_allowed&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;is_published&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;author&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;40103875&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;username&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;api_test&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;scratchteam&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;history&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;joined&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;1900-01-01T00:00:00.000Z&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;profile&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="s2"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="s2"&gt;&amp;quot;images&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;90x90&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/user/40103875_90x90.png?v=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;60x60&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/user/40103875_60x60.png?v=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;55x55&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/user/40103875_55x55.png?v=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;50x50&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/user/40103875_50x50.png?v=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;32x32&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/user/40103875_32x32.png?v=&amp;quot;&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;image&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/277117877_480x360.png&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;images&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;282x218&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/277117877_282x218.png?v=1547524633&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;216x163&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/277117877_216x163.png?v=1547524633&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;200x200&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/277117877_200x200.png?v=1547524633&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;144x108&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/277117877_144x108.png?v=1547524633&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;135x102&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/277117877_135x102.png?v=1547524633&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;100x80&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/277117877_100x80.png?v=1547524633&amp;quot;&lt;/span&gt;
  &lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;history&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;created&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2019-01-04T11:40:46.000Z&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;modified&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2019-01-15T03:57:13.000Z&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;shared&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2019-01-04T12:27:22.000Z&amp;quot;&lt;/span&gt;
  &lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;stats&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;views&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;loves&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;favorites&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;comments&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;remixes&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
  &lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;remix&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;root&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;每个字段的含义参考:&lt;a href="https://github.com/towerofnix/scratch-api-unofficial-docs/blob/master/api/definitions/project_object.md"&gt;Project Object&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="_4"&gt;更新项目信息&lt;/h1&gt;
&lt;h3 id="_5"&gt;更新项目名&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;PUT https://api.scratch.mit.edu/projects/277117877&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;以json形式提交了: &lt;code&gt;{"title":"test-api2"}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;服务器返回和&lt;code&gt;GET https://api.scratch.mit.edu/projects/277117877&lt;/code&gt;一样的信息。&lt;/p&gt;
&lt;p&gt;可以看出它们的url也是一样的&lt;/p&gt;
&lt;h3 id="_6"&gt;更新操作说明&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;PUT https://api.scratch.mit.edu/projects/277117877&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;以json形式提交了: &lt;code&gt;{"instructions":"操作说明test"}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;服务器返回同上。&lt;/p&gt;
&lt;h3 id="_7"&gt;更新备注与谢志&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;PUT https://api.scratch.mit.edu/projects/277117877&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;以json形式提交了: &lt;code&gt;{"description":"test"}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;服务器返回同上。&lt;/p&gt;
&lt;p&gt;一致性非常好。&lt;/p&gt;
&lt;h1 id="_8"&gt;点赞(❤️/⭐️)&lt;/h1&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_de57849c.png" /&gt;&lt;/p&gt;
&lt;p&gt;❤️代表&lt;code&gt;loves&lt;/code&gt;, ⭐️代表&lt;code&gt;favorites&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;这两个的接口十分相似:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;POST https://api.scratch.mit.edu/proxy/projects/277117877/loves/user/api_test
POST https://api.scratch.mit.edu/proxy/projects/277117877/favorites/user/api_test
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;后端返回分别为&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;{&amp;quot;projectId&amp;quot;:&amp;quot;277117877&amp;quot;,&amp;quot;userLove&amp;quot;:true,&amp;quot;statusChanged&amp;quot;:true} # ❤️
{&amp;quot;projectId&amp;quot;:&amp;quot;277117877&amp;quot;,&amp;quot;userFavorite&amp;quot;:true,&amp;quot;statusChanged&amp;quot;:true}  # ⭐️
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如果你要取消它们，API分别为&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;DELETE https://api.scratch.mit.edu/proxy/projects/277117877/loves/user/api_test # ❤️
DELETE https://api.scratch.mit.edu/proxy/projects/277117877/favorites/user/api_test # ⭐️
&lt;/pre&gt;&lt;/div&gt;


&lt;h1 id="_9"&gt;被改编/浏览的次数&lt;/h1&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_067c109e.png" /&gt;&lt;/p&gt;
&lt;p&gt;被浏览的次数，一个用户最多贡献一次。可以使用redis的set来做(记录用户id)。&lt;/p&gt;
&lt;h1 id="_10"&gt;评论&lt;/h1&gt;
&lt;p&gt;最后我们来关心评论。这部分稍微复杂些。&lt;/p&gt;
&lt;h3 id="_11"&gt;顶层评论&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;POST https://api.scratch.mit.edu/proxy/comments/project/277117877&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;提交的json数据为: &lt;code&gt;{"content":"test","parent_id":"","commentee_id":""}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;注意到顶层评论的parent_id为空。&lt;/p&gt;
&lt;p&gt;后端返回:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;{
  &amp;quot;id&amp;quot;: 106196727,
  &amp;quot;parent_id&amp;quot;: null,
  &amp;quot;commentee_id&amp;quot;: null,
  &amp;quot;content&amp;quot;: &amp;quot;test&amp;quot;,
  &amp;quot;datetime_created&amp;quot;: &amp;quot;2019-01-15T04:38:43.000Z&amp;quot;,
  &amp;quot;datetime_modified&amp;quot;: &amp;quot;2019-01-15T04:38:43.000Z&amp;quot;,
  &amp;quot;visibility&amp;quot;: &amp;quot;visible&amp;quot;,
  &amp;quot;author&amp;quot;: {
    &amp;quot;id&amp;quot;: 40103875,
    &amp;quot;username&amp;quot;: &amp;quot;api_test&amp;quot;,
    &amp;quot;scratchteam&amp;quot;: false,
    &amp;quot;image&amp;quot;: &amp;quot;https://cdn2.scratch.mit.edu/get_image/user/40103875_60x60.png&amp;quot;
  },
  &amp;quot;reply_count&amp;quot;: 0
}
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="_12"&gt;子评论&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;POST https://api.scratch.mit.edu/proxy/comments/project/277117877&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;提交的json数据为: &lt;code&gt;{"content":"子评论","parent_id":106196727,"commentee_id":40103875}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;后端返回:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;106196741&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;parent_id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;106196727&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;commentee_id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;40103875&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;content&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;子评论&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;datetime_created&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2019-01-15T04:40:05.000Z&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;datetime_modified&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2019-01-15T04:40:05.000Z&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;visibility&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;visible&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;author&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;40103875&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;username&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;api_test&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;scratchteam&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;image&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/user/40103875_60x60.png&amp;quot;&lt;/span&gt;
  &lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;reply_count&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4 id="_13"&gt;对子评论的回复&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;POST https://api.scratch.mit.edu/proxy/comments/project/277117877&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;提交的json数据为: &lt;code&gt;{"content":"对子评论 的回复","parent_id":106196727,"commentee_id":40103875}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;后端返回:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;106196774&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;parent_id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;106196727&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;commentee_id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;40103875&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;content&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;对子评论 的回复&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;datetime_created&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2019-01-15T04:42:46.000Z&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;datetime_modified&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2019-01-15T04:42:46.000Z&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;visibility&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;visible&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;author&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;40103875&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;username&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;api_test&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;scratchteam&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;image&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/user/40103875_60x60.png&amp;quot;&lt;/span&gt;
  &lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;reply_count&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可以看出&lt;code&gt;parent_id&lt;/code&gt;始终指向&lt;code&gt;顶级评论&lt;/code&gt;。 &lt;!--&lt;code&gt;commentee_id&lt;/code&gt;指向的应该是被回复者。--&gt;&lt;/p&gt;
&lt;h3 id="_14"&gt;关闭评论功能&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;PUT https://api.scratch.mit.edu/projects/277117877&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;提交的json数据为: &lt;code&gt;{"comments_allowed":false}&lt;/code&gt;&lt;/p&gt;
&lt;h3 id="_15"&gt;删除评论&lt;/h3&gt;
&lt;p&gt;删除权利在项目拥有者手中，而不在评论发出者手中。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;DELETE https://api.scratch.mit.edu/proxy/comments/project/277117877/comment/106196842&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;返回:&lt;code&gt;{}&lt;/code&gt;&lt;/p&gt;
&lt;h3 id="_16"&gt;举报评论&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;POST https://api.scratch.mit.edu/proxy/project/277117877/comment/106196741/report&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;返回值: &lt;code&gt;{"reportId":null}&lt;/code&gt;&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Tue, 15 Jan 2019 12:57:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-01-15:Scratch3_project_homepage_analysis_3.html</guid><category>scratch</category></item><item><title>Scratch3技术分析之静态资源API(第2篇)</title><link>/Scratch3_asset_analysis_2.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_dc534091.png" /&gt;&lt;/p&gt;
&lt;p&gt;在这篇文章中，我们来重点关注Scratch静态资源相关的API, 了解这些资源是如何被存储以及如何被加载的。&lt;/p&gt;
&lt;p&gt;关注的静态资源包括:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Scratch project 中的静态资源&lt;ul&gt;
&lt;li&gt;角色&lt;/li&gt;
&lt;li&gt;舞台&lt;/li&gt;
&lt;li&gt;声音&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;项目缩略图&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="scratch-project"&gt;Scratch project 中的静态资源&lt;/h1&gt;
&lt;h3 id="_1"&gt;角色&lt;/h3&gt;
&lt;p&gt;我们来上传一个角色，看看发生了什么。&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_dc534091.png" /&gt;&lt;/p&gt;
&lt;p&gt;可以看到，当我们从本地加载图片时，并没有发生忘了交互，并未上传到后台，只是从本地加载到浏览器。&lt;/p&gt;
&lt;p&gt;当我们点击立即保存之后，发生了如下请求:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;POST https://assets.scratch.mit.edu/945f73f489fda5a87ad5203f457e436a.png&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;细节为:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_818f1894.png" /&gt;&lt;/p&gt;
&lt;p&gt;后台返回:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;{"status":"ok","content-name":"945f73f489fda5a87ad5203f457e436a.png"}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;从&lt;code&gt;项目的内部数据&lt;/code&gt;(我们在&lt;a href="https://blog.just4fun.site/Scratch3_api_analysis_1.html#get"&gt;Scratch3技术分析之创作平台API(第1篇)&lt;/a&gt;定义了这个概念)可以看出，新上传的角色的一些信息。&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_feadb636.png" /&gt;&lt;/p&gt;
&lt;p&gt;从名称可以看出，&lt;code&gt;945f73f489fda5a87ad5203f457e436a&lt;/code&gt;是角色图片的md5，我们在shell中验证一下: &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;➜  Rectangle.iconset md5 icon_512x512.png
MD5 (icon_512x512.png) = 945f73f489fda5a87ad5203f457e436a
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;果不其然。&lt;/p&gt;
&lt;p&gt;角色的md5值，由&lt;a href="https://github.com/LLK/scratch-storage/blob/5e9c19d970a4e30e85d3886dd2b15cac94aa9415/src/Asset.js#L61"&gt;if (generateId) this.assetId = md5(data);&lt;/a&gt;生成。&lt;/p&gt;
&lt;p&gt;至此我们就理解了&lt;code&gt;角色&lt;/code&gt;是如何被存储的。在用户点击&lt;code&gt;立即保存&lt;/code&gt;的时候，角色会被上传到后台。这个行为发生在项目json数据(&lt;code&gt;PUT https://projects.scratch.mit.edu/279586215&lt;/code&gt;)更新之前, 所以json数据中的角色只需要保存有md5值就行了(钩子/uri)。&lt;/p&gt;
&lt;h3 id="md5"&gt;md5&lt;/h3&gt;
&lt;p&gt;我们顺便提一下&lt;code&gt;md5&lt;/code&gt;，使用md5来作为文件名(同时也是&lt;a href="https://baike.baidu.com/item/%E6%96%87%E4%BB%B6%E7%AD%BE%E5%90%8D"&gt;文件签名&lt;/a&gt;)的一个好处是，相同的文件在服务器只需要存储一份。考虑到scratch有大量的&lt;code&gt;改编&lt;/code&gt;项目，这个做法将大大解决资源，既节约了网络资源(如果本地有缓存就不必加载)，同时节约了服务器的存储资源。&lt;/p&gt;
&lt;h3 id="_2"&gt;舞台、音乐&lt;/h3&gt;
&lt;p&gt;如你所猜，舞台、音乐和角色是完全一样的做法。&lt;/p&gt;
&lt;h1 id="_3"&gt;项目缩略图&lt;/h1&gt;
&lt;p&gt;最后我们来关注一下项目缩略图.&lt;/p&gt;
&lt;p&gt;在&lt;a href="https://blog.just4fun.site/Scratch3_api_analysis_1.html"&gt;上篇文章&lt;/a&gt;已经分析了缩略图是如何上传的:  在点击&lt;code&gt;立即保存&lt;/code&gt;之后，会触发:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;PUT https://scratch.mit.edu/internalapi/project/thumbnail/279586215/set/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;细节为:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_1e48c0c6.png" /&gt;&lt;/p&gt;
&lt;p&gt;其中&lt;code&gt;279586215&lt;/code&gt;是项目id。&lt;/p&gt;
&lt;h3 id="_4"&gt;获取缩略图&lt;/h3&gt;
&lt;p&gt;scratch使用CDN分发静态资源。我们知道，使用CDN常常会牵扯到缓存策略问题。注入更新了图片，用户却迟迟看不到更新。&lt;/p&gt;
&lt;p&gt;角色、舞台、音乐使用md5存储，所以不用担心缓存问题(更新前后的md5不同)。但缩略图似乎并没有使用md5. 那么缩略图如何处理缓存问题呢？&lt;/p&gt;
&lt;p&gt;我们进入项目主页:&lt;code&gt;https://scratch.mit.edu/projects/279586215/&lt;/code&gt;，看看加载缩略图的细节:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;GET https://api.scratch.mit.edu/projects/279586215&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_38b64d6d.png" /&gt;&lt;/p&gt;
&lt;p&gt;可以看到图片有多种规格:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;https://cdn2.scratch.mit.edu/get_image/project/279586215_480x360.png
https://cdn2.scratch.mit.edu/get_image/project/279586215_100x80.png?v=1547520628
https://cdn2.scratch.mit.edu/get_image/project/279586215_135x102.png?v=1547520628
https://cdn2.scratch.mit.edu/get_image/project/279586215_144x108.png?v=1547520628
https://cdn2.scratch.mit.edu/get_image/project/279586215_200x200.png?v=1547520628
https://cdn2.scratch.mit.edu/get_image/project/279586215_216x163.png?v=1547520628
https://cdn2.scratch.mit.edu/get_image/project/279586215_282x218.png?v=1547520628
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如果你熟悉图片存储平台的API，你可能容易猜到&lt;code&gt;279586215_480x360.png&lt;/code&gt;中的&lt;code&gt;480x360&lt;/code&gt; 是这些平台系统的API。七牛云就提供了类似的。&lt;/p&gt;
&lt;p&gt;我进入创作平台对舞台做了调整，发现&lt;code&gt;https://cdn2.scratch.mit.edu/get_image/project/279586215_480x360.png&lt;/code&gt;立即变更。从url来看，它利用了cdn，又没有用md5，能做到立即更新，很赞！这应该是CDN平台提供的功能。&lt;/p&gt;
&lt;p&gt;我们对scratch使用的CDN平台感到好奇，决定做一番探索:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;➜  githubblog ping cdn2.scratch.mit.edu
PING d.sni.global.fastly.net (151.101.110.133): 56 data bytes
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;他们在使用&lt;code&gt;fastly&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;最后我们来看下请求缩略图的细节:&lt;code&gt;GET https://cdn2.scratch.mit.edu/get_image/project/279586215_480x360.png&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_f4302433.png" /&gt;&lt;/p&gt;
&lt;p&gt;缓存策略值得我们学习，尤其关注一下&lt;code&gt;etag&lt;/code&gt;。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Tue, 15 Jan 2019 10:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-01-15:Scratch3_asset_analysis_2.html</guid><category>scratch</category></item><item><title>将codelab-adapter用作Python解释器</title><link>/scratch3-adapter-as-python-interpreter.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/python_1a60e935.png" /&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;everything is message; message is everything&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id="_1"&gt;新的插件&lt;/h1&gt;
&lt;p&gt;近期我们构建了
&lt;a href="https://github.com/Scratch3Lab/scratch3_adapter_extensions/blob/master/extension_python_kernel.py"&gt;extension_python_kernel.py&lt;/a&gt;插件， 已经内置在&lt;a href="https://codelab-adapter-docs.codelab.club"&gt;scratch3-adapter&lt;/a&gt;最新版本中&lt;/p&gt;
&lt;p&gt;同时我们正在规划插件市场:&lt;a href="https://codelab-adapter-docs.codelab.club/extension_guide/extension_market/"&gt;extension_market&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/Scratch3Lab/scratch3_adapter_extensions/blob/master/extension_python_kernel.py"&gt;extension_python_kernel.py&lt;/a&gt;插件用以支持以下使用场景：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;将&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;用作Python解释器，解释运行网页发送过来的Python代码&lt;/li&gt;
&lt;li&gt;在Scratch3.0中构建Python REPL&lt;/li&gt;
&lt;li&gt;以简易的方式粘合Python和Scratch3.0&lt;/li&gt;
&lt;li&gt;...&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="codelab-adapterpython"&gt;将codelab-adapter用作Python解释器&lt;/h3&gt;
&lt;p&gt;第一个使用场景: &lt;code&gt;将codelab-adapter用作Python解释器，可以运行网页发送过来的Python代码&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;通过这个插件，允许在前端构建编辑器，而将&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;用作实际运行代码的后端，前端拿到代码执行结果，或者错误信息(stdout/stderr)。这和&lt;a href="https://jupyter.org/"&gt;jupyter&lt;/a&gt;的架构很相似，我之前写过几篇分析jupyter架构的文章，jupyter是codelab-adapter的灵感来源之一。 &lt;/p&gt;
&lt;p&gt;如此一来，为了教学Python，就不必使用javascript实现的Python解释器了。不再需要烦心不同解释器之间的差异。学习者也不会为此困惑。更重要的是，得到了一个完全真实的Python解释器，它可以与网络交互，可以与文件系统交互！你在网页里写的Python代码可以做到任何事！喜欢&lt;code&gt;requests&lt;/code&gt;库？尽情使用它吧，在下个发行版中，我们将在codelab-adapter内置常用的Python库！&lt;/p&gt;
&lt;!--
### 插件的使用方法
我们将在[codelab-adapter](https://codelab-adapter-docs.codelab.club/)内置[extension_python_kernel.py](https://github.com/Scratch3Lab/scratch3_adapter_extensions/blob/master/extension_python_kernel.py)插件，目前在使用前，需要安装它。安装方法很简单，不用担心。

插件的使用方法参考:[extension Usage](https://codelab-adapter-docs.codelab.club/extension_guide/usage/)
--&gt;

&lt;h1 id="scratchpython-repl"&gt;在Scratch中构建Python REPL&lt;/h1&gt;
&lt;p&gt;下边来做一件有趣的事，借助&lt;a href="https://github.com/Scratch3Lab/scratch3_adapter_extensions/blob/master/extension_python_kernel.py"&gt;extension_python_kernel.py&lt;/a&gt;, 搭配codelab的scratch3.0 EIM extension，只需9块积木，就可以在在scratch 3.0中构建一个python REPL！&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/python-interrapter_fd18e1f5.png" /&gt;&lt;/p&gt;
&lt;p&gt;我们创建了一个列表用来容纳输出，这是个非常理想的容器！&lt;/p&gt;
&lt;p&gt;使用&lt;code&gt;询问积木&lt;/code&gt;作为代码的输入框。&lt;/p&gt;
&lt;p&gt;我们来实际测试一下&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/python_08ac7c0b.png" /&gt;&lt;/p&gt;
&lt;p&gt;来测试一个更复杂的代码:&lt;code&gt;import re;print(re.search(r'just4fun', 'blog.just4fun.site').span())&lt;/code&gt;, 测试代码的逻辑是 找出blog.just4fun.site中just4fun的起止位置。&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/python_feada21f.png" /&gt;&lt;/p&gt;
&lt;p&gt;结果显示just4fun的起止位置为&lt;code&gt;(5,13)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;9块积木完成python REPL！&lt;/p&gt;
&lt;h1 id="codelab-adapter"&gt;codelab-adapter可以支持其他编程平台吗？&lt;/h1&gt;
&lt;p&gt;如果你希望将codelab-adapter用作你自己的编程平台(无论是scratch3还是blockly)的Python解释器。参考&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/FAQ/#codelab-adapter"&gt;codelab-adapter可以支持其他编程平台吗？&lt;/a&gt;&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Mon, 14 Jan 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-01-14:scratch3-adapter-as-python-interpreter.html</guid><category>scratch</category></item><item><title>使用Scratch3.0制作幻灯片</title><link>/scratch3-adapter-presentation.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-ppt_d7ba0c14.png" /&gt;&lt;/p&gt;
&lt;p&gt;ps: 文末有演讲稿的scratch程序。&lt;/p&gt;
&lt;h1 id="_1"&gt;周末演讲&lt;/h1&gt;
&lt;p&gt;上周六我们就&lt;a href="https://blog.just4fun.site/about-codelab-club.html"&gt;codelab&lt;/a&gt;在正在做的事情和进展做了一个演讲，与会者们很感兴趣。&lt;/p&gt;
&lt;p&gt;演讲采用的幻灯片，我们使用Scratch3.0来构建.&lt;/p&gt;
&lt;p&gt;在技术领域，&lt;code&gt;自举&lt;/code&gt;是个和&lt;code&gt;递归&lt;/code&gt;一样令人着迷的概念。&lt;a href="https://blog.just4fun.site/about-codelab-club.html"&gt;codelab&lt;/a&gt;之后的演讲都会采用我们自己打造的创作工具来制作。演讲谈及的创作工具，正是用于制作这个演讲内容本身的工具。&lt;/p&gt;
&lt;p&gt;幻灯片里，需要打开超链接、预览PDF，这些是系统功能，Scratch3.0是个网页应用，并不支持这些。为了支持这些演示行为，可以使用&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;内置的&lt;a href="https://github.com/Scratch3Lab/scratch3_adapter_extensions/blob/master/extension_python_kernel.py"&gt;extension_python_kernel.py&lt;/a&gt;插件。&lt;/p&gt;
&lt;p&gt;如果你下回准备采用Scratch3.0制作演讲稿，又需要播放本地视频、打开新的浏览器标签页、预览文件、PDF... 欢迎使用&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;。&lt;/p&gt;
&lt;video width="350px" src="http://wwj-tmp-video.just4fun.site/scratch-adapter-3.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;h3 id="_2"&gt;翻页笔&lt;/h3&gt;
&lt;p&gt;演讲的前一天，想起来一直没有翻页笔，淘宝去买也来不及了，想着是不是自己制作一个？&lt;/p&gt;
&lt;p&gt;一会儿功夫做了三个翻页笔。&lt;/p&gt;
&lt;p&gt;一个micro:bit翻页笔，一个&lt;a href="https://zh.wikipedia.org/zh-hans/Joy-Con"&gt;switch Joy-Con&lt;/a&gt;翻页笔，一个眼动仪翻页笔。&lt;/p&gt;
&lt;p&gt;看看效果:&lt;/p&gt;
&lt;video width="350px" src="http://scratch3-files.just4fun.site/scratch3-adapter-ppt.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;购买任天堂Switch游戏机又多了一个理由： “我需要一个幻灯片翻页笔！”&lt;/p&gt;
&lt;p&gt;从视频中可以看到，多个翻页笔可控制同一个PPT，市面上的翻页笔应该目前还不支持：）多人控制PPT几乎是个伪需求，但这个随手构建的例子演示了你可以在这里构建任何东西。即便只是出于好玩。&lt;/p&gt;
&lt;h3 id="_3"&gt;使用目光控制幻灯片&lt;/h3&gt;
&lt;p&gt;&lt;video width="600px" src="http://scratch3-files.just4fun.site/scratch-adapter-ppt-eye.mp4" controls="controls"&gt;&lt;/video&gt;&lt;/p&gt;
&lt;p&gt;在这个视频中，我们使用目光来控制幻灯片！眼睛盯着下翻的箭头，幻灯片立即翻页，没有任何肢体操作！&lt;/p&gt;
&lt;p&gt;相比于我们前头的例子(switch手柄翻页笔)，它便有实际价值了，考虑一下弱势群体，有许多人双手并不方便（包括霍金）。在codelab的&lt;a href="https://scratch3.codelab.club/"&gt;创作工具&lt;/a&gt;中增加眼控功能， 只需要七个积木！不到一分钟，你就增加了一个软件的新功能！想想微软需要多久为PPT增加一个新特性。&lt;/p&gt;
&lt;h1 id="_4"&gt;演讲稿程序&lt;/h1&gt;
&lt;p&gt;点击下载&lt;a href="http://wwj-tmp-video.just4fun.site/codelab-presentation_0_4.sb3"&gt;演讲稿程序&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="_5"&gt;使用&lt;/h3&gt;
&lt;p&gt;打开&lt;a href="https://scratch3.codelab.club/"&gt;scratch3.codelab.club&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;点击&lt;code&gt;从电脑中上传&lt;/code&gt;，选择你刚才下载的&lt;code&gt;codelab-presentation.sb3&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-ppt_9f4e8f7e.png" /&gt;&lt;/p&gt;
&lt;p&gt;如果你要自定义幻灯片里的内容，首先点击&lt;code&gt;舞台&lt;/code&gt;，然后进入&lt;code&gt;背景&lt;/code&gt;中去调整内容。&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-ppt_9a808724.png" /&gt;&lt;/p&gt;
&lt;p&gt;在没有任何外部设备的情况下，你可以使用电脑的&lt;code&gt;上下方向键&lt;/code&gt;来切换幻灯片，如果你有microbit/switch joy-con/眼动仪，你也可以使用它们。&lt;/p&gt;
&lt;p&gt;如果你需要在幻灯片中打开电脑资源(播放本地视频，打开本地PDF)，需要在scratch3-adapter中打开&lt;a href="https://github.com/Scratch3Lab/scratch3_adapter_extensions/blob/master/extension_python_kernel.py"&gt;extension_python_kernel.py&lt;/a&gt;插件：&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-presentation_61ecc04d.png" /&gt;&lt;/p&gt;
&lt;h1 id="_6"&gt;附录&lt;/h1&gt;
&lt;p&gt;这部分是写给软件开发人员的。&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-ppt_2ed5668d.png" /&gt;&lt;/p&gt;
&lt;p&gt;这一部分的代码是令人诧异的。它似乎是反模式，为何不用RPC？为何直接发送源码？这是什么愚蠢设计？这是我们的精心设计：）&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/Scratch3Lab/scratch3_adapter_extensions/blob/master/extension_python_kernel.py"&gt;extension_python_kernel.py&lt;/a&gt;的插件源码我们已经开源了，源码读起来可能十分奇怪，似乎作者过于偷懒，也过于依赖message，这是采纳dynamicland的架构建议的结果(单一入口)  这个原则加上艾伦凯的&lt;code&gt;everything is message&lt;/code&gt;的建议，构建出来的东西会令亲手构建它的人自己感到震惊。它的灵活和清晰会超出你的预期，这非常反直觉。&lt;/p&gt;
&lt;p&gt;这也正是我们在设计上不认同Scratch link的原因，它缺乏足够好的灵活性。&lt;/p&gt;
&lt;p&gt;很适合从这儿衍生开来，讨论晚绑定(late binding)、面向对象、动态性、Smalltalk、错误处理这些有趣的话题，限于篇幅和主题相关性，在此不多谈论，我近期受艾伦凯影响很深，&lt;code&gt;原来还可以这样构建东西!&lt;/code&gt;之后单独写一篇编程语言/操作系统设计相关话题的文章。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Mon, 14 Jan 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-01-14:scratch3-adapter-presentation.html</guid><category>scratch</category></item><item><title>Scratch3.0、micro:bit与Windows7</title><link>/Scratch3-micro:bit-Windows7.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-microbit_d401c6cc.png" /&gt;&lt;/p&gt;
&lt;h1 id="_1"&gt;前言&lt;/h1&gt;
&lt;p&gt;Scratch3.0在2019.1.2推出后，社区一下子热了起来。从Scratch2.0到Scratch3.0的更新中，显著的一个变化就是增加了对micro:bit的官方支持。&lt;/p&gt;
&lt;p&gt;micro:bit是非常优秀的开源硬件，Scratch3.0对其进行支持，无疑能够帮助用户作出更加有趣的创造，也提高了Scratch的天花板。&lt;/p&gt;
&lt;p&gt;要在Scratch3.0中使用micro:bit，可以参考官方的&lt;a href="https://scratch.mit.edu/microbit"&gt;帮助文档&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;从开发文档中可以看出，我们首先需要在电脑上安装官方的Scratch Link。&lt;/p&gt;
&lt;p&gt;Scratch Link目前有以下依赖:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Windows 10 version 1709+&lt;/li&gt;
&lt;li&gt;macOS 10.13+&lt;/li&gt;
&lt;li&gt;Bluetooth 4.0&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;可以看出Scratch Link对环境要求很严苛。而国内有大量用户/机构在使用Windows7，他们都将无法在Scratch3.0中使用micro:bit。&lt;/p&gt;
&lt;p&gt;如果你也是这些用户之一，你想在Windows7使用Scratch3.0操控micro:bit进行数字创作，&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;是你的理想选择。&lt;/p&gt;
&lt;h1 id="_2"&gt;使用文档&lt;/h1&gt;
&lt;p&gt;使用文档我们已经放在&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;的文档中： &lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/usage/"&gt;使用文档&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="_3"&gt;开放计划&lt;/h1&gt;
&lt;p&gt;scratch3-adapter可以支持其他编程平台吗？而不只是在&lt;a href="https://blog.just4fun.site/about-codelab-club.html"&gt;codelab&lt;/a&gt;的的平台上使用。&lt;/p&gt;
&lt;p&gt;可以的！&lt;/p&gt;
&lt;p&gt;scratch3-adapter几乎支持任何平台，无论是scratch3.0构建的还是blockly构建的(如Tynker和code.org)的，或者你用其他什么黑魔法构建的，都没问题！&lt;/p&gt;
&lt;p&gt;我们近期确实准备将这个能力开放出来，目前在撰写开发文档，并准备开放出相应的源代码。一旦我们开放这部分，我们将允许合作方使用他们的平台来连接万物。&lt;/p&gt;
&lt;p&gt;相关的合作条款我们正在构建中。&lt;/p&gt;
&lt;p&gt;期待接入scratch3-adapter的公司或组织，欢迎联系我们: &lt;code&gt;wuwenjie718@gmail.com&lt;/code&gt;&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Thu, 10 Jan 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-01-10:Scratch3-micro:bit-Windows7.html</guid><category>scratch</category></item><item><title>Scratch3技术分析之创作平台API(第1篇)</title><link>/Scratch3_api_analysis_1.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch_api_00c13663.png" /&gt;&lt;/p&gt;
&lt;h1 id="_1"&gt;&lt;a href="https://scratch.mit.edu/projects/editor/"&gt;创作平台&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Scratch3.0的创作平台在&lt;a href="https://scratch.mit.edu/projects/editor/"&gt;这儿&lt;/a&gt;可以体验。&lt;a href="https://scratch.mit.edu/projects/editor/"&gt;创作平台&lt;/a&gt;是用户的创作工具，用户在这里头拖拽积木，编程程序。我们重点关注&lt;a href="https://scratch.mit.edu/projects/editor/"&gt;创作平台&lt;/a&gt;的这些功能：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;创建新项目&lt;/li&gt;
&lt;li&gt;更新项目&lt;/li&gt;
&lt;li&gt;分享项目&lt;/li&gt;
&lt;li&gt;改编项目&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="https://scratch.mit.edu/projects/editor/"&gt;创作平台&lt;/a&gt;的源代码托管在GitHub: &lt;a href="https://github.com/LLK/scratch-gui"&gt;LLK/scratch-gui&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;在&lt;a href="https://blog.just4fun.site/Scratch3_api_analysis.html"&gt;Scratch3技术分析系列文章中&lt;/a&gt;中，我们计划从&lt;a href="https://scratch.mit.edu/projects/editor/"&gt;创作平台&lt;/a&gt;的后端API开始分析。之后转向分析&lt;a href="https://scratch.mit.edu/"&gt;社区&lt;/a&gt;的后端API。&lt;/p&gt;
&lt;p&gt;下边正式开始我们的分析, 分析主要依赖于Chrome DevTools.&lt;/p&gt;
&lt;h1 id="_2"&gt;打开创作平台&lt;/h1&gt;
&lt;p&gt;在此只讨论已登陆状态。你如果想复现以下分析，需要先注册一个用户。我注册的测试用户是&lt;code&gt;api_test&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;假设你目前已经处于登陆状态。&lt;/p&gt;
&lt;h1 id="_3"&gt;创建新项目&lt;/h1&gt;
&lt;p&gt;每当你打开创作平台: &lt;code&gt;https://scratch.mit.edu/projects/editor&lt;/code&gt;, 你会发现scratch后端自动为你创建了一个新项目，前端redirect到&lt;code&gt;https://scratch.mit.edu/projects/[projects_id]/editor&lt;/code&gt;，形如&lt;code&gt;https://scratch.mit.edu/projects/278159553/editor&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;这块是前端(client)策略，和后端API关系不大。&lt;/p&gt;
&lt;p&gt;之所以提及，是因为它可能令人困惑，因为许多平台，是在第一次提交数据时，才创建项目。而Scratch的创作工具，则在你打开创作工具时，就默认为你创建了项目。&lt;/p&gt;
&lt;p&gt;由于第一次打开就创建(POST)了新项目，于是之后的任何操作都是更新它(PUT)&lt;/p&gt;
&lt;p&gt;创建项目实际是: &lt;code&gt;POST https://projects.scratch.mit.edu/&lt;/code&gt;, 细节如下:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch_api_analyse_3a5178d1.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch_api_22bdc8b2.png" /&gt;&lt;/p&gt;
&lt;p&gt;可以发现，即便用户啥也没做，也会有数据被提交(在&lt;code&gt;request payload&lt;/code&gt;中可以看到). 不过这样一来，POST(创建)和之后的PUT(保存用户作品)几乎一致。&lt;/p&gt;
&lt;p&gt;后端返回:&lt;code&gt;{"status":"ok","content-name":"278159553","content-title":"VW50aXRsZWQtMzY=","autosave-interval":"120"}&lt;/code&gt;&lt;/p&gt;
&lt;h1 id="_4"&gt;保存数据&lt;/h1&gt;
&lt;p&gt;搭建两块积木，点击立即保存&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch_api_00c13663.png" /&gt;&lt;/p&gt;
&lt;p&gt;保存期间，与后端发生了3次api交互:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;OPTIONS https://projects.scratch.mit.edu/278159553
PUT https://projects.scratch.mit.edu/278159553
POST https://scratch.mit.edu/internalapi/project/thumbnail/278159553/set/
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;OPTIONS https://projects.scratch.mit.edu/278159553&lt;/code&gt;可以忽视，OPTIONS是Request Method的一种，用于获取目的资源所支持的通信选项。&lt;/p&gt;
&lt;hr /&gt;
&lt;h3 id="json"&gt;保存项目数据（json）&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;PUT https://projects.scratch.mit.edu/278159553&lt;/code&gt; 的请求细节为:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_42a3d036.png" /&gt;&lt;/p&gt;
&lt;p&gt;如果你对官方的后端技术栈感兴趣(希望不是为了做坏事)，多关注&lt;code&gt;Response Headers&lt;/code&gt;，其中&lt;code&gt;server: restify&lt;/code&gt;暴露了scratch的后端框架用了&lt;a href="http://restify.com/"&gt;restify&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;我们来看看提交的数据.(不必去理解它，为了构建后端API，无需注意提交的json数据的内部细节)&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_825413e8.png" /&gt;&lt;/p&gt;
&lt;p&gt;从&lt;code&gt;Request Headers&lt;/code&gt;中我们得知&lt;code&gt;content-type: application/json&lt;/code&gt;, 数据以json格式发往后端。&lt;/p&gt;
&lt;p&gt;保存的数据为:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;targets&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;isStage&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Stage&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;variables&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;`jEk@4|i[#Fk?(8x)AV.-my variable&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;我的变量&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;lists&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;broadcasts&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;blocks&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;comments&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;currentCostume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;costumes&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;cd21514d0531fdffb22204e0ec5ed84a&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;背景1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;cd21514d0531fdffb22204e0ec5ed84a.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;240&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;180&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sounds&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83a9787d4cb6f3b7632b4ddfebf74367&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;啵&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;format&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rate&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;44100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sampleCount&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1032&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83a9787d4cb6f3b7632b4ddfebf74367.wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;volume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;layerOrder&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;tempo&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;60&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;videoTransparency&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;videoState&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;on&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;textToSpeechLanguage&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;},{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;isStage&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;角色1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;variables&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;lists&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;broadcasts&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;blocks&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;qI)a2qkxK=]VtK^%eH@~&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;motion_movesteps&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;FYZnCl:MFx`sQhhiEwkj&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;STEPS&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;FYZnCl:MFx`sQhhiEwkj&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;event_whenflagclicked&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;qI)a2qkxK=]VtK^%eH@~&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;150&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;}},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;comments&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;currentCostume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;costumes&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;b7853f557e4426412e64bb3da6531a99&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;造型1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;bitmapResolution&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;b7853f557e4426412e64bb3da6531a99.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;48&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;},{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;e6ddc55a6ddd9cc9d84fe0b4c21e016f&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;造型2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;bitmapResolution&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;e6ddc55a6ddd9cc9d84fe0b4c21e016f.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;46&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;53&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sounds&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83c36d806dc92327b9e7049a565c6bff&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;喵&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;format&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rate&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;44100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sampleCount&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;37376&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83c36d806dc92327b9e7049a565c6bff.wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;volume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;layerOrder&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;visible&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;size&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;direction&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;90&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;draggable&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationStyle&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;all around&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;monitors&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;extensions&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;meta&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;semver&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;3.0.0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;vm&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;0.2.0-prerelease.20190107184530&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;agent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;之后我们单独写一篇文章讨论Scratch的项目数据结构，它是被精心设计过的，非常优美。&lt;/p&gt;
&lt;p&gt;后端的返回json作为响应&lt;code&gt;{"status":"ok","content-length":32744,"content-name":"278159553","autosave-internal":"120","result-code":0}&lt;/code&gt;， &lt;code&gt;Status Code&lt;/code&gt;为200。 非常REST。&lt;/p&gt;
&lt;hr /&gt;
&lt;h3 id="_5"&gt;更新项目缩略图&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;POST https://scratch.mit.edu/internalapi/project/thumbnail/278159553/set/&lt;/code&gt;用于更新项目的缩略图。&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_33595f1a.png" /&gt;&lt;/p&gt;
&lt;p&gt;舞台区将被截图发网后端(之后在社区和项目展示页作为项目的封面)&lt;/p&gt;
&lt;h1 id="get"&gt;获取项目数据(GET)&lt;/h1&gt;
&lt;p&gt;在新页面打开我们刚才保存的项目:&lt;code&gt;https://scratch.mit.edu/projects/278159553/editor&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;关注以下API交互:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;GET https://projects.scratch.mit.edu/278159553
GET https://api.scratch.mit.edu/projects/278159553
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;GET https://projects.scratch.mit.edu/278159553&lt;/code&gt;后台返回的数据，正是我们刚才提交的:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;targets&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;isStage&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Stage&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;variables&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;`jEk@4|i[#Fk?(8x)AV.-my variable&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;æçåé&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;lists&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;broadcasts&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;blocks&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;comments&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;currentCostume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;costumes&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;cd21514d0531fdffb22204e0ec5ed84a&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;èæ¯1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;cd21514d0531fdffb22204e0ec5ed84a.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;240&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;180&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sounds&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83a9787d4cb6f3b7632b4ddfebf74367&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;åµ&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;format&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rate&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;44100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sampleCount&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1032&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83a9787d4cb6f3b7632b4ddfebf74367.wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;volume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;layerOrder&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;tempo&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;60&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;videoTransparency&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;videoState&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;on&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;textToSpeechLanguage&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;},{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;isStage&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;è§è²1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;variables&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;lists&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;broadcasts&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;blocks&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;qI)a2qkxK=]VtK^%eH@~&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;motion_movesteps&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;FYZnCl:MFx`sQhhiEwkj&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;STEPS&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;FYZnCl:MFx`sQhhiEwkj&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;event_whenflagclicked&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;qI)a2qkxK=]VtK^%eH@~&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;150&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;}},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;comments&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;currentCostume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;costumes&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;b7853f557e4426412e64bb3da6531a99&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;é å1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;bitmapResolution&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;b7853f557e4426412e64bb3da6531a99.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;48&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;},{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;e6ddc55a6ddd9cc9d84fe0b4c21e016f&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;é å2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;bitmapResolution&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;e6ddc55a6ddd9cc9d84fe0b4c21e016f.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;46&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;53&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sounds&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83c36d806dc92327b9e7049a565c6bff&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;åµ&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;format&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rate&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;44100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sampleCount&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;37376&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83c36d806dc92327b9e7049a565c6bff.wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;volume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;layerOrder&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;visible&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;size&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;direction&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;90&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;draggable&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationStyle&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;all around&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;monitors&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;extensions&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;meta&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;semver&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;3.0.0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;vm&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;0.2.0-prerelease.20190107184530&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;agent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;我们将&lt;code&gt;https://projects.scratch.mit.edu/278159553&lt;/code&gt;提供的信息称为&lt;code&gt;项目的内部数据&lt;/code&gt;。这部分信息是scratch项目的数据表示形式。它的另一个表示形式是scratch程序。我们将项目保存到本地时，这些json整个在一个文件中，所以我们可以把它整体视为静态文件。&lt;/p&gt;
&lt;!--
存在数据库(mongo)中的好处是，易于分析，存成静态文件的好处是易于CDN 但很小。
存本地需要作为文件考虑 座位id保存？ 更新怎么办， 变更之后怎么更新 云 不缓存 
scratch官方
  etag
  server: AmazonS3
  以为着没法分析。

https://projects.scratch.mit.edu/278159553 视为api 没有model . 作为

api.scratch.mit.edu/projects/json/278159553 -&gt; https://projects.scratch.mit.edu/278159553
创建项目应该是 POST api.scratch.mit.edu/projects

--&gt;

&lt;p&gt;看到这里，小伙伴可能有点纳闷了，怎么返回的数据中没有项目meta信息： 项目的名字啦、项目点赞数啦、项目id啦、项目的缩略图地址啦之类的东西。&lt;/p&gt;
&lt;p&gt;这些信息由&lt;code&gt;GET https://api.scratch.mit.edu/projects/278159553&lt;/code&gt;接口系统&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;278159553&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;title&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Untitled-36&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;description&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;instructions&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;visibility&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;visible&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;public&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;comments_allowed&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;is_published&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;author&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;18286387&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;username&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;wwj718&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;scratchteam&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;history&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;joined&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;1900-01-01T00:00:00.000Z&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;profile&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="s2"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="s2"&gt;&amp;quot;images&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;90x90&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/user/18286387_90x90.png?v=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;60x60&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/user/18286387_60x60.png?v=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;55x55&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/user/18286387_55x55.png?v=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;50x50&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/user/18286387_50x50.png?v=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;32x32&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/user/18286387_32x32.png?v=&amp;quot;&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;image&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/278159553_480x360.png&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;images&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;282x218&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/278159553_282x218.png?v=1547026704&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;216x163&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/278159553_216x163.png?v=1547026704&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;200x200&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/278159553_200x200.png?v=1547026704&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;144x108&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/278159553_144x108.png?v=1547026704&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;135x102&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/278159553_135x102.png?v=1547026704&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;100x80&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/278159553_100x80.png?v=1547026704&amp;quot;&lt;/span&gt;
  &lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;history&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;created&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2019-01-09T09:16:15.000Z&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;modified&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2019-01-09T09:38:24.000Z&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;shared&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2019-01-09T11:02:36.000Z&amp;quot;&lt;/span&gt; &lt;span class="c1"&gt;// 未分享是null&lt;/span&gt;
  &lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;stats&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;views&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;loves&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;favorites&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;comments&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;remixes&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
  &lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;remix&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;root&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;我们把这些数据称为&lt;code&gt;项目的外部数据&lt;/code&gt;，主要与项目的社交属性有关(分享/点赞/混合)。&lt;/p&gt;
&lt;p&gt;至此我们差不多就可以构建Scratch project的后端model了。&lt;/p&gt;
&lt;p&gt;顺便也把&lt;code&gt;GET https://api.scratch.mit.edu/projects/278159553&lt;/code&gt;的通信细节列出&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/sscratch-api_6e728ecb.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_d87b04f5.png" /&gt;&lt;/p&gt;
&lt;h1 id="_6"&gt;分享项目&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;PUT https://api.scratch.mit.edu/proxy/projects/278159553/share&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;后端返回:&lt;code&gt;{"is_published":"true"}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;交互细节&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_56a0d249.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_a1ff7efd.png" /&gt;&lt;/p&gt;
&lt;p&gt;这里值得一提的是。url中包含&lt;code&gt;proxy&lt;/code&gt;,从语义猜测，这是个过度阶段得api，原先这部分的api用django写，目前还没有使用restify完全实现，只是在restify中包装了django得api。 其中&lt;code&gt;x-csrftoken&lt;/code&gt;很可能就是django需要的header参数。&lt;/p&gt;
&lt;h1 id="_7"&gt;改编项目&lt;/h1&gt;
&lt;p&gt;改编项目，概念颇似github中的fork。&lt;/p&gt;
&lt;p&gt;我们来改编这个项目: &lt;code&gt;https://scratch.mit.edu/projects/276660763/editor/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_21fc6e71.png" /&gt;&lt;/p&gt;
&lt;p&gt;点击改变，URL变为&lt;code&gt;https://scratch.mit.edu/projects/278183746/editor&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;发生的API交互为:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;POST https://projects.scratch.mit.edu/?is_remix=1&amp;amp;original_id=276660763&amp;amp;title=Scratch%203.0%20is%20here%21
POST https://scratch.mit.edu/internalapi/project/thumbnail/278183746/set/
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可见，改编本质上是基于当前页面的项目数据，创建新项目，在url参数中说明改编自什么父项目！API的一致性非常好！&lt;/p&gt;
&lt;p&gt;&lt;code&gt;POST https://projects.scratch.mit.edu/?is_remix=1&amp;amp;original_id=276660763&amp;amp;title=Scratch%203.0%20is%20here%21&lt;/code&gt;返回:&lt;/p&gt;
&lt;p&gt;{"status":"ok","content-name":"278183746","content-title":"U2NyYXRjaCAzLjAgaXMgaGVyZSEgcmVtaXgtMw==","autosave-interval":"120"}&lt;/p&gt;
&lt;h3 id="_8"&gt;获取改编项目的数据&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;GET https://projects.scratch.mit.edu/278183746&lt;/code&gt; （项目的内部数据）&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;targets&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;isStage&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Stage&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;variables&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;lists&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;broadcasts&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;blocks&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;3cR(o:tw]HBgKsti_Q)S&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;event_whenflagclicked&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;+kvKfEp%EYSJFj%RGky2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;52&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;49&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;+kvKfEp%EYSJFj%RGky2&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;control_forever&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;3cR(o:tw]HBgKsti_Q)S&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUBSTACK&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;:T1p=hf!cs59HaF5n8Id&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;:T1p=hf!cs59HaF5n8Id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sound_playuntildone&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;+kvKfEp%EYSJFj%RGky2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SOUND_MENU&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;x##owp)CLS^@CW|%Mr;a&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;x##owp)CLS^@CW|%Mr;a&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sound_sounds_menu&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;:T1p=hf!cs59HaF5n8Id&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SOUND_MENU&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Celebration Song&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;}},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;comments&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;currentCostume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;costumes&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;e42904fd488ec20699e3525b2e768c4e&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Background&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;bitmapResolution&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;e42904fd488ec20699e3525b2e768c4e.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;240&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;180&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sounds&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;65fb0fd9faf8ecdb07e203998b6067fc&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Celebration Song&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rate&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;22050&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sampleCount&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;5688585&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;65fb0fd9faf8ecdb07e203998b6067fc.wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;volume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;layerOrder&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;tempo&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;60&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;videoTransparency&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;videoState&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;off&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;textToSpeechLanguage&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;},{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;isStage&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Scratch Cat&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;variables&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;lists&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;broadcasts&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;blocks&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;DAgri|f0b0-qvj1dbB(j&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;event_whenflagclicked&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;))L(a^)NJBLu*qnD0zqW&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;63&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;58&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;))L(a^)NJBLu*qnD0zqW&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;motion_gotoxy&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;3i1!GO9qPSqF`B([=qgD&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;DAgri|f0b0-qvj1dbB(j&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;X&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Y&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;3i1!GO9qPSqF`B([=qgD&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;motion_setrotationstyle&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;xEl;UQ[q([{FmimS]%nc&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;))L(a^)NJBLu*qnD0zqW&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;STYLE&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;left-right&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;xEl;UQ[q([{FmimS]%nc&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;looks_switchcostumeto&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sxxM;2LRrhj2ogrDc4G}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;3i1!GO9qPSqF`B([=qgD&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;COSTUME&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;%+B_`S0Uff?]w.;4B`}P&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;%+B_`S0Uff?]w.;4B`}P&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;looks_costume&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;xEl;UQ[q([{FmimS]%nc&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;COSTUME&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Launch Dance 1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sxxM;2LRrhj2ogrDc4G}&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;control_forever&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;xEl;UQ[q([{FmimS]%nc&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUBSTACK&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/{pGoV)XFJUG71~PJGQo&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/{pGoV)XFJUG71~PJGQo&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;motion_pointindirection&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;z8yx%IhP{jKU|J3xiQO7&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sxxM;2LRrhj2ogrDc4G}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;DIRECTION&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;90&lt;/span&gt;&lt;span class="p"&gt;]]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;z8yx%IhP{jKU|J3xiQO7&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;control_repeat&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;[#%1}sI.R5vOsvH28L^/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/{pGoV)XFJUG71~PJGQo&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TIMES&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUBSTACK&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;PZc2Hh||URK}Ra6S3KXz&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;PZc2Hh||URK}Ra6S3KXz&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;looks_nextcostume&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;.FblvK`:%q_p`Z}_qs0M&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;z8yx%IhP{jKU|J3xiQO7&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;.FblvK`:%q_p`Z}_qs0M&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;control_wait&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;PZc2Hh||URK}Ra6S3KXz&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;DURATION&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;]]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;[#%1}sI.R5vOsvH28L^/&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;motion_pointindirection&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;uNba4/i7dp)@C^Q[4iRy&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;z8yx%IhP{jKU|J3xiQO7&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;DIRECTION&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;90&lt;/span&gt;&lt;span class="p"&gt;]]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;uNba4/i7dp)@C^Q[4iRy&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;control_repeat&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;[#%1}sI.R5vOsvH28L^/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TIMES&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUBSTACK&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;]q[m:+M5h)*ueKe1F=wN&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;]q[m:+M5h)*ueKe1F=wN&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;looks_nextcostume&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;tdjsS~#EW5lD=RwVT?8(&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;uNba4/i7dp)@C^Q[4iRy&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;tdjsS~#EW5lD=RwVT?8(&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;control_wait&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;]q[m:+M5h)*ueKe1F=wN&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;DURATION&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;]]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;}},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;comments&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;currentCostume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;costumes&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;7b7b5534b7220d7b3b650fb0ef4c1231&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Launch Dance 1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;bitmapResolution&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;7b7b5534b7220d7b3b650fb0ef4c1231.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;78&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;135&lt;/span&gt;&lt;span class="p"&gt;},{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;6f5cfd00497303a9df804baca5ba46cd&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Launch Dance 2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;bitmapResolution&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;6f5cfd00497303a9df804baca5ba46cd.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;78&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;145&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sounds&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83a9787d4cb6f3b7632b4ddfebf74367&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;pop&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;format&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rate&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;44100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sampleCount&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1032&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83a9787d4cb6f3b7632b4ddfebf74367.wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;volume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;layerOrder&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;visible&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;size&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;direction&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;90&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;draggable&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationStyle&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;left-right&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;},{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;isStage&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;confetti&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;variables&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;lists&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;broadcasts&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;blocks&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;*M6p!(P?e@riXF+:j/Zn&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;event_whenflagclicked&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;EpRWF`|+9^X@p]]njua1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;42&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;59&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;EpRWF`|+9^X@p]]njua1&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;looks_hide&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;hB}JrE-+#L0gT~6/p*y6&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;*M6p!(P?e@riXF+:j/Zn&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;hB}JrE-+#L0gT~6/p*y6&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;control_forever&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;EpRWF`|+9^X@p]]njua1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SUBSTACK&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;!x*HhPq?~.6BeqTsZ4ro&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;!x*HhPq?~.6BeqTsZ4ro&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;control_create_clone_of&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;hB}JrE-+#L0gT~6/p*y6&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;CLONE_OPTION&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;{?bm)?kpbHHW{mqNzvqI&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;{?bm)?kpbHHW{mqNzvqI&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;control_create_clone_of_menu&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;!x*HhPq?~.6BeqTsZ4ro&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;CLONE_OPTION&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;_myself_&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;FM!NAH@`eu4UT,JPH/]^&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;control_start_as_clone&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;ch1sNDRxQpDV}Fl:]C?a&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;55&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;490&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;ch1sNDRxQpDV}Fl:]C?a&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;looks_show&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;gm-8lOB8OHXcR*,4@D!G&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;FM!NAH@`eu4UT,JPH/]^&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;gm-8lOB8OHXcR*,4@D!G&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;motion_gotoxy&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;iw/rG]nC]vw,kLCSqSVh&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;ch1sNDRxQpDV}Fl:]C?a&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;X&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;09Nmy6@[tVNmU!_[eZB2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;]],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Y&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;180&lt;/span&gt;&lt;span class="p"&gt;]]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;09Nmy6@[tVNmU!_[eZB2&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;operator_random&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;gm-8lOB8OHXcR*,4@D!G&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;FROM&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;233&lt;/span&gt;&lt;span class="p"&gt;]],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TO&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;233&lt;/span&gt;&lt;span class="p"&gt;]]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;iw/rG]nC]vw,kLCSqSVh&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;looks_switchcostumeto&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;]-u,r6LbB#*_w0nPF82S&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;gm-8lOB8OHXcR*,4@D!G&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;COSTUME&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;odmz7bTTPOm-N@Vdog]5&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;IDT#NqY,5U6(`G7!ax*}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;odmz7bTTPOm-N@Vdog]5&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;operator_random&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;iw/rG]nC]vw,kLCSqSVh&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;FROM&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TO&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;IDT#NqY,5U6(`G7!ax*}&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;looks_costume&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;iw/rG]nC]vw,kLCSqSVh&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;COSTUME&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;]-u,r6LbB#*_w0nPF82S&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;looks_seteffectto&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;`Eln_V*EJZG{h=LX3)^x&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;iw/rG]nC]vw,kLCSqSVh&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;VALUE&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;V[DD].JkDo647[(M*,d4&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;]]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;EFFECT&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;color&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;V[DD].JkDo647[(M*,d4&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;operator_random&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;]-u,r6LbB#*_w0nPF82S&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;FROM&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TO&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;]]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;`Eln_V*EJZG{h=LX3)^x&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;looks_setsizeto&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Dj]~SwUD+Kw{~8[Xu0~`&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;]-u,r6LbB#*_w0nPF82S&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SIZE&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;+/)uc{CnYnmR[N#P41Eu&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;]]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;+/)uc{CnYnmR[N#P41Eu&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;operator_random&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;`Eln_V*EJZG{h=LX3)^x&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;FROM&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;]],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TO&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;125&lt;/span&gt;&lt;span class="p"&gt;]]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Dj]~SwUD+Kw{~8[Xu0~`&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;motion_glidesecstoxy&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;RN;6V~MOndS*z3K+X_AK&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;`Eln_V*EJZG{h=LX3)^x&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SECS&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;tXzt,MO(_+Gie9j!MEG+&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;]],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;X&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;o*`O]VAp(2f=cuGYZ%Wg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;]],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Y&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;177&lt;/span&gt;&lt;span class="p"&gt;]]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;tXzt,MO(_+Gie9j!MEG+&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;operator_random&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Dj]~SwUD+Kw{~8[Xu0~`&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;FROM&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;]],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;TO&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;o*`O]VAp(2f=cuGYZ%Wg&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;motion_xposition&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Dj]~SwUD+Kw{~8[Xu0~`&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;RN;6V~MOndS*z3K+X_AK&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;control_delete_this_clone&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Dj]~SwUD+Kw{~8[Xu0~`&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;}},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;comments&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;currentCostume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;costumes&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;024e4a12770c91f6843e1f1773a31272&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;costume1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;bitmapResolution&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;024e4a12770c91f6843e1f1773a31272.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;},{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;8e54feb32cdddc3a3dc146f48777479c&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;costume2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;bitmapResolution&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;8e54feb32cdddc3a3dc146f48777479c.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;},{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;c32c7bcb9f5870a824f6f8ce1facebf8&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;costume3&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;bitmapResolution&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;c32c7bcb9f5870a824f6f8ce1facebf8.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;},{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;e2b2d97f76d0f3fcc54dc0d192976eec&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;costume4&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;bitmapResolution&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;e2b2d97f76d0f3fcc54dc0d192976eec.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sounds&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83a9787d4cb6f3b7632b4ddfebf74367&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;pop&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;format&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rate&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;44100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sampleCount&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1032&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83a9787d4cb6f3b7632b4ddfebf74367.wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;volume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;layerOrder&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;visible&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:-&lt;/span&gt;&lt;span class="mi"&gt;164&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:-&lt;/span&gt;&lt;span class="mi"&gt;177&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;size&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;direction&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;90&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;draggable&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationStyle&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;all around&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;},{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;isStage&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Thumbnail&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;variables&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;lists&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;broadcasts&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;blocks&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;v|[%SWWcCG_z#=5k8^(m&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;event_whenflagclicked&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;@YebWp8N.]:!u1QFj}p[&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;59&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;68&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;@YebWp8N.]:!u1QFj}p[&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;motion_gotoxy&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;8^cnVM0FqA*GtC:wq0XD&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;v|[%SWWcCG_z#=5k8^(m&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;X&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Y&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;8^cnVM0FqA*GtC:wq0XD&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;looks_seteffectto&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;@YebWp8N.]:!u1QFj}p[&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;VALUE&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;100&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;EFFECT&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;ghost&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;}},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;comments&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;currentCostume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;costumes&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;8e5cc5d3958709d6a80bde80f94751f9&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Editable&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;bitmapResolution&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;8e5cc5d3958709d6a80bde80f94751f9.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;240&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;180&lt;/span&gt;&lt;span class="p"&gt;},{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;9230a0b1c1176bf5ce32b3a79f16405b&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Thumbnail&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;bitmapResolution&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;9230a0b1c1176bf5ce32b3a79f16405b.png&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;png&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;480&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;360&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sounds&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83a9787d4cb6f3b7632b4ddfebf74367&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;pop&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;format&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rate&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;44100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sampleCount&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1032&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83a9787d4cb6f3b7632b4ddfebf74367.wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;volume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;layerOrder&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;visible&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;size&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;direction&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;90&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;draggable&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationStyle&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;all around&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;monitors&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;extensions&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;meta&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;semver&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;3.0.0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;vm&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;0.2.0-prerelease.20190107184530&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;agent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;GET https://api.scratch.mit.edu/projects/278183746&lt;/code&gt;（项目的外部数据）&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;278183746&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;title&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Scratch 3.0 is here! remix-3&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;description&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;instructions&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Scratch 3.0 is here! \n\nRemix this project and join us in celebration! We look forward to seeing what you create :D\n\nMeow!\n=^..^=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;visibility&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;visible&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;public&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;comments_allowed&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;is_published&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;author&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;18286387&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;username&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;wwj718&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;scratchteam&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;history&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;joined&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;1900-01-01T00:00:00.000Z&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;profile&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="s2"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="s2"&gt;&amp;quot;images&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;90x90&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/user/18286387_90x90.png?v=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;60x60&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/user/18286387_60x60.png?v=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;55x55&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/user/18286387_55x55.png?v=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;50x50&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/user/18286387_50x50.png?v=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;32x32&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/user/18286387_32x32.png?v=&amp;quot;&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;image&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/278183746_480x360.png&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;images&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;282x218&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/278183746_282x218.png?v=1547032372&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;216x163&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/278183746_216x163.png?v=1547032372&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;200x200&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/278183746_200x200.png?v=1547032372&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;144x108&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/278183746_144x108.png?v=1547032372&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;135x102&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/278183746_135x102.png?v=1547032372&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;100x80&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/278183746_100x80.png?v=1547032372&amp;quot;&lt;/span&gt;
  &lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;history&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;created&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2019-01-09T11:12:51.000Z&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;modified&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2019-01-09T11:12:52.000Z&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;shared&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;
  &lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;stats&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;views&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;loves&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;favorites&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;comments&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;remixes&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
  &lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;remix&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;276660763&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;root&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;276660763&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;hr /&gt;
&lt;p&gt;2019.01.21更新&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;以上人有些数据有空缺，我给出一份更完整的:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;281071071&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;title&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Scratch Translate 2.0 remix&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;description&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;instructions&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Make sure your sound is on! This translator features ambient music and some nifty sound effects :)\n\nWith the recent addition of text to speech and translation functions, this is currently the most advanced translator on Scratch possible! Featuring...\n\n-12 unique languages\n-Mobile support\n-Text to speech in respective languages\n-Prompts based on chosen language\n-Swapping two languages\n-Translating without retyping phrases\n\nInstructions:\nSelect the respective language by clicking the drop down button. The switch button in the center allows you to swap between two languages. When trying to translate a phrase into different languages, you can change the second language and your translation will automatically update! If you want to write a new phrase, press space or use the translation button. Finally, you can listen to text-to-speech using the sound buttons.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;visibility&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;visible&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;public&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;comments_allowed&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;is_published&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;author&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;18286387&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;username&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;wwj718&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;scratchteam&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;history&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;joined&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;1900-01-01T00:00:00.000Z&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;profile&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="s2"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="s2"&gt;&amp;quot;images&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;90x90&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/user/18286387_90x90.png?v=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;60x60&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/user/18286387_60x60.png?v=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;55x55&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/user/18286387_55x55.png?v=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;50x50&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/user/18286387_50x50.png?v=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;32x32&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/user/18286387_32x32.png?v=&amp;quot;&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;image&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/281071071_480x360.png&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;images&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;282x218&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/281071071_282x218.png?v=1548057585&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;216x163&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/281071071_216x163.png?v=1548057585&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;200x200&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/281071071_200x200.png?v=1548057585&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;144x108&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/281071071_144x108.png?v=1548057585&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;135x102&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/281071071_135x102.png?v=1548057585&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;100x80&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://cdn2.scratch.mit.edu/get_image/project/281071071_100x80.png?v=1548057585&amp;quot;&lt;/span&gt;
  &lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;history&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;created&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2019-01-21T07:54:14.000Z&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;modified&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2019-01-21T07:59:45.000Z&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;shared&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2019-01-21T07:59:45.000Z&amp;quot;&lt;/span&gt;
  &lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;stats&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;views&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;loves&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;favorites&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;comments&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;remixes&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
  &lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;remix&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;279503424&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;root&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;279207380&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="_9"&gt;删除项目&lt;/h3&gt;
&lt;p&gt;目前需要到&lt;code&gt;https://scratch.mit.edu/mystuff/&lt;/code&gt;里边才能删除项目。首先你要将项目改为&lt;code&gt;非分享&lt;/code&gt;模式，然后才能删除。&lt;/p&gt;
&lt;p&gt;删除项目的web请求为:&lt;code&gt;PUT https://scratch.mit.edu/site-api/projects/all/281079681/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;请求数据为:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;view_count&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;favorite_count&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;remixers_count&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;creator&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;wwj718&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;title&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Untitled-40&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;isPublished&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;datetime_created&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2019-01-21T08:52:31&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;thumbnail_url&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;//uploads.scratch.mit.edu/projects/thumbnails/281079681.png&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;visibility&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;trshbyusr&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;love_count&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;datetime_modified&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2019-01-21T09:22:56.784&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;uncached_thumbnail_url&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;//cdn2.scratch.mit.edu/get_image/project/281079681_100x80.png&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;thumbnail&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;281079681.png&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;datetime_shared&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2019-01-21T08:54:17&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;commenters_count&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;281079681&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;需要注意:&lt;code&gt;"visibility": "trshbyusr",&lt;/code&gt;，trshbyusr意思因该是用户将项目移到垃圾桶。应该是伪删除。&lt;/p&gt;
&lt;p&gt;ps：这个接口目前正在迁移中。&lt;/p&gt;
&lt;p&gt;你仍然可以访问到该项目，只是它在垃圾桶里:&lt;code&gt;https://scratch.mit.edu/projects/281079681/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;可以看到，当前项目外部数据为:&lt;code&gt;"visibility": "notvisible",&lt;/code&gt;&lt;/p&gt;
&lt;h1 id="_10"&gt;非法请求&lt;/h1&gt;
&lt;p&gt;为了让我们自定义的后端兼容scratch的前端，我们需要把&lt;code&gt;非法请求&lt;/code&gt;的后端响应也做个分析. 以便后端对错误的响应和官方完全一致，这样我们就不必对scratch前端做任何修改。&lt;/p&gt;
&lt;p&gt;我们重点分析，这两种典型的请求错误。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;未登录&lt;/li&gt;
&lt;li&gt;提交错误数据&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="_11"&gt;未登录&lt;/h3&gt;
&lt;p&gt;未登录状态下与需要用户身份的API交互，产生的错误，一般是403错误。&lt;/p&gt;
&lt;p&gt;一试之下，果不其然（使用&lt;a href="https://github.com/jakubroztocil/httpie"&gt;httpie&lt;/a&gt;测试）&lt;/p&gt;
&lt;p&gt;http PUT https://projects.scratch.mit.edu/278159553 &lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_91f83662.png" /&gt;&lt;/p&gt;
&lt;h3 id="_12"&gt;提交错误数据&lt;/h3&gt;
&lt;p&gt;接下来，我们来模拟提交错误数据。(已登陆)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;http PUT https://projects.scratch.mit.edu/278159553  &lt;span class="s1"&gt;&amp;#39;Cookie:_ga=GA1.3.971025469.1526828393; _ga=GA1.2.1108813793.1527058082; ajs_user_id=null; ajs_group_id=null; ajs_anonymous_id=%22006109e0-522e-443a-89fc-0d5ce2d618ce%22; __unam=70b497d-16492cf2b97-22ea0fd0-2; __utmc=133675020; _gcl_au=1.1.1178771398.1541398301; scratchcsrftoken=6yewIduDcyNoLwsdlzFu9U8ruIGR6d82; _gid=GA1.3.1921625291.1547005822; __utmz=133675020.1547009438.121.16.utmcsr=google|utmccn=(organic)|utmcmd=organic|utmctr=(not%20provided); __utma=133675020.971025469.1526828393.1547009438.1547028631.122; __utmb=133675020.0.10.1547028631; scratchsessionsid=&amp;quot;.eJxVj0tPxCAUhf8La6cWKNDObiYZ3agLjRrdNBQuLX3ApI80qfG_C6ab2d2c75ybc37QMsHo5ADoiNa1FThHd6iUy9yUkZRWB4BzknOai4BmmGblfWf_A37sQN8GKqk6cDEVNXCzVXK23iU7mJJXuPa7eN7N4a8PRwgpkxJdcG0w5RkWpCgMEQpLATkTBSbH7_ppaR634bn94Kf2gZ2bt-398Fmm2yW86X1t3cFeY2lME84TLGiSp7FjL129yDoW35qDckHTbdB8OdsBNu8iOQ0whnL3L7CWX2He7bhGTk0waWwAdGqqQgJlnBFlKFSp4lRWQEhmqGIZ4Qz9_gGKgHFO:1ghAol:ZmjO6wosjoQAYN0n5dCpVvrrkA4&amp;quot;&amp;#39;&lt;/span&gt; &amp;lt; /tmp/project.json
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Cookie数据从Chrome DevTools中获得。&lt;/p&gt;
&lt;p&gt;第一次我使用有效的项目数据(json)去更新它(将角色名字改为&lt;code&gt;test1&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;&lt;code&gt;cat /tmp/project.json&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;targets&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;isStage&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Stage&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;variables&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;`jEk@4|i[#Fk?(8x)AV.-my variable&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;æçåé&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;lists&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;broadcasts&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;blocks&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;comments&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;currentCostume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;costumes&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;cd21514d0531fdffb22204e0ec5ed84a&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;èæ¯1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;cd21514d0531fdffb22204e0ec5ed84a.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;240&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;180&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sounds&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83a9787d4cb6f3b7632b4ddfebf74367&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;åµ&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;format&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rate&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;44100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sampleCount&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1032&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83a9787d4cb6f3b7632b4ddfebf74367.wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;volume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;layerOrder&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;tempo&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;60&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;videoTransparency&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;videoState&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;on&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;textToSpeechLanguage&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;},{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;isStage&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;test1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;variables&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;lists&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;broadcasts&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;blocks&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;qI)a2qkxK=]VtK^%eH@~&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;motion_movesteps&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;FYZnCl:MFx`sQhhiEwkj&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;STEPS&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;FYZnCl:MFx`sQhhiEwkj&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;event_whenflagclicked&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;qI)a2qkxK=]VtK^%eH@~&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;150&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;}},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;comments&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;currentCostume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;costumes&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;b7853f557e4426412e64bb3da6531a99&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;é å1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;bitmapResolution&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;b7853f557e4426412e64bb3da6531a99.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;48&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;},{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;e6ddc55a6ddd9cc9d84fe0b4c21e016f&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;é å2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;bitmapResolution&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;e6ddc55a6ddd9cc9d84fe0b4c21e016f.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;46&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;53&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sounds&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83c36d806dc92327b9e7049a565c6bff&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;åµ&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;format&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rate&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;44100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sampleCount&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;37376&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83c36d806dc92327b9e7049a565c6bff.wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;volume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;layerOrder&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;visible&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;size&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;direction&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;90&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;draggable&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationStyle&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;all around&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;monitors&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;extensions&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;meta&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;semver&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;3.0.0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;vm&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;0.2.0-prerelease.20190107184530&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;agent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_92721dee.png" /&gt;&lt;/p&gt;
&lt;p&gt;修改成功:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch-api_edcaa8f0.png" /&gt;&lt;/p&gt;
&lt;p&gt;接下来我使用无效的项目数据("targets"-&amp;gt;"targets1")， &lt;/p&gt;
&lt;p&gt;&lt;code&gt;cat /tmp/project.json&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;targets1&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;isStage&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Stage&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;variables&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;`jEk@4|i[#Fk?(8x)AV.-my variable&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;æçåé&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;lists&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;broadcasts&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;blocks&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;comments&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;currentCostume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;costumes&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;cd21514d0531fdffb22204e0ec5ed84a&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;èæ¯1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;cd21514d0531fdffb22204e0ec5ed84a.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;240&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;180&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sounds&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83a9787d4cb6f3b7632b4ddfebf74367&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;åµ&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;format&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rate&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;44100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sampleCount&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1032&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83a9787d4cb6f3b7632b4ddfebf74367.wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;volume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;layerOrder&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;tempo&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;60&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;videoTransparency&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;videoState&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;on&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;textToSpeechLanguage&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;},{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;isStage&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;test1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;variables&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;lists&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;broadcasts&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;blocks&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;qI)a2qkxK=]VtK^%eH@~&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;motion_movesteps&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;FYZnCl:MFx`sQhhiEwkj&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;STEPS&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]]},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;FYZnCl:MFx`sQhhiEwkj&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;opcode&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;event_whenflagclicked&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;qI)a2qkxK=]VtK^%eH@~&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;parent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;inputs&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;fields&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;shadow&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topLevel&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;150&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;}},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;comments&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{},&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;currentCostume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;costumes&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;b7853f557e4426412e64bb3da6531a99&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;é å1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;bitmapResolution&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;b7853f557e4426412e64bb3da6531a99.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;48&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;},{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;e6ddc55a6ddd9cc9d84fe0b4c21e016f&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;é å2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;bitmapResolution&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;e6ddc55a6ddd9cc9d84fe0b4c21e016f.svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;svg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterX&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;46&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationCenterY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;53&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sounds&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;assetId&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83c36d806dc92327b9e7049a565c6bff&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;åµ&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dataFormat&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;format&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rate&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;44100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sampleCount&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;37376&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;md5ext&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;83c36d806dc92327b9e7049a565c6bff.wav&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;volume&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;layerOrder&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;visible&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;size&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;direction&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;90&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;draggable&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rotationStyle&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;all around&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;monitors&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;extensions&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;[],&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;meta&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;semver&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;3.0.0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;vm&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;0.2.0-prerelease.20190107184530&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;agent&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/vimscratch-api_6787d937.png" /&gt;&lt;/p&gt;
&lt;p&gt;有点尴尬，这个错误信息没有被官方处理(可能会引起灾难，大家不要试了).原来想测试学习官方的错误处理机制了，结果测出了官方后端的bug。我稍后给他们反馈一下。&lt;/p&gt;
&lt;p&gt;以上的演示有助于大家了解，如何与后端交互，并且测试它，所以我都保留下来。&lt;/p&gt;
&lt;h1 id="_13"&gt;相关链接&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/Scratch3_api_analysis.html"&gt;Scratch3.0技术分析之后端API(第0篇)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://scratch.mit.edu/projects/276660763/"&gt;Scratch 3.0 is here!&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Wed, 09 Jan 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-01-09:Scratch3_api_analysis_1.html</guid><category>scratch</category></item><item><title>Scratch3.0技术分析之后端API(第0篇)</title><link>/Scratch3_api_analysis.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch_analyse_6179c869.png" /&gt;&lt;/p&gt;
&lt;p&gt;近期我们计划对Scratch3.0做一系列的技术分析，这是这个系列的开篇。&lt;/p&gt;
&lt;p&gt;我们致力于实现以下目标：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;理解Scratch3.0的架构设计&lt;/li&gt;
&lt;li&gt;理解Scratch拥有强大兼容性的原因&lt;/li&gt;
&lt;li&gt;梳理Scratch3.0产品背后使用的一些设计原则&lt;ul&gt;
&lt;li&gt;表现与实现的分离&lt;/li&gt;
&lt;li&gt;事件驱动&lt;/li&gt;
&lt;li&gt;面相对象&lt;/li&gt;
&lt;li&gt;everything is message&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;按照Scratch一贯的设计原则，独立实现Scratch并未开源的部分。确保之后能随着Scratch一同升级，架构上保证向后兼容。&lt;/li&gt;
&lt;li&gt;顺着Scratch的思路，对Scratch作出改进。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;总而言之，我们希望通过这些分析，获得定制scratch的能力，但同时又能与上游的官方版本保持兼容。我们重视官方对Scratch的改进。与其说我们重视他们技术能力，不如说我们重视他们对教育和社区的深刻理解，这些是极为稀缺的，它不是技术问题，也不是资金问题。我们希望能随时将官方的改进merge回我们调整后的项目中。我们不希望做出硬分叉。&lt;/p&gt;
&lt;h1 id="scratch30"&gt;Scratch3.0 正式发布&lt;/h1&gt;
&lt;p&gt;Scratch3.0于2019.1.2如期而至。 &lt;/p&gt;
&lt;p&gt;Scratch3.0的&lt;a href="https://github.com/LLK/scratch-gui"&gt;GUI&lt;/a&gt;和&lt;a href="https://github.com/LLK/scratch-www"&gt;社区的前端&lt;/a&gt;都已开源:&lt;a href="https://github.com/LLK"&gt;LLK&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;你可以&lt;a href="https://scratch.mit.edu/"&gt;在线体验&lt;/a&gt;一番.&lt;/p&gt;
&lt;p&gt;目前Scratch3.0团队没有透露社区后端和GUI的存储部分是否有开源计划(我们之后将这两块统称为后端)，我此前和Scratch3.0后端团队成员做过沟通，他提到Scratch3.0后端目前同时采用了新构建的REST API和之前遗留的Django server。他们陆续将一些基础服务从Django中迁出，转化为API对外提供服务。从我们之后的分析中可以知道，他们新的后端基于&lt;a href="http://restify.com/"&gt;restify&lt;/a&gt;。我想官方的技术选型主要出于&lt;a href="http://restify.com/"&gt;restify&lt;/a&gt;对REST的友好支持，以及&lt;a href="http://restify.com/"&gt;restify&lt;/a&gt;应对高负载的能力，毕竟Scratch社区有3000万用户。&lt;/p&gt;
&lt;p&gt;考虑到Scratch2.0的后端并未开源，3.0社区后端开源的概率估计也不大。个中原因可能是防止社区分裂。毕竟每家公司跑一个scratch社区挺奇怪的，它分裂了用户群。更何况，大多数的公司采取的教育策略，正是《终生幼儿园》所反对的。&lt;/p&gt;
&lt;p&gt;除了Scratch3.0的社区后端，Scratch3.0的其他部分，官方都有计划开源，包括desktop，终生幼儿园小组正在和MIT校方沟通推进这件事，这些信息在scratch团队日常的讨论中有提到。&lt;/p&gt;
&lt;h1 id="_1"&gt;为何做这个分析&lt;/h1&gt;
&lt;p&gt;Scratch3.0的社区与插件系统，将开放到什么程度？官方的计划是什么？目前scratch团队并没有给出明确说明.他们在FAQ中提到说这部分的工作还在进展中。&lt;/p&gt;
&lt;p&gt;我们(codelab.club)今年(2019)上半年有计划与scratch team碰个面，如果官方接受，我们希望将&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;集成到官方项目中。帮助Scratch3.0连接到更广阔的世界(education as life)，同时建立Scratch3.0与Python(或者任何其他语言)的无缝连接。如果官方没太大合作意愿，也不愿开放接入机制，我们将独立构建用户社区。我们仍鼓励用户使用scratch官方社区（如果网络顺畅），因为那里边有丰富而友好的的人群，海量的不可思议的创意项目，以及scratch团队令人称赞的运营方式。但对于那些官方不支持的创造，尤其是与生活相关的创造(education as life),我们将提供另一个社区来支持用户。我们的目标是让万物积木化，支持更广泛的创造。支持杜威提倡的&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;education as life&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我们关注如何构建出兼容官方已有开放项目的后端，让用户保持一致的使用体验。同时也保证我们随时可以merge回官方的最新进展。我们另有一个野心是在我们的实现中加入&lt;a href="https://www.w3.org/TR/activitypub/"&gt;activitypub&lt;/a&gt;，让scratch的社区数据，轻松支持跨站共享和分布式存储。 codelab.club是一个非营利组织，这是我们希望支持落后地区的一个举措。让我们设想一种场景，在贫困山区，网络并不通畅，如何帮助那儿的孩子接入到社区中？他们如何了解社区最近创造出的有趣的项目(projects)？而peers和projects是scratch很核心的2个概念。有了&lt;a href="https://www.w3.org/TR/activitypub/"&gt;activitypub&lt;/a&gt;，我们在山区中可以使用树莓派跑一个scratch社区后端，孩子们可以在局域网内形成社区（一台树莓派即可，树莓派可以发射热点构建局域网）。当志愿者到来，开放出手机热点，&lt;a href="https://www.w3.org/TR/activitypub/"&gt;activitypub&lt;/a&gt;将为他们把外部世界的数据同步进来。很多的手机卡已经几乎免流量了。这件事没有想象的那么困难，即便在经济上也没有。&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.w3.org/TR/activitypub/"&gt;activitypub&lt;/a&gt;可能起作用的场景当然远不止贫困山区。关于这块的可能性有空在谈。&lt;/p&gt;
&lt;p&gt;为了支持我们上边提到的所有目标。我们需要分析目前官方的后端API（其他开源的部分我们也将分析）。我们看到scratch为兼容性这块付出了巨大的努力，他们精心设计了数据的结构，他们花了很大精力来保持对旧版本的兼容，他们甚至希望兼容到1.4版本(十年前的项目！). Scratch团队始终不抛弃已有的用户和用户创作的项目，很难看到比scratch team更尊重用户作品的组织了，这是一群令人肃然起敬的教育者。&lt;/p&gt;
&lt;h1 id="scratch-api"&gt;整理已有的Scratch API相关文档&lt;/h1&gt;
&lt;p&gt;社区里目前有不少Scratch后端API相关的文档和项目。&lt;/p&gt;
&lt;p&gt;在此做个梳理。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://en.scratch-wiki.info/wiki/Scratch_API_(2.0)"&gt;Scratch API（2.0）&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://en.scratch-wiki.info/wiki/Scratch_APIs"&gt;Scratch APIs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/LLK/scratch-rest-api/wiki"&gt;LLK/scratch-rest-api/wiki&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/towerofnix/scratch-api-unofficial-docs"&gt;towerofnix/scratch-api-unofficial-docs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/trumank/scratch-api"&gt;trumank/scratch-api&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/PolyEdge/scratchapi"&gt;PolyEdge/scratchapi&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这些项目是Scratch2.0的API，但Scratch3.0和2.0的API基本是相同的。主要原因我们前边有提到: 出于兼容性的考虑。&lt;/p&gt;
&lt;p&gt;我在完成这篇文章的途中，也会顺手给出scratch3.0的api文档，如果时间允许，我还将给出Python实现的Scratch client。&lt;/p&gt;
&lt;p&gt;此外，也可能顺手实现Python版本的&lt;a href="https://github.com/LLK/scratch-parser"&gt;scratch-parser&lt;/a&gt;，这个工具将来会成为我们为scratch用户制作画像的基础，由于Python社区的数据分析生态最成熟，所以我计划用Python来做。评估Scratch用户的学习效果，以及用户对知识的掌握情况，我认为目前是项目驱动的平台（如scratch）存在的痛点。我们希望这个项目支持所有Scratch平台，只要大家兼容官方的数据结构即可。这就是我们如此重视兼容性的原因，因为这样有助于打造通用的工具链。&lt;/p&gt;
&lt;p&gt;评估学习者的学习进展并不容易，我认为对程序的静态分析可能是突破口之一，所以我们需要重新实现&lt;a href="https://github.com/LLK/scratch-parser"&gt;scratch-parser&lt;/a&gt;。在静态分析的基础上，加上一些机器学习的算法和推荐系统，将来甚至可以做到，针对用户的学习情况和兴趣点，给他推荐可能感兴趣的人与项目。如此一来，线上平台就部分实现了我们希望在club中实现的东西：帮助用户去寻找和发现感兴趣的projects与peers。&lt;/p&gt;
&lt;h1 id="_2"&gt;工作计划&lt;/h1&gt;
&lt;p&gt;我们的分析工作从&lt;a href="https://scratch.mit.edu/projects/editor/"&gt;创作平台&lt;/a&gt;开始。&lt;/p&gt;
&lt;p&gt;之后转向分析&lt;a href="https://scratch.mit.edu/"&gt;社区&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;我们相信这一系列的文章对于准备使用Scratch3.0作为公司基础项目的产品经理和系统架构师会有价值。&lt;/p&gt;
&lt;h1 id="_3"&gt;文章列表&lt;/h1&gt;
&lt;p&gt;截止到2019.01.15这个系列的分析文章基本写完了,整理如下:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/Scratch3_api_analysis.html"&gt;Scratch3.0技术分析之后端API(第0篇)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/Scratch3_api_analysis_1.html"&gt;Scratch3技术分析之创作平台API(第1篇)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/Scratch3_asset_analysis_2.html"&gt;Scratch3技术分析之静态资源API(第2篇)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/Scratch3_project_homepage_analysis_3.html"&gt;Scratch3技术分析之项目主页API(第3篇)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/Scratch3_user_api_analysis_4.html"&gt;Scratch3技术分析之User API(第4篇)
&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/Scratch3_community_analysis_5.html"&gt;Scratch3技术分析之社区 API(第5篇)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/Scratch3_project_json_analysis_6.html"&gt;Scratch3技术分析之项目内部数据(第6篇）&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!--
Project
    创作平台API
        Project model/json
    静态资源API
        创作平台
        其他的API   
        缓存问题/过期
    项目主页API
        点赞/评论
Studio

User

之后是关系(软的)

补遗
    用户程序的数据的表示(json)。
--&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Sun, 06 Jan 2019 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2019-01-06:Scratch3_api_analysis.html</guid><category>scratch</category></item><item><title>运行在树莓派中的 scratch3-adapter opencv 插件</title><link>/adapter-opencv.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratchopencv_988e5c4c.png" /&gt;&lt;/p&gt;
&lt;p&gt;我们在&lt;a href="https://blog.just4fun.site/adapter-tensorflow.html"&gt;上一篇文章&lt;/a&gt;里介绍了如何制作运行在树莓派中的scratch3-adapter tensorflow插件。&lt;/p&gt;
&lt;p&gt;tensorflow models的使用非常繁琐。本文介绍如何使用OpenCV的dnn模块调用TesorFlow训练的模型，实现物体检测。&lt;/p&gt;
&lt;p&gt;配置要简单的多。&lt;/p&gt;
&lt;h1 id="scratch3-adapter"&gt;在树莓派中运行scratch3-adapter&lt;/h1&gt;
&lt;p&gt;这部分的操作与&lt;a href="https://blog.just4fun.site/adapter-tensorflow.html#scratch3-adapter"&gt;上篇文章&lt;/a&gt;相同.&lt;/p&gt;
&lt;h1 id="_1"&gt;安装依赖&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo apt-get install libjpeg-dev libtiff5-dev libjasper-dev libpng12-dev
sudo apt-get install libavcodec-dev libavformat-dev libswscale-dev libv4l-dev
sudo apt-get install libxvidcore-dev libx264-dev
sudo apt install libatlas-base-dev
sudo apt-get install qt4-dev-tools
&lt;span class="c1"&gt;# 如果失败 则:  sudo apt-get install qt4-dev-tools --fix-missing&lt;/span&gt;
pip3 install opencv-python imutils pyzmq --user
&lt;/pre&gt;&lt;/div&gt;


&lt;!--
另一种方法
https://www.pyimagesearch.com/2018/09/19/pip-install-opencv/
sudo apt-get install libhdf5-dev libhdf5-serial-dev
sudo apt-get install libqtwebkit4 libqt4-test
--&gt;

&lt;h1 id="_2"&gt;下载物体检测程序(包含模型)&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; ~/scratch3_adapter
git clone https://github.com/wwj718/ExploreOpencvDnn
&lt;/pre&gt;&lt;/div&gt;


&lt;h1 id="scratch3-adapter_1"&gt;构建scratch3-adapter插件&lt;/h1&gt;
&lt;p&gt;在&lt;code&gt;~/scratch3_adapter/extensions/&lt;/code&gt;构建&lt;code&gt;extension_opencv.py&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;zmq&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;zmq&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Context&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;subprocess&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pathlib&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;platform&lt;/span&gt;

&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;scratch3_adapter.core_extension&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Extension&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;scratch3_adapter&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;settings&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;OpencvExtension&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Extension&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__name__&lt;/span&gt; &lt;span class="c1"&gt;# class name&lt;/span&gt;
        &lt;span class="nb"&gt;super&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="c1"&gt;# REP&lt;/span&gt;
        &lt;span class="n"&gt;port&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;38780&lt;/span&gt;
        &lt;span class="n"&gt;context&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;socket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;zmq&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;REP&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bind&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;tcp://*:&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="c1"&gt;# Object_detection_for_adapter.py 依赖于shell中的变量，所以需要在命令行里启动&lt;/span&gt;
        &lt;span class="c1"&gt;# ~/scratch3_adapter目录&lt;/span&gt;
        &lt;span class="n"&gt;scratch3_adapter_dir&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pathlib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;scratch3_adapter&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;script&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;  &lt;span class="s2"&gt;&amp;quot;{}/ExploreOpencvDnn/main_for_adapter.py&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;scratch3_adapter_dir&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;platform&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Darwin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="c1"&gt;# which python3&lt;/span&gt;
            &lt;span class="n"&gt;python&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/usr/local/bin/python3&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;platform&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Windows&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;python&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;python&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;platform&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Linux&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;python&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/usr/bin/python3&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;cmd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;python&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;script&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="n"&gt;tf&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;subprocess&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Popen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cmd&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_running&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;tf_class&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv_json&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;class&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send_json&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;status&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;200&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
            &lt;span class="c1"&gt;# 发往scratch3.0中的eim积木&lt;/span&gt;
            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;publish&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topic&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;eim&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;message&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;tf_class&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
        &lt;span class="c1"&gt;# release socket&lt;/span&gt;
        &lt;span class="n"&gt;tf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;terminate&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;tf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;wait&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;term&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;export&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;OpencvExtension&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;搞定.&lt;/p&gt;
&lt;p&gt;双击运行scratch3-adapter. 之后勾选extension_opencv插件就行。&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratchopencv_988e5c4c.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/tfscratch_de6dfb62.png" /&gt;&lt;/p&gt;
&lt;h1 id="_3"&gt;提醒&lt;/h1&gt;
&lt;p&gt;scratch3-adapter opencv 插件目前支持树莓派、macOS、Windows.&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/macopencv_4d12f7dd.png" /&gt;&lt;/p&gt;
&lt;p&gt;运行在笔记本上，处理速度要快很多。&lt;/p&gt;
&lt;!--
资源路径都挡在adapter目录下吧，之后有入口
进一步提高易用性
可以跨平台使用
--&gt;

&lt;h1 id="_4"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://gist.github.com/wwj718/235b53953eb071d0321a8198a9d8bb6c"&gt;face_landmark_detection.py &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://heartbeat.fritz.ai/real-time-object-detection-on-raspberry-pi-using-opencv-dnn-98827255fa60"&gt;Real-Time Object Detection on Raspberry Pi Using OpenCV DNN&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/wwj718/TensorFlow-Object-Detection-on-the-Raspberry-Pi/blob/master/Object_detection_for_adapter.py"&gt;Object_detection_for_adapter.py&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/wwj718/ExploreOpencvDnn"&gt;ExploreOpencvDnn&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.pyimagesearch.com/2018/02/26/face-detection-with-opencv-and-deep-learning/"&gt;Face detection with OpenCV and deep learning&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Thu, 27 Dec 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-12-27:adapter-opencv.html</guid><category>codelab</category></item><item><title>运行在树莓派中的scratch3-adapter tensorflow插件</title><link>/adapter-tensorflow.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/vasetf_5e0ac57e.png" /&gt;&lt;/p&gt;
&lt;h1 id="scratch30"&gt;树莓派与Scratch3.0&lt;/h1&gt;
&lt;p&gt;树莓派目前的浏览器不支持webGL，但scratch3.0需要webGL支持。这篇文章准备让scratch3-adapter运行在树莓派中，而scratch3.0运行在电脑上的chrome浏览器里。&lt;/p&gt;
&lt;p&gt;scratch team正在和树莓派社区合作，推出scratch3.0的树莓派版本。所以在未来，你也可以使用树莓派中使用scratch3.0。&lt;/p&gt;
&lt;p&gt;当我们允许scratch3.0和scratch3-adapter运行在不同机器上时，我们得到了一些有趣的副产品，诸如支持移动端(ipad/mobile)、分布式运行、远程教育等等。&lt;/p&gt;
&lt;h3 id="scratch3-adapter"&gt;在树莓派中运行scratch3-adapter&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/install/"&gt;下载scratch3-adapter&lt;/a&gt;。建议你重新下载插件，我刚才有更新，修复了一个字节码相关的bug。&lt;/p&gt;
&lt;p&gt;下载好之后，给予它运行权限: &lt;code&gt;chmod +x xxx&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;之后双击运行即可.&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/rpiadapter_35394424.png" width=600 /&gt;&lt;/p&gt;
&lt;h3 id="_1"&gt;建立连接&lt;/h3&gt;
&lt;p&gt;首先访问: &lt;a href="https://raspberrypi.local:12358/"&gt;https://raspberrypi.local:12358/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;点击&lt;code&gt;高级 &amp;gt; 继续前往raspberrypi.local（不安全）&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/rpiadapter_03d96e0e.png" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;当你看到&lt;code&gt;hello world&lt;/code&gt;就ok了。&lt;/p&gt;
&lt;p&gt;打开&lt;a href="https://scratch3.codelab.club/?adapter_host=raspberrypi.local"&gt;scratch3.codelab.club&lt;/a&gt;, 指定adapter_host参数: &lt;code&gt;https://scratch3.codelab.club/?adapter_host=raspberrypi.local&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;你将看到，本地的网页已经与树莓派上的scratch3-adapter建立了连接. 之后你就可以在树莓派中&lt;a href="https://codelab-adapter-docs.codelab.club/dev_guide/helloworld/"&gt;构建scratch3-adapter的插件&lt;/a&gt;，同时在PC上的scratch3.0中操控它.和本地插件没有区别。&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/rpiadapter_4bc72c77.png" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;如果你在windows下打开scratch3.0，将&lt;code&gt;raspberrypi.local&lt;/code&gt;替代为你的树莓派的IP。&lt;/p&gt;
&lt;p&gt;对于mac/linux用户，如果你没有修改树莓的hostname，可以直接使用&lt;code&gt;raspberrypi.local&lt;/code&gt;,作为adapter_host.&lt;/p&gt;
&lt;p&gt;如果windows用户也不想每次去找树莓派的IP，需要安装&lt;a href="https://support.apple.com/kb/DL999?locale=zh_CN"&gt;Bonjour Print Services (Windows)&lt;/a&gt;，之后&lt;code&gt;raspberrypi.local&lt;/code&gt;就会直接指向树莓派。这部分涉及到&lt;a href="https://en.wikipedia.org/wiki/Multicast_DNS"&gt;mDNS&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="tensorflow"&gt;在树莓派安装依赖(tensorflow及其他)&lt;/h1&gt;
&lt;p&gt;scratch3-adatper默认启动为图形界面模式，所以你需要在图形界面中操作。我们之后会推出cli版本。&lt;/p&gt;
&lt;p&gt;如果你希望一切都在浏览器中操作，可以使用&lt;a href="https://blog.just4fun.site/raspberrypi-install-and-config.html#novnc"&gt;noVNC&lt;/a&gt;，在浏览器中操作树莓派的桌面。&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/rpinovnc_fa7f131c.png" /&gt;&lt;/p&gt;
&lt;h3 id="tensorflow_1"&gt;安装 tensorflow&lt;/h3&gt;
&lt;p&gt;tensorflow只是一个普通的Python库，scratch3-adatper允许使用Python构建插件，来拓展scrtach3.0的能力。所以这部分没有任何特殊性。构建AI插件和构建普通插件没有区别。你可以参考目前已有的插件例子:&lt;a href="https://github.com/Scratch3Lab/scratch3_adapter_extensions/"&gt;scratch3_adapter_extensions&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;在树莓派中安装&lt;a href="https://github.com/tensorflow/tensorflow"&gt;tensorflow&lt;/a&gt;已经变得非常简单，&lt;a href="https://medium.com/tensorflow/tensorflow-1-9-officially-supports-the-raspberry-pi-b91669b0aa0"&gt;tensorflow 1.9之后官方正式支持树莓派&lt;/a&gt;, 安装只需运行两行命令:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo apt install libatlas-base-dev
pip3 install tensorflow pyzmq --user
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;使用python3运行以下代码，看是否安装成功:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# python3&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;tensorflow&lt;/span&gt; &lt;span class="kn"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;tf&lt;/span&gt;
&lt;span class="n"&gt;tf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;enable_eager_execution&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;hello&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;constant&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Hello, TensorFlow!&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;hello&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# tf.Tensor(b&amp;#39;Hello, TensorFlow!&amp;#39;, shape=(), dtype=string)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="opencv"&gt;安装opencv&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo apt-get install libjpeg-dev libtiff5-dev libjasper-dev libpng12-dev
sudo apt-get install libavcodec-dev libavformat-dev libswscale-dev libv4l-dev
sudo apt-get install libxvidcore-dev libx264-dev
sudo apt-get install qt4-dev-tools
pip3 install opencv-python --user
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="protobuf"&gt;安装 Protobuf&lt;/h3&gt;
&lt;p&gt;如果你想使用&lt;a href="https://github.com/tensorflow/models"&gt;tensorflow/models&lt;/a&gt;,你就需要安装protobuf-compiler。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sudo apt-get install protobuf-compiler&lt;/code&gt;&lt;/p&gt;
&lt;h3 id="_2"&gt;其他&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pip3 install matplotlib pyzmq --user
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="_3"&gt;运行物体识别程序&lt;/h3&gt;
&lt;p&gt;从&lt;a href="https://github.com/wwj718/TensorFlow-Object-Detection-on-the-Raspberry-Pi#5-set-up-tensorflow-directory-structure-and-pythonpath-variable"&gt;Set up TensorFlow Directory Structure and PYTHONPATH Variable&lt;/a&gt;往下做相应配置。&lt;/p&gt;
&lt;p&gt;配置好之后你应该就能在树莓派上运行&lt;a href="https://github.com/wwj718/TensorFlow-Object-Detection-on-the-Raspberry-Pi/blob/master/Object_detection_usb_cam.py"&gt;Object_detection_usb_cam.py&lt;/a&gt;
而不报错。&lt;/p&gt;
&lt;p&gt;程序目前使用usb摄像头，如果你想使用树莓派官方的摄像头，需要做些调整。&lt;/p&gt;
&lt;p&gt;以上这些步骤与scratch3-adapter无关，是在树莓派中用tensorflow运行物体识别程序需要的步骤，挺繁琐的。&lt;/p&gt;
&lt;p&gt;ps: 我们之后写一篇文章讲解在opencv中跑神经网络，而不用tensorflow，将省去很多繁琐步骤。&lt;/p&gt;
&lt;p&gt;完成之后，我们就可以开始在scratch3-adapter中写插件了。&lt;/p&gt;
&lt;h3 id="scratch3-adapter_1"&gt;构建scratch3-adapter插件&lt;/h3&gt;
&lt;!--构建常见的管道，让开发者易于上手，构建一些基础设施和小工具到adatper中，内置它--&gt;

&lt;p&gt;首先把tensorflow物体识别程序放到用户目录下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; ~
wget https://raw.githubusercontent.com/wwj718/TensorFlow-Object-Detection-on-the-Raspberry-Pi/master/Object_detection_for_adapter.py
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在&lt;code&gt;~/scratch3_adapter/extensions/&lt;/code&gt;构建&lt;code&gt;extension_tensorflow.py&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;zmq&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;zmq&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Context&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;subprocess&lt;/span&gt;

&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;scratch3_adapter.core_extension&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Extension&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;scratch3_adapter&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;settings&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;TensorflowExtension&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Extension&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__name__&lt;/span&gt; &lt;span class="c1"&gt;# class name&lt;/span&gt;
        &lt;span class="nb"&gt;super&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="c1"&gt;# REP&lt;/span&gt;
        &lt;span class="n"&gt;port&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;38779&lt;/span&gt;
        &lt;span class="n"&gt;context&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;socket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;zmq&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;REP&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bind&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;tcp://*:&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="c1"&gt;# Object_detection_for_adapter.py 依赖于shell中的变量，所以需要在命令行里启动&lt;/span&gt;
        &lt;span class="n"&gt;cmd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/usr/bin/python3 /home/pi/Object_detection_for_adapter.py&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;tf&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;subprocess&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Popen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cmd&lt;/span&gt; &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;shell&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_running&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;tf_class&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv_json&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;class&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send_json&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;status&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;200&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
            &lt;span class="c1"&gt;# 发往scratch3.0中的eim积木&lt;/span&gt;
            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;publish&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topic&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;eim&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;message&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;tf_class&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
        &lt;span class="c1"&gt;# release socket&lt;/span&gt;
        &lt;span class="n"&gt;tf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;terminate&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;tf&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;wait&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;term&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;export&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;TensorflowExtension&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;搞定。&lt;/p&gt;
&lt;p&gt;之后双击启动extension_tensorflow插件就行。&lt;/p&gt;
&lt;p&gt;注意: tensorflow的model在在树莓派中加载很慢，所以从运行插件，到你看到摄像头被激活，可能有几秒钟时间。&lt;/p&gt;
&lt;h3 id="tips"&gt;tips&lt;/h3&gt;
&lt;p&gt;每次退出scratch3-adapter，记得取消勾选extension_tensorflow，不关闭这个进程，树莓派的很多计算资源仍然会被它占用。&lt;/p&gt;
&lt;p&gt;如果你不慎直接退出了scratch3-adapter，可以通过&lt;code&gt;ps aux |grep adapter&lt;/code&gt;查杀&lt;code&gt;Object_detection_for_adapter.py&lt;/code&gt;&lt;/p&gt;
&lt;h1 id="_4"&gt;展示&lt;/h1&gt;
&lt;p&gt;&lt;img src='http://wwj-fig-bed.just4fun.site/vasetf_5e0ac57e.png' width=600&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/tfscratch_de6dfb62.png" /&gt;&lt;/p&gt;
&lt;h1 id="_5"&gt;提醒&lt;/h1&gt;
&lt;p&gt;[scratch3-adapter tensorflow插件](http(s://blog.just4fun.site/adapter-tensorflow.html)除了用于树莓派中，也完全可用在电脑上。需要对资源(model)路径做些调整（使用绝对路径）。&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/macopencv_4d12f7dd.png" /&gt;&lt;/p&gt;
&lt;p&gt;运行在笔记本上，处理速度要快很多。&lt;/p&gt;
&lt;h1 id="todo"&gt;todo&lt;/h1&gt;
&lt;p&gt;在未来，我们会直接发布内置scratch3-adapter的树莓派镜像，支持tensorflow/opencv/dlib/gpio。开箱即用，只需要将树莓派接入局域网(将内置&lt;a href="https://github.com/balena-io/wifi-connect"&gt;wifi-connect&lt;/a&gt;来简化wifi连接)，你就可以立刻用scratch3.0来为它编程。&lt;/p&gt;
&lt;h1 id="_6"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter docs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/Scratch3Lab/scratch3_adapter_extensions/"&gt;scratch3_adapter_extensions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://en.wikipedia.org/wiki/Multicast_DNS"&gt;wikipedia mDNS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/wwj718/TensorFlow-Object-Detection-on-the-Raspberry-Pi"&gt;TensorFlow-Object-Detection-on-the-Raspberry-Pi&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Thu, 27 Dec 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-12-27:adapter-tensorflow.html</guid><category>codelab</category></item><item><title>codelab.club ❤️ Vector</title><link>/codelab-love-Vector.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/vector_b8143852.png" /&gt;&lt;/p&gt;
&lt;h1 id="_1"&gt;前言&lt;/h1&gt;
&lt;h3 id="vector"&gt;&lt;a href="https://www.anki.com/en-us/vector"&gt;Vector&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;我们近期接入了&lt;a href="https://www.anki.com/en-us/vector"&gt;Vector&lt;/a&gt;！这是我们今年的里程碑之一，Vector代表着机器人的一种可能的未来。它是&lt;a href="https://www.anki.com/en-us/cozmo"&gt;Cozmo&lt;/a&gt;的下一代。在我看来，Cozmo/Vector是划时代的AI玩具,它甚至成为了CMU(卡内基梅隆大学)教学机器人的教具，如CMU的&lt;a href="https://en.wikipedia.org/wiki/David_S._Touretzky"&gt;Dave Touretzky教授&lt;/a&gt;(他是cozmo死忠粉)在社区里说的： cozmo在很多方面，至今独孤求败。&lt;/p&gt;
&lt;h3 id="scratch3-adapter"&gt;scratch3-adapter&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;是&lt;a href="https://codelab.club"&gt;codelab.club&lt;/a&gt;构建的基础设施之一。scratch3-adapter目标是使万物积木化，帮助没有编程经验又热爱创造的人，更容易地去实现他们的创意。&lt;/p&gt;
&lt;p&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;是全球第一个将Vector积木化的工具，我们甚至赶在了官方的前边。今年上半年anki(Vector所属的公司)就推荐社区里关心教育的用户，使用scratch3-adapter作为将Cozmo接入教育平台的工具。&lt;/p&gt;
&lt;h1 id="_2"&gt;演示&lt;/h1&gt;
&lt;p&gt;我们先来看下演示视频:&lt;/p&gt;
&lt;video width="300px" src="http://scratch3-files.just4fun.site/vector_leapmotion.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;例子中，我通过手势来"驾驶" Vector。 通过简单拼搭&lt;a href="https://www.leapmotion.com/zh-hans/"&gt;leap motion&lt;/a&gt;积木和Vector积木，我们就可以利用手势来"驾驶" Vector。&lt;/p&gt;
&lt;h3 id="_3"&gt;开发者视角&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://codelab-adapter-docs.codelab.club"&gt;scratch3-adapter&lt;/a&gt;希望打造一个开放的生态,鼓励开发者和公司将自己的设备接入进来。我们希望降低开发者的接入门槛，不必从Scratch3.0的源码入手。目前官方的扩展机制，抛开文档缺失不说，每次发布新的积木，都得经历编写js插件、build vm、build gui，重新打包发布的过程， 繁琐而缓慢。&lt;/p&gt;
&lt;p&gt;为了简化开发者自定义插件的流程，我们构建了&lt;a href="https://codelab-adapter-docs.codelab.club"&gt;scratch3-adapter&lt;/a&gt;，同时我们在&lt;a href="https://scratch3.codelab.club"&gt;scratch3.codelab.club&lt;/a&gt;中构建了通用的通道:&lt;code&gt;EIM&lt;/code&gt;(Everything Is Message), 利用这两个东西，允许开发者连接AI、开源硬件、物联网或任何开放的东西。为了支持开发者做更复杂的扩展，我们加入了json积木，允许用户在自定义的Python插件和Scratch之间传递复杂的数据结构：&lt;a href="https://blog.just4fun.site/python-scratch-with-adapter.html"&gt;Python与Scratch的双向通信&lt;/a&gt;。如果开发者追求简便而不是扩展性，我们也准备了更为便捷的通道:&lt;a href="https://blog.just4fun.site/scratch-adapter-eim-script.html"&gt;使用Python拓展Scratch的能力&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;EIM虽然扩展了Scratch的能力，但开发者往往觉得还不够，他们希望能自定义积木的外观和构建新的原语，而不是使用EIM中最原始的通信原语，也就是说他们希望直接面相用户构建积木的样式。Vector的接入是很好的案例，我们在此把技巧分享给大家。&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratchvector_2ba4d6c0.png" /&gt;&lt;/p&gt;
&lt;p&gt;在这个例子中，我们演示了如何使用json积木块来传递复杂的数据结构(类似&lt;a href="https://zh.wikipedia.org/zh-hans/%E9%81%A0%E7%A8%8B%E9%81%8E%E7%A8%8B%E8%AA%BF%E7%94%A8"&gt;RPC&lt;/a&gt;的参数构造，包含方法(method)和参数(params)),之后使用EIM的send积木，将数据发往&lt;a href="https://codelab-adapter-docs.codelab.club"&gt;scratch3-adapter&lt;/a&gt;，这是scratch3-adapter中解析这个消息的插件代码:&lt;a href="https://github.com/Scratch3Lab/scratch3_adapter_extensions/blob/master/extension_vector.py"&gt;extension_vector.py&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;在scratch一侧，通过Scratch的自定义积木功能，创建出特定于应用的积木，而不是使用最原始的EIM积木。如此以来EIM成为实现自定义积木的底层设施。&lt;/p&gt;
&lt;p&gt;我们构建了新的插件机制！scratch3-adapter为scratch 3.0构建了一种新的抽象层，兼容官方源码，但允许你用Python而不是JavaScript 来动态扩展Scratch3.0，无须重新build整个平台，同时为你保留了自定义积木外观的能力，这是我们构建开放的开放者生态的重要一步，欢迎开发者入坑: ）&lt;/p&gt;
&lt;p&gt;如此一来，开发者就这样就可以构建直观的积木给用户使用，eim作为实现它的底层，用户无需关心这部分。为了更加友好，你可以把自定义的部分放在一个独立的target(角色)里。在概念上它就像拓展包。target E表示&lt;code&gt;EIM&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratchvector_8895f36c.png" /&gt;&lt;/p&gt;
&lt;p&gt;插件本身包含在源码中，无需重新编译发布Scratch平台，这意味着扩展是分布式进行的，平台本身不需要调整(意味着更好的兼容性)，你可以在我们不知情的情况下快速展开你的工作。完成你的扩展之后。下载下来分发给用户即可！&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratchvector_0451f5a2.png" /&gt;&lt;/p&gt;
&lt;p&gt;2019年1月份等Scratch team正式发布了Scratch3.0的稳定版，我们将同步开始构建线上社区，到时候你只需要给你的用户分发URL就行。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Wed, 19 Dec 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-12-19:codelab-love-Vector.html</guid><category>codelab</category></item><item><title>codelab.club近况</title><link>/codelab-club-recent-situation.html</link><description>&lt;p&gt;&lt;img alt="办公室" src="http://wwj-fig-bed.just4fun.site/codelaboffice_cfaf69cc.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://zh.wikipedia.org/zh-cn/%E9%A9%AC%E5%85%8B%C2%B7%E5%90%90%E6%B8%A9"&gt;马克·吐温&lt;/a&gt;在给朋友的信中写道:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我没有时间给你写一封短信，我只能给你写一封长信。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href="https://codelab.club/"&gt;codelab.club&lt;/a&gt;近期忙于构建&lt;a href="https://blog.just4fun.site/about-codelab-club.html#neverland"&gt;neverland&lt;/a&gt;、制定与外部的合作框架、扩大scratch3-adapter的连接范围、完善基础设施以及探索什么是未来的创造工具。&lt;/p&gt;
&lt;p&gt;这是个愉快的旅程，途中有许多有趣的收获与发现，我们希望抽些时间，做一番梳理，让关心codelab.club的人能了解到我们的近况与进展。我们也将汇报近期的困惑与阻碍，希望能得到热心之人的帮助。&lt;/p&gt;
&lt;h1 id="neverland"&gt;&lt;a href="https://blog.just4fun.site/about-codelab-club.html#neverland"&gt;neverland&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;&lt;a href="https://blog.just4fun.site/about-codelab-club.html#neverland"&gt;neverland&lt;/a&gt;是&lt;a href="https://codelab.club/"&gt;codelab.club&lt;/a&gt;的办公室与活动空间。此前在&lt;a href="https://blog.just4fun.site/about-codelab-club.html#neverland"&gt;关于codelab.club&lt;/a&gt;中对它做过介绍。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;codelab.club的办公室是开放的, 你可以在任何时间来找我们玩，&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;neverland名字来自《小飞侠彼得·潘》,是故事中的一座海岛。在永无乡里，人们永远长不大。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;后来，他领着我飞到了永无乡(neverland)，那儿还有仙子，还有海盗，还有印第安人，还有人鱼的礁湖；还有地下的家，还有那间小屋子。 --《小飞侠彼得·潘》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;目前我们正在将neverland付诸实践。设计方案已定稿，目前正在装修中。&lt;/p&gt;
&lt;p&gt;neverland的整体规划和设计元素由codelab.club的志愿者共同谈论确定，之后由独立设计师@CJ为我们完成设计方案。&lt;/p&gt;
&lt;p&gt;neverland的空间规划经过一次大的调整，起初，我们倾向于将空间划分为办公区域和活动区域。后来经由商议，确定去除任何的分割。让活动参与者与codelab的工作人员紧密接触，让用户参与到产品的开发之中，这是《终生幼儿园》给我们的启发。&lt;/p&gt;
&lt;p&gt;neverland的设计方案,经历了若干次讨论、汇集意见、形成共识的过程，最终形成的文档放在Google Docs上。&lt;/p&gt;
&lt;p&gt;codelab是一个开放的组织，包括我们的思考与讨论本身也作为开放资源的一部分，欢迎外部的建议和批评。&lt;/p&gt;
&lt;p&gt;neverland是我们的第一个里程碑，它远不只是一个办公室,&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我们在其中办公，在其中编程，在其中玩乐，在其中做一些有趣的探索和创作。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我们在其中生活、冒险与创造，也愿意分享这其中的点点滴滴，之后可能制作为课程、故事短片、情景剧或是直播。&lt;/p&gt;
&lt;p&gt;neverland设计方案的确定，很能体现codelab.club的协作模式。我们在此梳理和再现我们的协作过程。&lt;/p&gt;
&lt;p&gt;这是neverland的第一个概念方案:&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/neverlandoffice_2d551c07.png" width=500 /&gt;&lt;/p&gt;
&lt;p&gt;codelab的志愿者们对此并不满意。&lt;/p&gt;
&lt;p&gt;@刘鑫提到:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;读书角这种风格是不是现在比较流行的风格？可能是我读书不够多，感觉这种实用性不够。&lt;/p&gt;
&lt;p&gt;隐私问题值得注意，如果空间中有摄像头，应该告知参与者。若对外直播活动的过程，可以考虑将摄像头置于活动桌上方，人不出镜, 避免侵犯隐私。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;@程晨建议:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;根据neverland可能出现的场景来规划布局。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;@曾铮建议:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;空间分布可以整合，比如休息区（这个不止是家长休息，孩子可能也得休息）应该和饮食区、读书区合一。舒服的沙发旁边就是食品、饮料和书，工作者也可以过去休息，它是一个综合休息区。展示区的空间如果可以利用起来更好，活动空间就是最好的展示。考虑空间融合与空间复用。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这些建议成为neverland第二版草案的空间规划策略:&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/codelaboffice_217b9f9e.png" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;在这个版本中，保留了@陈海权提出的阶梯概念，并扩展了它的功能。@陈海权展示的汕头图书馆的设计令人印象深刻。&lt;/p&gt;
&lt;p&gt;@李懿建议将阶梯的位置挪到不规则墙面区域，如此一来颇有阶梯教室的味道，图书角成为了一个阅读/休息/观众席 综合区。@李懿进一步提议我们采用日式风格，就像Apple Store，弱化环境，强调空间中的物与人。&lt;/p&gt;
&lt;p&gt;一旦有了阶梯教室的概念，很自然地，对面墙壁适合放置投影设备。@罗云建议采用75寸的高清电视，而不是投影仪。&lt;/p&gt;
&lt;p&gt;@陈海权提议充分利用阶梯的空间，将柜子置于阶梯之后，一直往上延伸，于是天花就成为必要。天花方案最终采用了@罗云的提议，采用简约整洁的风格，保持风格的统一。&lt;/p&gt;
&lt;p&gt;既已决定采用日式风格，@罗云进一步建议说室内设施应该与环境融合，不使用时不应突兀出来，同时他提议取消形象区，彻底打通整个空间，贯彻&lt;code&gt;开放&lt;/code&gt;的理念，但又希望能展示codelab.club的形象。之前为我们出方案的设计公司无法给出好的解决方案，于是我们另请了独立设计师@CJ来为我们重新设计。&lt;/p&gt;
&lt;p&gt;这是下一版的草图:&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/codelaboffice_61b64c6f.png" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;以及最终的渲染图:&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/codelaboffice_88dea9b5.png" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/codelaboffice_cfaf69cc.png" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;其中电视两边放置可以书写的不锈钢板，它同时又充当镜子，来放大空间。@陈爱华最初提议在空间里放置可以写字的玻璃板，之后@陈海权建议改为不锈钢板。&lt;/p&gt;
&lt;p&gt;@陈爱华建议风格上点缀些俏皮元素，这个概念最终演变为设计师@CJ为我们带来的若干小巧点缀。@陈爱华还有许多有趣而实用的建议：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;彩色积木可以任意组装成书桌、书架、展示台等等。coding的无趣和偏见就是工业灰，我们应该尽可能打破这个。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;之后我们购置小物品时，会按照这个建议，尽量选择积木风格的物品。&lt;/p&gt;
&lt;p&gt;升降桌也由她提出(她目前人在硅谷):&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;硅谷的标配是升降桌 可以调节高度的 宜家有便宜版本&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!-- https://docs.google.com/document/d/1P-TpOeezInzj0ZeflJsbUToVAUDJM3NtghQYjE8PauE/edit --&gt;

&lt;p&gt;关于展示区她也给出了很棒的建议:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;除了工作、协作、学习、创造的功能，我们也提供一个给孩子们展示的空间！比如将绘画作品制作成丝巾、文化衫，我个人是很喜欢创造+时尚结合起来！甚至一段有意思的python代码 都可以打印到衣服上。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--
# 线上社区
我们在[codelab.club](https://www.codelab.club/)主页中写道:

&gt;  线下方面，codelab.club将在全国主要城市，利用周末时间，组织志愿者、借用场地，开展编程活动；线上方面，codelab.club将构建先进的少儿编程平台，在积木化编程里加入开源硬件、物联网和人工智能；同时我们将构建活跃的用户社区，鼓励家长、教育者、学习者参与其中；我们也乐于与其他公益组织展开合作，让编程与更广泛的社会活动结合

线上
--&gt;

&lt;h1 id="_1"&gt;万物积木化&lt;/h1&gt;
&lt;p&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;是codelab.club构建的基础设施之一。&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;目标是使万物积木化，帮助没有编程经验又热爱创造的人，更容易地去实现他们的创意。&lt;/p&gt;
&lt;p&gt;下边梳理一下，我们近期在这块的工作。&lt;/p&gt;
&lt;h3 id="ai"&gt;积木化AI&lt;/h3&gt;
&lt;p&gt;AI方面，我们优化了图像分类器的性能(基于&lt;a href="https://arxiv.org/abs/1704.04861"&gt;MobileNet&lt;/a&gt;)，增加了标签(label)的数量(为了支持联想研究院的小伙伴制作的演示案例)。&lt;/p&gt;
&lt;video width="600px" src="http://scratch3-files.just4fun.site/%E9%97%AD%E7%9C%BC%E8%AF%B7%E7%86%84%E7%81%AF.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;在这个例子中，使用不到10个积木训练好神经网络后，制作了《闭眼，请关灯》：当kindle/书籍被翻开时，开灯阅读；当合上Kindle/书籍，闭上眼思考时，自动熄灭灯光。&lt;/p&gt;
&lt;p&gt;此外，我们将姿态神经网络变为了积木:&lt;/p&gt;
&lt;video width="600px" src="http://scratch3-files.just4fun.site/AR.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;这个例子叫《鼻梁上的老花镜》，它是一个增强现实(AR)作品。通过姿态神经网络我们可以拿到面部地标的数据，你的鼻子、眼睛、耳朵、嘴巴都被积木化了，你可以组合这些积木来创作。&lt;/p&gt;
&lt;p&gt;利用姿态神经网络，也可以将肢体的运动变为输入信号，来制作创意作品或体感游戏。&lt;/p&gt;
&lt;p&gt;上边的例子属于计算机视觉(CV)，人工智能另一大应用是自然语言处理(NLP)，下边是我们近期与NLP相关的一些例子：&lt;/p&gt;
&lt;video width="600px" src="http://scratch3-files.just4fun.site/hi%E6%B8%A1%E8%BE%B9%E5%90%9B.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;《hi，渡边君》是一个&lt;a href="https://zh.wikipedia.org/wiki/%E8%81%8A%E5%A4%A9%E6%A9%9F%E5%99%A8%E4%BA%BA"&gt;聊天机器人（Chatterbot）&lt;/a&gt;,我们在Python中构建本地Chatterbot（不需要云端支持），之后将其积木化。这个例子展示了我们利用Python来拓展Scratch的设计。通过Python你能极大拓展Scratch的能力，这部分后边细说，我们在这块做了很多有趣的探索。&lt;/p&gt;
&lt;p&gt;codelab在自然语言处理(NLP)这块的另一项工作是，利用积木构建智能音箱:&lt;/p&gt;
&lt;video width="600px" src="http://scratch3-files.just4fun.site/%E6%99%BA%E8%83%BD%E9%9F%B3%E7%AE%B1.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;利用20个积木不到，你就构建了一个自己的智能音箱，它使用一个Python插件来接入云端Chatterbot，这个插件我们已经开放出来了。我们的所有插件都是开放的。&lt;/p&gt;
&lt;h3 id="_2"&gt;积木化开源硬件/平台&lt;/h3&gt;
&lt;p&gt;说完我们在积木化AI这块的工作，接下来聊聊，积木化开源硬件这块的工作。&lt;/p&gt;
&lt;p&gt;我们接入了&lt;a href="https://mpython.readthedocs.io/zh/latest/"&gt;掌控板&lt;/a&gt;,掌控板是一块优秀的国产开源硬件，产品层面模仿了micro:bit,但做了很多增强：更好的媒体表现力(屏幕、喇叭)、更强的连接能力(WiFi)&lt;/p&gt;
&lt;video width="600px" src="http://scratch3-files.just4fun.site/%E6%8E%8C%E6%8E%A7%E6%9D%BF.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;接入四轴飞行器，目前支持&lt;a href="http://www.parrot.com.cn"&gt;Parrot&lt;/a&gt;三个系列的四轴飞行器:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;mambo&lt;/li&gt;
&lt;li&gt;Bebop&lt;/li&gt;
&lt;li&gt;Swing&lt;/li&gt;
&lt;/ul&gt;
&lt;video width="300px" src="http://scratch3-files.just4fun.site/fly.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;这个例子展示了简单组合积木所带来的威力：通过拼搭leap motion积木和四轴飞行器积木，我们就可以利用手势指挥四轴飞行器。&lt;/p&gt;
&lt;p&gt;接入&lt;a href="https://www.anki.com/en-us/vector"&gt;Vector&lt;/a&gt;！这是我们今年的里程碑之一，Vector代表着机器人的一种可能的未来。它是&lt;a href="https://www.anki.com/en-us/cozmo"&gt;Cozmo&lt;/a&gt;的下一代。在我看来，Cozmo/Vector是划时代的AI玩具,它甚至成为了CMU(卡内基梅隆大学)教学机器人的教具，如&lt;a href="https://en.wikipedia.org/wiki/David_S._Touretzky"&gt;Dave Touretzky&lt;/a&gt;教授(他是cozmo死忠粉)在社区里说的： cozmo在很多方面，至今独孤求败。&lt;/p&gt;
&lt;p&gt;codelab.club计划使用Vector进行AI教育。&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;是全球第一个将Vector积木化的工具，我们甚至赶在了官方的前边。今年上半年anki(Vector所属的公司)就推荐社区里关心教育的用户，使用&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;作为将Cozmo接入教育平台的工具。&lt;/p&gt;
&lt;video width="300px" src="http://scratch3-files.just4fun.site/vector_leapmotion.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;h3 id="_3"&gt;家庭娱乐设备&lt;/h3&gt;
&lt;p&gt;Switch颠覆了人们对游戏机的看法，Switch被看作家庭娱乐中心，它鼓励社交、合作和创造。Switch Labo的推出，更是掀起了全球的尖叫与狂欢。&lt;/p&gt;
&lt;p&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;的目标是将万物积木化，我们当然不会错过Switch Labo这种充满创意的事物。&lt;/p&gt;
&lt;video width="300px" src="http://scratch3-files.just4fun.site/switch_light.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;在这个例子中，我们利用Switch的外围设备(模型枪)来击灭房间里的灯。利用积木你可以把房间改造为战场。&lt;/p&gt;
&lt;video width="600px" src="http://scratch3-files.just4fun.site/%E5%B0%8F%E6%88%BF%E9%97%B4%E4%B8%8E%E5%A4%A7%E6%88%BF%E9%97%B4.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;在这个例子中，我们将Switch labo的瓦楞纸小房间与现实的大房间连接在一起。&lt;/p&gt;
&lt;h3 id="_4"&gt;社交媒体&lt;/h3&gt;
&lt;p&gt;我们接入了微信。&lt;/p&gt;
&lt;p&gt;不喜欢微信的聊天界面？没关系，在Scratch中制作自己的聊天界面：&lt;/p&gt;
&lt;video width="600px" src="http://scratch3-files.just4fun.site/wechat.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;天冷不想起床关灯？没关系，发一条微信消息就行：&lt;/p&gt;
&lt;video width="350px" src="http://scratch3-files.just4fun.site/%E8%A6%81%E6%9C%89%E5%85%89.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;h3 id="_5"&gt;更多&lt;/h3&gt;
&lt;p&gt;更多的的演示视频参考&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/gallery/"&gt;codelab-adapter docs gallery&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="_6"&gt;开放生态&lt;/h1&gt;
&lt;p&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;希望打造一个开放的生态，如我们在文档里说的:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;使用scratch3-adapter，你可以轻松将任何有趣的东西接入Scratch3.0(只需几行代码)，接入之后你便能用Scratch3.0的积木来操控它，让它与任何接入Scratch3.0的物体互动。无论是来自现实世界的物体，还是来自虚拟世界的AI或动画角色，都能彼此互动，我们不想针对某个硬件产品发布一个客户端，我们相信创意来自广泛的连接，我们致力于做一个中立的东西，将Scratch3.0连接到更广阔的领域，我们想做到宽围墙。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我们鼓励公司与开发者们加入这个生态，scratch3-adapter甚至允许你将AI的能力赋予给十几年前生产的玩具&lt;/p&gt;
&lt;video width="300px" src="http://wwj-fig-bed.just4fun.site/1539392124109888.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;理论上，我们能将绝大多数的玩具都积木化，并接入进来，包括你童年的那些玩具。正是这点引起了很多公司的兴趣。我们在后边将谈论codelab.club与企业的合作框架。&lt;/p&gt;
&lt;h3 id="_7"&gt;增强插件系统&lt;/h3&gt;
&lt;p&gt;为了方便开发者和公司将自己的设备更容易地接入，我们完善了&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;文档&lt;/a&gt;；增强了Scratch与Python的连接: &lt;a href="https://blog.just4fun.site/python-scratch-with-adapter.html"&gt;Python与Scratch的双向通信&lt;/a&gt;,给开发者更多的自由。&lt;/p&gt;
&lt;video width="600px" src="http://scratch3-files.just4fun.site/dlib_face.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;这个例子展示了，如何将Python写的检测面部关键点的程序积木化到Scratch中。&lt;/p&gt;
&lt;h3 id="scratcher"&gt;服务Scratcher&lt;/h3&gt;
&lt;p&gt;对于Scratcher，我们也鼓励他们&lt;a href="https://blog.just4fun.site/scratch-adapter-eim-script.html"&gt;使用Python拓展Scratch的能力&lt;/a&gt;，我们为此构建了两个通用插件:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/Scratch3Lab/scratch3_adapter_extensions/blob/master/extension_eim_script.py"&gt;extension_eim_script&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/Scratch3Lab/scratch3_adapter_extensions/blob/master/extension_eim_monitor.py"&gt;extension_eim_monitor&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;来简化Scratcher上手Python的门槛。这部分我们所做的思考都分享了出来:&lt;a href="https://blog.just4fun.site/scratch-adapter-eim-script.html#_3"&gt;教育层面的思考&lt;/a&gt;， 欢迎交流：）&lt;/p&gt;
&lt;p&gt;对了,scratch3-adapter的所有插件都是开放的: &lt;a href="https://github.com/Scratch3Lab/scratch3_adapter_extensions"&gt;scratch3_adapter_extensions&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="_8"&gt;星辰大海&lt;/h1&gt;
&lt;p&gt;我们目前做的这些，从外部的反馈(包括技术社区和教育社区)来看，大家觉得还挺酷的。但我们想做的远不止这些。&lt;/p&gt;
&lt;p&gt;在教育上我们追随Jean Piaget、Alan Curtis Kay、Seymour Papert和Mitchel Resnick。&lt;/p&gt;
&lt;p&gt;在技术上，&lt;a href="https://dynamicland.org/"&gt;Dynamicland&lt;/a&gt;是我们希望驶向的星辰大海。他们对计算和创造的未来做了最令人震惊的想象与探索。&lt;/p&gt;
&lt;p&gt;关于这块，我之前写了两篇文章：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/notes-from-dynamicland-programming-raspberry-pis.html"&gt;来自Dynamicland的笔记: 为树莓派(Raspberry Pi)编程&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/the-next-big-thing-is-a-room.html"&gt;"下一件大事"是一个房间&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;兼容和接入Dynamicland是我们未来的里程碑。&lt;/p&gt;
&lt;h1 id="_9"&gt;合作框架&lt;/h1&gt;
&lt;p&gt;由于&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;的开放性与连接能力，不少公司希望能与我们合作，将产品接入到codelab.club之中。&lt;/p&gt;
&lt;p&gt;接入的设备，将免费得到codelab.club提供的语音识别、机器视觉、空间编程的能力(为整个房子编程)，同时也得到与生态中的所有设备互动的能力，无论是控制飞行器还是与Vector交互。你不必做所有的这些，你只需做你擅长的，与万物连接的任务，交给我们。&lt;/p&gt;
&lt;p&gt;codelab.club是个非营利组织。我们最关心的是使命而不是商业价值。我们的使命是：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;传递编程的乐趣，帮助人们成为数字时代的创作者。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;那我们为何愿意与商业公司合作呢？考虑到长期的发展，如果我们通过与商业公司合作，得到更多企业的捐赠，这对我们扩大自身，服务更广阔的人群将有帮助。&lt;/p&gt;
&lt;p&gt;前提是这种合作不违背我们的使命，合作方的产品必须能够帮助用户去创造，符合我们认同的理念，合作才成为可能。就像乐高与Scratch的合作。彼此促进，共同为用户带来更大的创造可能。&lt;/p&gt;
&lt;p&gt;合作的收益永远会置于我们的使命之下。&lt;/p&gt;
&lt;p&gt;任何的合作都会经过codelab.club的内部评估，直到我们认为理念上一致，才进入下一步。我们对教育的看法和理念，《终生幼儿园》做了最为清晰的阐述。&lt;/p&gt;
&lt;h3 id="scratch3-adapter"&gt;使用scratch3-adapter&lt;/h3&gt;
&lt;p&gt;近期我们将推出scratch3-adapter的社区版，在社区版中，任何公司都可以利用scratch3-adapter将AI、开源硬件、物联网接入到自己的平台中，无论平台基于什么技术，我们都将兼容，而不必局限在Scratch3.0中。&lt;/p&gt;
&lt;p&gt;社区版允许商业使用。&lt;/p&gt;
&lt;!--
# 里程碑

### 已经实现的里程碑
*  [关于codelab.club](https://blog.just4fun.site/about-codelab-club.html)
*  成功注册非营利组织
*  接入[Vector](https://www.anki.com/en-us/vector)
*  

### 接下来的
*  建设neverland
*  构建在线社区(Scratch3.0正式发布后(2019.1.2))
    *  技术栈
        *  [Django](https://github.com/django/django)/[django-rest-framework](https://github.com/encode/django-rest-framework)
        *  [React](https://github.com/facebook/react)
*  构建开发者社区
*  拜访[Scratch Team](https://en.scratch-wiki.info/wiki/Scratch_Team)
*  拜访[Dynamicland](https://dynamicland.org/)
*  在neverland复现Dynamicland的实验与探索，
*  发布scratch3-adapter 1.0
*  接入realtalk/使用Python实现realtalk协议

招人
--&gt;

&lt;h1 id="_10"&gt;热心的你&lt;/h1&gt;
&lt;p&gt;热心的你如何参与进来呢？&lt;/p&gt;
&lt;p&gt;codelab.club还处在初期阶段，我们需要具备各种技能的志愿者。&lt;/p&gt;
&lt;p&gt;近期，codelab计划重新设计LOGO，用于制作一些纪念品，赠与志愿者。我们期待有热心的&lt;code&gt;设计师&lt;/code&gt;与我们同行。&lt;/p&gt;
&lt;p&gt;此外，我们陆续可能有一些外部合作，准备申请一些专利。如果你有技术领域的知识，又具备法律知识，愿意成为codelab.club的法律顾问，随时联系我们。&lt;/p&gt;
&lt;p&gt;技术这块，我们计划在1月份开始构建线上社区，技术栈选择Django/React，欢迎愿意加入的工程师。&lt;/p&gt;
&lt;p&gt;如果你身边恰好有这样的朋友，Ta和你一样热心肠、喜欢创造，欢迎帮我们牵线搭桥。&lt;/p&gt;
&lt;p&gt;你随时可以过来找我们玩, 带着你的创意，我们一起实现它。我们有各种有趣的玩具，neverland是给所有人准备的游乐场。&lt;/p&gt;
&lt;p&gt;如果童年意味着趣味、创造、好奇与天真。neverland的志愿者们并不曾长大。&lt;/p&gt;
&lt;p&gt;我们喜欢刘瑜在《送你一颗子弹》中关于天真的这段讨论:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我相信，大学精神的本质，并不是为了让我们变得深奥，而恰恰是恢复人类的天真。天真的人，才会无穷无尽地追问关于这个世界的道理。关于自然、关于社会。大学要造就的，正是达尔文的天真，爱因斯坦的天真，黑格尔的天真，顾准的天真。也就是那些“成熟的人”不屑一顾的“呆子气”。“成熟的人”永远是在告诉你：存在的就是合理的，而合理的就是不必追究的，不必改变的。　&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;欢迎天真的人们，neverland希望成为你的终生幼儿园。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Tue, 18 Dec 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-12-18:codelab-club-recent-situation.html</guid><category>codelab</category></item><item><title>来自Dynamicland的笔记: 为树莓派(Raspberry Pi)编程</title><link>/notes-from-dynamicland-programming-raspberry-pis.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/dynamicland_18bcdbbf.png" /&gt;&lt;/p&gt;
&lt;p&gt;Omar Rizwan上周在博客里记录了Dynamicland近期的探索和方向: &lt;a href="https://rsnous.com/posts/notes-from-dynamicland-programming-raspberry-pis/"&gt;Notes from Dynamicland: programming Raspberry Pis&lt;/a&gt;，为我们钩画了极为令人振奋的未来。&lt;/p&gt;
&lt;p&gt;Dynamicland的目标是重塑人机交互的方式，重塑计算机。&lt;/p&gt;
&lt;p&gt;下边是我的翻译。&lt;/p&gt;
&lt;h1 id="_1"&gt;摘要&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;树莓派(Raspberry Pi)是一种小型的单片机计算机；它可以通过其引脚和接口与外部硬件通信。&lt;ul&gt;
&lt;li&gt;Pi(树莓派的简称)展示了我们可以如何分解大型的Realbox机器，使Dynamicland成为许多计算机、传感器和执行器的生态系统，而不是服务器上的软件。&lt;/li&gt;
&lt;li&gt;“......Pi之于Dynamicland正如USB接口之于笔记本电脑：这就是我将东西插入Dynamicland的方式。”&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;使用Realtalk来打开/关闭Pi上LED的最小示例。&lt;/li&gt;
&lt;li&gt;解释Realtalk的“反应数据库”(reactive database)编程模型; 它如何使动感桌(dynamic table)中的Pi编程变得异常简单。Pi的编程与Dynamicland中的任何其他编程没什么区别。&lt;ul&gt;
&lt;li&gt;通过向Pi发送完整程序来进行远程控制，而不是用一些动力不足的控制语言与之通信。 &lt;!--远程RPC？安全问题？消息即源码？--&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;关于Pi如何在未来发挥作用的猜想。&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="realtalk"&gt;Realtalk 与 树莓派&lt;/h1&gt;
&lt;p&gt;如今，&lt;a href="https://dynamicland.org/"&gt;Dynamicland&lt;/a&gt;有一系列的动感桌：&lt;/p&gt;
&lt;video width="600px" src="https://rsnous.com/posts/notes-from-dynamicland-programming-raspberry-pis/dynamic-table.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;正在运行&lt;a href="https://www.gapminder.org/"&gt;Gapminder&lt;/a&gt; demo的动感桌&lt;/p&gt;
&lt;p&gt;每张桌子都由一个'Realbox'机器驱动, 'Realbox'机器充当计算引擎，它运行着Linux，它能执行桌子上的纸页(纸页上的功能代码)，并连接到摄像机和投影仪。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://rsnous.com/posts/notes-from-dynamicland-programming-raspberry-pis/realbox9-ceiling.jpg" width=500 /&gt;
安装在天花板上的Realbox。我争辩说，这只是一个权宜之计&lt;/p&gt;
&lt;p&gt;Realbox都通过Realtalk协议联合在一起，因此桌子可以在整个房间内进行通信并共享数据和程序。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://rsnous.com/posts/notes-from-dynamicland-programming-raspberry-pis/monolithic-realbox-diagram.png" width=600 /&gt;
目前Realbox体系：Realbox驱动的桌子，由Realtalk协议联网在一起&lt;/p&gt;
&lt;p&gt;我想说我们不应该需要那些Realboxes（以及它们包含的复杂软件栈），它们只是一个权宜之计。&lt;/p&gt;
&lt;p&gt;Realboxes功能是什么？大多数Realtalk程序（比如我以前的&lt;a href="https://rsnous.com/posts/notes-from-dynamicland-geokit/"&gt;Geokit&lt;/a&gt;）都使用摄像头作为输入和投影仪作为输出。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://rsnous.com/posts/notes-from-dynamicland-programming-raspberry-pis/input-output-board.jpg" width=600 /&gt;
带有简单输入和输出的海报(&lt;a href="https://rsnous.com/posts/notes-from-dynamicland-programming-raspberry-pis/input-output-board.jpg"&gt;原图&lt;/a&gt;)，使用了摄像头和投影仪&lt;/p&gt;
&lt;p&gt;Realbox有两个目标：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;通过USB和HDMI与摄像头和投影仪对话（&lt;a href="https://en.wikipedia.org/wiki/Hardware_abstraction"&gt;硬件抽象&lt;/a&gt;，输入输出(I/O)，'控制'）&lt;/li&gt;
&lt;li&gt;执行程序（'计算', '模拟'）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;考虑一下程序如何在你的笔记本电脑上运行：主要使用鼠标和键盘来输入，使用屏幕来输出，程序在笔记本电脑主板上的CPU上执行。&lt;/p&gt;
&lt;p&gt;但是，Realtalk的编程模型比这种特殊配置更加通用和强大。它根本不是关于摄像头、投影仪、彩色斑点或纸页。这是一个协议，用于各类动态的、物理的、可再编程的计算。&lt;/p&gt;
&lt;p&gt;该协议不需要像Realbox这样的大型Linux计算机来运行。Realtalk在小型计算机上同样可以运行（如树莓派）：&lt;/p&gt;
&lt;p&gt;&lt;img src="https://rsnous.com/posts/notes-from-dynamicland-programming-raspberry-pis/pi-vs-realbox.jpg" width=500 /&gt;
树莓派(左）和Realbox(右)运行相同的Realtalk系统！&lt;/p&gt;
&lt;p&gt;如果你不熟悉树莓派的话，我们简单介绍一下，树莓派是一块带有Wi-Fi和USB接口的小型单片机计算机，此外它拥有通用数字I/O引脚。它像我们日常所说的“计算机”一样功能齐全: 人们经常在其上运行桌面Linux操作系统，并插入显示器、鼠标和键盘。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://rsnous.com/posts/notes-from-dynamicland-programming-raspberry-pis/pi-3.png" width=500 /&gt;
树莓派3（来自&lt;a href="https://en.wikipedia.org/wiki/Raspberry_Pi#Connectors"&gt;维基百科&lt;/a&gt;）&lt;/p&gt;
&lt;p&gt;如果我们有这些小型Realtalk主机，为何我们还要将桌面上的所有内容连接到大型的Realbox上？每个传感器（如摄像机）和每个执行器（例如投影仪）都可以连接到它自己的Pi，或类似的"接口计算机"上 ，它可以在电信号和Realtalk语句之间进行转换。而这些Pi可以通过Realtalk协议联合在一起。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://rsnous.com/posts/notes-from-dynamicland-programming-raspberry-pis/ecosystem.png" width=500 /&gt;
未来的Realtalk生态系统，每个传感器和执行器都连接到自己的“接口计算机”上&lt;/p&gt;
&lt;p&gt;Pi能够与物理世界进行很好的连接，因为它具有丰富的接口和引脚，可用于与传感器和执行器通信。你可以&lt;a href="https://twitter.com/rsnous/status/1029913286500732928"&gt;接入电机并使Pi驱动🚗&lt;/a&gt;或 者&lt;a href="https://twitter.com/rsnous/status/1036838826751094784"&gt;连接触摸传感器👆&lt;/a&gt;。它与Dynamicland的目标非常契合，它是我们跳出了&lt;code&gt;摄像头-投影仪&lt;/code&gt;模式。&lt;/p&gt;
&lt;p&gt;Dynamicland是一个生态系统，而不是在Linux设备上运行的一段代码，它可以很容易地连接新的传感器和执行器，并且易于理解和修改单个部件。&lt;/p&gt;
&lt;p&gt;进一步设想一下不需要投影仪和摄像头的未来，今天我们打印的页面，在未来变为纸片薄的计算机，而不是木浆。代码存在于真实可见的物理世界，它便宜且不可变，因此它们保留了我们想要的Dynamicland&lt;a href="https://twitter.com/rsnous/status/1027045351646146560"&gt;属性&lt;/a&gt;。但是这些页面本身拥有计算能力，而不需要高高在上的&lt;code&gt;摄像头-投影仪&lt;/code&gt;系统。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://rsnous.com/posts/notes-from-dynamicland-programming-raspberry-pis/smart-pages.png" width=500 /&gt;
未来的Realtalk生态系统，具有“智能页面”而非摄像头-投影仪&lt;/p&gt;
&lt;p&gt;这些页面如何相互通信？它们又如何与周围的其他硬件相互通信？你如何与分布式计算机进行交互？那台计算机又如何赋予你权力？&lt;/p&gt;
&lt;p&gt;您可以将Dynamicland视为未来原型的尝试，并将Realtalk视为它可能是如何工作的一种建议：不是一个操作系统、网络协议、数据库、编程语言或用户界面范例，而是所有这些中的一部分。&lt;/p&gt;
&lt;h1 id="pi"&gt;今天与Pi沟通&lt;/h1&gt;
&lt;p&gt;我们已经在Dynamicland中建立了网络概念; 我们已经拥有了由独立的Realtalk主机驱动的独立动感桌，所有这些都使用Realtalk协议相互通信。你可以在桌子之间轻松地进行通信。&lt;/p&gt;
&lt;p&gt;现在，为了与Pi交谈，我们将Realtalk主机软件和Lua解释器移植到Pi，因此Pi在每个桌子上运行着相同的基础软件。&lt;/p&gt;
&lt;p&gt;Pi变成了“虚拟桌子”。在&lt;code&gt;桌子 &amp;lt;-&amp;gt; Pi&lt;/code&gt;之间的对话与 &lt;code&gt;桌子 &amp;lt;-&amp;gt; 其他桌子&lt;/code&gt;之间的对话并无不同。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://rsnous.com/posts/notes-from-dynamicland-programming-raspberry-pis/monolithic-realbox-diagram-with-pi.png" width=500 /&gt;
今天的Pi：一个“虚拟桌子”，与Realboxes地位相同&lt;/p&gt;
&lt;p&gt;下边将展示一个小例子，在Pi上切换LED，然后解释它是如何工作的以及它将来可能做些什么。&lt;/p&gt;
&lt;h1 id="dynamiclandpi"&gt;Dynamicland中的Pi&lt;/h1&gt;
&lt;p&gt;让我们看看树莓派现在Dynamicland中的样子。我已将Pi附加到纸页（18858），因此房间总是看得到纸页并知道Pi的确切位置。这个纸页就像是树莓派的"句柄"(&lt;a href="https://en.wikipedia.org/wiki/Handle_%28computing%29"&gt;handle&lt;/a&gt;); 我可以在其他程序中引用Pi的纸页(id)来控制它。&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/pipage_66cdcf37.png" width=500 /&gt;
左边是未通电的Pi，右边是已启动且已连接的Pi &lt;Processor pi-74a6&gt;&lt;/p&gt;
&lt;p&gt;Pi打开并连接(wifi?)后，页面变为绿色。接着，Pi的页面也会显示其标识符&lt;code&gt;&amp;lt;Processor pi-74a6&amp;gt;&lt;/code&gt;。&lt;code&gt;74a6&lt;/code&gt;是Pi的MAC地址的最后两个字节，每个Pi都是唯一的。&lt;/p&gt;
&lt;h1 id="activity-led"&gt;切换activity LED&lt;/h1&gt;
&lt;p&gt;activity LED是Pi上的一个LED灯，平时用于指示Pi的工作状态。&lt;/p&gt;
&lt;p&gt;现在我想在Pi上切换activity LED的状态。切换activity LED是我们可以对Pi的最简单又可见的事情。因此它适合用来测试Pi-Realtalk的集成。&lt;/p&gt;
&lt;p&gt;activity LED很难被发现, 它是Pi板子上红色LED上方的绿色LED：&lt;/p&gt;
&lt;p&gt;&lt;img src="https://rsnous.com/posts/notes-from-dynamicland-programming-raspberry-pis/activity-led.jpg" width=500 /&gt;
Pi上的绿色活动LED（当前已打开）&lt;/p&gt;
&lt;p&gt;我抓住我的&lt;code&gt;控制activity LED&lt;/code&gt;程序(也是一个纸页)，它生发出一根绿色的胡须。当我让这根胡须去戳Pi时，Pi的activity LED将会打开; 否则，它将熄灭。（我稍后会更详细地解释这个程序。）&lt;/p&gt;
&lt;video width="600px" src="https://rsnous.com/posts/notes-from-dynamicland-programming-raspberry-pis/toggle-act-led.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;使用程序切换activity LED的状态&lt;/p&gt;
&lt;p&gt;实际上，这个程序不仅限于那个Pi：它适用于桌面上的任何Pi。程序会打开胡须戳中的Pi上边的activity LED，而关闭其他Pi上边的activity LED。&lt;/p&gt;
&lt;p&gt;让我们在多个Pi上尝试&lt;/p&gt;
&lt;video width="600px" src="https://rsnous.com/posts/notes-from-dynamicland-programming-raspberry-pis/multiple-toggle-act-led.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;在多个Pi上activity LED的状态&lt;/p&gt;
&lt;p&gt;如果没有Realtalk系统，你要如何制作这种LED切换器？听起来很痛苦。也许你会ssh到每个Pi中，编写并执行一些Python脚本。（如果随后要更改代码，你要如何将更改部署到所有Pi上？）你需要实现对某些指针对象的跟踪以便控制它们。你需要一些通信协议来将信息从跟踪系统传送到所有Pi上。你需要手头的笔记本电脑来完成所有编程。如果你想添加第四、第五或第十个Pi呢，又该怎么办？&lt;/p&gt;
&lt;p&gt;你首先会有这些想法吗？&lt;/p&gt;
&lt;h1 id="led"&gt;LED切换器的工作原理&lt;/h1&gt;
&lt;p&gt;为了展示这个程序如何在桌面和Pi上工作，我需要解释一下Realtalk。&lt;/p&gt;
&lt;h3 id="realtalk_1"&gt;Realtalk数据库&lt;/h3&gt;
&lt;p&gt;Realtalk是一个编程系统，但它也是一种反应型数据库(reactive database)。&lt;/p&gt;
&lt;p&gt;运行着Realtalk的每台机器都知道每帧中一组一致的Realtalk 语句(statements)（如'30帧/秒'）。语句是Realtalk程序的声明(claim)或愿望(wish)。&lt;/p&gt;
&lt;p&gt;从我之前的&lt;a href="https://rsnous.com/posts/notes-from-dynamicland-geokit/"&gt;Geokit帖子&lt;/a&gt;中考虑这个最小的例子：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;-- Page 17813
-- Made-up claim demo
Claim (you) blahblahblah.

-- Page 17814
-- Made-up claim when demo
When /page/ blahblahblah:
    Wish (page) is highlighted &amp;quot;blue&amp;quot;.
End
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img src="https://rsnous.com/posts/notes-from-dynamicland-programming-raspberry-pis/made-up-claim.jpg" width=500 /&gt;
最小的Claim/When/Wish示例来说明数据库&lt;/p&gt;
&lt;p&gt;当页面17813和17814同时在桌子上面朝上时，桌子数据库将每帧包含这些语句：&lt;/p&gt;
&lt;p&gt;&lt;img src="https://rsnous.com/posts/notes-from-dynamicland-programming-raspberry-pis/realbox-2-statements.png" width=500 /&gt;&lt;/p&gt;
&lt;p&gt;如果我移走了下边一张页面（17814），后续帧中的数据库将只包含&lt;/p&gt;
&lt;p&gt;&lt;img src="https://rsnous.com/posts/notes-from-dynamicland-programming-raspberry-pis/realbox-1-statement.png" width=500 /&gt;&lt;/p&gt;
&lt;p&gt;因为底下的页面不再是“显示蓝色”的愿望(wish)了。&lt;/p&gt;
&lt;p&gt;如果我移走了顶部页（17813），但保留了底部页，数据库将不含有这两个语句。由于Realtalk的反应式设计，删除&lt;code&gt;blahblahblah&lt;/code&gt;声明会自动删除其依赖，即“显示蓝色”的愿望。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://rsnous.com/posts/notes-from-dynamicland-programming-raspberry-pis/realbox-0-statements.png" width=500 /&gt;&lt;/p&gt;
&lt;p&gt;即使底部页仍留在桌面上，它的&lt;code&gt;When&lt;/code&gt;也不再匹配任何&lt;code&gt;blahblahblah&lt;/code&gt;声明，因此底页不再产生愿望(wish)。&lt;/p&gt;
&lt;h3 id="realtalk_2"&gt;信息应该流经Realtalk数据库&lt;/h3&gt;
&lt;p&gt;页面通过在Realtalk数据库中读取和写入语句进行通信，而不是通过调用函数或定义变量。 &lt;!--动态性的来源，动态订阅似乎可以实现--&gt;&lt;/p&gt;
&lt;p&gt;我相信这些机制的灵感来自&lt;a href="https://en.wikipedia.org/wiki/Tuple_space"&gt;元组空间&lt;/a&gt;或&lt;a href="https://en.wikipedia.org/wiki/Blackboard_system#Metaphor"&gt;黑板&lt;/a&gt;概念，以及&lt;a href="https://github.com/harc/nl-datalog"&gt;Datalog&lt;/a&gt;，但我对这段历史知之甚少。你可以将Realtalk语句(statements)（声明和愿望）视为存在于“黑板”之上，所有程序都盯着这个“黑板”。然而，在Realtalk中，语句不仅仅是抽象数据; 他们应该关注现实世界。我们的“元组空间”(tuple space)模仿了桌子的社交空间，在这儿，每个人都可以看到和听到对方，同样地，Realtalk中的程序都可以看到彼此的声明(statements)。&lt;/p&gt;
&lt;p&gt;只要信息流经Realtalk数据库，之后就可以轻松检查、拦截、跟踪、调试和扩展！查询该数据库的进程将自动对更改进行实时响应。我经常制作一些&lt;a href="https://twitter.com/rsnous/status/1031067767485546498"&gt;一些小工具&lt;/a&gt;
与我手头的程序互动，交互式地探索它。&lt;/p&gt;
&lt;p&gt;相反，如果你坚持使用传统的函数和变量，那么你的程序将被封闭，并且对外部世界不透明。传统上构建的程序是静态的：除非您明确地对其进行编码以进行更新，否则它不会响应输入的更改（或周围程序的更改）。&lt;/p&gt;
&lt;p&gt;在我们的例子中，桌子和Pi是两个独立的Realtalk主机，因此每个（在Realtalk的当前实现中）都有自己的数据库（帧速率和每帧语句集）。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://rsnous.com/posts/notes-from-dynamicland-programming-raspberry-pis/realbox-pi-separate-statements.png" width=500 /&gt;&lt;/p&gt;
&lt;p&gt;请注意，Pi并未连接到摄像机，并且无法独立查看任何程序，因此Pi基本上是惰性的（没有外部刺激）：在别处运行的程序必须手动将程序和语句转发给Pi，以使其执行或了解外部世界的任何事情。&lt;/p&gt;
&lt;h3 id="toggler"&gt;切换器(toggler)的代码&lt;/h3&gt;
&lt;p&gt;切换器(toggler)是我们前头图片里带绿色胡须的程序。&lt;/p&gt;
&lt;p&gt;这是我之前的LED切换程序。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://rsnous.com/posts/notes-from-dynamicland-programming-raspberry-pis/control-pi-act-led.jpg" width=500 /&gt;
我正在使用的程序: 切换Pi 的activity LED的状态&lt;/p&gt;
&lt;p&gt;你了解&lt;a href="https://en.wikipedia.org/wiki/Fork_(system_call)#Application_usage"&gt;Unix上的fork&lt;/a&gt;吗?上边这个程序与Unix上使用fork的程序谜之相似:它与自己的分身并行运作。一个部分在这里运行，另一个部分在那里运行。&lt;/p&gt;
&lt;p&gt;你应该了解的是,&lt;code&gt;processor&lt;/code&gt;是一个全局变量，它标识着底层的Realtalk机器:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果页面在桌面上运行，那&lt;code&gt;processor&lt;/code&gt;形如&lt;Processor realbox7&gt;&lt;/li&gt;
&lt;li&gt;如果页面正在Pi上运行，&lt;code&gt;processor&lt;/code&gt;形如 &lt;Processor pi-74a6&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;该页面由两个代码块组成。该页面同时在Pi和动感桌上执行 ; 每个代码块的第一行检查页面正在执行的处理器(processor)类型，每个代码块据此决定是否运行。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;上边的代码块： &lt;code&gt;if not is_pi(processor) then ...&lt;/code&gt;, 像一个普通的Realtalk纸页运行在桌子上，全局函数&lt;code&gt;is_pi&lt;/code&gt;检查&lt;code&gt;processor&lt;/code&gt;是否是Pi.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;is_pi&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;processor&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt;
    &lt;span class="c1"&gt;-- This block runs on the realbox (the table).&lt;/span&gt;

    &lt;span class="n"&gt;When&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;pi&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="n"&gt;is&lt;/span&gt; &lt;span class="n"&gt;pi&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;something&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="c1"&gt;-- for each Pi on the table,&lt;/span&gt;
        &lt;span class="n"&gt;Wish&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;you&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;runs&lt;/span&gt; &lt;span class="n"&gt;remotely&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pi&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;

        &lt;span class="n"&gt;When&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;you&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;points&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;up&amp;quot;&lt;/span&gt; &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pi&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="n"&gt;Wish&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pi&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;sets&lt;/span&gt; &lt;span class="n"&gt;led&lt;/span&gt; &lt;span class="n"&gt;brightness&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
        &lt;span class="n"&gt;Otherwise&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;Wish&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pi&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;sets&lt;/span&gt; &lt;span class="n"&gt;led&lt;/span&gt; &lt;span class="n"&gt;brightness&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
        &lt;span class="n"&gt;End&lt;/span&gt;
        &lt;span class="n"&gt;Wish&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;processor&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;shares&lt;/span&gt; &lt;span class="n"&gt;statements&lt;/span&gt; &lt;span class="n"&gt;with&lt;/span&gt; &lt;span class="n"&gt;relation&lt;/span&gt;
            &lt;span class="s2"&gt;&amp;quot;_ wishes _ sets led brightness to _.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
    &lt;span class="n"&gt;End&lt;/span&gt;
&lt;span class="kr"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;找到桌子所有Pi的句柄(handles)，对于每个Pi,&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;将自身运行在Pi上: &lt;code&gt;Wish (you) runs remotely on (pi).&lt;/code&gt;, 接着&lt;/li&gt;
&lt;li&gt;投射绿色胡须:&lt;code&gt;When (you) points "up" at (pi)&lt;/code&gt;,如果那个胡须碰到pi，那么希望(wish)它的LED开启; 否则，希望(wish)它的LED关闭.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Wish (processor) shares statements with relation "_ wishes _ sets led brightness to _"&lt;/code&gt;联合该形式的所有愿望。不仅仅停留在桌子数据库中，也希望(wish)被转发到房间中所有其他Realtalk主机的数据库，包括Pi！&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;当我指向我的LED切换器时&lt;code&gt;pi-74a6&lt;/code&gt;，顶部块可能会在桌子数据库中生成这些语句（假设桌子本身由realbox7驱动）：&lt;/p&gt;
&lt;p&gt;&lt;img src="https://rsnous.com/posts/notes-from-dynamicland-programming-raspberry-pis/led-realbox-statements.png" width=500 /&gt;&lt;/p&gt;
&lt;p&gt;底部块, &lt;code&gt;When /someone/ wishes (you) runs remotely on (processor): ... runs&lt;/code&gt;只运行在Pi上。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;When&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;someone&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="n"&gt;wishes&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;you&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;runs&lt;/span&gt; &lt;span class="n"&gt;remotely&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;processor&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c1"&gt;-- This block runs on the Pi itself.&lt;/span&gt;

    &lt;span class="nb"&gt;os.execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;echo gpio | sudo tee /sys/class/leds/led0/trigger&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;When&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;pi&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="n"&gt;is&lt;/span&gt; &lt;span class="n"&gt;processor&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;processor&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
         &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;someone&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="n"&gt;wishes&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;pi&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="n"&gt;sets&lt;/span&gt; &lt;span class="n"&gt;led&lt;/span&gt; &lt;span class="n"&gt;brightness&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="nb"&gt;os.execute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;echo &amp;#39;&lt;/span&gt;&lt;span class="o"&gt;..&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;..&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; | sudo tee /sys/class/leds/led0/brightness&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;End&lt;/span&gt;
&lt;span class="n"&gt;End&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;顶部块让这些程序自身运行在每个Pi上，它还在房间内共享一些语句到每个Pi的数据库（右）中。我们可以使用&lt;code&gt;When&lt;/code&gt;来匹配哪些语句应该在Pi上运行，哪些该在桌子上运行。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://rsnous.com/posts/notes-from-dynamicland-programming-raspberry-pis/led-sharing-statements.png" width=500 /&gt;
从Realbox（左）到Pi（右）共享的语句&lt;/p&gt;
&lt;p&gt;底部代码块的第一个检查: &lt;code&gt;When /someone/ wishes (you) runs remotely on (processor)&lt;/code&gt;实质上是检查我们执行的原因。&lt;/p&gt;
&lt;p&gt;它之所以运行，是因为有人把它放在桌子上，或者顶部块（放在桌子上的）希望它在当前设备“远程运行” 。如果是后者，那么它必须在Pi上运行; 因此，如果这个&lt;code&gt;When&lt;/code&gt;被匹配，说明它正运行在Pi中。&lt;/p&gt;
&lt;p&gt;现在这段代码正在Pi上执行，可以使用&lt;a href="https://www.jeffgeerling.com/blogs/jeff-geerling/controlling-pwr-act-leds-raspberry-pi"&gt;普通的Unix命令来控制activity LED&lt;/a&gt;，就好像我们在Pi上的终端中键入命令一样。&lt;/p&gt;
&lt;p&gt;一旦我们开始，我们就会运行一个&lt;code&gt;echo | sudo tee&lt;/code&gt;命令将activity LED初始化为GPIO模式，以便我们以后可以控制它。&lt;/p&gt;
&lt;p&gt;接着，每当得到一个wish（来自桌子，如图中所示）来设置我们的&lt;code&gt;led brightness to some value,&lt;/code&gt;，就运行一个&lt;code&gt;echo | sudo tee&lt;/code&gt;实际设置LED亮度的命令。&lt;/p&gt;
&lt;p&gt;我确实有一种高级语言来处理: Wish (pi) runs unix command，你通常不需要这种明确声明&lt;code&gt;run remotely&lt;/code&gt;的模式(上边两个代码块的模式)。但我想在这里演示一些基本原理; 更高级别的接口是由这种基本模式构建的。&lt;/p&gt;
&lt;h1 id="_2"&gt;完整的编程系统&lt;/h1&gt;
&lt;p&gt;由于我们在Pi上运行完整的Realtalk系统，并且我们可以在那里远程运行页面代码，我们现在可以在页面上对Pi执行任何操作：我们可以控制任何外设并进行任何计算。机器人、乐器、旋钮/按钮、环境传感器、触摸板 -- 我们可以在桌面上编程​​所有这些。我们可以在桌子上为所有的这些编程。&lt;/p&gt;
&lt;!--和远程命令有什么区别 分布式动态，不是RPC--&gt;

&lt;p&gt;它不像Pi上存在的固定服务，我们只限于一些预设命令来告诉它该做什么。它让我想起了打印机、&lt;a href="http://dev.rsnous.com/dewdrop/executive/"&gt;NeWS&lt;/a&gt;、&lt;a href="https://lwn.net/Articles/740157/"&gt;eBPF&lt;/a&gt;中的&lt;a href="https://en.wikipedia.org/wiki/PostScript"&gt;PostScript&lt;/a&gt;，甚至现代Web本身：不是制作一些动力不足的命令语言，所以A可以控制B，&lt;strong&gt;让A将程序发送给B&lt;/strong&gt;，B在B端执行。然后A（桌子上的页面）可以使用B（Pi）的全部功能。&lt;/p&gt;
&lt;!--有些像远程RPC--&gt;

&lt;h1 id="_3"&gt;意见&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;在更深层次上，在单个统一接口上构建所有资源可以简化互操作性。一旦资源导出9P接口，它就可以透明地与系统的任何其他部分组合，以构建非同寻常的应用程序; 细节是隐藏的。&lt;br /&gt;
- Rob Pike等人，&lt;a href="https://www.usenix.org/legacy/publications/compsystems/1995/sum_pike.pdf#page=30"&gt;贝尔实验室的Plan 9&lt;/a&gt;（1995）&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--不要用rpc？--&gt;

&lt;ul&gt;
&lt;li&gt;Realtalk是&lt;a href="https://en.wikipedia.org/wiki/Network_transparency"&gt;网络透明的&lt;/a&gt;。无论是来自本地Realtalk实例还是来自远程Realtalk实例，语句都是相同的。&lt;ul&gt;
&lt;li&gt;最终，我们希望在Realtalk实例之间自动共享语句，因此您根本不需要明确地联合它们。想象一下所有Realtalk联合在一起的世界。&lt;/li&gt;
&lt;li&gt;你可以从Pi透明地访问回桌子，进行计算、交互和调试; 相反，在你为Arduino之类地东西编程时，它与你的笔记本电脑交互并输出运算结果通常需要额外的工作。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;每个Pi只是一个外围设备(peripheral)。Pi不持有任何代码或持久状态。事实上，我在它们地SD卡中烧录的是同一个镜像。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;所有实际行为都存在于我手中的页面上，而不在Pi内，这意味着任何人都可以理解并编辑它，就像Dynamicland中的任何其他内容一样。&lt;!--无状态--&gt;&lt;br /&gt;
任何人都可以进入并添加更多传感器和执行器（如果他们有Pi），无需插入天花板或修改“系统软件”。&lt;br /&gt;
我几乎认为Pi之于Dynamicland相当于USB端口之于我地笔记本电脑。它是我将东西接入Dynamicland的方式。
&lt;em&gt;  这个例子代码不多。&lt;a href="https://www.arduino.cc/en/Guide/Introduction"&gt;Arduino的平台&lt;/a&gt;扩展了对物理计算的访问，超越传统的“嵌入式程序员。” Dynamicland中的Pi可以走得更远; 代码可以像Arduino的草图一样简洁明了，而且构建过程更轻巧，更连续，因为你无需连接到笔记本电脑或IDE上。
&lt;/em&gt;  在桌面上可以轻易运行多个程序/Pi，通过指向来切换它们。这种桌子支持多人并发做游戏。很多人可以同时尝试很多想法。你只需拿出你的旧页面即可切换回旧程序或添加调试视图。&lt;/p&gt;
&lt;p&gt;真的，我根本不是为树莓派编程; 我正在为房间编程，而树莓派已成为房间的一种功能。我没有放弃Dynamicland模型的任何强大功能。所有代码仍在桌面上。&lt;/p&gt;
&lt;h1 id="_4"&gt;未来的暗示&lt;/h1&gt;
&lt;p&gt;我相信树莓派暗示了Dynamicland的未来。&lt;/p&gt;
&lt;p&gt;说实话，我开始这个项目是因为我厌倦了在天花板上移动大型Realtalk投影机--摄像头系统，它们会造成中断。我想玩单独的页面无法实现的交互: 移动真实物体、精确定位、直接触摸页面...... Pi为我们提供了逐步添加新交互的途径。&lt;/p&gt;
&lt;p&gt;鉴于这些Pi作为接口计算机，你还可以插入各种传感器并基于它们进行计算（例如，作为科学家或教师）。你在工作台上对现实世界进行测量，并连续分析这些测量结果，而不是要求您从实验室仪器切换到笔记本电脑。我们希望Dynamicland成为一种有利于跟踪而不是模拟现实世界的媒介，而Pi是支持该系统的传感器的平台。&lt;/p&gt;
&lt;p&gt;最后，正如我在介绍中所说，Pi暗示我们如何从单机“Realtalk系统”过渡到Realtalk主机的分布式生态系统。Dynamicland并不意味着拥有一台运行整个房间的服务器软件; 它意味着是一台由小型计算机组成的计算机，所有计算机都通过通用协议相互通信。&lt;/p&gt;
&lt;p&gt;我们试图找出正确的协议和抽象来使这个生态系统发挥作用，以及正确的价值观和界面范式，使其增强人类而不是疏远人类。&lt;/p&gt;
&lt;p&gt;如果你想继续听听这些想法，你可以在Twitter上&lt;a href="https://twitter.com/rsnous"&gt;关注我@rsnous&lt;/a&gt;和 &lt;a href="https://twitter.com/dynamicland1"&gt;@Fynamicland1&lt;/a&gt;。你可能还想阅读我之前关于&lt;a href="https://rsnous.com/posts/notes-from-dynamicland-geokit/"&gt;Geokit地图框架&lt;/a&gt;的帖子。&lt;/p&gt;
&lt;h1 id="_5"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/zh/%E6%A0%91%E8%8E%93%E6%B4%BE"&gt;树莓派&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Wed, 12 Dec 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-12-12:notes-from-dynamicland-programming-raspberry-pis.html</guid><category>code</category></item><item><title>使用Python拓展Scratch的能力</title><link>/scratch-adapter-eim-script.html</link><description>&lt;blockquote&gt;
&lt;p&gt;如果我们有设备和材料的结构，在我们面前就开辟了另一条路径。我们可以指导儿童的活动，使它们沿着一定方向运行，把它们渐渐引导到这条道路逻辑上必然要达到的目标上。 --约翰·杜威《学校与社会》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;希望不只对Pythonista友好，也对Scratcher友好。&lt;/p&gt;
&lt;p&gt;我们在上篇文章:&lt;a href="https://blog.just4fun.site/python-scratch-with-adapter.html"&gt;Python与Scratch的双向通信&lt;/a&gt;向开发者介绍了一些拓展Scratch的技巧。方便Python和Scratch的互操作，开发者们可以利用它制作功能强大的插件。将AI、物联网或者任何你能想到的东西接入到Scratch。&lt;/p&gt;
&lt;p&gt;本文则旨在阐述，如何用最简单的方式拓展Scratch3.0。无需了解&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;的&lt;a href="https://codelab-adapter-docs.codelab.club/dev_guide/helloworld/"&gt;插件机制&lt;/a&gt;，也无需了解Scratch3.0的插件机制，只需要写一个Python函数，即可为scratch加入新功能。考虑到多数Scratcher对Python并不熟悉，让他们理解插件的模版代码，从继承一个类开始，接着理解线程机制，有些不近人情。本文将阐述Scratcher如何使用最少的Python代码来扩展他们自己的项目。&lt;/p&gt;
&lt;h1 id="_1"&gt;设计上的思考&lt;/h1&gt;
&lt;h3 id="_2"&gt;编程风格层面&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;Everything is message&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;尽可能保持Scratch风格，尽量不改变大家的编程习惯/范式。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;基于消息的事件驱动风格&lt;/code&gt;是scratch编程的典型风格，继承自smalltalk。第一代的scratch采用smalltalk的方言squeak构建，所以scratch从smalltalk中继承了很多设计原则，关于这部分的更多讨论可以参考我之前的文章:&lt;a href="https://blog.just4fun.site/scratch-extension-token-bucket.html"&gt;Scratch3.0自定义插件注意事项之令牌桶算法&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;在&lt;a href="https://scratch.mit.edu/"&gt;scratch官方社区&lt;/a&gt;中，我们可以看到稍有规模的程序都会用到&lt;code&gt;消息积木&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratchdemo_5ff4a8e6.png" /&gt;&lt;/p&gt;
&lt;p&gt;上图显示的是scratch社区用户创作的最受欢迎的游戏之一：&lt;a href="https://scratch.mit.edu/projects/227802255/#editor"&gt;Bouncy Ninja 2&lt;/a&gt;, 程序之间的协同通过&lt;code&gt;广播消息&lt;/code&gt;来完成。 利用消息实现了程序的解耦。&lt;/p&gt;
&lt;p&gt;我们进一步观察，可以发现这个游戏使用了大量的&lt;code&gt;消息&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratchdemo_b6151312.png" /&gt;&lt;/p&gt;
&lt;p&gt;Scratcher之所以依赖消息机制，其中的原因，我在&lt;a href="https://blog.just4fun.site/visual-programming-why-its-bad-idea.html"&gt;可视化编程为何是个糟糕的主意&lt;/a&gt;中做过论述:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;消息机制是Scratch的核心机制。消息是绝佳的解耦工具，如果你逛一逛Scratch社区，就可以看到人们构建了许多令人惊叹的项目。它们中的许多并不简单，消息是帮助他们克服复杂度的核心工具之一。这个特性继承自smalltalk的设计原则: &lt;code&gt;计算应该被视为可通过发送消息来统一调用的对象的内在功能。&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;所以在编程风格层面，希望scratcher在使用Python拓展程序功能时，觉得是顺滑的，不强行要求他们转化范式。&lt;/p&gt;
&lt;h3 id="_3"&gt;教育层面&lt;/h3&gt;
&lt;p&gt;下边说说教育层面的思考。&lt;/p&gt;
&lt;p&gt;我们来讨论下目前这个领域，大家所关心的:如何从图形界面过渡/进阶到代码。&lt;/p&gt;
&lt;p&gt;事实上，我不认为这种过渡是必须的。当然我也并不反对从图形界面过渡到代码。如果这种过渡是必要的，我希望它们是渐进的，而不是割裂的，否则就不叫过渡了。初学者熟悉scratch，也喜欢它，我知道大多数使用scratch的孩子，对它的好感大都胜过文本语言。你不必抛弃scratch，如果你需要一些更强大的功能，使用Python去扩展它，这个过程应该很愉快，你写了很少的Python代码，立马就能应用到你喜欢的Scratch项目上，你看到你逐渐能做更多有趣的事，你感到充满乐趣，所学的新知识，立马应用在你感兴趣的项目里。&lt;/p&gt;
&lt;p&gt;我们反对割裂式的教学，学习者从scratch切换到Python，很长时间内只能通过print看到输出，没有生动的反馈，于是许多人便对阶段感到沮丧，踏上一条从入门到放弃的路。&lt;/p&gt;
&lt;p&gt;学习的过程，有时的确会遇到一些困难，有些困难是固有的，或者如康德所说的它是先天的。另一些则是人为的，教育者或者基础设施建设者应该努力去清理那些人为的困难。&lt;/p&gt;
&lt;p&gt;我不喜欢教育者们有时候提到的&lt;code&gt;学习的过程，痛苦必不可少，所以你应当忍受&lt;/code&gt;这种宿命论的观点，有时候它只是我们懒惰和无能的借口。&lt;/p&gt;
&lt;h1 id="_4"&gt;使用&lt;/h1&gt;
&lt;p&gt;下边我们来演示如何使用它。&lt;!--发布一个新版本 0.3--&gt;&lt;/p&gt;
&lt;p&gt;在插件目录创建&lt;code&gt;eim_script.py&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;ps: 插件目录可以通过&lt;code&gt;菜单&amp;gt;插件&amp;gt;查看目录&lt;/code&gt;查看: Mac/Linux用户在&lt;code&gt;~/scratch3_adapter/extensions&lt;/code&gt;, windows用户在&lt;code&gt;C:\Users\[你的用户名]\scratch3_adapter\extensions&lt;/code&gt; &lt;!-- todo --&gt;&lt;/p&gt;
&lt;p&gt;从一个最简单的例子开始: &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;handle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;message&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; from script&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;我们写了一个名叫&lt;code&gt;handle&lt;/code&gt;的函数来处理从Scratch EIM插件广播过来的消息。&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/geim_cac4611e.png" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;消息内容在message参数中，logger参数你暂时可以忽略。&lt;/p&gt;
&lt;p&gt;这个插件的功能是: 将Scratch广播过来的消息末尾加上&lt;code&gt;from script&lt;/code&gt;，返回给Scratch那边。它不具备实际的用途，为了展示原理，它尽可能简单。&lt;/p&gt;
&lt;p&gt;完成之后启动scratch3-adapter，勾选&lt;code&gt;extension_eim_script&lt;/code&gt;插件(在&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/install/"&gt;最新的scratch3-adapter版本&lt;/a&gt;中，已经内置了这个插件), 即刻生效，可以看到Python对Scratch的扩展已经生效:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/eimscript_bb260253.png" /&gt;&lt;/p&gt;
&lt;p&gt;每次修改eim_script.py建议重启scratch3-adapter。&lt;/p&gt;
&lt;h1 id="_5"&gt;旧版本&lt;/h1&gt;
&lt;p&gt;extension_eim_script已经内置在0.3.0之后的版本中。如果你使用的scratch3-adapter版本低于&lt;code&gt;0.3.0&lt;/code&gt;(通过&lt;code&gt;菜单&amp;gt;关于&amp;gt;version&lt;/code&gt;查看版本)，你需要先下载extension_eim_script插件。&lt;/p&gt;
&lt;h3 id="_6"&gt;下载插件&lt;/h3&gt;
&lt;p&gt;在scratch3-adapter中下载插件很简单,点击&lt;code&gt;菜单&amp;gt;插件&amp;gt;下载&lt;/code&gt;，弹出输入框，将插件的url链接复制粘贴其中即可。&lt;/p&gt;
&lt;p&gt;extension_eim_script插件的链接是: &lt;code&gt;https://github.com/Scratch3Lab/scratch3_adapter_extensions/blob/master/extension_eim_script.py&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;下载完成之后重启软件，即可看到插件。&lt;/p&gt;
&lt;p&gt;所有插件列表在&lt;a href="https://github.com/Scratch3Lab/scratch3_adapter_extensions"&gt;scratch3_adapter_extensions&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="_7"&gt;用例&lt;/h1&gt;
&lt;p&gt;留个课后作业。&lt;/p&gt;
&lt;p&gt;利用这个插件，配合micro:bit，可以很容易实现&lt;a href="https://blog.just4fun.site/pi-guardian.html"&gt;树莓派守护者!&lt;/a&gt;：  你正在看《多啦A梦》，突然有人闯入了你的房间，你的屏幕自动切换为正在阅读论文。&lt;/p&gt;
&lt;h1 id="_8"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/python-scratch-with-adapter.html"&gt;Python与Scratch的双向通信&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/interest-based-learning.html"&gt;基于兴趣的学习面临的诘难&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/Hardware-Programming-style.html"&gt;两种硬件编程风格的比较&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Mon, 03 Dec 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-12-03:scratch-adapter-eim-script.html</guid><category>Scratch</category></item><item><title>Python与Scratch的双向通信</title><link>/python-scratch-with-adapter.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/flow_6f3076dd.png" /&gt;&lt;/p&gt;
&lt;p&gt;近期我们在&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;制作了不少&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/gallery/"&gt;有趣的案例&lt;/a&gt;.得益于我们最近构建的json extension，我们可以让Python与&lt;a href="http://scratch3.codelab.club"&gt;Scratch3.0&lt;/a&gt;之间传递任意复杂的数据结构。如此一来，我们就可以将任意的Python程序接入&lt;a href="http://scratch3.codelab.club"&gt;Scratch3.0&lt;/a&gt;中。&lt;/p&gt;
&lt;p&gt;以下是摘自&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/gallery/"&gt;scratch3-adapter gallery&lt;/a&gt;页面的一些有趣的案例:&lt;/p&gt;
&lt;video width="600px" src="http://scratch3-files.just4fun.site/dlib_face.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;人脸地标： 在Python中使用dlib采集我的脸部地标，之后将这些数据完整地传给Scratch，接着在Scratch中解析这些数据，将其用于绘图，在Scratch中实时绘制出我的脸部特征点。当然我们也可以用于任何其他用途。这个策略是完全通用的，意味着可以将Python构建的任意AI项目积木化。当然这个过程有些细节需要注意，诸如numpy描述的矩阵得先转化为Python数据结构，如果你对此感兴趣，我们可以邮件里细说：）&lt;/p&gt;
&lt;video width="600px" src="http://scratch3-files.just4fun.site/wechat.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;不喜欢微信的聊天界面？没关系，我们在Scratch中自己new一个。它真实可用，你可以用于与朋友聊天。当然你也可以通过组合积木将微信用于控制智能家居。&lt;/p&gt;
&lt;video width="350px" src="http://scratch3-files.just4fun.site/%E8%A6%81%E6%9C%89%E5%85%89.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;所有的这些都发生在Scratch中！&lt;/p&gt;
&lt;p&gt;下边我们将以简单的例子，展示这种交互方式。&lt;/p&gt;
&lt;h1 id="python-scratch"&gt;Python &lt;code&gt;-&amp;gt;&lt;/code&gt; Scratch&lt;/h1&gt;
&lt;p&gt;我们先来展示数据从Python流向Scratch。&lt;/p&gt;
&lt;p&gt;我们希望将以下数据发布给Scratch：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;quot;hello&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;world&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;quot;numbers&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;我们先来看看scratch3-adapter extension插件应该怎么写&lt;/p&gt;
&lt;h3 id="python-extensions"&gt;Python extensions&lt;/h3&gt;
&lt;p&gt;在&lt;code&gt;~/scratch3_adapter/extensions&lt;/code&gt;目录下(linux/mac适用。windows用户可以点击&lt;code&gt;菜单栏-&amp;gt;插件-&amp;gt;查看目录&lt;/code&gt;), 创建&lt;code&gt;extension_test.py&lt;/code&gt;插件,内容如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;scratch3_adapter&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;settings&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;scratch3_adapter.core_extension&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Extension&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DemoExtension&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Extension&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__name__&lt;/span&gt;
        &lt;span class="nb"&gt;super&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="c1"&gt;# run 会被作为线程调用&lt;/span&gt;
        &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_running&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;topic&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;eim&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
            &lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;message&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;hello&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;world&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;numbers&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]}&lt;/span&gt;
            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;publish&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;export&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;DemoExtension&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="scratch"&gt;Scratch&lt;/h3&gt;
&lt;p&gt;当extension_test插件在scratch3_adapter中被加载后，在Scratch一侧，我们就可以利用EIM插件与Json插件 来取回我们从Python中发过来的消息。&lt;/p&gt;
&lt;p&gt;scratch接收到&lt;code&gt;{"hello": "world","numbers": [1,2,3]}&lt;/code&gt;，它成为EIM &lt;code&gt;receive message&lt;/code&gt;积木的内容。&lt;/p&gt;
&lt;p&gt;我们可以使用Json积木来解析消息体。&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/jsonscratch_4f6ec6a4.png" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/jsonscratcgh_379ea9fb.png" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;以上两个例子展示了我们可以解析任意的json结构。值得注意的是，列表的下标从1开始(不是0)，这是为了遵循Scratch社区对列表的操作风格(用户更容易理解)。&lt;/p&gt;
&lt;h1 id="scratch-python"&gt;Scratch &lt;code&gt;-&amp;gt;&lt;/code&gt; Python&lt;/h1&gt;
&lt;p&gt;接下来，我们将展示，从Scratch发往Python的消息。对大部分用户来说，发送字符串就够了。对于高级用户，他们可能希望传递更复杂的数据结构。当然没问题！&lt;/p&gt;
&lt;p&gt;一个典型的用例是:前端使用颜色控件选择颜色，将RGB信息发往后端&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;quot;R&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;quot;G&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;quot;B&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="scratch_1"&gt;Scratch&lt;/h3&gt;
&lt;p&gt;我们在Scratch需要做的是&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/jsonscratch_6f04d076.png" width=400 /&gt;&lt;/p&gt;
&lt;p&gt;更理想的做法其实是在Scratch中制作一个新的extension，构建颜色选择器，这部分涉及前端的调整，官方还没放出教程，这种优化问题我们以后再讨论。如果你已经在EIM中构建好了这个积木，要迁移到新的extension UI上，是非常简单的。核心的通信过程并没有变化，我们已经为你都做好了。构建EIM的目的是给出一种通用的积木，你无需编写js代码，动态性在消息中，而不是固化在积木，这种特性，对开发和扩展极为有利。 在我们以后的&lt;code&gt;microworld&lt;/code&gt;和&lt;code&gt;realworld&lt;/code&gt;案例中，我们将演示这种架构将带来多么大的灵活性和可能性，我们认为Scratch从Smalltalk学到的重要东西，正是通过消息来解耦，并获得扩展能力，scratch3-adapter将继续发挥这个原则。&lt;/p&gt;
&lt;p&gt;你可能会问，如何将你定制的的EIM积木分发给用户？目前你可以下载下来，之后让用户用这个文件初始化项目便可。在以后，我们会允许你发布到云端，用户打开特定链接就行。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;everything is message&lt;/code&gt;&lt;/p&gt;
&lt;h3 id="python-extensions_1"&gt;Python extensions&lt;/h3&gt;
&lt;p&gt;在&lt;code&gt;~/scratch3_adapter/extensions&lt;/code&gt;目录下(linux/mac), 创建&lt;code&gt;extension_test.py&lt;/code&gt;插件,内容如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;scratch3_adapter&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;settings&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;scratch3_adapter.core_extension&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Exte&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DemoExtension&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Extension&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__name__&lt;/span&gt;
        &lt;span class="nb"&gt;super&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_running&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;info&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;export&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;DemoExtension&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;当extension_test插件在scratch3_adapter中被加载后吗， 新开一个命令行运行&lt;code&gt;tail -f ~/scratch3_adapter/info.log | grep extension_test&lt;/code&gt; (mac/linux适用，windows用户参考&lt;a href="https://codelab-adapter-docs.codelab.club/dev_guide/debug/#windows"&gt;windows用户&lt;/a&gt;)，查看接收到的来自Scratch的消息:&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/jsonscratch_eee125e9.png" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;至此演示完毕。&lt;/p&gt;
&lt;p&gt;对了如果你希望在一个插件中双向传递数据,你需要多线程，可以参考我们的例子:&lt;a href="https://github.com/Scratch3Lab/scratch3_adapter_extensions/blob/master/extension_eim.py"&gt;extension_eim.py&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="_1"&gt;注意&lt;/h1&gt;
&lt;p&gt;大多数情况下，你只需要发送和接受字符串就够了，这种风格与Scratch内置的&lt;code&gt;广播&lt;/code&gt;极为相近。是典型的事件驱动风格。&lt;/p&gt;
&lt;p&gt;这篇教程主要针对那些希望去拓展Scratch的人。当你需要将一些复杂的程序接入Scratch（例如接入AI或者接入微信，如我们制作的&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/gallery/"&gt;例子&lt;/a&gt;），它会对你有帮助。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Wed, 28 Nov 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-11-28:python-scratch-with-adapter.html</guid><category>codelab</category></item><item><title>可视化编程为何是个糟糕的主意</title><link>/visual-programming-why-its-bad-idea.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/vp_3883727e.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/mikehadlow"&gt;mikehadlow&lt;/a&gt;于2018.10.1在&lt;a href="http://mikehadlow.com/"&gt;他的博客&lt;/a&gt;上写了篇文章:&lt;a href="http://mikehadlow.blogspot.com/2018/10/visual-programming-why-its-bad-idea.html"&gt;Visual Programming - Why it’s a Bad Idea&lt;/a&gt;。他在&lt;a href="https://www.reddit.com"&gt;reddit&lt;/a&gt;上发了个&lt;a href="https://www.reddit.com/r/programming/comments/9kgk75/visual_programming_why_its_a_bad_idea/"&gt;同名帖子:&lt;/a&gt;，一石激起千层浪。截至今日(2018.11.21)，帖子获得414票的赞同，383个评论。考虑到它只是技术话题，算是非常热门了。&lt;/p&gt;
&lt;p&gt;今早有人将这篇文章推到&lt;a href="https://news.ycombinator.com/"&gt;hacker news&lt;/a&gt;。我读完文章，顺带将同名帖子下的所有讨论一并读了。关于图形化编程，这是我近来读到最精彩的争论，做个梳理。&lt;/p&gt;
&lt;p&gt;我最初给&lt;a href="https://www.reddit.com/r/programming/comments/9kgk75/visual_programming_why_its_a_bad_idea/"&gt;那篇帖子&lt;/a&gt;点了个踩，后来改为点赞。起初点踩的原因是，我不赞同文章的观点。但我认为那是一篇好文章，至少也算抛砖引玉，希望它被更多人读到，引起更广泛的讨论和思考。它值得一读，也值得一驳，这是我给它点赞的原因。一篇文章值得被反驳，是一种赞美。&lt;/p&gt;
&lt;p&gt;这听起来有些古怪。如果有人跟我说，我写得东西，值得他花半个小时来反驳，我会觉得这是一种莫大的荣耀。要知道，太多的文章混乱不堪，根本不值驻足细读，更别说理解之后再反驳了，你恨不能捏起鼻子赶紧跑开。&lt;/p&gt;
&lt;p&gt;在哲学圈，有这么一条不成文的规矩：对一位哲学家最大的尊重，就是去反驳他的论证。&lt;/p&gt;
&lt;p&gt;罗素在《西方哲学史》卷三.近代哲学部分，写霍布斯时说:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;把霍布斯和以前的政治理论家们作个对比，他的高明处显露得清楚极了。他完全摆脱了迷信；他不根据亚当和夏娃堕落人间时的遭遇发议论。他论事清晰而合逻辑；他的伦理学说对也好错也好，总是完全可以理解的东西，里面没使用任何暧昧含混的概念。除开远比他见识狭隘的马基雅弗利，他是讲政治理论的第一个真正近代的著述家。他若有错处，错也出于过分简单化，并不是因为他的思想基础不现实、偏空想。为这个缘故，他仍旧值得一驳。 &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;你看，“他仍旧值得一驳。"的原因正是因为他有如此多的优点。&lt;/p&gt;
&lt;p&gt;大卫·休谟（David Hume，1711—76）在1739年出版他的《人性论》（Treatise of HumanNa ture）后，期待着猛烈的攻击，打算用堂堂的反驳来迎击。殊不料谁也不注意这本书；如他自己说的，“它从印刷机死产下来。” 。你都准备好了在一次伟大的争论中，让观点屹立于世，却不料期待的对手始终没有出现。&lt;/p&gt;
&lt;p&gt;我有个小人之心的想法，故事中持剑的少年，内心是期待着那条劫走公主的恶龙出现的。我甚至不知道持剑的少年究竟喜欢公主多些，还是喜欢恶龙多些。&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;近期正在尝试写文献综述风格的文章，本文是这个系列的第三篇。&lt;/p&gt;
&lt;h1 id="_1"&gt;可视化编程为何是个糟糕的主意&lt;/h1&gt;
&lt;p&gt;我先翻译&lt;a href="https://github.com/mikehadlow"&gt;mikehadlow&lt;/a&gt;对可视化编程的攻击，在文章后半部分，给出reddit社区用户对这篇文章的反驳以及我个人对此的反驳。&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/mikehadlow"&gt;mikehadlow&lt;/a&gt;在&lt;a href="http://mikehadlow.blogspot.com/2018/10/visual-programming-why-its-bad-idea.html"&gt;Visual Programming - Why it’s a Bad Idea&lt;/a&gt;中写道:&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/scratch_cc3e3292.png" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;可视化编程语言&lt;/code&gt;允许编程者通过操控图形元素不是通过输入文本命令来创建程序。众所周知的例子是&lt;a href="https://scratch.mit.edu/"&gt;Scratch&lt;/a&gt;,一个来自MIT(麻省理工学院)的可视化编程语言，用于教孩子编程。Scratch的优点是让新手和普通用户能够轻松地开始编程。&lt;/p&gt;
&lt;p&gt;在20世纪90年代，有一种非常流行的运动，即通过所谓的&lt;a href="https://en.wikipedia.org/wiki/Computer-aided_software_engineering"&gt;CASE工具&lt;/a&gt;将这类工具带入企业，企业系统可由UML定义和生成，无需雇佣专业开发者。这涉及“round tripping”的概念，在其中，系统可以在视觉上建模，程序代码从模型中生成，并且代码的任何更改都可以反映到模型上。这些工具未能兑现承诺，大多数这此类尝试现已基本放弃。&lt;/p&gt;
&lt;p&gt;除了一些非常有限的领域外，可视化编程未能成功。这基本上归因于以下对编程的误解：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;基于文本的编程语言使得本质上简单的过程变得混乱。&lt;/li&gt;
&lt;li&gt;抽象和解耦在编程中处于边缘位置，作用不大。&lt;/li&gt;
&lt;li&gt;为支持编程而开发的工具并不重要。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;第一个误解认为软件开发存在很大的门槛，因为文本编程语言模糊了编程的本质。Scratch在教育学家中的流行属于这种误解。该观点认为编程实际上非常简单，如果我们以清晰的图形呈现它，将大大降低创建和阅读软件的难度，学习曲线将平缓。这种误解源自未能理解文本代码写就的典型程序，转而想将它转换为框和箭头等图形元素。如果你这样做，很快就会发现一行代码经常映射到几个图形块上，一个简单的程序包含数百行代码是很典型的。&lt;!--一定不写Python --&gt;这将转化为成百上千个图形元素。在头脑中理解如此复杂的图形往往比阅读等效的文本要困难得多。&lt;/p&gt;
&lt;!--作者没有用过图形编程--&gt;

&lt;p&gt;大多数可视化编程语言应对上述问题的策略是使用“块”来代表更复杂的操作，以便每个可视化元素等同于大块的文本代码。可视化工作流工具是罪魁祸首。问题是需要在某处定义此代码。它变成了“属性对话编程”。视觉元素仅代表最高级别的程序流程，大多数工作都是隐藏在框中的标准文本代码中完成的。这种做法，两边不讨好。一边是，文本编程没有现代工具的支持。另一边是视觉元素只能由有经验的程序员创建&lt;!--消息系统是大家都能理解的，dynamicland，编程只能由专业程序员来做，只能用，如果它早出生20年，它会说只能在，dyncmicland向我们演示了--&gt;，只能通过阅读它们的文本代码来理解。因此视觉元素的大多数假定的优点都会丢失。&lt;!--抽象都需要细节名，如果你把积木是为一个抽象来看待。如果是对labview的批评，我不知道，但对积木的批评完全没有道理--&gt;在视觉“代码”和文本代码之间存在着阻抗不匹配&lt;!--这完全没有道理，python和C代码也不匹配，google/blockly--&gt;，编程者必须在两者之间切换，时间都浪费在理解图形化工具上，而不是解决手头的问题。&lt;!--一种别蹩脚的包装--&gt;&lt;/p&gt;
&lt;p&gt;这让我们产生了第二个误解，即抽象和解耦是外围问题。可视化编程假设大多数程序都是简单的程序序列，有点像流程图。实际上，这是大多数新手程序员想象软件的工作原理&lt;!--倚老卖老，我资深，智慧并不会随着年纪自动增长，那些聪明人，年轻的时就已经很聪明，那些保守的家伙，老去之后，只是更加保守而已--&gt;。然而，一旦程序变得比一个简单的例子更大，复杂性很快就会压倒新手程序员。&lt;!--去看看scratch社区人们做出的东西--&gt;他们发现很难推断大规模的程序代码，并且经常难以大规模生产稳定有效的软件。编程语言中的大多数创新都是尝试管理复杂性，最常见的是通过抽象，封装和解耦。面向对象和函数式编程实际上只是努力控制这种复杂性。&lt;!--编程的本质是控制复杂度--&gt;大多数专业程序员将不断抽象和解耦代码。实际上，好的和坏的代码之间的区别本质上便是这样。可视化编程工具缺少有效的机制来实现这些，它们让开发者置身于1970年代的BASIC中。&lt;/p&gt;
&lt;!--图形化编程那么多，你在吐槽什么--&gt;

&lt;p&gt;最后的误解是可视化编程者可以在没有现代编程工具的支持下编程&lt;!--作者写C#居多，如果知道我们这些写C/Python/Golang的人，还在使用vim，他得多同情我们的遭遇--&gt;。考虑代码编辑器和IDE的长期演变。例如，Visual Studio支持高效的智能感知，可以单独查找基类库中可用的数千个API。缺乏良好的源代码控制是大多数可视化编程工具的另一个主要缺点。即使他们将布局保存为文本格式，比较代码差异(diff)几乎没有意义。对大量的XML或JSON进行“git blame”非常困难。有些事情对程序的功能执行没有任何影响，例如图形元素的位置和大小，仍然会导致元数据的变化，这使得观察差异(diff)变得更加困难。文本编程语言已经学会将代码单元分成单独的源文件，因此系统的一部分的更改很容易与另一部分的更改合并(merge)。可视化编程工具通常坚持每个图(diagram)单独存储，这意味着合并变得困难。当难以解析差异的语义时，这将更加困难。&lt;/p&gt;
&lt;p&gt;总之，可视化编程工具提供的优势：使程序更容易创建和理解，几乎总是海市蜃楼。它们只能在最简单的情况下成功。&lt;/p&gt;
&lt;h3 id="_2"&gt;作者更新&lt;/h3&gt;
&lt;p&gt;我可能错误地使用了Scratch的截图，并将其用作我的第一段中的主要示例。我不是一名教育工作者，我对Scratch作为一种教学工具的有效性并没有真正的看法。许多人提到它在教学编程方面非常有用，特别是对儿童而言。任何将人们引向精彩纷呈的编程世界的东西都是值得欢迎的。我真的不打算将此帖作为对Scratch的批评，我主要批评人们听过的那些流行的可视化编程系统。&lt;/p&gt;
&lt;p&gt;Reddit上的小伙伴们提到的另一个反例是静态结构工具，例如UI设计工具，数据库模式设计工具或类设计工具。我同意他们非常有用。任何有助于可视化数据结构或程序的大规模结构的东西都是好东西。但这些不足以支撑他们的论点的。PowerBuilder等90个试图构建在可视化之上，用以创建一个完全无代码的开发环境，都失败了，就证明了这点。&lt;/p&gt;
&lt;h1 id="_3"&gt;反驳&lt;/h1&gt;
&lt;p&gt;&lt;a href="https://github.com/mikehadlow"&gt;mikehadlow&lt;/a&gt;关于Scratch的观点，遭到reddit上很多用户的反驳，于是他在文章结尾处加了一段更新说:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我可能错误地使用了Scratch的截图，并将其用作我的第一段中的主要示例。我不是一名教育工作者，我对Scratch作为一种教学工具的有效性并没有真正的看法。许多人提到它在教学编程方面非常有用，特别是对儿童而言。任何将人们引向精彩纷呈的编程世界的东西都是值得欢迎的。我真的不打算将此帖作为对Scratch的批评，我主要批评人们听过的那些流行可视化编程系统。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href="https://github.com/mikehadlow"&gt;mikehadlow&lt;/a&gt;在文章中盛气凌人，一副"我是资深程序员，你们这些渣渣新手"的姿态。关于Scratch的部分，在reddit上被一通反驳之后，态度突然变得这么低，让人反倒没什么反驳的热情了。&lt;/p&gt;
&lt;p&gt;我们来看看reddit上的一些讨论。&lt;/p&gt;
&lt;p&gt;@victotronics评论说:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我赞同这个家伙的几点论述。传统编程无法从图形环境中受益。&lt;br /&gt;
但是，对于初学者来说，积木块是不可能出现语法错误的语句。这很有价值！你希望初学者考虑算法的结构，而不是分号的位置。我现在正在教授一所大学开始编程课程一个月。我仍然看到学生们得到一个编译器消息说它预期出现一个分号，他们很难确定在哪里或为什么需要这个分号。为什么编译器指向“for“并且说它需要分号？嗯，这是因为前一行。非常违反直觉。”&lt;br /&gt;
请主意文章中关于Scratch的截图。编程者正在为精灵编写事件处理程序。事件循环是环境的一部分，而这不需要明确编程！你可以让一个10岁的孩子写一堆精灵，每个精灵都有一个行为，如果你点击某些东西，就会发生一些事情。你能想象用常规语言进行的工作吗？&lt;br /&gt;
但我完全承认他关于抽象的观点。图形环境可能对此的支持多是蹩脚的，而抽象是优秀软件的本质。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;@AlSweigart评论说：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Scratch专为8至16岁儿童设计,这是完美的; 它是图形化的，具有简短的反馈循环，并使简单的事情变得简单。&lt;br /&gt;
我知道很多程序员都希望教他们的孩子编码，并忘记了它是多么令人生畏和沮丧。Scratch的辉煌之处在于它做到了平易近人的同时，仍然是实际的编程（而不只是配置一下游戏）。但是，期待“可视化编程”将使编码变得更容易却不现实。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;@yummybear评论说：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;今天向我11岁的女儿介绍了Scratch，她喜欢它。仅仅几分钟后，她就让人物移动和跳舞，并对进展感到开心。Scratch中的积木块也被翻译成我们的母语，她可以阅读它们的行为。&lt;br /&gt;
我不确定文本语言是否会给出同样直接的反馈激励。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="_4"&gt;当我们谈论图形化编程的时候，我们在谈论什么&lt;/h3&gt;
&lt;p&gt;当我们谈论图形化编程的时候，我们在谈论什么呢？&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/mikehadlow"&gt;mikehadlow&lt;/a&gt;以为他在谈所有的"图形化编程"，他假设所有的这些编程工具都吹嘘一样的优点，有一样的缺陷，所以&lt;a href="https://github.com/mikehadlow"&gt;mikehadlow&lt;/a&gt;准备写一篇文章，一次驳倒它们，把“可视化编程”通通归为糟糕的主意,他不具体谈哪个软件，不举例说明，唯一在开头举了Scratch的例子，结果又成为众矢之的，只好改称:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我不是一名教育工作者，我对Scratch作为一种教学工具的有效性并没有真正的看法。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;而reddit上的用户则代入各自的经历，以为&lt;a href="https://github.com/mikehadlow"&gt;mikehadlow&lt;/a&gt;在谈他们各自熟悉的图形化编程工具，有人在吐槽Labview，有人在拥护虚幻引擎中的图形工具，有人在赞扬Scratch...于是我们一时不知道大家在争执什么。这场面简直像哲学家们对意义、真理、道德的争论，大家自说自话，全然忘了问题是什么。&lt;/p&gt;
&lt;p&gt;那么问题是什么？我们究竟能否用"图形化编程"来描述所有与图形有关的编程，它们是否可以混为一谈？是否都拥有一样的缺陷？是否需要再做细分，分门别类来谈论？是否更多的例证，而不是泛泛而论？&lt;/p&gt;
&lt;p&gt;@teerre对此说得比较尖刻:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;阅读他的文字我不禁认为他实际上从未使用过任何可视化编程，而只是在谈论他在自己的脑海中所构成的猜想。缺乏实际的例子。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="scratch"&gt;Scratch的缺陷&lt;/h3&gt;
&lt;p&gt;总的来说我是喜欢&lt;a href="https://github.com/mikehadlow"&gt;mikehadlow&lt;/a&gt;这篇文章的，正是因为喜欢，我才决定好好反驳它。尽管他的讨论，显得有点粗糙，&lt;a href="https://github.com/mikehadlow"&gt;mikehadlow&lt;/a&gt;本人对Scratch也缺乏必要的了解，但他提到的“图形化编程共有的问题“，其中至少有一点，Scratch确实存在:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;缺乏良好的源代码控制... 对大量的XML或JSON进行“git blame”非常困难。对程序的功能执行没有任何影响的事情，例如图形元素的位置和大小，仍然会导致元数据的变化，这使得观察差异(diff)变得更加困难。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;@balefrost在帖子下的评论，比mikehadlow的原文更为精彩，也更为深刻。balefrost评论道:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我认为使用Scratch教学基本编程没有任何问题。在我看来，图形化编程大的缺点在以下方面:&lt;br /&gt;
使用空间经常不足。我见过的大多数图形化编程环境都有节点与线的连接。因此需要将节点间隔得足够远，以使连线有足够空间，并限制你将获得的线路交叉数量; 即便如此，无论给它们多少空间，总会有一些交叉线。你可能必须手动布线，以获得好看的图表。最终会投入大量时间和精力来制定“漂亮”（即“可读”）的图式。只要更改图式，所有仔细的布局工作都可能毫无价值.尽管Scratch不需要连线，但使用空间经常不足却也经常不足。而且积木组合如何分布好看也确实影响阅读。&lt;br /&gt;
文本编程语言还省略了图形化编程环境中存在的视觉装饰，因为我们不需要它们。VP(visual programming)中的框必须足够大，以便用户可以合理地使用鼠标来操纵它们，这是我们可以在文本语言中不必考虑的因素。&lt;br /&gt;
围绕纯文本文件构建了很多工具。我可以在任何我想要的编辑器中编辑纯文本文件。简化和合并纯文本编程文件通常是众所周知的活动，并且像Git这样的源代码控制工具针对纯文本文件进行了优化。即使VP环境将其代码保存在纯文本文件中，因为可视化编程文件需要编码算法信息以及空间信息，VP语言文件的差异通常比文本编程文件更嘈杂。&lt;br /&gt;
为文本编程编写代码生成器很容易，因为不需要太担心空间安排（只关心缩进）。用于可视化编程的代码生成器将需要担心放置节点的位置，这是一个非常重要的细节。&lt;br /&gt;
还有许多其他工具针对处理纯文本文件进行了优化。有一个丰富的文本编辑器生态系统，其中许多都对文本编程有很好的支持。可视化编程的编辑可能是一次性的。  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;@balefrost的这些论点都非常精彩，Scratch确实有这些问题。但我认为这些并不影响Scratch达成它的使命。而且像编辑器生态总是会随着时间和社区的壮大，持续改进。比如blockly就发展出了编译为6种文本语言的能力，并且可以还加入类型判断，用以决定可组合性，两块积木是否可吸合，这即便在文本编程工具里，也是很酷的功能，相当于静态分析了。而makecode则发展出了代码与图形积木的双向转换。这些都是非常先进的。而且在持续改进中。我们有理由保持乐观。&lt;/p&gt;
&lt;p&gt;@balefrost继续说道:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我认为可视化编程将在非传统环境中取得最大成功。对于有大量条件逻辑的常规算法工作，我不知道可视化编程是否合适。我认为它在高级别工作中效果更好 - 将算法复杂性隐藏在预先封装的块中。我认为可视化编程适用于我们之前使用过脚本语言的一些任务。在我看来，Automator是一种向不熟悉Bash的用户提供UNIX管道功能的方法。&lt;br /&gt;
根据我的经验，一旦达到一定程度的复杂性，VP似乎真的会崩溃。我不能确定这是因为工具不足，个人经验不足，还是因为它是范式的根本限制。我的直觉告诉我，问题是根本的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id="_5"&gt;我的反驳&lt;/h1&gt;
&lt;p&gt;下边单说我的反驳。&lt;/p&gt;
&lt;p&gt;由于我的兴趣主要关注图形化编程在教育这块的应用，所以我的焦点集中在以下系统:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/LLK/scratch-gui"&gt;Scratch&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/google/blockly"&gt;blockly&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://snap.berkeley.edu/"&gt;Snap!&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://gpblocks.org/"&gt;GP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://labo.nintendo.com/invent/"&gt;Toy-Con Garage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://en.wikipedia.org/wiki/Etoys_(programming_language)"&gt;Etoys&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/zh-hans/Squeak"&gt;Squeak&lt;/a&gt;(smalltalk)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我将结合这几种图形化编程工具，来反驳&lt;a href="https://github.com/mikehadlow"&gt;mikehadlow&lt;/a&gt;的观点。&lt;/p&gt;
&lt;h3 id="_6"&gt;降低入门门槛&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://github.com/mikehadlow"&gt;mikehadlow&lt;/a&gt;说&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;该观点认为编程实际上非常简单，如果我们以清晰的图形呈现它，将大大降低创建和阅读软件的难度，学习曲线将平缓。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我认为&lt;a href="https://github.com/mikehadlow"&gt;mikehadlow&lt;/a&gt;对Scratch存在很大误解，我甚至怀疑&lt;a href="https://github.com/mikehadlow"&gt;mikehadlow&lt;/a&gt;并没使用过Scratch。在Scratch社区，我们认为Scratch帮助降低编程入门门槛，我们并不认为编程实际上非常简单，我们认为入门编程应该尽可能简单，不应该让入门者太沮丧。使用Scratch构建大型程序确实会变得非常复杂，其中一些原因@balefrost在前头说得非常好，为了克服这种复杂度，Scratch的分支项目&lt;a href="https://snap.berkeley.edu/"&gt;Snap!&lt;/a&gt;做了很多探索。&lt;/p&gt;
&lt;h3 id="_7"&gt;图形积木与文本代码的视野切换&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://github.com/mikehadlow"&gt;mikehadlow&lt;/a&gt;在文章里说:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;视觉元素仅代表最高级别的程序流程，大多数工作都是隐藏在框中的标准文本代码中完成的。&lt;/p&gt;
&lt;p&gt;视觉元素只能由有经验的程序员创建,只能通过阅读它们的文本代码来理解。在视觉“代码”和文本代码之间存在着阻抗不匹配，编程者必须在两者之间切换，时间都浪费在理解图形化工具上，而不是解决手头的问题。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我不认为在Scratch3.0中, 这种切换是必要的，如果我们把编程积木视为一种好的抽象（我们应该这样做），那么我们是可以设计出原子积木的，它们彼此正交。编程者并不需要理解抽象背后的细节，这正是抽象的目标之一。正像他们在面向对象系统中，可以轻易使用别人定义的类。&lt;/p&gt;
&lt;p&gt;我认为这是设计Scratch3.0这类积木化编程系统的核心工作。它并不容易，让一个积木可以运行是简单的，要设计出抽象得合理又正交的积木，极为困难，你可能需要一些研究PL的人以及交互设计的人，而且他们最好是一个人。&lt;/p&gt;
&lt;p&gt;但你知道，大多数项目并没有精心设计，只是勉强能用，于是造成了使用者的灾难。&lt;/p&gt;
&lt;p&gt;我们在&lt;a href="https://blog.just4fun.site/about-codelab-club.html"&gt;codelab.club&lt;/a&gt;中做了很多有趣的探索，我们希望设计出尽可能正交的积木。此外我们允许大家在熟悉系统后，可以轻松去&lt;a href="https://codelab-adapter-docs.codelab.club/dev_guide/helloworld/"&gt;扩展这个系统&lt;/a&gt;，我们准备了通用的积木(EIM)。这里的核心概念是&lt;code&gt;Everything is message&lt;/code&gt;，在这一点上，基于这个概念，能很轻松解耦。同时免费获得可组合性。我们是艾伦凯的忠实追随者。在这个领域，他一骑绝尘。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;视觉元素仅代表最高级别的程序流程，大多数工作都是隐藏在框中的标准文本代码中完成的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我不认为这是个缺陷，而认为这是个很好的特性，我在&lt;a href="https://blog.just4fun.site/Hardware-Programming-style.html"&gt;两种硬件编程风格的比较&lt;/a&gt;有做论述。&lt;/p&gt;
&lt;h3 id="_8"&gt;复杂度&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;然而，一旦程序变得比一个简单的例子更大，复杂性很快就会压倒新手程序员...编程语言中的大多数创新都是尝试管理复杂性，最常见的是通过抽象，封装和解耦。面向对象和函数式编程的所有类型系统实际上只是努力控制这种复杂性。大多数专业程序员将不断抽象和解耦代码。实际上，好的和坏的代码之间的区别本质上便是这样的。可视化编程工具缺少有效的机制来实现这些，它们让开发者置身于1970年代的BASIC中。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这是全文中我最为赞同的一段，如《SICP》在序言里说的，编程的本质是克服复杂度。但我认为Scratch/blockly这类积木化语言是有支持抽象的机制的。&lt;/p&gt;
&lt;p&gt;先说Blockly。&lt;/p&gt;
&lt;p&gt;@SanityInAnarchy在帖子下说:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我无法真正看到关于抽象的观点。函数只是一个容纳代码的块，包括一个“参数”块。一旦定义了，你就会得到一个调用你的函数的“调用”块，并且可以将值作为参数放到该函数中。这是抽象的大部分内容，而code.org上的东西似乎很好地涵盖了它。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;code.org使用blockly，blockly确实已经很好地实现了函数的机制。这个机制并不比大多数语言的函数功能更弱。而函数是实现抽象的绝佳工具。&lt;/p&gt;
&lt;p&gt;至于Scratch则在解耦这块做得很好。&lt;code&gt;消息&lt;/code&gt;机制是Scratch的核心机制。消息是绝佳的解耦工具，如果你逛一逛Scratch社区，就可以看到人们构建了许多令人惊叹的项目。它们中的许多并不简单，&lt;code&gt;消息&lt;/code&gt;是帮助他们克服复杂度的核心工具之一。这个特性继承自smalltalk的设计原则:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;计算应该被视为可通过发送消息来统一调用的对象的内在功能。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在&lt;a href="https://blog.just4fun.site/about-codelab-club.html"&gt;codelab.club&lt;/a&gt;中，我们把这个概念进一步发挥，使用消息将积木块接入现实生活，我们做了许多有趣的&lt;a href="https://codelab-adapter-docs.codelab.club"&gt;探索&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;如果你对图形化编程充满热情，来&lt;a href="https://blog.just4fun.site/about-codelab-club.html"&gt;codelab.club&lt;/a&gt;中与我们一起探索吧。&lt;/p&gt;
&lt;h1 id="_9"&gt;未来&lt;/h1&gt;
&lt;p&gt;我赞同@balefrost在前头提到的:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我认为可视化编程将在非传统环境中取得最大成功。对于有大量条件逻辑的常规算法工作，我不知道可视化编程是否合适。我认为它在高级别工作中效果更好 - 将算法复杂性隐藏在预先封装的块中。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我们相信可视化编程将在非传统环境中取得成功。我们在&lt;a href="https://blog.just4fun.site/about-codelab-club.html"&gt;codelab.club&lt;/a&gt;做了许多探索，我们希望将可视化编程（我们更喜欢称它们为积木化编程）带入物联网与人工智能，我们已经做出了很多&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/gallery/"&gt;有趣的东西&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;我们将继续探索这个领域，并且利用这种技术，让编程变得更加温和有趣，为每个人所用，去解决他们生活中的问题。&lt;/p&gt;
&lt;p&gt;科技，以人为本。&lt;/p&gt;
&lt;p&gt;除了&lt;a href="https://blog.just4fun.site/about-codelab-club.html"&gt;codelab.club&lt;/a&gt;，这个领域还有很多有趣的探索者。艾伦·凯正在领导一个革命性的项目&lt;a href="https://dynamicland.org/"&gt;dynamicland&lt;/a&gt;，如果进展顺利，dynamicland将重塑人们对计算的理解。艾伦·凯在施乐实验室的工作，塑造了今天计算机的形态，我们认为他在dynamicland的工作将塑造未来。&lt;a href="https://blog.just4fun.site/about-codelab-club.html"&gt;codelab.club&lt;/a&gt;计划明年三月份去dynamicland实验室参观。我们喜欢dynamicland的理想:将数字力量赋予给所有人，而不是收聚在技术精英手中。&lt;/p&gt;
&lt;p&gt;dynamicland远不是一般的图形化编程，它把现实世界的真实物体视为编程元素，"现实便是计算引擎"，这是极为激进而令人热血沸腾的想法。如果你对此感兴趣，可以参考我此前的文章:&lt;a href="https://blog.just4fun.site/the-next-big-thing-is-a-room.html"&gt;"下一件大事"是一个房间&lt;/a&gt;。&lt;/p&gt;
&lt;h1 id="_10"&gt;收尾&lt;/h1&gt;
&lt;p&gt;最后我想用reddit两个用户的评论来结束本文.&lt;/p&gt;
&lt;p&gt;@zushiba评论道:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;虽然我同意文章的很多观点，但我想指出，当低级编程语言统治世界时，高级编程语言也遭遇类似的说法。&lt;br /&gt;
他们说:"这样做会混淆代码实际上在做什么，或者产生一代不知道编译器如何工作的程序员。" &lt;br /&gt;
我并不是说可视化编程会接管世界，但这些都是可以解决的问题。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;@not_perfect_yet评论道:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我不喜欢看到人们诋毁一个没有真正探索过的想法。如果我们现在扔掉火并回到树上，我们将永远不会使用内燃机。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--
消息 # 只是解耦的方式

snap

GP

cyancynic
艾伦凯几十年来一直在抱怨这件事。Scratch和eToys是图形仿真环境，具有基于磁贴的编程环境。你制造东西，制定一些关于他们行为方式的规则，并点击“玩”并观察发生了什么。

基于文本的环境中的模拟是不必要的，并且远远超出了初级程序员的技能水平。

另一个例子是DrGeo一个交互式几何模拟环境。值得注意的是，Scratch和DrGeo都是在开源的Smalltalk环境中编写的（Scratch是Squeak，DrGeo是Pharo - Squeak的一个分支）。DrGeo允许直接操作几何结构，但也允许使用Smalltalk代码编写脚本。

在我看来，这是两个世界中最好的。Hypercard是另一种环境，允许您以图形方式组装内容，但脚本交互。我有点难过今天生产的这类工具并不多，而且我们只是深入到文本中。

mollymoo
简单是好的，但它不是可视化编程的同义词。根据我的经验，拖动块会非常非常快速地达到复杂性限制。这个初始阶段的简单性是否值得我不知道 - 自从我学到这些东西以来，已经很长很长时间了。

nikofeyn
    几乎每个拥有这种观点的人都从未真正认真地使用图形语言，所以我永远不能认真对待这些论点。这是一群人在谈论他们不知道的事情。




我认为Nand2Tetris课程和Hack语言将是教授编程的好方法。


Plazmatic
可视化编程语言由于依赖于菜单，我的必要性最终导致开发速度显着降低。你不能真正自动完成，你不能真正做源代码控制，你不能真正做智能感知，你不能保持多层次的抽象，你不能处理大量的复杂性以外的语言本身处理。它只是不起作用。

我使用过Scratch，Simulink，Blueprints和Labview。所有的开发都很慢，成为一个记住菜单而不是学习如何编程的游戏。



Earhacker
我是个音乐家。有趣的是，音乐/音频领域一直有很多可视化编程环境。我认为其中最着名的是Pure Data，Max和Reaktor。我认为期望是音乐家“得到”通过电线连接的设备的类比（如吉他FX踏板，模块化合成器，工作室设备......），视觉编程范例在音乐中比在任何其他设备中更受欢迎我知道除了教育之外。
我想我的观点是，音乐家在进入视觉编程方面看起来比大多数人都要好，而视觉编程通常是创作音乐的有用且强大的范例。


http://www.stencyl.com/ 制作游戏



zushiba
虽然我同意文章的很多观点，但我想指出，当低级语言统治世界时，高级编程语言也有类似的说法。

这样做会混淆代码实际上在做什么，或者产生一代不知道编译器如何工作的程序员。

我并不是说视觉编程会以任何方式接管世界，但这些都是可以解决的问题。

not_perfect_yet
我不喜欢看到人们诋毁一个没有真正探索过的想法。如果我们现在扔掉火并回到树上，我们将永远不会使用内燃机。
--&gt;

&lt;h1 id="_11"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://mikehadlow.blogspot.com/2018/10/visual-programming-why-its-bad-idea.html"&gt;Visual Programming - Why it’s a Bad Idea&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.reddit.com/r/programming/comments/9kgk75/visual_programming_why_its_a_bad_idea/"&gt;reddit Visual Programming - Why it’s a Bad Idea&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://en.wikipedia.org/wiki/Visual_programming_language"&gt;Visual programming language&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.reddit.com/r/AskProgramming/comments/8teoci/the_future_of_visual_programming_langauges/"&gt;可视化编程Langauges的未来&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://en.wikipedia.org/wiki/Fourth-generation_programming_language#What's_previous"&gt;第四代编程语言&lt;/a&gt; &lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/zh-hans/Squeak"&gt;Squeak&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://en.wikipedia.org/wiki/Etoys_(programming_language)"&gt;Etoys&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://snap.berkeley.edu/"&gt;Snap!&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://labo.nintendo.com/invent/"&gt;Toy-Con Garage&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Wed, 21 Nov 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-11-21:visual-programming-why-its-bad-idea.html</guid><category>codelab</category></item><item><title>codelab.club周末聚会</title><link>/codelab-club-weekend-party.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/codelab_party_e89853f6.png" /&gt;&lt;/p&gt;
&lt;p&gt;你想创造自己的火星车吗? 抑或是体感游戏、手风琴、智慧房屋? 如果是的话，来参加与你志趣相投之人的聚会吧！&lt;/p&gt;
&lt;p&gt;我们以这个开头向&lt;code&gt;家酿计算机俱乐部&lt;/code&gt;(Homebrew Computer Club)致敬,他们第一次聚会的传单上印着:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;你想搭建自己的计算机吗？抑或是终端机，电视机，打印机？如果是的话，来参加与你志趣相投的人们的聚会吧！&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--
# [codelab.club](https://blog.just4fun.site/about-codelab-club.html)周末聚会

公众号 markdown: http://blog.didispace.com/tools/online-markdown/
--&gt;

&lt;!--
感谢大家对[codelab.club](https://blog.just4fun.site/about-codelab-club.html)的关注。我们将在本周末举行一次小型聚会，[永无乡(neverland)](https://blog.just4fun.site/about-codelab-club.html#neverland)
如果你的，兴趣在交互设计、剧本创作、人工智能、物联网、编程教育。
--&gt;

&lt;p&gt;如果你对以下任何话题感兴趣，可能将在聚会上获得惊喜。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;交互设计&lt;/li&gt;
&lt;li&gt;编程教育&lt;/li&gt;
&lt;li&gt;积木化编程&lt;/li&gt;
&lt;li&gt;人工智能&lt;/li&gt;
&lt;li&gt;物联网&lt;/li&gt;
&lt;li&gt;体感游戏&lt;/li&gt;
&lt;li&gt;故事创作&lt;/li&gt;
&lt;li&gt;未来生活&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;预测未来的最好方式就是去创造它。  --艾伦·凯&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我们期待与你一同去创造未来:)&lt;/p&gt;
&lt;h1 id="_1"&gt;活动详情&lt;/h1&gt;
&lt;h3 id="_2"&gt;活动相关主题&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;人工智能、物联网与积木化编程: 成果展示与未来计划&lt;/li&gt;
&lt;li&gt;codelab.club: 非营利组织的近况与招募计划&lt;/li&gt;
&lt;li&gt;最富创造性的项目介绍: Dynamicland与Switch Labo(Toy-Con Garage)&lt;/li&gt;
&lt;li&gt;近期我们在&lt;code&gt;万物积木化&lt;/code&gt;这块的进展: PoseNet、空间编程与Switch Joy-Con&lt;/li&gt;
&lt;li&gt;下个里程碑: Vector 与 永无乡(neverland)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="_3"&gt;活动口号&lt;/h3&gt;
&lt;p&gt;我们计划为每次活动选择一个口号，此次的活动口号是:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Live in the future and build what seems interesting.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="_4"&gt;活动时间&lt;/h3&gt;
&lt;p&gt;2018.11.24(周六)  14:00-16:00&lt;/p&gt;
&lt;h3 id="_5"&gt;活动地点&lt;/h3&gt;
&lt;p&gt;广州市 天河区 中信广场。&lt;/p&gt;
&lt;p&gt;详细地址将在报名成功后以短信通知。&lt;/p&gt;
&lt;h3 id="_6"&gt;注意事项&lt;/h3&gt;
&lt;p&gt;codelab.club的活动空间要求干净整洁，不能携带食物。&lt;/p&gt;
&lt;h3 id="_7"&gt;活动报名入口&lt;/h3&gt;
&lt;p&gt;扫描二维码或长按屏幕。&lt;/p&gt;
&lt;p&gt;&lt;img  width=200 src="http://wwj-fig-bed.just4fun.site/codelab_party_qrcode_74b6f7f9.png" /&gt;&lt;/p&gt;
&lt;h1 id="_8"&gt;相关资料&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://mp.weixin.qq.com/s?__biz=MzU4NzY2OTk4NA==&amp;amp;mid=2247483671&amp;amp;idx=1&amp;amp;sn=1cee1bffa7812c6bcd4851a756233fa1&amp;amp;chksm=fde9c998ca9e408eee669eb5dabb40eeb9c4bc2796c1a8cb88e27717eda088751225dc28749a&amp;amp;token=2093264662&amp;amp;lang=zh_CN#rd"&gt;关于codelab.club&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/gallery/"&gt;演示案例&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!--
如果你关心 交互设计、

如果你愿意一起来折腾这些有趣的事

这句话说起来可能有点。

我们的目标是星辰大海：）
--&gt;

&lt;!--
### 目的
让关注codelab的人知道进展

分享我们正在做的事  吸引优秀的人加入。

展示我们正在做的一些很酷的事。它们的进展、规划。

人工智能、物联网与积木化

绝佳的地方来实践这些。

### 关于codelab.club


一些案例，参考展示。

二维码，扫码报名，活动行 还是？

人数限制
--&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Sun, 18 Nov 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-11-18:codelab-club-weekend-party.html</guid><category>codelab</category></item><item><title>关于codelab.club</title><link>/about-codelab-club.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/creative_6bc22f2f.png" /&gt;&lt;/p&gt;
&lt;h1 id="codelabclub"&gt;codelab.club&lt;/h1&gt;
&lt;p&gt;&lt;a href="https://www.codelab.club/"&gt;codelab.club&lt;/a&gt;是一个非营利组织。&lt;/p&gt;
&lt;p&gt;我们致力于传递编程的乐趣，帮助人们成为数字时代的创作者。&lt;!--从教育入手--&gt;&lt;/p&gt;
&lt;p&gt;codelab.club是一个编程俱乐部，编程是用以创造的工具，我们会帮助你熟悉这个工具，但我们更大的兴趣在于，鼓励你去探索和尝试。我们希望与你一起制作有趣的项目，寻找热情所在，寻找志同道合的同伴，一起去玩耍与创造。&lt;/p&gt;
&lt;p&gt;codelab.club是一个非营利组织而不是一家公司。codelab.club是免费的，但免费并不是我们的核心诉求，正如免费不是开源运动的核心诉求（自由才是）。开放、中立、分享、协作，这些是我们的核心诉求，我们希望更多的志愿者、学习者、创造者能加入其中。&lt;/p&gt;
&lt;p&gt;我们希望让创造成为一种运动、一种生活方式，我们喜欢约翰·杜威提倡的:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;education as life.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;教育是我们极为关心的一块，我们希望将创造与教育融合。编程作为载体，来实现我们的目标。&lt;/p&gt;
&lt;p&gt;编程这个词听起来有点唬人，有点冰冷，有点不近人情。这个词勾起的想象，多半是一个木讷的人，黑着眼圈驮着背，盯着黑乎乎的屏幕，屏幕上满是数字、符号和字母。但编程也可以平易近人又充满乐趣，可以是大家聚会时&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/gallery/"&gt;击掌奏乐&lt;/a&gt;，可以是冬夜里&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/gallery/"&gt;卧床关灯&lt;/a&gt;,可以让你儿时的&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/gallery/"&gt;玩具四驱车变得和动画片里一样智能&lt;/a&gt;;可以让你搭建一个智慧家庭，在你年迈的老奶奶夜里起床时，自动开灯。&lt;/p&gt;
&lt;p&gt;《理想国》里说:"言语是一种比蜡还容易随意捏造的材料", 它如此灵活，能够用来与朋友逗乐，用来表达你的思想，用来创造诗歌与小说；编程就像言语，它同样可以用来表达你的想法，用来与朋友逗乐，以及，用来创造。它让你与世间的万物沟通，你可以用它创造一个飞行器，制作一个&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/gallery/"&gt;体感游戏&lt;/a&gt;,或是让自己的房间变得智能。你可以在朋友生日那天，在Ta进门的一刻，将手中的魔杖一挥，在空中划一个字母L的轨迹，瞬间，点亮房间里五彩的灯光。在codelab.club，你将轻松做出这样的魔杖。如果你愿意，你可以将codelab.club看作霍格沃茨(Hogwarts)。&lt;/p&gt;
&lt;p&gt;事实上，新的技术往往都接近&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/gallery/"&gt;魔法&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;弗兰西斯·培根在17世纪说: "知识就是力量"(Knowledge is power)。今天，应该没什么人会反对这句话了。但问题是我们如何有效获得这种力量呢?教科书式的知识罗列多半是枯燥无味的，我们努力去记忆，却收效甚微，当然，通过努力记忆和练习往往可以考得不错成绩，但你希望得到的是知识，而不是考试成绩，这两者的不同，杜威论述了很多。知识、逻辑和理性都不具有主动性。不排除一些人天生对微积分、形式系统和康德感兴趣，但更多的人，热情可能来自于帮助家人与朋友、恶作剧以及制作有趣的东西。codelab.club希望做的，便是与你一起去寻找热情所在，一旦找到那些让你热血沸腾之事，你便会开始对知识感兴趣，因为知识能帮你更好地实现目标，接下来你将愉快且高效地掌握所需的知识。在这点上，我们喜欢&lt;a href="https://zh.wikipedia.org/zh/%E7%BA%A6%E7%BF%B0%C2%B7%E6%9D%9C%E5%A8%81"&gt;约翰·杜威(John Dewey)&lt;/a&gt; 、&lt;a href="https://zh.wikipedia.org/zh-hans/%E4%BC%AF%E7%89%B9%E5%85%B0%C2%B7%E7%BD%97%E7%B4%A0"&gt;罗素(Bertrand Russell)&lt;/a&gt;、&lt;a href="https://zh.wikipedia.org/zh-hans/%E8%AE%93%C2%B7%E7%9A%AE%E4%BA%9E%E5%82%91"&gt;皮亚杰(Jean Piaget)&lt;/a&gt;、&lt;a href="https://zh.wikipedia.org/zh-hans/%E8%89%BE%E4%BC%A6%C2%B7%E5%87%AF"&gt;艾伦·凯(Alan Curtis Kay)&lt;/a&gt;、&lt;a href="https://en.wikipedia.org/wiki/Seymour_Papert"&gt;派普特(Seymour Papert)&lt;/a&gt;和&lt;a href="https://en.wikipedia.org/wiki/Mitchel_Resnick"&gt;密契尔(Mitchel Resnick)&lt;/a&gt;的建议。&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;codelab.club的第一笔捐赠来自罗云先生,这笔捐赠让我们得以全力以赴做这件事情。codelab.club的想法令我们振奋，即便没有捐赠，我们也会持续推进它，但可能松散而缓慢。有了这笔捐赠，我们在广州有了办公室，我们可以调度更多的资源。罗云先生热心于教育事业,给予codelab.club很多方面的支持,目前他也是codelab.club的理事之一。&lt;/p&gt;
&lt;p&gt;在很多人看来，我们可能有些不切实际，说得好听一点，有些理想主义。我很开心周围能有这样一群"不切实际"的朋友，我们选择做那些我们认为是对的事，而不是那些操作容易见效快的事。感谢早期推动着codelab.club的所有人。我将这份名单列出，名字不分先后。哈哈，我们做到了真正意义上的&lt;code&gt;不分先后&lt;/code&gt;，用的便是&lt;code&gt;编程&lt;/code&gt;，我写了几行代码来随机排列人名，你每次刷新页面，排序都将不同 :)&lt;/p&gt;
&lt;!--

wzxhzdk:0

--&gt;

&lt;hr /&gt;
&lt;div id="random_names"&gt;&lt;/div&gt;

&lt;script&gt;
var random_names = document.querySelector('#random_names');
var pinyin_names = ['程晨', '陈爱华', '崔欣', '陈海权', '罗云', '刘鑫', '李懿', '钱振方', '瞿旻', '沈煜', '孙彬彬', '吴文杰', '左翔','曾铮']
random_names.innerHTML = pinyin_names.sort(function() { return 0.5 - Math.random() });
&lt;/script&gt;

&lt;hr /&gt;
&lt;p&gt;希望这份名单不断加长，也希望参与其中的每个人，热爱贡献、分享与创造的过程。&lt;/p&gt;
&lt;!--
消磨周日午后光阴的，哲学、徒步与骑车.
 但我大部分的你们，不会成为职业程序员，毕竟世上有趣的事情那么多，选择。所以你不必去背什么算法、数据结构，不必去记那些恼人标点符号规则。就像，我们给你一些逻辑积木块，去堆叠你的想法与创意。5分钟，你就可以起步
 我们认为这是值得做的，所以我们开始
--&gt;

&lt;!-- 我们不能帮你在C语言考试里多考5分，我们可能对于你要获得奥林匹克，也不会有什么立竿见影的效果。 --&gt;

&lt;p&gt;虽然我们有些"不切实际"，但在具体执行上，却希望尽可能做得合理、高效，所以我们阅读&lt;a href="https://zh.wikipedia.org/zh/%E5%BD%BC%E5%BE%97%C2%B7%E5%BE%B7%E9%B2%81%E5%85%8B"&gt;彼得·德鲁克&lt;/a&gt;的《非营利组织的管理》、约翰·杜威的《学校与社会》、伯特兰·罗素的《论教育》、伊藤穰一的《爆裂》、米切尔•雷斯尼克的《终生幼儿园》、以及Y Combinator的《YC创业课》。我们去学习&lt;a href="https://code.org/learn"&gt;code.org&lt;/a&gt;、&lt;a href="https://www.codeclub.org.uk/"&gt;code club&lt;/a&gt;、&lt;a href="http://microbit.org"&gt;microbit&lt;/a&gt;、&lt;a href="https://raspberrypi.org"&gt;raspberrypi&lt;/a&gt;以及&lt;a href="https://scratch.mit.edu/"&gt;scratch&lt;/a&gt;等 优秀的非营利项目的策略。&lt;/p&gt;
&lt;p&gt;要做好这件事，仅靠这些还远不够，我们希望你能加入进来，一起去探索、分享和创造。&lt;/p&gt;
&lt;!--我们不赞同目前这个领域大家做的大部分事情。--&gt;

&lt;h1 id="_1"&gt;我们准备怎么做&lt;/h1&gt;
&lt;!--
codelab.club将探索多种club模式，构建编程教育的基础设施，科普。我们力图做到中立、客观，不蹭热点不站队:)--&gt;

&lt;p&gt;线下方面，codelab.club将在全国主要城市，利用周末时间，组织志愿者、借用场地，开展编程活动；&lt;br /&gt;
线上方面，codelab.club将构建先进的编程平台，在积木化编程里加入开源硬件、物联网和人工智能；&lt;br /&gt;
同时我们将构建活跃的用户社区，鼓励志愿者、学习者、创造者参与其中；&lt;br /&gt;
我们也乐于与其他公益组织展开合作，让编程与更广泛的社会活动结合。&lt;/p&gt;
&lt;p&gt;我们目前的办公室在广州，我们会先在广州探索各种club的模式，一旦运转流畅，我们就在全国各地去开展活动。&lt;/p&gt;
&lt;h1 id="_2"&gt;接下来我们准备做的一些事&lt;/h1&gt;
&lt;h3 id="_3"&gt;鲁滨逊计划&lt;/h3&gt;
&lt;!--
    *  培养志愿者
    *  漂流
    *  动手打造
    *  play
    *  wedo2，ev3，租赁式
    *  交互设计、空间编程、物联网、人工智能、情景剧。
--&gt;

&lt;p&gt;&lt;code&gt;鲁滨逊计划&lt;/code&gt;是一项漂流计划，codelab.club将拥有各类新奇有趣的东西，从人工智能机器人、体感设备到&lt;a href="https://openbci.com/"&gt;OpenBCI&lt;/a&gt;(脑电波传感器)，他们都是可编程的。我们定期在办公室组织活动，邀请该计划的参与者参观、谈论这些最新最有趣的东西。大家可以轮流将它们带回家保管，用它们学习编程与创造。之后我们鼓励你到codelab.club分享你的创造历程。&lt;/p&gt;
&lt;h3 id="homebrew-coding-club"&gt;Homebrew Coding Club&lt;/h3&gt;
&lt;!--
    *  爱好者小组
    *  会员通信，邮件组。微信群会冷掉。
    那天晚上是我一生中最重要的夜晚之一。
--&gt;

&lt;blockquote&gt;
&lt;p&gt;你想创造自己的火星车吗?抑或是体感游戏，机器人，智能房屋? 如果是的话，来参加与你志趣相投的人们的聚会吧！&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Homebrew Coding Club的想法来自&lt;a href="https://en.wikipedia.org/wiki/Homebrew_Computer_Club"&gt;家酿计算机俱乐部&lt;/a&gt;。家酿计算机俱乐部是硅谷的早期的计算机爱好者小组，他们定期聚会，彼此分享新的信息和技术。&lt;/p&gt;
&lt;p&gt;家酿计算机俱乐部的第一次聚会前, 发布的传单上写着:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;你想搭建自己的计算机吗？抑或是终端机，电视机，打印机？如果是的话，来参加与你志趣相投的人们的聚会吧！&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;乔布斯、沃兹尼亚克、比尔·盖茨都曾是其中的成员。沃兹尼亚克后来提到:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;那天晚上是我一生中最重要的夜晚之一。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Homebrew Coding Club的目的在于让爱好者们分享最新的资讯，了解当前全球最有意思的项目。并在其中找到自己的同伴。Homebrew Coding Club采用邀请制，你可以邀请你周围那些最富创造性的人加入，如果小组中，有过半成员认为Ta做过的项目足够有趣，则予以通过。&lt;/p&gt;
&lt;h3 id="neverland"&gt;永无乡(neverland)&lt;/h3&gt;
&lt;!--
    *  开放办公室
        *  kinect
        *  智能家居
--&gt;

&lt;p&gt;"永无乡"(neverland)是codelab.club活动空间的名字。作为codelab.club办公室的一部分。codelab.club的办公室是开放的, 你可以在任何时间来找我们玩，我们在其中办公，在其中编程，在其中玩乐，在其中做一些有趣的探索和创作。&lt;/p&gt;
&lt;p&gt;"永无乡"(neverland)名字来自《小飞侠彼得·潘》,是故事中的一座海岛。在永无乡里，人们永远长不大。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;后来，他领着我飞到了永无乡，那儿还有仙子，还有海盗，还有印第安人，还有人鱼的礁湖；还有地下的家，还有那间小屋子。 --《小飞侠彼得·潘》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我们将在永无乡里做很多有趣的事，我们准备在其中实现空间编程，亲手编程将它打造为一个智慧空间，我们准备在其中创作情景剧、体感游戏，以及构建令人热血沸腾的&lt;a href="https://blog.just4fun.site/the-next-big-thing-is-a-room.html"&gt;Dynamicland&lt;/a&gt;。所有这些你都可以参与进来，他们像搭积木一样地简单。在这个过程中，你将学习人工智能、物联网和虚拟现实。&lt;/p&gt;
&lt;h3 id="_4"&gt;漫游者计划&lt;/h3&gt;
&lt;p&gt;我在&lt;a href="https://blog.just4fun.site/Hungry-Robot-Eat-everything.html#_9"&gt;Hungry Robot - Eat everything&lt;/a&gt;中表述了漫游者计划。&lt;/p&gt;
&lt;p&gt;NASA(美国国家航空航天局)做了一个开源项目: &lt;a href="https://github.com/nasa-jpl/open-source-rover"&gt;JPL Open Source Rover Project&lt;/a&gt;，这是NASA&lt;a href="https://zh.wikipedia.org/zh-hans/%E7%81%AB%E6%98%9F%E6%8E%A2%E6%B5%8B%E6%BC%AB%E6%B8%B8%E8%80%85"&gt;漫游者号火星车&lt;/a&gt;的教育版本。&lt;/p&gt;
&lt;p&gt;漫游者计划的想法是，定期组织大家一起制作有趣的项目，像上边提到的火星车。在制作的过程中，大家分工协作，没有人扮演指导者和老师。大家可能会遇到困难，需要一起解决。在这个过程中，参与者将看到真实项目的制作过程，有困惑，需要思考，最后解决它。如果家长带着孩子一起参加，让一个孩子看到困惑是如何产生的，知识和思考又是如何帮助解决问题的，我们相信会比按照说明书组装完事，有价值得多。漫游者计划中，所有人都将面对未知、获得成长。我们喜欢杜威说的: 教育的目的是它本身。而不是为了达成某个任务。&lt;/p&gt;
&lt;h1 id="_5"&gt;如何参与&lt;/h1&gt;
&lt;p&gt;&lt;!-- &gt;  那些疯狂到以为自己能够改变世界的人， 才能真正改变世界。 -- 史蒂夫·乔布斯--&gt; &lt;/p&gt;
&lt;p&gt;有很多种方式参与codelab.club。&lt;/p&gt;
&lt;p&gt;你可以成为志愿者，帮助组织活动; 可以贡献出你的技能，为codelab.club设计海报、编写代码、编写剧本、撰写文章、翻译国外优质内容......以及其他你能想到，而我没想到的。&lt;/p&gt;
&lt;p&gt;你也可以全职加入，我们目前正在招&lt;code&gt;活动策划&lt;/code&gt;，未来会开放更多职位。我们希望你充满热情，热爱分享、热爱教育、热爱创造。对了,我们招聘的硬性要求是，你必须读过《终生幼儿园》这本书:)&lt;/p&gt;
&lt;p&gt;codelab准备做很多有趣的事，你有任何想法，都欢迎随时联系我们: wuwenjie718@gmail.com&lt;/p&gt;
&lt;p&gt;也欢迎你将本文分享给你身边可能对此感兴趣的朋友。&lt;/p&gt;
&lt;p&gt;Just for fun, just for you :)&lt;/p&gt;
&lt;!--
# 参考
*  [codelab.club](https://www.codelab.club/)
*  ["下一件大事"是一个房间](https://blog.just4fun.site/the-next-big-thing-is-a-room.html#neverland)
*  [Hungry Robot - Eat everything](https://blog.just4fun.site/Hungry-Robot-Eat-everything.html#_9)
*  [codelab-adapter](https://codelab-adapter-docs.codelab.club/)
*  [scratch3-adapter value](https://codelab-adapter-docs.codelab.club/about/value/)
*  [Scratch3 Lab](https://blog.just4fun.site/Scratch3-Lab.html)
--&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Thu, 08 Nov 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-11-08:about-codelab-club.html</guid><category>codelab</category></item><item><title>Hungry Robot - Eat everything</title><link>/Hungry-Robot-Eat-everything.html</link><description>&lt;blockquote&gt;
&lt;p&gt;Stay hungry, Stay foolish&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/hungryrobot_432e1f4d.png" /&gt;&lt;/p&gt;
&lt;video width="400px" src="http://wwj-fig-bed.just4fun.site/hungry_robot.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;带着Hungry Robot参加北京的maker faire，它可能是全场最受欢迎的robot了。&lt;/p&gt;
&lt;h1 id="hungry-robot"&gt;关于Hungry Robot&lt;/h1&gt;
&lt;p&gt;Hungry Robot是&lt;a href="https://www.thingiverse.com/EunchanPark/about"&gt;EunchanPark&lt;/a&gt;制作的&lt;a href="https://sites.google.com/view/100happythings/home"&gt;一系列有趣的机器人&lt;/a&gt;中的一个。&lt;/p&gt;
&lt;p&gt;来自丹麦的&lt;a href="https://www.thingiverse.com/EunchanPark/about"&gt;EunchanPark&lt;/a&gt;喜欢做令人快乐之事，也乐于与社区分享创作的过程。[Happy Things Maker]是Ta的使命。&lt;a href="https://www.thingiverse.com/EunchanPark/about"&gt;EunchanPark&lt;/a&gt;想建立“快乐之物博物馆”，在其中尽可能多地放置令人愉悦之物。这是Ta的&lt;a href="https://sites.google.com/view/100happythings/home"&gt;100 HAPPY THINGS&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://sites.google.com/view/100happythings/18-Hungry-Robot"&gt;Hungry Robot&lt;/a&gt;是&lt;a href="https://sites.google.com/view/100happythings/home"&gt;100 HAPPY THINGS&lt;/a&gt;之一。&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.thingiverse.com/EunchanPark/about"&gt;EunchanPark&lt;/a&gt;创作&lt;a href="https://sites.google.com/view/100happythings/18-Hungry-Robot"&gt;Hungry Robot&lt;/a&gt;的动机是&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I want to make a robot for emotional purpose not for functional. This is fun, makes smile and feels good. &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href="https://sites.google.com/view/100happythings/18-Hungry-Robot"&gt;Hungry Robot&lt;/a&gt;的外壳采用3D打印制作，控制芯片选用Arduino。这些东西都对社区开放:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.thingiverse.com/thing:2824451"&gt;Hungry Robot&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/happythingsmaker/TrashEatingRobot"&gt;TrashEatingRobot&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="_1"&gt;我的制作笔记&lt;/h1&gt;
&lt;p&gt;从&lt;a href="https://github.com/happythingsmaker/TrashEatingRobot"&gt;TrashEatingRobot&lt;/a&gt;源码中可以看出，Hungry Robot的控制逻辑十分简单: 当&lt;code&gt;红外测距传感器&lt;/code&gt;检测到有物体靠近时（如有人放置硬币），便触发舵机转动，把硬币倒入口中。这就是Hungry Robot的所有控制逻辑。&lt;/p&gt;
&lt;p&gt;较之于Arduino，我更喜欢micro:bit,所以决定采用micro:bit来制作Hungry Robot。&lt;/p&gt;
&lt;h1 id="_2"&gt;开始制作&lt;/h1&gt;
&lt;h3 id="_3"&gt;准备工作&lt;/h3&gt;
&lt;p&gt;制作&lt;a href="https://www.thingiverse.com/thing:2824451"&gt;Hungry Robot&lt;/a&gt;，需要以下素材&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;micro:bit&lt;/li&gt;
&lt;li&gt;3D打印的机器人外壳&lt;/li&gt;
&lt;li&gt;红外测距传感器模块(夏普 GP2Y0A21YK0F 10-80cm)&lt;/li&gt;
&lt;li&gt;SG90舵机&lt;/li&gt;
&lt;li&gt;尼龙扎带(细)&lt;/li&gt;
&lt;li&gt;导线若干&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;以上物资都可以通过淘宝搞定。除了micro:bit，其他材料都在几块钱到十几块钱之间。&lt;/p&gt;
&lt;p&gt;单独说说&lt;code&gt;3D打印的机器人外壳&lt;/code&gt;,如果你有3D打印机，直接从&lt;a href="https://www.thingiverse.com/thing:2824451"&gt;Hungry Robot 3D print files&lt;/a&gt;中下载模型，打印出来即可。如果你没有3D打印机，可以在淘宝上购买3D打印服务，给店家发去3D打印文件即可。&lt;/p&gt;
&lt;p&gt;我采用了光敏树脂,打印出的外壳十分细腻。&lt;/p&gt;
&lt;h3 id="_4"&gt;组装机器人&lt;/h3&gt;
&lt;p&gt;如何从一堆零件中，组装出Hungry Robot呢？&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.youtube.com/watch?v=Ipmwis2oPFA"&gt;Hungry Robot (Eat everything) long take without edit (How to make)&lt;/a&gt;给出了细致的引导。&lt;/p&gt;
&lt;p&gt;视频在Youtube上，需要翻墙。我已经把它搬运到本地.你可以在此观看&lt;/p&gt;
&lt;video width="600" src="http://wwj-fig-bed.just4fun.site/Arduino%20Project%20%5D%20Hungry%20Robot%20%28Eat%20everything%29%20long%20take%20without%20edit%20%28How%20to%20make%29-Ipmwis2oPFA.f18.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;h3 id="_5"&gt;开始编程&lt;/h3&gt;
&lt;p&gt;我喜欢把对知识的教学放在制作项目的过程中，之前在&lt;a href="https://mp.weixin.qq.com/s?__biz=MzU4NzY2OTk4NA==&amp;amp;mid=2247483662&amp;amp;idx=1&amp;amp;sn=fbd7309b42d33eff688c144e8137bb1f&amp;amp;chksm=fde9c981ca9e40972ef5ec89b53ace2e81559853c6baedf833460bf3407607069f510a820557#rd"&gt;基于兴趣的学习面临的诘难&lt;/a&gt;写道:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;当一个孩子有了兴趣和冲动，Ta为了追逐这个兴趣，就需要动手实践。你知道的，魔鬼都在细节里，动手实践的过程总会碰到许多障碍，于是Ta就要熟悉材料，运用独创性、坚持以及机智，这个过程必然包含着各种训练、以及需要教育者提供知识来帮助Ta。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;约翰.杜威说:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;如果我们有设备和材料的结构，在我们面前就开辟了另一条路径。我们可以指导儿童的活动，使它们沿着一定方向运行，把它们渐渐引导到这条道路逻辑上必然要达到的目标上。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;接下来让我们看看制作Hungry Robot，需要熟悉的材料，并在这个过程中学习编程相关的知识。&lt;/p&gt;
&lt;h5 id="_6"&gt;红外测距传感器&lt;/h5&gt;
&lt;p&gt;在Hungry Robot中，红外测距传感器用于测距，当检测到有物体靠近时(有人放置硬币)，则触发舵机转动。&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/hungryrobot_707de07f.png" width=350 /&gt;&lt;/p&gt;
&lt;p&gt;图中的三条线中:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;红色接电源线(Vcc)&lt;/li&gt;
&lt;li&gt;黑色接地(GND)&lt;/li&gt;
&lt;li&gt;黄色是数据线(Vo)，我将其接在micro:bit pin1引脚，你可以选择其他引脚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;红外测距传感器通过黄色数据线，对外输出模拟信号(analog signal),制作Hungry Robot并不需要对&lt;a href="https://zh.wikipedia.org/wiki/%E6%A8%A1%E6%93%AC%E4%BF%A1%E8%99%9F"&gt;模拟信号&lt;/a&gt;有深入连接，你只需知道红外测距传感器在测距时，会把距离信息对外输出就行。&lt;/p&gt;
&lt;p&gt;如果你对&lt;a href="https://zh.wikipedia.org/wiki/%E6%A8%A1%E6%93%AC%E4%BF%A1%E8%99%9F"&gt;模拟信号&lt;/a&gt;有兴趣，维基百科是很好的学习入口，无论你对什么有兴趣，维基百科常是入门的好伴侣。&lt;/p&gt;
&lt;p&gt;下边我们动手来熟悉一下红外测距传感器。&lt;/p&gt;
&lt;p&gt;使用&lt;a href="https://codewith.mu/"&gt;mu-editor&lt;/a&gt;作为编辑器，来为micro:bit编程。&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/mu.gif" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://codewith.mu/"&gt;mu-editor&lt;/a&gt;是一款Python编辑器，我们可以使用Python来为micro:bit编程。当然也可以使用图形化编辑器&lt;a href="https://makecode.microbit.org/"&gt;makecode&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;连接好电路之后,使用数据线将microbit连上电脑，打开&lt;a href="https://codewith.mu/"&gt;mu-editor&lt;/a&gt;，只需要4行代码我们就能源源不断获取红外测距传感器测得的信息&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;microbit&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;

&lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;distance&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pin1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read_analog&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;distance&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  &lt;span class="c1"&gt;# 说明&lt;/span&gt;
    &lt;span class="n"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;写完代码后，我们需要将代码烧入(flash)到microbit，在编辑器中点击flash即可。microbit背后的信号灯开始闪烁，片刻之后，闪烁停止，代码烧入即已完成。&lt;/p&gt;
&lt;p&gt;此时打开编辑器上的REPL按钮，将看到红外测距传感器输出的模拟信号。&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/repl_ba264c23.png" width=600 alt="repl" /&gt;&lt;/p&gt;
&lt;p&gt;这些模拟信号并不是真实的距离。在这个例子中，我们并不需要知道模拟信号如何转化为距离，我们只需要观察模拟信号与距离的关系即可。&lt;/p&gt;
&lt;p&gt;mu-editor可以将打印出来的模拟信号绘制成一条曲线&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/plotter_3788ae3f.png" width=600 alt="plotter" /&gt;&lt;/p&gt;
&lt;p&gt;为了将模拟信号绘制成曲线，需要微调一下代码&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;microbit&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;

&lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;distance&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pin1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read_analog&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;distance&lt;/span&gt;&lt;span class="p"&gt;,))&lt;/span&gt; &lt;span class="c1"&gt;# &lt;/span&gt;
    &lt;span class="n"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;将distance改为 &lt;code&gt;(distance,)&lt;/code&gt;。&lt;code&gt;(distance,)&lt;/code&gt;是python中的元组。Plotter会将元组中的数据绘制成图像。可以暂时不关心这些，这些只是语法上的约定，对于学习编程没有特别重要。需要时查一下规则就行，不必去记它。&lt;/p&gt;
&lt;p&gt;重新烧入(flash),点击Plotter按钮，即可看到红外测距传感器输出的信号被绘制成了图像。如果你观察仔细，会发现信号中存在噪声。&lt;/p&gt;
&lt;p&gt;将你的手掌从远到近，逐渐靠近红外测距传感器，你将看到曲线的变化。&lt;code&gt;距离越近,数值越大&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/plotter_36a87124.png" width=600 alt="演示" /&gt;&lt;/p&gt;
&lt;p&gt;经过一番实验，我将临界值设为700. 当我的手离机器人大约10多厘米时，图中数值大约是700。我们用这个数值表达:&lt;code&gt;有东西机器人很近&lt;/code&gt;，翻译成你看到的场面就是: 你正把拿着硬币靠近机器人，准备放在它手上。&lt;/p&gt;
&lt;p&gt;&lt;a href="https://codewith.mu/"&gt;mu-editor&lt;/a&gt;是个非常好的Python编辑器，它使用简单，对初学者友好，很适合用来做一些探索性的实验。&lt;/p&gt;
&lt;h3 id="_7"&gt;舵机&lt;/h3&gt;
&lt;p&gt;下边来说说舵机。我们采用SG90舵机，这是使用最广的控制舵机，价格低廉。&lt;/p&gt;
&lt;p&gt;如果你对舵机的控制原理有兴趣，可以使用搜索引擎做细致的了解(PWM)。在此我们只需知道，通过编程可以控制舵机转动某个角度就足够了。&lt;/p&gt;
&lt;p&gt;SG90舵机如图所示。&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/hungryrobot_01452c7b.png" width=400 alt="sg90" /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;红色: VCC&lt;/li&gt;
&lt;li&gt;棕色: GND&lt;/li&gt;
&lt;li&gt;橙黄是信号线（脉冲输入）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;将舵机的橙黄是信号线接在microbit的pin0上。&lt;/p&gt;
&lt;p&gt;最初我完全准备采用Python来实现Hungry Robot的控制逻辑，结果发现，使用Python控制SG90舵机并不方便，社区里有人写了一些通用的源码，来精确控制舵机转动角度，但源码似乎有问题&lt;a href="https://github.com/microbit-playground/microbit-servo-class/blob/master/servo.py"&gt;servo.py&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;最终决定采用makecode来编程。&lt;/p&gt;
&lt;h4 id="_8"&gt;最终项目&lt;/h4&gt;
&lt;p&gt;先把最终项目的源码直接放上来,大家可以&lt;a href="https://makecode.microbit.org/_chKXMmXiicPV"&gt;点击查看&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/makecode_rob%20ot_c7894c97.png" width=800 /&gt;&lt;/p&gt;
&lt;p&gt;梳理一下代码逻辑：在一个无限循环中，不断检测红外测距传感器测得的距离，当距离小于临界值时(说明有人给它喂食)，则调用eat函数，eat函数用于驱动舵机：从180度的位置，转动都60度的位置，再转回去，舵机带动手臂，于是完成了进食。这些角度通过实验来获得。&lt;/p&gt;
&lt;h3 id="tips"&gt;tips&lt;/h3&gt;
&lt;p&gt;推荐使用电脑或移动电源为microbit供电，使用5号电池组供电，可能无法驱动电机。&lt;/p&gt;
&lt;h1 id="scratch3-dapterhungry-robot"&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;scratch3-dapter&lt;/a&gt;版hungry robot&lt;/h1&gt;
&lt;p&gt;使用&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;scratch3-dapter&lt;/a&gt;将hungry robot的舵机接管到&lt;a href="http://scratch3.codelab.club"&gt;scratch3&lt;/a&gt;中，如此一来，就可以让hungry robot与所有扩展交互，诸如接入物联网或人工智能。&lt;/p&gt;
&lt;p&gt;&lt;a href="https://makecode.microbit.org/_233XzLYydRcK"&gt;makecode固件部分的源码&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;scratch部分的源码为：&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/hungryrobot_486432b5.png" width=800 /&gt;&lt;/p&gt;
&lt;p&gt;在我的例子中，我将hungry robot与声音响度积木结合，当我们给hungry robot喂食时，它无动于衷，只有我们敲敲碗，它才张嘴吃东西。我们于是制作了一个&lt;a href="https://zh.wikipedia.org/zh/%E5%B7%B4%E7%94%AB%E6%B4%9B%E5%A4%AB"&gt;巴布洛夫&lt;/a&gt;的robot&lt;/p&gt;
&lt;video width="600px" src="http://wwj-fig-bed.just4fun.site/1540219015667808.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;h1 id="_9"&gt;后话: 漫游者计划&lt;/h1&gt;
&lt;p&gt;某天逛树莓派社区，发现NASA(美国国家航空航天局)开放了一个教育项目: &lt;a href="https://github.com/nasa-jpl/open-source-rover"&gt;JPL Open Source Rover Project&lt;/a&gt;。我很喜欢这个项目，但制作这个项目可能得花费我好多个周末的时间。想在青旅(我在南京和朋友一起开了家青旅)中邀请更多的人周末一起来制作这个项目，召集那些对此有热情的人，大家分工协作。如此一来，就不会像大多的个人周末项目，因为遇到困难而放弃。更多的人参与，意味着，更多元的技能，以及更多的碰撞和灵感。好比我极不擅长拼搭的工作，但善于编程。在这个过程里，我就可以观察和学习那些善于拼搭的人，是如何做好这个工作的，同时，我也可以带着那些渴望获得编程技能的小伙伴一起编程。&lt;/p&gt;
&lt;p&gt;那我自己是否应该先拼完下整个项目，有了充分把握，再带着大家一起做呢？&lt;/p&gt;
&lt;p&gt;我很快否定了这个想法，我并不乐意对项目了然于心，之后作为老师/志愿者带着大家玩。这个过程，不只教学者没有获得成长，学习者也无法看到制作项目的真实过程。制作真实的项目，会遇到困难，需要思考来解决问题。如果有个人充当上帝的角色，什么都懂，也设计了路线，那么其他人只是按照固定的流程在做机械性的工作。这没什么价值。我希望让大家参与到真实项目里。这也是我们吸引志愿者以及有专长的人的原因，他们不只是来做贡献，所有人都将面对未知、获得成长。不喜欢课堂上的那种不真实，我喜欢杜威说的&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;education as life&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;生活没有彩排，每天都是现场直播，这正是它有趣且令人充满热情的原因。&lt;/p&gt;
&lt;p&gt;漫游者计划希望去实践这些。我这个月底去广州，我们会在天河的中心区域拿下一个办公室，它是可编程的，而且会非常酷。我们在其中创作各种好玩的项目，我们也在其中办公以及交流，我们会开放它，作为漫游者计划的据点之一。&lt;/p&gt;
&lt;p&gt;在漫游者计划中。参与者、志愿者、学习者、教师这些角色融为一体。或者说我们不需要这些角色分类，在这儿，只有&lt;code&gt;协作者&lt;/code&gt;，即便是一对父母带着他们的孩子前来，他们也是平等的协作者。对参与者的年龄没有限制，多元总是好的，它会带来更多的创意。&lt;/p&gt;
&lt;p&gt;我将漫游者计划视为探索&lt;a href="https://codelab.club/"&gt;codelab.club&lt;/a&gt;的一步。它club的一种形式。&lt;/p&gt;
&lt;p&gt;其他的club形式会并行运作。诸如邀请制的club，在这种club中，我们每周末的晚上，会进行线下成员聚会，会邀请一些有趣的hacker/maker做分享和交流，大家分享有趣的信息以及各自正在制作的项目。这种club是邀请制，你可以邀请你周围最聪明的朋友加入，但要求申请者有自己的作品，且能展示自己创作和分享的热情。&lt;/p&gt;
&lt;!--
之前和曾老师应刘院长之邀，到他们学校(高校)做了一次Open edX的技术分享，期间认识了杨老师，杨老师在大学里教计算机，她的孩子(翟同学)是个小maker，对动手制作东西很感兴趣。开朗活泼，有许多有趣的妙点子。

由于杨老师教学使用C++，翟同学从小对C++熟练。同他吃午饭期间，他聊到并不喜欢C++,他问到为了实现一个简单的功能，为什么不能拖一个积木，而要写各种冒号和花括号，写完还不能立刻运行。

翟同学的这个疑惑，让我想到Philip Guo的这篇文章[Why Python is a great language for teaching beginners in introductory programming classes](http://pgbovine.net/python-teaching.htm)。我前些时间给UCSD的Philip Guo发了封邮件，说想把他的这篇文章翻译到国内，他觉得这件事很棒，只要我在博客的译文里附上原文链接就行。Philip Guo在这篇文章里论述了为何Python是一门优秀的语言，用于入门编程课程中教授初学者。

文章里就提到说:

&gt;  大多数入门学习者根本不关心计算机科学或编程语言理论，而只是想让计算机简单运行一下他们的代码，而不必大费周章写一堆样板代码。需要编写的代码越少，可能遇到的bug和错误就越少; 而遇到的bug和错误越少，他们就越不容易在入门之初因为沮丧而放弃编程。

我很喜欢这段论述，这也是我反对C/C++/JavaScript作为编程入门语言的原因。我相信Scratch和Python更为理想。Philip Guo的文章里给出了强有力的论证，我近期会翻译完放到博客上。

翟同学近期想做两个


如约翰.杜威所言`教育的目的就是它本身`。同杨老师在

这个过程中，作品

约了个周末

杨老师 我的计划

周末 项目 兴趣
--&gt;

&lt;!--
### 智能家居
homeassistant 已经 0.77 需要登陆（大特性）

0.72不需要

cat ~/.homeassistant/configuration.yaml


wzxhzdk:2

--&gt;

&lt;h1 id="_10"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://sites.google.com/view/100happythings/18-Hungry-Robot"&gt;HUNGRY ROBOT - EAT EVERYTHING!&lt;/a&gt;: 教程与资料&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=KfP_LfUiwdc"&gt;Hungry Robot | Servo,Sensor,3d printer Arm project tutorial example&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=Ipmwis2oPFA"&gt;Hungry Robot (Eat everything) long take without edit (How to make)&lt;/a&gt;: 细致的教程&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.microbit.co.uk/functions/analog-read-pin"&gt;Analog Read Pin&lt;/a&gt;: 读取红外&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.kitronik.co.uk/blog/control-a-360-degree-servo-with-a-bbc-microbit/"&gt;Control A 360 Degree Servo With A BBC micro:bit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;EunchanPark&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.thingiverse.com/EunchanPark/about"&gt;about EunchanPark&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.youtube.com/EunchanPark"&gt;youtube EunchanPark&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://sites.google.com/view/100happythings/home"&gt;[ HOW TO MAKE ] 100 HAPPY FUN DIY THINGS&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="http://101.96.10.63/www.sharp-world.com/products/device/lineup/data/pdf/datasheet/gp2y0a21yk_e.pdf"&gt;GP2Y0A21YK0F&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/zh-cn/%E6%A8%A1%E6%93%AC%E4%BF%A1%E8%99%9F"&gt;模拟信号&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/zh/%E8%84%88%E8%A1%9D%E5%AF%AC%E5%BA%A6%E8%AA%BF%E8%AE%8A"&gt;PWM&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Mon, 22 Oct 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-10-22:Hungry-Robot-Eat-everything.html</guid><category>scratch</category></item><item><title>codelab-adapter接入blender</title><link>/scratch3-adapter-blender.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/blender-adapter_2e1cc54a.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;提醒&lt;/strong&gt;:  我们为blender写了新的插件, 支持最新的blender版本(2.8), 参考&lt;a href="https://blog.just4fun.site/codelab-love-blender"&gt;codelab❤️blender&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;我在&lt;a href="https://blog.just4fun.site/blockly-3D.html"&gt;积木化编程与3D场景&lt;/a&gt;写道:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我近期会将codelab-adapter接入blender中！如此一来就建立了现实世界与虚拟世界的连接，你甚至可以和电影中的角色打交道。很多著名的电影都使用了blender来创作。&lt;br /&gt;
一旦codelab-adapter与Blender连接完成，你可以徒手创作minecraft中的世界(借助leapmotion，而minecraft的资源包社区里已经有了:&lt;a href="http://theduckcow.com/dev/blender/mcprep/"&gt;BLENDER MINECRAFT ADDON&lt;/a&gt;。你也可以使用micro:bit制作的魔法棒与虚拟世界的哈利波特一决高下。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;video width="800" src="http://scratch3-files.just4fun.site/blender-adapter.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;这部分的工作已经完成。做些笔记&lt;/p&gt;
&lt;h1 id="_1"&gt;开发笔记&lt;/h1&gt;
&lt;h3 id="debug"&gt;debug&lt;/h3&gt;
&lt;p&gt;blender有多种方式可以运行Python脚本，参考&lt;a href="https://docs.blender.org/api/current/info_overview.html#script-loading"&gt;Script Loading&lt;/a&gt;。 运行text editor中的代码，我们无法看到输出，为了调试方便，我们可以这样启动blender:&lt;code&gt;blender --python /tmp/test.py  /tmp/test_bge.blend&lt;/code&gt;,如此一来项目中运行python程序时，输出会显示在命令行。&lt;/p&gt;
&lt;p&gt;上边的blender命令其实是:&lt;code&gt;alias blender=/Applications/Blender/blender.app/Contents/MacOS/blender&lt;/code&gt;&lt;/p&gt;
&lt;h3 id="_2"&gt;逻辑积木&lt;/h3&gt;
&lt;p&gt;blender的逻辑积木与&lt;a href="https://github.com/node-red/node-red"&gt;node-red&lt;/a&gt;很像。使用方式也基本一样，&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/blender-adapter_14597542.png" /&gt;&lt;/p&gt;
&lt;p&gt;值得注意的是blender运行python的方式。注意程序的生命周期。从上图可以看出，Python程序由传感器触发。每当设置的sensor发现了某个事件(event),python脚本则运行一次，在脚本中可以拿到传感器(sensor)的信息，以此决定如何影响触动器(actuator)。由此可以看出，我们的脚本是被动运行的，它被多次促发。所以你不能在脚本中跑守护进程。我只好将zmq rep socket改为NOBLOCK风格。&lt;/p&gt;
&lt;h3 id="_3"&gt;消息&lt;/h3&gt;
&lt;p&gt;blender有两类逻辑积木:传感器(sensor)和触动器(actuator)都支持消息(message)&lt;/p&gt;
&lt;p&gt;使用消息，可以实现跨场景控制，这个scratch很像。和adapter也很像。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;everything is message&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;bge&lt;/span&gt;
&lt;span class="n"&gt;cont&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bge&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;logic&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getCurrentController&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;own&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cont&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;owner&lt;/span&gt;
&lt;span class="c1"&gt;# send message&lt;/span&gt;
&lt;span class="n"&gt;own&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sendMessage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# 会激活messge sensor&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="_4"&gt;导出游戏&lt;/h3&gt;
&lt;p&gt;使用blender插件可以将制作的游戏导出为独立应用，参考&lt;a href="https://blender.stackexchange.com/questions/95481/how-to-export-correctly-a-standalone-game"&gt;How to Export correctly a standalone Game?&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;需要注意的是，如果你使用了自己安装的python第三方包，导出为游戏时会出错，错误原因是第三方包没有到打包进应用。我使用pyzmq，就遇到相应问题。&lt;/p&gt;
&lt;p&gt;由于导出的应用没办法看到调试信息，你可以简单打个log&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;test&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;run_server&lt;/span&gt;
&lt;span class="k"&gt;except&lt;/span&gt;  &lt;span class="ne"&gt;Exception&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="c1"&gt;# export to log&lt;/span&gt;
    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/tmp/error.log&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;a+&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="bge"&gt;BGE&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;blender在暂停BGE引擎之后需要重启，否则zmq端口没有释放&lt;/li&gt;
&lt;li&gt;重启blender, adapter和scratch3.0插件不需要重启&lt;/li&gt;
&lt;li&gt;记得连接逻辑积木，&lt;code&gt;always&lt;/code&gt;作为触发器&lt;/li&gt;
&lt;li&gt;被触发的Python脚本在进程中，当心阻塞blender&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="_5"&gt;实际操作&lt;/h1&gt;
&lt;p&gt;我将操作录了个屏&lt;/p&gt;
&lt;p&gt;&lt;img src="http://scratch3-files.just4fun.site/adapter_blender_v1.gif" /&gt;&lt;/p&gt;
&lt;p&gt;简而言之分以下几步:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/install/"&gt;codelab-adapter(建议使用最新版本v0.2.2)&lt;/a&gt;中下载blender插件:&lt;a href="https://github.com/Scratch3Lab/scratch3_adapter_extensions/raw/master/extension_blender.py"&gt;extension_blender&lt;/a&gt;。点击&lt;code&gt;菜单栏 &amp;gt; 插件 &amp;gt; 下载&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;重启codelab-adapter，选择运行extension_blender&lt;/li&gt;
&lt;li&gt;下载&lt;a href="http://scratch3-files.just4fun.site/adapter_bge_v1.blend"&gt;adapter_bge_v1.blend&lt;/a&gt;，在blender中打开。点击&lt;code&gt;菜单栏 &amp;gt; 游戏引擎 &amp;gt; 启动游戏引擎&lt;/code&gt;。需要注意，每次重新启动游戏引擎，都需要重启blender。&lt;/li&gt;
&lt;li&gt;打开&lt;a href="https://scratch3.codelab.club/"&gt;scratch3.codelab.club&lt;/a&gt;，选择EIM插件，发送&lt;code&gt;up&lt;/code&gt;和&lt;code&gt;down&lt;/code&gt;消息，即可控制3D物体移动。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;注意，以上只是一个最小原型，可以随意修改，enjoy yourself：）&lt;/p&gt;
&lt;h1 id="_6"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://bgepython.tutorialsforblender3d.com/GameLogic/sendMessage"&gt;Game Logic: sendMessage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blender.stackexchange.com/questions/80971/blender-game-controller-using-arduino-not-working-properly"&gt;Blender game controller using arduino not working properly&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blender.stackexchange.com/questions/95481/how-to-export-correctly-a-standalone-game"&gt;How to Export correctly a standalone Game?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Sat, 29 Sep 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-09-29:scratch3-adapter-blender.html</guid><category>scratch</category></item><item><title>WebUSB与micro:bit</title><link>/webusb-microbit.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/webusb_a5dff4a7.png" /&gt;&lt;/p&gt;
&lt;h1 id="webusb"&gt;webusb&lt;/h1&gt;
&lt;p&gt;&lt;a href="https://wicg.github.io/webusb/"&gt;WebUSB API&lt;/a&gt;在简介里说到：&lt;/p&gt;
&lt;p&gt;WebUSB API提供了一种将USB设备服务安全地公开给Web的方法。&lt;/p&gt;
&lt;p&gt;借此API，硬件制造商将能够为其设备构建跨平台JavaScript SDK。web平台成为调度硬件的一等公民。&lt;/p&gt;
&lt;h1 id="_1"&gt;硬件设备的困扰&lt;/h1&gt;
&lt;p&gt;&lt;img width=800 src="http://wwj-fig-bed.just4fun.site/webusb_9a77f466.png" /&gt;&lt;/p&gt;
&lt;p&gt;我们从&lt;a href="https://www.numworks.com"&gt;numworks&lt;/a&gt;说起，&lt;a href="https://www.numworks.com"&gt;numworks&lt;/a&gt;是一个支持绘图的计算器，目标是使学习数学更容易。刷&lt;a href="https://news.ycombinator.com/"&gt;hacker news&lt;/a&gt;时偶然发现了这个项目，十分惊艳，&lt;a href="https://www.numworks.com"&gt;numworks&lt;/a&gt;支持运行python，它甚至写了个自己的操作系统，这些都是开放的:&lt;a href="https://github.com/numworks/epsilon"&gt;epsilon&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.numworks.com"&gt;numworks&lt;/a&gt; 在&lt;a href="https://www.numworks.com/blog/webusb-firmware-update/"&gt;Writing a device updater? Seriously consider WebUSB!&lt;/a&gt;中描述了它们为更新设备固件所遇到的麻烦，最终发现webusb是理想选择。&lt;/p&gt;
&lt;p&gt;文章里写道&lt;a href="https://www.numworks.com"&gt;numworks&lt;/a&gt;的目标是确保他们的设备固件可以轻松升级，为了达到目标，需要满足以下要求:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;尽可能跨更多的平台&lt;/li&gt;
&lt;li&gt;用户不必为了更新设备而安装特定软件。&lt;/li&gt;
&lt;li&gt;尽可能少编写代码。代码越少，错误越少。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;webusb完美地满足这些要求.在跨平台方面,webusb适用于各种设备和操作系统（Android，Windows，macOS和Linux）,而且是开箱即用的&lt;/p&gt;
&lt;p&gt;文章里有不少有趣的部分，诸如作者提到，解决方案之一是使用配有USB-to-HTTP桥接器的Web应用程序(Scratch Link和scratch3-adapter都是这种程序),&lt;a href="https://www.numworks.com"&gt;numworks&lt;/a&gt;也使用了一段时间这个选项，但我们最终决定放弃它，原因是&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;因为无法为localhost提供有效证书&lt;/li&gt;
&lt;li&gt;分发仍然很痛苦，您仍然可能需要更新网桥&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;这两个问题其实都有很好的解决方案，问题1，我在已经给出了解决方案:&lt;a href="https://blog.just4fun.site/localhost-https-ssl.html"&gt;本地https/wss服务与SSL安全证书&lt;/a&gt;，问题2的理想解决方案是&lt;a href="https://github.com/mherrmann/fbs"&gt;fbs&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.numworks.com"&gt;numworks&lt;/a&gt;的案例很好地给出了选择WebUSB更新固件的理由，WebUSB的应用场景当然远不只是更新固件。下边写出一些&lt;a href="https://wicg.github.io/webusb/"&gt;WebUSB API&lt;/a&gt;中提到的使用场景&lt;/p&gt;
&lt;h1 id="_2"&gt;使用场景&lt;/h1&gt;
&lt;h3 id="_3"&gt;教育设备&lt;/h3&gt;
&lt;p&gt;基于Web的软件交付模型适合于教育教育领域，因为它们可以快速加载到任何计算机上，而无需考虑平台兼容性。平台的兼容性在教育领域产生的影响可能远远超出你的预期，尤其是国内。&lt;/p&gt;
&lt;p&gt;基于Web的硬件API，允许将设备的支持直接构建到现有的在线课程材料中，从而提供无缝的连接体验。而不会增加实施成本，诸如在每台电脑安装一个客户端软件。&lt;/p&gt;
&lt;p&gt;学生可利用在线开发人员工具编写和上传他们的代码，老师可以随时查阅，管理和干预。因为数据都在线上，这就提供了AI介入的可能。&lt;/p&gt;
&lt;p&gt;此外学生的作品可以在线分享，可以据此构建在线社区。&lt;/p&gt;
&lt;p&gt;当设备可以被接入web，那么我们就可以将大量的web玩法引入到硬件教育中。诸如远程指导，协同编程等等&lt;/p&gt;
&lt;p&gt;我相信web bluetooth和webusb是教育领域的未来。&lt;/p&gt;
&lt;h3 id="_4"&gt;网络驱动程序&lt;/h3&gt;
&lt;p&gt;Web的可组合性，可能发展出生态系统。&lt;/p&gt;
&lt;p&gt;以3D打印机为例，想象一下托管3D模型的网站希望将打印直接集成到他们的页面中。目前，Web支持2D打印（普通打印机），但3D版本还没有API。如果使用WebUSB API将数据从网站发送到其打印机，则站点可以使用这些页面来集成对硬件的支持，就像将嵌入式地图等功能一样，可以添加到许多现有站点中。成为一种通用积木。&lt;/p&gt;
&lt;h3 id="_5"&gt;设备更新和诊断&lt;/h3&gt;
&lt;p&gt;虽然蓝牙等无线协议通常是消费级设备的更方便选择，但USB端口不断扩散，因为它们是电源传输的简单解决方案，并且可以在设备不工作时作为最后的连接方式。&lt;/p&gt;
&lt;p&gt;设备制造商只要将用户引导到自己的网站上，就可以为用户提供在线诊断。&lt;/p&gt;
&lt;h1 id="_6"&gt;文档&lt;/h1&gt;
&lt;p&gt;Google的这篇文档很赞: &lt;a href="https://developers.google.com/web/updates/2016/03/access-usb-devices-on-the-web"&gt;Access USB Devices on the Web&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;文档里提到chrome内置的一些调试工具:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;chrome://device-log&lt;/li&gt;
&lt;li&gt;chrome://usb-internals&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="webusbmicrobit"&gt;使用webusb与microbit通信&lt;/h1&gt;
&lt;p&gt;microbit是个为编程教育而生的硬件，对microbit不了解的小伙伴，可以参考我之前的文章:&lt;a href="https://blog.just4fun.site/microbit-notes.html"&gt;micro:bit使用笔记&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;microbit官方推荐的两个编程工具：&lt;a href="https://python.microbit.org/v/beta"&gt;Python Editor&lt;/a&gt;和&lt;a href="https://makecode.microbit.org/beta#editor"&gt;makecode&lt;/a&gt;近期都将支持webusb，这当然是个明智之举，将进一步降低学习者的门槛。&lt;/p&gt;
&lt;p&gt;相关文档在: &lt;a href="https://support.microbit.org/support/solutions/articles/19000084059-beta-testing-web-usb"&gt;Beta testing - Web USB&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;在此，我做个操作纪录.&lt;/p&gt;
&lt;h3 id="_7"&gt;怎么做&lt;/h3&gt;
&lt;p&gt;为了让microbit能使用webusb，我们首先需要将它的固件更新到0250，我这里直接给出固件，大家烧录即可。&lt;/p&gt;
&lt;p&gt;烧入方式为: 按住microbit背后的复位按钮，然后连上电脑，电脑将出现名为&lt;code&gt;MAINTENANCE&lt;/code&gt;的设备，把如下固件:&lt;a href="http://scratch3-files.just4fun.site/0250_kl26z_microbit_0x8000.hex"&gt;0250_kl26z_microbit_0x8000.hex&lt;/a&gt;拖入&lt;code&gt;MAINTENANCE&lt;/code&gt;即可。&lt;/p&gt;
&lt;p&gt;之后你就可以在线为microbit编程了.&lt;/p&gt;
&lt;p&gt;&lt;img width=800 src="http://wwj-fig-bed.just4fun.site/webusb_de2a5177.png" /&gt;&lt;/p&gt;
&lt;p&gt;有两点值得一提，其一是烧录的过程比较慢，得10s+。原因是每回都得烧录完整的固件(500K左右)&lt;/p&gt;
&lt;p&gt;其二是，你可以在线使用REPL功能，它甚至支持自动补全，REPL的另一个好处是，它提供实时反馈！此外它的速度很快！因为每次只有代码文本在阐述，几个字节而已。&lt;/p&gt;
&lt;p&gt;&lt;img width=800 src="http://wwj-fig-bed.just4fun.site/webusb_ac39183d.png" /&gt;&lt;/p&gt;
&lt;p&gt;所以我目前在进行的工作是，将REPL的管道分离出来。供在线课程使用。我希望提供即时的反馈,关于理由我之前在&lt;a href="https://blog.just4fun.site/Hardware-Programming-style.html"&gt;两种硬件编程风格的比较&lt;/a&gt;论述过。&lt;/p&gt;
&lt;p&gt;&lt;a href="https://firialabs.com/"&gt;firialabs&lt;/a&gt;是一门microbit的课程，它使用webusb来建立网页与microbit的连接。&lt;/p&gt;
&lt;h1 id="_8"&gt;注意⚠️&lt;/h1&gt;
&lt;p&gt;WebUSB已被收录在Chrome 61中，在这之后的版本都可以使用，iOS设备不受支持，由于chrome对XP只支持到49，所以XP无法使用WebUSB。&lt;/p&gt;
&lt;h1 id="_9"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://developers.google.com/web/updates/2016/03/access-usb-devices-on-the-web"&gt;Access USB Devices on the Web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://support.microbit.org/support/solutions/articles/19000084059-beta-testing-web-usb"&gt;Beta testing - Web USB&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://support.microbit.org/support/solutions/articles/19000019131-how-to-upgrade-the-firmware-on-the-micro-bit"&gt;How to upgrade the firmware on the micro:bit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://python.microbit.org/v/beta"&gt;python.microbit.org/v/beta&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/ARMmbed/DAPLink/releases/tag/v0250"&gt;DAPLink v0250&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://makecode.microbit.org/beta#editor"&gt;makecode webusb&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://micropython.top/editor-zh-hans.html"&gt;PythonEditor cn&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.numworks.com/"&gt;numworks&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.numworks.com/blog/webusb-firmware-update/"&gt;Writing a device updater? Seriously consider WebUSB!&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://makitosan.github.io/vue-microbit-webusb/"&gt;vue-microbit-webusb&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.micropython.org.cn/bbs/forum.php?mod=viewthread&amp;amp;tid=1262"&gt;microbit的webusb功能测试&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://firialabs.com/"&gt;microbit webusb course&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/WICG/webusb"&gt;WICG/webusb&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.freebuf.com/sectool/101511.html"&gt;WebUSB API：让你的USB设备安全的接入网络&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://wicg.github.io/webusb/"&gt;WebUSB API&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/bbcmicrobit/PythonEditor/tree/webusb-beta"&gt;PythonEditor webusb-beta&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Thu, 27 Sep 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-09-27:webusb-microbit.html</guid><category>microbit</category></item><item><title>积木化编程与3D场景</title><link>/blockly-3D.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/verge3d_fc0fd21f.png" /&gt;&lt;/p&gt;
&lt;h1 id="_1"&gt;缘起&lt;/h1&gt;
&lt;p&gt;近期试着把类似code.org的编程项目移植到3D场景中。&lt;/p&gt;
&lt;p&gt;我们最初使用&lt;a href="https://threejs.org/"&gt;three.js&lt;/a&gt;实现了原型，后来发现了Blender和Verge3D，十分称心，便切换到这个技术栈里。&lt;/p&gt;
&lt;h1 id="blender"&gt;&lt;a href="https://www.blender.org/"&gt;Blender&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Blender名声在外，早有听闻，但一直没去试用。&lt;/p&gt;
&lt;p&gt;近期在树莓派的&lt;a href="https://projects.raspberrypi.org/"&gt;项目页面&lt;/a&gt;看到&lt;a href="https://projects.raspberrypi.org/en/projects?software%5B%5D=blender"&gt;3D modelling projects&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;看了几个学习项目，觉得还不错，这些项目依赖于Blender，便下载试用了Blender，在学习Blender过程中发现许多惊艳的东西，在此做个笔记。&lt;/p&gt;
&lt;p&gt;也是在了解Blender过程中，意外地发现&lt;a href="https://www.soft8soft.com"&gt;Verge3D&lt;/a&gt;，觉得这就是我要找的工具，用来构建3D场景的编程教育项目。&lt;/p&gt;
&lt;p&gt;最近常在浏览开源项目中意外解决了手头的问题。而且事后发现它们往往是最佳解决方案，原本以为要花上几个月的工作量常常变成了几周或几天。甚至几分钟(如昨天发现的&lt;a href="https://github.com/mherrmann/fbs"&gt;fbs&lt;/a&gt;将彻底省下我之后重构scratch3-adapter的时间)&lt;/p&gt;
&lt;h3 id="blender_1"&gt;Blender是什么&lt;/h3&gt;
&lt;p&gt;Blender主页上的介绍是:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Open Source 3D creation. Free to use for any purpose, forever&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在阅读介绍之前，我喜欢先把软件下载下来，凭感觉胡乱捣鼓一番，先做个感性的认识，再做知性的了解。&lt;/p&gt;
&lt;p&gt;Blender的下载地址为&lt;a href="https://www.blender.org/download/"&gt;download&lt;/a&gt;, 我目前使用的版本是&lt;code&gt;v2.79b&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;以下内容摘自维基百科词条:&lt;a href="https://zh.wikipedia.org/wiki/Blender"&gt;Blender&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Blender是一套专业的，自由及开放源代码的三维计算机图形软件。由荷兰的一个动画工作室NeoGeo创建。&lt;/p&gt;
&lt;p&gt;Blender使用Python语言来创作及制作游戏及工作自动化脚本。这令我们这些python拥趸跃跃欲试，我在还不会使用blender的时候，就先去翻它的python文档。&lt;/p&gt;
&lt;p&gt;Blender有个子计划叫&lt;a href="https://zh.wikipedia.org/wiki/Game_Blender"&gt;Game Blender&lt;/a&gt;,用于制作实时交互内容。该游戏引擎使用 C++ 程序语言编写，并支持 Python 脚本和 OpenAL 3D 音频。&lt;/p&gt;
&lt;p&gt;Blender的先进功能包括:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在Blender中，物体与数据是分离的，这使其可以快速塑模。&lt;/li&gt;
&lt;li&gt;可以将多个场景合并至单一文件（称为".blend"的文件）&lt;/li&gt;
&lt;li&gt;所有Blender所生成的".blend"文件均有完善的向前，向后版本的兼容性，同时亦具有完整的跨平台支持。&lt;/li&gt;
&lt;li&gt;所有场景，对象，材料，材质，声音，图片，后期制作特效均可集成至最后生成的".blend"动画档里。&lt;/li&gt;
&lt;li&gt;可透过".blend"文件来自定义用户界面。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="_2"&gt;案例&lt;/h3&gt;
&lt;p&gt;NASA为火星探测车“好奇”着陆三周年纪念日作出了交互web-软件。探测车的动作、摄影机和机械手的操纵是基于 Blender 和 &lt;a href="https://en.wikipedia.org/wiki/Blend4Web"&gt;Blend4Web&lt;/a&gt; 创造的软件实现的。Blend4Web是用于创建和在网页浏览器中显示交互式三维计算机图形的开源框架。近期NASA将技术栈从Blend4Web迁移到Verge3D。&lt;/p&gt;
&lt;p&gt;这是个非常炫酷的项目:&lt;a href="https://opensourcerover.jpl.nasa.gov/#!/home"&gt;opensourcerover&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="blender_2"&gt;Blender与电影&lt;/h3&gt;
&lt;p&gt;第一套使用Blender专业视频是蜘蛛侠2，在该片制作中用来绘制分镜脚本。&lt;/p&gt;
&lt;p&gt;Blender基金会牵头制作了一些开源电影。&lt;/p&gt;
&lt;p&gt;这些通过 Blender 创作出的电影作品，都是根据CC协议（Creative Commons）发表的。因此 DVD 内带有所有电影创作相关 .blend 文件、模型、纹理和其他材料，还有原始剧本、支配表、画面分镜剧本，以及技术细节文档和视频，教你如何使用这些素材，所有人可以下载该作品或其源文件，用于修改后重新发布。&lt;/p&gt;
&lt;p&gt;这些开源电影包括:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/zh-hans/%E5%A4%A7%E8%B1%A1%E4%B9%8B%E6%A2%A6"&gt;大象之梦&lt;/a&gt;（开源视频计划：橙）&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/zh-hans/Big_Buck_Bunny"&gt;大雄兔（Big Buck Bunny）&lt;/a&gt; （开源视频计划：桃）&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/zh-hans/%E8%BE%9B%E7%89%B9%E5%B0%94"&gt;辛特尔（sintel）&lt;/a&gt;（开源视频计划：榴莲）&lt;/li&gt;
&lt;li&gt;&lt;a href="https://movie.douban.com/subject/19965709/"&gt;钢铁之泪 Tears of Steel&lt;/a&gt;（开源视频计划：芒果）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;大家可以看其中的一个例子（辛特尔）:&lt;/p&gt;
&lt;video width=800 src="https://upload.wikimedia.org/wikipedia/commons/transcoded/f/f1/Sintel_movie_4K.webm/Sintel_movie_4K.webm.480p.webm" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;这些例子令人震惊之处在于，创作者所使用的工具全都开源，任何人可以轻松获得，他们把作品的所有细节，从剧本到素材也都开源，你可以看到一个人手握屠龙刀，斩落恶龙的所有细节。这就给人一种希望，只要努力，有朝一日，我们也可能创作出如此惊人的作品。事实上极少人最终走到这一步。有时候，令人难过的是，你本来有机会做出一些令人惊叹的事，外部环境已足够友好，也有前辈尽力予以支持，但却因为自身的原因，不够努力或不够聪明，未能达成目标。&lt;/p&gt;
&lt;p&gt;在开源的世界里，无论你想成为一个顶级黑客，还是想建构一个新的虚拟世界，或是用程序操控现实中的万物，屠龙刀都是可以轻易获得的，但屠龙技却得靠自己的努力去习得。&lt;/p&gt;
&lt;h1 id="verge3d"&gt;Verge3D&lt;/h1&gt;
&lt;p&gt;&lt;a href="https://zh.wikipedia.org/zh-hans/Verge3D"&gt;Verge3D&lt;/a&gt;是一个用于创建运行于网页的3D交互式体验的实时渲染器和工具套件。&lt;/p&gt;
&lt;p&gt;Verge3D是由以前创建的Blend4Web 框架的核心软件工程师团队创建。 Verge3D使用户能够利用常用的三维设计工具(目前支持 Autodesk 3ds Max 和 Blender )创做3D交互内容，并直接转换到网络浏览器中查看。&lt;/p&gt;
&lt;p&gt;Verge3D基于 WebGL 进行渲染，整合了 Three.js 库，并向程序开发人员公开&lt;a href="https://www.soft8soft.com/docs/"&gt;API接口&lt;/a&gt;。&lt;/p&gt;
&lt;h3 id="puzzles"&gt;Puzzles编辑器&lt;/h3&gt;
&lt;p&gt;Puzzles编辑器是基于Blockly编写的可视化编程环境。Verge3D的程序功能可直接编写代码或使用Puzzles编辑器添加 JavaScript 脚本。 Puzzles主要面向非程序员，使其可通过 拖放 操作快速创建交互场景。&lt;/p&gt;
&lt;!--截图有1.9M--&gt;

&lt;p&gt;&lt;img width=800 src="http://wwj-fig-bed.just4fun.site/verge3d_fc0fd21f.png" /&gt;&lt;/p&gt;
&lt;p&gt;使用Puzzles，非技术用户(如艺术家)可以轻松创作出动态的场景或游戏。步骤是在Blender中导入或创建好3D模型，接着在Puzzles中拼搭积木为3D场景/物体编程。强大而友好得令人震惊！&lt;/p&gt;
&lt;p&gt;Verge3D的工作流与主流的WebGL框架有很大的不同，它追求的是一个强大的面向艺术家的方法。开发一个新的Verge3D应用开发通常是从3D对象的建模、纹理和动画开始的，在单一的&lt;em&gt;.max或&lt;/em&gt;.blend文件中组装模型完成3D场景。然后即可在App Manager调用该文件，作为初始化Verge3D项目的基础。&lt;/p&gt;
&lt;p&gt;此外以团队协作的视角来看，通过在程序员和设计师之间分配责任，将提高团队的效率。这个神奇的工具既可用于快速原型制作，也可用于生产。&lt;/p&gt;
&lt;p&gt;需要注意的是，Puzzles项目的底层使用了three.js，物体之间的交互逻辑由js控制。所以一个使用python来控制逻辑的&lt;code&gt;.blend&lt;/code&gt;项目导入Puzzles后，python逻辑不生效。&lt;/p&gt;
&lt;p&gt;Puzzles是对blender内置的&lt;a href="https://docs.blender.org/manual/de/dev/game_engine/logic/sensors/introduction.html"&gt;逻辑编辑器&lt;/a&gt;的替代。&lt;/p&gt;
&lt;!--
# 灵感
佟
minecraft  blender
swift
边缘监测

制作地形
--&gt;

&lt;h1 id="blenderpython"&gt;Blender与Python&lt;/h1&gt;
&lt;p&gt;我们前头提到&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Blender使用Python语言来创作及制作游戏及工作自动化脚本。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Blender v2.79b携带的Python版本是3.5.3&lt;/p&gt;
&lt;p&gt;&lt;a href="https://cgmasters.net/free-tutorials/python-scripting/"&gt;这篇教程&lt;/a&gt;介绍了如何使用Python与Blender的内置的游戏引擎打交道，快速做一个游戏。文章里的代码直接可用(2012年的文章，可见其兼容性之好)&lt;/p&gt;
&lt;h3 id="python"&gt;安装python第三方库&lt;/h3&gt;
&lt;p&gt;由于Blender支持Python，所以我们可以把Blender接入到更广阔的世界中，让外部世界与Blender虚构的3维空间交互。&lt;/p&gt;
&lt;p&gt;在这个过程中我们可能需要安装一些第三方python库，下边是教程，演示如何安装&lt;code&gt;pyserial&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;参考&lt;a href="https://gist.github.com/csaudiodesign/3e243fbe284cc0c02270d4b8c455e3aa"&gt;Install packages for blender bundled python&lt;/a&gt;&lt;/p&gt;
&lt;!--
陀螺仪控制3D场景 microbit，都用python编程。只需要ws client就行，读取数据
--&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /Applications/Blender/blender.app/Contents/Resources/2.79/python
wget https://bootstrap.pypa.io/get-pip.py
./bin/python3.5m ./get-pip.py --prefix /Applications/Blender/blender.app/Contents/Resources/2.79/python
./bin/python3.5m bin/pip3 install pyserial
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;我近期会将Scratch3-adapter接入blender中！如此一来就建立了现实世界与虚拟世界的连接，你甚至可以和电影中的角色打交道。很多著名的电影都使用了blender来创作。&lt;/p&gt;
&lt;p&gt;一旦scratch3-adapter与Blender连接完成，你可以徒手创作minecraft中的世界(借助leapmotion，而minecraft的资源包社区里已经有了:&lt;a href="http://theduckcow.com/dev/blender/mcprep/"&gt;BLENDER MINECRAFT ADDON&lt;/a&gt;)。你也可以使用micro:bit制作的魔法棒与虚拟世界的哈利波特一决高下。&lt;/p&gt;
&lt;p&gt;我们之前的&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/gallery/"&gt;演示案例&lt;/a&gt;很快将延伸到虚拟世界中。&lt;/p&gt;
&lt;h3 id="python-api"&gt;python api&lt;/h3&gt;
&lt;p&gt;Blender相关的python API参考&lt;a href="https://docs.blender.org/api/current/"&gt;Python API&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;而BGE(Blender Game Engine)相关的api则参考:&lt;a href="https://docs.blender.org/manual/de/dev/game_engine/python_api/videotexture.html#first-example"&gt;game_engine&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# 移动名为Cube的对象的顶点&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;bpy&lt;/span&gt;
&lt;span class="n"&gt;bpy&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Cube&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vertices&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;co&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="mf"&gt;1.0&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;一个bge例子&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# car&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;bge&lt;/span&gt;
&lt;span class="n"&gt;cont&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bge&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;logic&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getCurrentController&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;own&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cont&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;owner&lt;/span&gt;
&lt;span class="n"&gt;move&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cont&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;actuators&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;move&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;pressup&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cont&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sensors&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;up&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;pressdown&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cont&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sensors&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;down&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;speed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;move&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dLoc&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;pressup&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;positive&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;speed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;speed&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mf"&gt;0.05&lt;/span&gt;
    &lt;span class="n"&gt;move&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dLoc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;speed&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;cont&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;activate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;move&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;pressdown&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;positive&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;speed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
    &lt;span class="n"&gt;cont&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deactivate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;move&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;move&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dLoc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;此外我写了一个简单的完整例子:&lt;a href="http://scratch3-files.just4fun.site/test_bge.blend"&gt;test_bge.blend&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="python_1"&gt;如何运行python脚本&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://docs.blender.org/api/current/info_overview.html#script-loading"&gt;Script Loading&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# alias blender=/Applications/Blender/blender.app/Contents/MacOS/blender
blender  --python my_script.py # 会打开新的blender窗口
# blender --python --help
blender --python a.py  test_bge.blend # 这种模式下blend编辑器里的输出会在命令行打印出来！
&lt;/pre&gt;&lt;/div&gt;


&lt;h1 id="_3"&gt;教程&lt;/h1&gt;
&lt;p&gt;在学习Blender的过程中，发现不少很不错的教程，记录如下:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=JYj6e-72RDs"&gt;Blender Beginner Tutorial - Part 1: User Interface&lt;/a&gt;: 主播生动有趣，十分推荐&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/mikepan/GameEngineBook"&gt;GameEngineBook&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://projects.raspberrypi.org/en/projects?software%5B%5D=blender"&gt;raspberrypi 3D&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="_4"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://projects.raspberrypi.org/en/projects?software%5B%5D=blender"&gt;raspberrypi 3D&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.blender.org/"&gt;www.blender.org&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/wiki/Blender"&gt;wikipedia Blender&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/mikepan/GameEngineBook"&gt;GameEngineBook&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.youtube.com/channel/UCSMOQeBJ2RAnuFungnQOxLg"&gt;youtube Blender&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://gist.github.com/csaudiodesign/3e243fbe284cc0c02270d4b8c455e3aa"&gt;Install packages for blender bundled python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Blend4Web&lt;ul&gt;
&lt;li&gt;&lt;a href="https://en.wikipedia.org/wiki/Blend4Web"&gt;wikipedia Blend4Web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/wiki/Blend4Web"&gt;wikipedia zh Blend4Web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/TriumphLLC/Blend4Web"&gt;github Blend4Web&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.soft8soft.com"&gt;Verge3D&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/zh-hans/Verge3D"&gt;wikipedia zh Verge3D&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://en.wikipedia.org/wiki/Verge3D"&gt;wikipedia Verge3D&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;NASA Switches from Blend4Web to Verge3D&lt;/li&gt;
&lt;li&gt;demo: NASA&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.soft8soft.com/blender-to-webgl-in-4-simple-steps/"&gt;BLENDER TO WEBGL IN 4 SIMPLE STEPS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=2SNQsWSRGsQ"&gt;Verge3D Puzzles Visual Logic&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/Soft8Soft"&gt;github.com/Soft8Soft&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.soft8soft.com/cn/verge3d/"&gt;Verge3D 中文&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.soft8soft.com/docs/#manual/introduction/Beginner-Guide"&gt;Beginner's Guide&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Puzzles，使用&lt;code&gt;python3 -m server&lt;/code&gt;在项目目录下可把包含html的项目跑起来&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.soft8soft.com/topic/some-questions-about-verge3d/"&gt;some-questions-about-verge3d&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.creativebloq.com/3d-tips/blender-tutorials-1232739"&gt;31 brilliant Blender tutorials&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://cgmasters.net/free-tutorials/python-scripting/"&gt;Python Scripting for the Blender Game Engine&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;bge&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/alabd14313/awesome-BGE"&gt;awesome-BGE&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://pymove3d.readthedocs.io/en/latest/stations/blender-game-engine/a_introduction.html"&gt;Starting the Blender Game Engine (BGE)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/wiki/Game_Blender"&gt;Game_Blender&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://armory3d.org/"&gt;armory3d&lt;/a&gt;: 3D Game Engine for Blender&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/armory3d/armory"&gt;github armory3d&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/a1studmuffin/SpaceshipGenerator"&gt;SpaceshipGenerator&lt;/a&gt;:  A Blender script to procedurally generate 3D spaceships&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/ptabriz/FOSS4G_workshop"&gt;FOSS4G_workshop&lt;/a&gt;: Real-time 3D visualization of geospatial data with Blender&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=JYj6e-72RDs"&gt;Blender Beginner Tutorial - Part 1: User Interface&lt;/a&gt;: 生动有趣，推荐！&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/MadMinstrel/blender-sculpt-tools"&gt;blender-sculpt-tools&lt;/a&gt;: Python addon streamlining some Blender tools for sculpting&lt;/li&gt;
&lt;li&gt;&lt;a href="https://sketchfab.com/"&gt;sketchfab&lt;/a&gt;:  publish &amp;amp; find 3D models online&lt;ul&gt;
&lt;li&gt;&lt;a href="https://sketchfab.com/models?date=week&amp;amp;features=downloadable&amp;amp;sort_by=-likeCount&amp;amp;type=models"&gt;sketchfab downloadable&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="https://sketchfab.com/models/578dae149c17402c97010ed848404f4a"&gt;Scacchiera Bosco&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://sketchfab.com/models/d0157e20709e45089c282b2db9145a4f"&gt;M3-GTS car&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://sketchfab.com/models/7ae4966708504f5c9e3cf2fad42476fc"&gt;V The Vbot&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://sketchfab.com/models/66c18ecd7a834d4a99dabc46b5ee6e4a"&gt;Low Poly Beach Assets&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://sketchfab.com/models/82b92dbcdb194235b6bfc54cb9b473f6"&gt;Otter T pose&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://sketchfab.com/models/b275000eacf24b1e96747e940a26a377"&gt;Hatsune Miku&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://sketchfab.com/models/cbcf188a01f54d63a10f10c227c5a6ff?ref=related"&gt;Tiki Treasure&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://sketchfab.com/models/7ae818dc56be44de88cdf5f4845ec0ee"&gt;Elephant Rhino Bear&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="http://theduckcow.com/dev/blender/mcprep/"&gt;BLENDER MINECRAFT ADDON&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.rymdnisse.net/download/blender-rigs/minecraft-blender-rig/"&gt;Minecraft Blender Rig&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://orange.blender.org/"&gt;orange.blender.org&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/wiki/Yo_Frankie!"&gt;鼯鼠弗兰基（Yo Frankie!，代号 Apricot）&lt;/a&gt; : 开源动作游戏,使用 Python作为脚本语言&lt;/li&gt;
&lt;li&gt;&lt;a href="https://durian.blender.org/"&gt;sintel project&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://docs.blender.org/manual/de/dev/game_engine/logic/sensors/introduction.html"&gt;game_engine&lt;/a&gt;: game_engine提供很多逻辑砖，它们在逻辑编辑器里，逻辑关联到实体。和node-red很像。&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blenderartists.org/t/running-background-jobs-with-asyncio/673805"&gt;Running background jobs with Asyncio&lt;/a&gt;
&lt;!--对软件的学习通过开源图书，项目的学习通过树莓派--&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Wed, 26 Sep 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-09-26:blockly-3D.html</guid><category>工具</category></item><item><title>scratch3-adapter接入优必选Alpha系列机器人</title><link>/scratch3-adapter-ubtrobot.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/ubtrobot_b39dca67.png" /&gt;&lt;/p&gt;
&lt;p&gt;近期在&lt;a href="https://codelab-adapter-docs.codelab.club"&gt;scratch3-adapter&lt;/a&gt;中加入了优必选Alpha系列机器人的驱动，于是我们可以在scratch3.0中为优必选Alpha系列机器人编程&lt;/p&gt;
&lt;video width=400px src="http://scratch3-files.just4fun.site/1537510098140.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;我们近期的另一项工作是在scratch3.0中加入课程模式(类似code.org), 之后使用scratch3-adapter + scratch3.0就可以在web中教学机器人、AI和物联网，不损失web带来的好处(瘦客户端、跨平台、记录学习情况)，又能与身边的硬件互动。&lt;/p&gt;
&lt;p&gt;&lt;img witdh=700 src="http://wwj-fig-bed.just4fun.site/scratch3-course_5a67bb0b.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img witdh=700 src="http://wwj-fig-bed.just4fun.site/scratch-course_8b040b52.png" /&gt;&lt;/p&gt;
&lt;p&gt;当然我更期待官方的microworld，等官方推出microworld，我到时候会将硬件整合进microworld。&lt;/p&gt;
&lt;p&gt;考虑到优必选目前只对合作伙伴公开蓝牙通信协议，所以我们暂不公开这部分的驱动代码。待将来优必选公开蓝牙协议的细节后，这部分的源码也将开放给大家。&lt;/p&gt;
&lt;p&gt;目前我们已经给出了移除协议细节之后的源码:&lt;a href="https://github.com/Scratch3Lab/scratch3_adapter_extensions/blob/master/extension_ubtrobot.py"&gt;extension_ubtrobot.py&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;在此记录一些思路和开发笔记。&lt;/p&gt;
&lt;h3 id="_1"&gt;机器人的驱动&lt;/h3&gt;
&lt;p&gt;为了在scratch3.0中使用积木为优必选Alpha系列机器人编程，我们需要先在&lt;a href="https://codelab-adapter-docs.codelab.club"&gt;scratch3-adapter&lt;/a&gt;构建插件，与机器人通信。&lt;/p&gt;
&lt;p&gt;我们先来看一下&lt;a href="https://codelab-adapter-docs.codelab.club"&gt;scratch3-adapter&lt;/a&gt;的架构图&lt;/p&gt;
&lt;p&gt;&lt;img width=700 src="http://wwj-tmp-video2.just4fun.site/%E6%8F%92%E4%BB%B6%E7%B3%BB%E7%BB%9F.png" /&gt;&lt;/p&gt;
&lt;p&gt;优必选Alpha系列机器人对外暴露蓝牙接口。从上边的架构图看出，&lt;a href="https://codelab-adapter-docs.codelab.club"&gt;scratch3-adapter&lt;/a&gt;允许开发者自定义任何的通信方式，无论是蓝牙(BT/BLE)、usb还是wifi。&lt;/p&gt;
&lt;p&gt;优必选Alpha系列机器人内置的是蓝牙串口服务，在Mac和windows(win10/win7)上，当电脑与机器人建立蓝牙连接之后，在本地都会虚拟出蓝牙串口。之后在自定义插件中使用pyserial与之交互即可。&lt;/p&gt;
&lt;p&gt;但值得注意的是，树莓派(Linux)上的操作方式并不一样，在linux下，建议先安装blueman来管理蓝牙。连接机器人时，选择serial port模式，之后会虚拟出&lt;code&gt;/dev/rfcomm*&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;由于不同操作系统的蓝牙略有差异，建议使用&lt;code&gt;platform.system()&lt;/code&gt;来区分不同平台(Darwin/Windows/Linux)&lt;/p&gt;
&lt;h3 id="_2"&gt;多个控制端&lt;/h3&gt;
&lt;p&gt;近期我们在做一个实验室解决方案，一个实验桌有多位学生，共同控制一个机器人，这是n-1架构。同时希望学生端可以同时使用ipad和电脑同时控制机器人。&lt;/p&gt;
&lt;p&gt;我们的解决方案是让&lt;a href="https://codelab-adapter-docs.codelab.club"&gt;scratch3-adapter&lt;/a&gt;跑在树莓派中，对外提供服务，之后scratch3.0与树莓派交互。而学生在浏览器中与运行在树莓派里的&lt;a href="https://codelab-adapter-docs.codelab.club"&gt;scratch3-adapter&lt;/a&gt;交互，如此一来，就实现了n个学生共同控制一台机器人。&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;2019.1.21更新&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;目前优必选已经将alpha1系列机器人的&lt;a href="http://downloads.ubtrobot.com/"&gt;蓝牙协议&lt;/a&gt;开放了, 如我们之前承诺的，我们的extension的源码也开源出来了: &lt;a href="https://github.com/Scratch3Lab/scratch3_adapter_extensions/blob/master/extension_ubtrobot.py"&gt;extension_ubtrobot.py&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Alpha 1同时支持ble和bt，所以现在可以做到一个client同时控制多台机器人。就是说可以实现同时跳舞的功能。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Thu, 20 Sep 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-09-20:scratch3-adapter-ubtrobot.html</guid><category>scratch</category></item><item><title>scratch3-adapter重构笔记</title><link>/scratch3-adapter-refactoring-note.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/adapter_47fb79f2.png" /&gt;&lt;/p&gt;
&lt;p&gt;近期在重构&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;,目前的最新版本是0.1.1, 我们计划在10月份发布0.2.0&lt;/p&gt;
&lt;p&gt;这次重构带来的改变包括:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;本地SSL安全证书&lt;/li&gt;
&lt;li&gt;引入&lt;a href="https://github.com/pavlov99/json-rpc"&gt;json-rpc&lt;/a&gt;，鼓励开发者使用json-rpc简化插件的开发&lt;/li&gt;
&lt;li&gt;引入&lt;a href="https://scratch.mit.edu/microbit"&gt;Scratch Link&lt;/a&gt;模式（目前scratch3-adapter在开发模式下允许切换为Scratch Link模式，与官方Scratch Link保持相同的架构，官方暂未开放Scratch Link，我做了逆向分析。）&lt;/li&gt;
&lt;li&gt;允许在GUI面板上启停插件&lt;/li&gt;
&lt;li&gt;发布不同平台的安装包(exe/dmg/Python package)&lt;ul&gt;
&lt;li&gt;在跨平台软件分发这块，很多地方参考了&lt;a href="https://github.com/mu-editor/mu"&gt;mu&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;在插件方面，添加了优必选alpha系列机器人的支持&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="_1"&gt;缘起&lt;/h1&gt;
&lt;p&gt;近期使用官方七月底发布的&lt;a href="https://scratch.mit.edu/microbit"&gt;Scratch Link&lt;/a&gt;，我很喜欢这个软件，对它做了不少分析，&lt;a href="https://scratch.mit.edu/microbit"&gt;Scratch Link&lt;/a&gt;有许多聪明的设计，准备把这些好的主意移植到scratch3-adapter上。当然也有一些我们不喜欢的地方，我们准备做些有趣的探索和调整。&lt;/p&gt;
&lt;h1 id="_2"&gt;目标&lt;/h1&gt;
&lt;p&gt;此次重构的主要目标是提升软件易用性，&lt;a href="https://github.com/mu-editor/mu"&gt;mu&lt;/a&gt;和&lt;a href="https://scratch.mit.edu/microbit"&gt;Scratch Link&lt;/a&gt;在易用性方面都做得非常好，这两个软件是我们主要的学习对象。&lt;/p&gt;
&lt;h1 id="_3"&gt;重大变更&lt;/h1&gt;
&lt;p&gt;下边记录重构前后，发生的一些大的变更&lt;/p&gt;
&lt;h3 id="ssl"&gt;本地SSL安全证书&lt;/h3&gt;
&lt;p&gt;我在&lt;a href="https://blog.just4fun.site/scratch3-plugin-2.html"&gt;为Scratch3.0设计的插件系统(下篇)&lt;/a&gt;中描述了&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;的架构设计，其中提到:scratch3-adapter中包含了一个websocket-server&lt;/p&gt;
&lt;p&gt;逆向分析&lt;a href="https://scratch.mit.edu/microbit"&gt;Scratch Link&lt;/a&gt;可以看到，它内部也包含了一个websocket-server，使用的是&lt;a href="https://github.com/Building42/Telegraph"&gt;Telegraph&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;当我们从https网站访问本地websocket-server服务时，如果本地websocket-server服务没有采用SSL安全证书，会给用户增加操作步骤(需要用户确认继续访问)，体验不够友好，问题的描述和解决方案我都写在&lt;a href="https://blog.just4fun.site/localhost-https-ssl.html"&gt;本地https/wss服务与SSL安全证书&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="json-rpc"&gt;引入&lt;a href="https://github.com/pavlov99/json-rpc"&gt;json-rpc&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;scratch3-adapter受&lt;a href="https://zh.wikipedia.org/wiki/%E6%A9%9F%E5%99%A8%E4%BA%BA%E4%BD%9C%E6%A5%AD%E7%B3%BB%E7%B5%B1"&gt;ROS&lt;/a&gt;影响很深,ROS本质上是一个消息系统。&lt;/p&gt;
&lt;p&gt;我很喜欢Smalltalk的设计原则中的这条:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;计算应该被视为可通过发送消息来统一调用的对象的内在功能。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Scratch的&lt;a href="https://github.com/LLK/Scratch_1.4"&gt;第一个版本&lt;/a&gt;由Smalltalk的方言Squeak写成，受Smalltalk影响极深。可以看到Scratch3.0依然保持着这条设计原则。&lt;/p&gt;
&lt;p&gt;我希望scratch3-adapter能延续Smalltalk的设计原则。所以消息会一直作为核心要素。&lt;/p&gt;
&lt;p&gt;我相信这条原则是scratch3-adapter达成它的目标&lt;code&gt;将万物积木化&lt;/code&gt;的核心所在。&lt;/p&gt;
&lt;p&gt;但原始的消息对于大多开发者来说，可能过于原始了，所以我们决定学习&lt;a href="https://scratch.mit.edu/microbit"&gt;Scratch Link&lt;/a&gt;，在消息之上抽象出RPC，方便开发者写自定义的插件。当然这个特性是可选的，是否使用json-rpc由开发者自行决定。我原本计划在消息之上添加自定义协议，后来发现json-rpc就是我想要的，所以就不重造轮子了。&lt;/p&gt;
&lt;h3 id="scratch-link"&gt;&lt;a href="https://scratch.mit.edu/microbit"&gt;Scratch Link&lt;/a&gt;模式&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://scratch.mit.edu/microbit"&gt;Scratch Link&lt;/a&gt;本身非常简单，我大约使用100代码实现了它的功能。这部分作为&lt;a href="https://scratch.mit.edu/microbit"&gt;Scratch Link&lt;/a&gt;模式，开发模式下可以启用，&lt;a href="https://scratch.mit.edu/microbit"&gt;Scratch Link&lt;/a&gt;模式很简单，不包含ZeroMQ，它的核心是&lt;code&gt;websocket-server&lt;/code&gt; + &lt;code&gt;json-rpc&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;我们来演示scratch3-adapter的&lt;a href="https://scratch.mit.edu/microbit"&gt;Scratch Link&lt;/a&gt;模式下，如何完美替代官方的Scratch Link。&lt;/p&gt;
&lt;p&gt;我们让scratch3-adapter模拟成Scratch Link，欺骗前端说它已经搜索到了micro:bit。实际上我们连电脑的蓝牙都没打开。&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/adapter-link_2aa33dd6.png" width=800 /&gt;&lt;/p&gt;
&lt;p&gt;接着让我们点击连接，再次成功骗过前端&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/adapter-link_08a8898f.png" width=800 /&gt;&lt;/p&gt;
&lt;p&gt;我比较坚持引入ZeroMQ，所以scratch3-adapter默认不采用Scratch Link模式,而将ZeroMQ作为架构的核心部分(默认模式)。对于异步任务、分布式组件、协同控制，ZeroMQ都能帮上大忙。ZeroMQ会让scratch3-adapter极为灵活，如果之后要引入复杂的机器人、AI、飞行器矩阵，ZeroMQ会让这些事变得简单。我希望提供一个强大、灵活而开放的架构。&lt;/p&gt;
&lt;p&gt;jupyter架构的核心元素之一便是ZeroMQ，jupyter如此健壮的原因之一便是ZeroMQ。我在&lt;a href="https://blog.just4fun.site/jupyter-notebook-architecture.html"&gt;jupyter notebook架构分析&lt;/a&gt;做了讨论&lt;/p&gt;
&lt;h3 id="gui"&gt;允许在GUI面板上启停插件&lt;/h3&gt;
&lt;p&gt;重写了插件管理系统，支持线程管理。于是可以在GUI面板上随意启停插件。而不必反复重启软件&lt;/p&gt;
&lt;h3 id="_4"&gt;软件安装包&lt;/h3&gt;
&lt;p&gt;为了让软件更加易于使用，我们决定提供各个平台的安装包,windows下为exe，macOS下为dmg，linux下可以选择python package或者打包好的软件。&lt;/p&gt;
&lt;p&gt;这部分主要学习了&lt;a href="https://github.com/mu-editor/mu"&gt;mu-editor&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="_5"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/localhost-https-ssl.html"&gt;本地https/wss服务与SSL安全证书&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/scratch3-microbit-analysis.html"&gt;分析scratch3.0与micro:bit的通信&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter docs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/mu-editor/mu"&gt;mu&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/mu-editor/mu/blob/43bb9f8bb5af177fb5fac05e25bade16c14c758a/docs/packaging.rst"&gt;Packaging Mu&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Sun, 16 Sep 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-09-16:scratch3-adapter-refactoring-note.html</guid><category>scratch</category></item><item><title>本地https/wss服务与SSL安全证书</title><link>/localhost-https-ssl.html</link><description>&lt;h1 id="_1"&gt;前言&lt;/h1&gt;
&lt;p&gt;我之前在&lt;a href="https://blog.just4fun.site/scratch3-microbit-analysis.html"&gt;分析scratch3.0与micro:bit的通信&lt;/a&gt;提到&lt;code&gt;https校验问题&lt;/code&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;由于网站都逐渐过渡到https，而Scratch Link是个本地websocker server，要让Scratch Link与浏览器通信，需要使用wss协议。而本地websocker server采用openssl本地自生成的证书的话，浏览器要让用户在一个新页面里点击高级设置才行，体验很不友好.&lt;br /&gt;
scratch团队的解决方案十分聪明, 让&lt;code&gt;device-manager.scratch.mit.edu&lt;/code&gt;这个域名指向&lt;code&gt;127.0.0.1&lt;/code&gt;，websocker server就可以使用这个域名的证书。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我觉得这个机制对大多数在本地提供https/wss服务的软件都有用，于是写篇文章将讨论如何实现Scratch Link的本地证书机制&lt;/p&gt;
&lt;h1 id="_2"&gt;问题的一般形式&lt;/h1&gt;
&lt;p&gt;这个问题极具一般性，我们先抛开Scratch Link，来描述下它的一般形式。&lt;/p&gt;
&lt;p&gt;你在本地写了一个软件(native application)，软件内跑了一个本地的https/wss服务。https要求ssl证书，于是你使用openssl生成了本地证书。当你在浏览器中访问https/wss服务时，浏览器会阻止你访问https/wss服务，并提醒你存在安全问题，直到你点击下图的所示的地方，才能继续访问https/wss服务。&lt;/p&gt;
&lt;p&gt;&lt;img width="600px" src="http://wwj-fig-bed.just4fun.site/https_1c8478da.png"&gt;&lt;/p&gt;
&lt;h1 id="_3"&gt;解决方案&lt;/h1&gt;
&lt;p&gt;这个问题相信大多数开发者都遇见过。社区里也出了一些解决方案：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/FiloSottile/mkcert"&gt;mkcert&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://letsencrypt.org/docs/certificates-for-localhost/"&gt;certificates-for-localhost&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;前头的两个解决方案最具代表性，但面向的都是开发者，本质上是修改了本地的系统配置。对于普通用户并不理想。&lt;/p&gt;
&lt;p&gt;所以我们将给出一个面向普通用户的解决方案。&lt;/p&gt;
&lt;p&gt;思路其实很简单:  使用你的域名申请到安全证书，申请到证书后，将证书放在本地软件里，用于本地的https/wss服务，将证书对应的域名指向&lt;code&gt;127.0.0.1&lt;/code&gt;&lt;/p&gt;
&lt;h1 id="_4"&gt;操作步骤&lt;/h1&gt;
&lt;p&gt;我们接着来详细描述操作细节。&lt;/p&gt;
&lt;p&gt;我选择从&lt;a href="https://letsencrypt.org/"&gt;Let's Encrypt&lt;/a&gt;获得证书&lt;/p&gt;
&lt;p&gt;Let's Encrypt的使用方法可以参考:&lt;a href="https://blog.just4fun.site/https-note.html"&gt;使用Let’s Encrypt(certbot)为你的网站生成免费的 SSL 证书&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;完成上文的操作我们就获得了Let’s Encrypt为我们网站颁发的证书，证书位置在形如&lt;code&gt;/etc/letsencrypt/live/xxx.example.com/&lt;/code&gt;的目录里。接着我们将证书从服务器拷贝出来，放到本地软件里，用于本地的https/wss服务。举例来说，我使用python-socketio提供https/wss服务，我的配置为&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;on_startup&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;start_background_tasks&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;use_ssl&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;ssl_context&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ssl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SSLContext&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ssl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PROTOCOL_SSLv23&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;ssl_context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_default_verify_paths&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;ssl_context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;load_cert_chain&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;resource_path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;./cert.pem&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;resource_path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;./privkey.pem&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
        &lt;span class="n"&gt;web&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run_app&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;SOCKET_SERVER_HOST&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;SOCKET_SERVER_PORT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;ssl_context&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ssl_context&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;web&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run_app&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;SOCKET_SERVER_HOST&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;SOCKET_SERVER_PORT&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;配置好后重启本地软件，可以看到Chrome已经信任本地的https/wss服务了！&lt;/p&gt;
&lt;p&gt;&lt;img width="600px" src="http://wwj-fig-bed.just4fun.site/https_231c8629.png"&gt;&lt;/p&gt;
&lt;p&gt;接下来我们来讨论一些细节问题。&lt;/p&gt;
&lt;h3 id="_5"&gt;安全提醒&lt;/h3&gt;
&lt;p&gt;我不建议不要将通配符证书打包在本地软件中，万一加密过程没做好，证书泄漏，容易造成安全问题，具体可能造成的风险参考:&lt;a href="https://www.zhihu.com/question/50486404"&gt;域名的SSL证书泄漏对网站的安全性影响大吗？&lt;/a&gt;，主要的风险是攻击者可以利用受信任的证书发起中间人攻击，获取到用户的数据。&lt;/p&gt;
&lt;p&gt;所以我单独为一个二级域名申请证书，只用于&lt;code&gt;127.0.0.1&lt;/code&gt;,如此一来，即便不加密证书，也不会造成大问题。但加密总归是好的。&lt;/p&gt;
&lt;h3 id="_6"&gt;证书更新&lt;/h3&gt;
&lt;p&gt;由&lt;code&gt;Let's Encrypt&lt;/code&gt;颁发的证书，有效期是3个月，离过期还有30天以内可以renew证书。我们每三个月在服务器上更新证书自然不成问题，但如何同步更新用户机器上的证书呢，我的建议是在软件上做自动更新功能，定期去同步服务器上的证书。&lt;/p&gt;
&lt;p&gt;当然也可以定期更新软件本身, 我目前使用Pyinstaller来跨平台打包应用程序。所以可以选择&lt;a href="https://github.com/JMSwag/PyUpdater"&gt;PyUpdater&lt;/a&gt;来自动更新软件。&lt;/p&gt;
&lt;p&gt;如果你觉得太麻烦，可以考虑购买一个长期的安全证书。&lt;/p&gt;
&lt;h3 id="_7"&gt;如何调试&lt;/h3&gt;
&lt;p&gt;如果我们在Chrome中已经同意继续前往&lt;code&gt;127.0.0.1&lt;/code&gt;,短期内刷新，Chrome就不会再做安全提醒，我们要确定新的安全证书是否生效，需要&lt;code&gt;重新启用警告功能&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img width="600px" src="http://wwj-fig-bed.just4fun.site/https_0fe5e391.png"&gt;&lt;/p&gt;
&lt;h1 id="_8"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/scratch3-microbit-analysis.html"&gt;分析scratch3.0与micro:bit的通信&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;scratch3_adapter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/FiloSottile/mkcert"&gt;mkcert&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://letsencrypt.org/docs/certificates-for-localhost/"&gt;certificates-for-localhost&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.zhihu.com/question/50486404"&gt;域名的SSL证书泄漏对网站的安全性影响大吗？&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Mon, 03 Sep 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-09-03:localhost-https-ssl.html</guid><category>scratch</category></item><item><title>Scratch3.0自定义插件注意事项之令牌桶算法</title><link>/scratch-extension-token-bucket.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/bucket_df323db8.png" /&gt;&lt;/p&gt;
&lt;h1 id="_1"&gt;前言&lt;/h1&gt;
&lt;p&gt;我们之前在&lt;a href="https://blog.just4fun.site/Hardware-Programming-style.html"&gt;两种硬件编程风格的比较&lt;/a&gt;中提到:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;在少儿编程/硬件编程教育领域，硬件编程有两种风格，我将这两种风格分别称为灌入式和交互式&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在上述文章里，我试图论述了,对少儿编程教育而言，为何交互式编程优于灌入式编程。&lt;/p&gt;
&lt;p&gt;如果我们按照Scratch的设计风格，那么拓展Scratch，使其与硬件交互的插件一定是交互式的。Scratch大量采用了Smalltalk的设计原则，这些原则包括:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果一个系统要服务于创造精神，那么对于一个人来说，它必须是完全可以理解的。&lt;/li&gt;
&lt;li&gt;系统应该用最少的且不可更改的部件构建; 这些部分应尽可能一般化; 系统的所有部分都应保持在统一的框架内。&lt;/li&gt;
&lt;li&gt;计算应该被视为可通过发送消息来统一调用的对象的内在功能。&lt;/li&gt;
&lt;li&gt;语言应围绕一个强大的隐喻设计，这样就可以统一应用于所有领域。&lt;/li&gt;
&lt;li&gt;用户可以访问的每个组件都应该能够以有意义的方式呈现自己，以便于用户进行观察和操作。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这些原则，我们之后有时间再细说，单独提一下第三点:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;计算应该被视为可通过发送消息来统一调用的对象的内在功能。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这一点指出了消息通信在Scratch所占据的核心位置，我之前构建&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;就主要围绕这条原则。我相信这点是Smalltalk留给Scratch的重要遗产，是Scratch如此灵活强大的原因，也是理解和写出复杂的Scratch程序的核心所在&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/LLK/Scratch_1.4"&gt;第一代的Scratch&lt;/a&gt;就是用Smalltalk的方言Squeak写的，尽管Scratch经过2次的重写，最新的一代已经从Squeak迁移到了JavaScript，但设计原则上并没有发生变化。&lt;/p&gt;
&lt;p&gt;所以我坚持Scratch的插件都应该遵循这些原则。如果Scratch3.0的硬件插件是灌入式的（目前国内不少公司确实在这样做），系统的所有部分将无法保持在统一的框架内。&lt;/p&gt;
&lt;h1 id="_2"&gt;交互式存在的问题&lt;/h1&gt;
&lt;p&gt;如果我们同意了Scratch插件应该采用交互式风格来写，并且以message为中心（官方团队目前都是这么做的，但他们在消息之上很聪明地抽象出了一层:远程调用）&lt;/p&gt;
&lt;p&gt;那么我们就需要解决消息通信类系统固有的一些问题，典型的问题之一就是消息发送速率&lt;/p&gt;
&lt;p&gt;在通信系统中，我们需要控制发送数据的速率，如果速率太高，可能带来许多问题，诸如带宽不足，或者服务端无法应对意料之外的高频消息，诸如社区里在使用官方的wedo插件时就遇到了:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/LLK/scratch-vm/issues/1531"&gt;Wedo2 sometimes drops commands&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/LLK/scratch-vm/issues/1523"&gt;WeDo2 motor blocks do not work correctly with two motors plugged in&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;消息发送速率问题当然有很多解决方案，在ZeroMQ中，框架内可以帮我们处理这个问题，诸如让消息在接受者一端排队，当消息高于设置水位之后，自动丢弃。&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;采用了ZeroMQ，所以这个问题可以通过简单配置来解决。&lt;/p&gt;
&lt;p&gt;但scratch团队的&lt;a href="https://scratch.mit.edu/wedo"&gt;Scratch Link&lt;/a&gt;并未采用ZeroMQ，所以他们选择手写&lt;code&gt;令牌桶算法&lt;/code&gt;(token bucket)来实现&lt;code&gt;速率限制（Rate Limiting）&lt;/code&gt;。&lt;/p&gt;
&lt;h1 id="token-bucket"&gt;&lt;a href="https://en.wikipedia.org/wiki/Token_bucket"&gt;令牌桶算法(token bucket)&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;令牌桶算法是速率限制（Rate Limiting）中最常使用的一种算法。&lt;/p&gt;
&lt;p&gt;令牌桶算法基于令牌桶中是否存在令牌来指示什么时候可以发送数据。如果桶中存在令牌，则允许发送数据；反之，则不允许。&lt;/p&gt;
&lt;p&gt;图示如下:&lt;/p&gt;
&lt;p&gt;&lt;img width=300 src="http://wwj-fig-bed.just4fun.site/tokenbucket_b8e36c38.png" /&gt;&lt;/p&gt;
&lt;h3 id="_3"&gt;算法&lt;/h3&gt;
&lt;p&gt;令牌桶算法在概念上表述如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果设置的平均发送速率为r，那么令牌以1/r秒的速率添加到桶中。&lt;/li&gt;
&lt;li&gt;假设桶最多可存b个令牌。如果令牌在桶已满时到达，则将其丢弃。&lt;/li&gt;
&lt;li&gt;当n个数据包到达时，从令牌桶中取出(删除)n个令牌，同时将数据包被发送出去。如果令牌不够，则数据不发送。&lt;ul&gt;
&lt;li&gt;它们可以被丢弃；也可以排放在队列中以便当桶中累积了足够多的令牌时再发送；&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;由于在此我们主要关心数据包数量，而不考虑不讨论具体数据大小，所以我们暂不讨论流量问题。&lt;/p&gt;
&lt;h1 id="_4"&gt;算法实现&lt;/h1&gt;
&lt;h3 id="python"&gt;Python实现&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;TokenBucket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;An implementation of the token bucket algorithm.&lt;/span&gt;

&lt;span class="sd"&gt;    &amp;gt;&amp;gt;&amp;gt; bucket = TokenBucket(80, 0.5)&lt;/span&gt;
&lt;span class="sd"&gt;    &amp;gt;&amp;gt;&amp;gt; print bucket.consume(10)&lt;/span&gt;
&lt;span class="sd"&gt;    True&lt;/span&gt;
&lt;span class="sd"&gt;    &amp;gt;&amp;gt;&amp;gt; print bucket.consume(90)&lt;/span&gt;
&lt;span class="sd"&gt;    False&lt;/span&gt;
&lt;span class="sd"&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tokens&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fill_rate&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;tokens is the total tokens in the bucket. fill_rate is the&lt;/span&gt;
&lt;span class="sd"&gt;        rate in tokens/second that the bucket will be refilled.&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;capacity&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;float&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tokens&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_tokens&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;float&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tokens&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fill_rate&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;float&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fill_rate&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timestamp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;consume&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tokens&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Consume tokens from the bucket. Returns True if there were&lt;/span&gt;
&lt;span class="sd"&gt;        sufficient tokens otherwise False.&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;tokens&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tokens&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_tokens&lt;/span&gt; &lt;span class="o"&gt;-=&lt;/span&gt; &lt;span class="n"&gt;tokens&lt;/span&gt;
        &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_tokens&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_tokens&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;capacity&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;now&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
            &lt;span class="n"&gt;delta&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fill_rate&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timestamp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_tokens&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;min&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;capacity&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_tokens&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;delta&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timestamp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;now&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_tokens&lt;/span&gt;
    &lt;span class="n"&gt;tokens&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;property&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;get_tokens&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;我们来对它进行测试:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vm"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;__main__&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;bucket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;TokenBucket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;tokens = &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;bucket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_tokens&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;consume(10) = &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;bucket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;consume&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;consume(10) = &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;bucket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;consume&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;tokens = &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;bucket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_tokens&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;tokens = &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;bucket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_tokens&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;consume(90) = &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;bucket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;consume&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;90&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;tokens = &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;bucket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_tokens&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;consume(90) = &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;bucket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;consume&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;90&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;tokens = &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;bucket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_tokens&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;输出为:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;➜  /tmp python token_bucket.py
tokens = 80.0
consume(10) = True
consume(10) = True
tokens = 61.0040922165
tokens = 62.0080561638
consume(90) = False
tokens = 62.0081322193
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="scratch3_wedo2-extension"&gt;scratch3_wedo2 extension的实现&lt;/h3&gt;
&lt;p&gt;我们来看看scratch官方的实现（包含在&lt;a href="https://github.com/LLK/scratch-vm/pull/1540"&gt;这次提交&lt;/a&gt;中）&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;Timer&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;require&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;../util/timer&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="kr"&gt;class&lt;/span&gt; &lt;span class="nx"&gt;RateLimiter&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="cm"&gt;/**&lt;/span&gt;
&lt;span class="cm"&gt;     * A utility for limiting the rate of repetitive send operations, such as&lt;/span&gt;
&lt;span class="cm"&gt;     * bluetooth messages being sent to hardware devices. It uses the token bucket&lt;/span&gt;
&lt;span class="cm"&gt;     * strategy: a counter accumulates tokens at a steady rate, and each send costs&lt;/span&gt;
&lt;span class="cm"&gt;     * a token. If no tokens remain, it&amp;#39;s not okay to send.&lt;/span&gt;
&lt;span class="cm"&gt;     * @param {number} maxRate the maximum number of sends allowed per second&lt;/span&gt;
&lt;span class="cm"&gt;     * @constructor&lt;/span&gt;
&lt;span class="cm"&gt;     */&lt;/span&gt;
    &lt;span class="nx"&gt;constructor&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;maxRate&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="cm"&gt;/**&lt;/span&gt;
&lt;span class="cm"&gt;         * The maximum number of tokens.&lt;/span&gt;
&lt;span class="cm"&gt;         * @type {number}&lt;/span&gt;
&lt;span class="cm"&gt;         */&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_maxTokens&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;maxRate&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

        &lt;span class="cm"&gt;/**&lt;/span&gt;
&lt;span class="cm"&gt;         * The interval in milliseconds for refilling one token. It is calculated&lt;/span&gt;
&lt;span class="cm"&gt;         * so that the tokens will be filled to maximum in one second.&lt;/span&gt;
&lt;span class="cm"&gt;         * @type {number}&lt;/span&gt;
&lt;span class="cm"&gt;         */&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_refillInterval&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1000&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="nx"&gt;maxRate&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

        &lt;span class="cm"&gt;/**&lt;/span&gt;
&lt;span class="cm"&gt;         * The current number of tokens in the bucket.&lt;/span&gt;
&lt;span class="cm"&gt;         * @type {number}&lt;/span&gt;
&lt;span class="cm"&gt;         */&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_count&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_maxTokens&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;


        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_timer&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Timer&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_timer&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;start&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;

        &lt;span class="cm"&gt;/**&lt;/span&gt;
&lt;span class="cm"&gt;         * The last time in milliseconds when the token count was updated.&lt;/span&gt;
&lt;span class="cm"&gt;         * @type {number}&lt;/span&gt;
&lt;span class="cm"&gt;         */&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_lastUpdateTime&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_timer&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;timeElapsed&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="cm"&gt;/**&lt;/span&gt;
&lt;span class="cm"&gt;     * Check if it is okay to send a message, by updating the token count,&lt;/span&gt;
&lt;span class="cm"&gt;     * taking a token and then checking if we are still under the rate limit.&lt;/span&gt;
&lt;span class="cm"&gt;     * @return {boolean} true if we are under the rate limit&lt;/span&gt;
&lt;span class="cm"&gt;     */&lt;/span&gt;
    &lt;span class="nx"&gt;okayToSend&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="c1"&gt;// Calculate the number of tokens to refill the bucket with, based on the&lt;/span&gt;
        &lt;span class="c1"&gt;// amount of time since the last refill.&lt;/span&gt;
        &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;now&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_timer&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;timeElapsed&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
        &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;timeSinceRefill&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;now&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_lastUpdateTime&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;refillCount&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;Math&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;floor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;timeSinceRefill&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_refillInterval&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

        &lt;span class="c1"&gt;// If we&amp;#39;re adding at least one token, reset _lastUpdateTime to now.&lt;/span&gt;
        &lt;span class="c1"&gt;// Otherwise, don&amp;#39;t reset it so that we can continue measuring time until&lt;/span&gt;
        &lt;span class="c1"&gt;// the next refill.&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;refillCount&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_lastUpdateTime&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;now&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;

        &lt;span class="c1"&gt;// Refill the tokens up to the maximum&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_count&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;Math&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;min&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_maxTokens&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_count&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;refillCount&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

        &lt;span class="c1"&gt;// If we have at least one token, use one, and it&amp;#39;s okay to send.&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_count&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_count&lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nx"&gt;module&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;exports&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;RateLimiter&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;a href="https://github.com/LLK/scratch-vm/blob/769156c9af416430c5e0cc20621471d2b99fde43/test/unit/util_rateLimiter.js"&gt;测试用例&lt;/a&gt;为:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;test&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;require&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;tap&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;test&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;RateLimiter&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;require&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;../../src/util/rateLimiter.js&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
 &lt;span class="nx"&gt;test&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;rate limiter&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;t&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;rate&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;30&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;limiter&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;RateLimiter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;rate&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
     &lt;span class="c1"&gt;// The rate limiter starts with a number of tokens equal to the max rate&lt;/span&gt;
    &lt;span class="nx"&gt;t&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;equal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;limiter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_count&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;rate&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
     &lt;span class="c1"&gt;// Running okayToSend rate times uses up all of the tokens&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;let&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="nx"&gt;rate&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;t&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;limiter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;okayToSend&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;
        &lt;span class="nx"&gt;t&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;equal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;limiter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_count&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;rate&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="nx"&gt;t&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;limiter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;okayToSend&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;
     &lt;span class="c1"&gt;// After a delay of one second divided by the max rate, we should have exactly&lt;/span&gt;
    &lt;span class="c1"&gt;// one more token to use.&lt;/span&gt;
    &lt;span class="nx"&gt;setTimeout&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;t&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;limiter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;okayToSend&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;
        &lt;span class="nx"&gt;t&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;limiter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;okayToSend&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;
        &lt;span class="nx"&gt;t&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;end&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
    &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="mi"&gt;1000&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="nx"&gt;rate&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="scratchratelimiter"&gt;使用scratch官方的RateLimiter&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;// const RateLimiter = require(&amp;#39;../../util/rateLimiter.js&amp;#39;);&lt;/span&gt;
&lt;span class="c1"&gt;// this._rateLimiter = new RateLimiter(30);&lt;/span&gt;

    &lt;span class="nx"&gt;_send&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;uuid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;message&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getPeripheralIsConnected&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;Promise&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;resolve&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;

        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_rateLimiter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;okayToSend&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;Promise&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;resolve&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;

        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_ble&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;UUID&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;IO_SERVICE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;uuid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;message&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;base64&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在&lt;a href="https://github.com/LLK/scratch-vm/blob/769156c9af416430c5e0cc20621471d2b99fde43/src/extensions/scratch3_wedo2/index.js"&gt;wedo插件&lt;/a&gt;中，我们可以看到RateLimiter暴露出的接口:&lt;code&gt;this._rateLimiter.okayToSend()&lt;/code&gt;清晰易用&lt;/p&gt;
&lt;p&gt;值得一提的是，scratch官方实现的令牌桶算法和Python的实现略有不同。scratch官方实现没有n条消息同时涌入的情况，而是逐条处理:&lt;code&gt;this._count--&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;大家之后在Scratch3.0中自定义插件，需要处理速率问题时，可以直接使用官方的&lt;code&gt;RateLimiter&lt;/code&gt;,我的建议是所有与消息相关的插件都该加上&lt;code&gt;RateLimiter&lt;/code&gt;, 否则系统的健壮性是堪忧的，也很难做到&lt;code&gt;宽围墙&lt;/code&gt;，可能一不小心就塌了&lt;/p&gt;
&lt;!--
[Rate-limiting with a token bucket for the WeDo extension](https://github.com/LLK/scratch-vm/pull/1540)
    算法:[rateLimiter.js](https://github.com/LLK/scratch-vm/blob/769156c9af416430c5e0cc20621471d2b99fde43/src/util/rateLimiter.js)
    应用: [scratch3_wedo2/index.js](https://github.com/LLK/scratch-vm/blob/769156c9af416430c5e0cc20621471d2b99fde43/src/extensions/scratch3_wedo2/index.js#L541)
    解决的问题:[Wedo2 sometimes drops commands](https://github.com/LLK/scratch-vm/issues/1531)

交互式中的核心问题,我之前写交互式设计

为了实现宽围墙

设施的牢固性

蹦蹦床的时候

那是疫苗

# todo
*  算法的图示
*  算法的伪代码
*  Python实现
*  Scratch实现
--&gt;

&lt;h1 id="_5"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/Hardware-Programming-style.html"&gt;两种硬件编程风格的比较&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/LLK/scratch-vm/pull/1540"&gt;Rate-limiting with a token bucket for the WeDo extension&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://en.wikipedia.org/wiki/Token_bucket"&gt;wikipedia Token bucket&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://baike.baidu.com/item/token%20bucket/4315253?noadapt=1"&gt;百度 token bucket&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.csdn.net/YEYUANGEN/article/details/20529793"&gt;qos令牌桶（Token Bucket）算法解析&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/falconry/token-bucket/blob/master/token_bucket/limiter.py"&gt;Python token-bucket&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://gist.github.com/drocco007/6155452"&gt;Python generator rate limiter using token bucket&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/ActiveState/code/blob/master/recipes/Python/511490_Implementatitoken_bucket/recipe-511490.py"&gt;Implementatitoken_bucket&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://jiajunhuang.com/articles/2016_11_05-token_bucket.rst.html"&gt;Token Bucket 算法 celery&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://medium.com/smyte/rate-limiter-df3408325846"&gt;High-performance rate limiting&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://liuliqiang.info/post/214/"&gt;速率限制的一些思考&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Wed, 29 Aug 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-08-29:scratch-extension-token-bucket.html</guid><category>scratch</category></item><item><title>基于兴趣的学习面临的诘难</title><link>/interest-based-learning.html</link><description>&lt;!--「基于兴趣的学习与标准化课程」是我非常感兴趣的一个话题。--&gt;

&lt;p&gt;&lt;img alt="rye" src="http://wwj-fig-bed.just4fun.site/rye_b5257654.png" /&gt;&lt;/p&gt;
&lt;p&gt;我们在公众号的第一篇文章:&lt;a href="https://mp.weixin.qq.com/s?__biz=MzU4NzY2OTk4NA==&amp;amp;mid=2247483652&amp;amp;idx=1&amp;amp;sn=23c76eb5a05ab9356a7bf6a2a1b8c21a&amp;amp;chksm=fde9c98bca9e409d70a31066b7380facad0a5506b2697c63de5a9938d8be489320db9814a5e2#rd"&gt;教育游戏化&lt;/a&gt;中抛出了一个对「基于兴趣的学习」的典型诘难:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;如果你从儿童的冲动和兴趣出发，一切都是如此粗率，如此不规则，如此散乱，如此没有经过提炼、没有精神上的意义，他将怎样获得必要的训练、陶冶和知识呢?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我在文章结尾处说:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;杜威引述的这个问题十分尖锐，杜威自己给出了很不错的答案，Scratch也给出了令人满意的答卷，我们留待之后讨论热情(Passion)的部分来讨论它。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我们在上篇文章:&lt;a href="https://mp.weixin.qq.com/s?__biz=MzU4NzY2OTk4NA==&amp;amp;mid=2247483657&amp;amp;idx=1&amp;amp;sn=8674959e1312517aedca707822b37d7c&amp;amp;chksm=fde9c986ca9e4090491912999a74bb694bfd63463dd9f1fb48db4ead41a75f49c469688f635e&amp;amp;scene=0#rd"&gt;hard fun&lt;/a&gt;里讨论了热情(Passion)，本文将开始讨论基于兴趣的学习面临的诘难。&lt;/p&gt;
&lt;h1 id="_1"&gt;约翰·杜威的看法&lt;/h1&gt;
&lt;p&gt;杜威对这个诘难的回答是:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;如果除了激发和迁就儿童的这些冲动以外，我们就别无其他道路可走，这个问题问得就是有道理的。那样的话，我们要么压制这些冲动，要么迁就它们。但是如果我们有设备和材料的结构，在我们面前就开辟了另一条路径。我们可以指导儿童的活动，使它们沿着一定方向运行，把它们渐渐引导到这条道路逻辑上必然要达到的目标上。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我们都知道愿望不等于事实，当一个孩子有了兴趣和冲动，Ta为了追逐这个兴趣，就需要动手实践。你知道的，魔鬼都在细节里，动手实践的过程总会碰到许多障碍，于是Ta就要熟悉材料，运用独创性、坚持以及机智，这个过程必然包含着各种训练、以及需要教育者提供知识来帮助Ta。&lt;/p&gt;
&lt;p&gt;对烹饪感兴趣的幼童一开始对于烹饪并没什么概念，它只是一个“消磨时间”的欲望，也许是为了模仿大人的活动。但是在这里，如果冲动得到利用，就会碰到困难，为了跨越困难，就有了训练和知识的要素参与其中。&lt;/p&gt;
&lt;p&gt;杜威举了一个孩子参与煮鸡蛋实验的例子，这是从炒蔬菜到烧肉的过渡，为了获得对比的证据，他们首先总结了在蔬菜中食物构成的成分，并与肉中的成分作了一个初步比较。于是，他们发现蔬菜中的木质纤维和纤维素相当于肉中的结缔组织，是形体和结构的成分。然后，他们准备考虑一下正确处理蛋白质的必要条件——以鸡蛋作为实验材料。 他们首先用不同温度的水做实验，看它何时达到烫手的程度，何时达到即将沸腾的程度，何时沸腾，并弄清各种不同的温度对蛋白质的影响。做完那些事以后，他们不仅学会了煮鸡蛋，而且懂得了煮鸡蛋中的原理。&lt;/p&gt;
&lt;p&gt;如果一个孩子只是想煮一个鸡蛋，因而把它放在水里煮三分钟，叫Ta取出时Ta就取出，这是没有教育性的，对这点的批评毫无问题。但是，如果一个孩子由于认清了事实、材料和所包含的条件去实现Ta的冲动，这就有了教育性。这就是杜威所坚持的满足一种兴趣和对兴趣的指导来实现它这二者之间的区别。 在后者中, 既满足了孩子的兴趣, 同时又容纳了必要的训练和知识。&lt;/p&gt;
&lt;p&gt;杜威在这个话题的最后总结说:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我们是不顾这种天生的背景和倾向，完全不与活泼的儿童打交道而与我们已经建立的僵死的概念打交道，还是使这种天生的倾向发挥作用，给它以满足?一旦我们信任生活，信任儿童的生活，那么，所说的一切作业和价值，一切历史和科学都将成为感染力的手段和培养想象力的材料，并由此而使他的生活变得丰富和有条理。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--
# 约翰·杜威
如果我们想象一下普通的教室，一排排难看的课桌按几何顺序摆着挤在一起，以便尽可能没有活动的余地，课桌几乎全都是一样大小，桌面刚好放得下书籍、铅笔和纸，外加一张讲桌，几把椅子，光秃秃的墙，可能有几张图画，凭这些我们就能重新构成仅仅能在这种地方进行的教育活动。一切都是为“静听”准备的，因为仅仅学习书本上的课文不过是另外一种“静听”，它标志着一个人的心理依附于另一个人的心理

只有一切事情都是以“静听”为基础时，你才能有统一的教材和方法。耳朵和反映耳朵的书本构成了同样适用于一切人的媒介。

要有一个小型实验室，他的探究可以在这里得到指导。

学校与儿童生活的关系问题，实际上不过是这样一个问题：我们是不顾这种天生的背景和倾向，完全不与活泼的儿童打交道而与我们已经建立的僵死的概念打交道，还是使这种天生的倾向发挥作用，给它以满足?一旦我们信任生活，信任儿童的生活，那么，所说的一切作业和价值，一切历史和科学都将成为感染力的手段和培养想象力的材料，并由此而使他的生活变得丰富和有条理。
--&gt;

&lt;h1 id="_2"&gt;米切尔·雷斯尼克的辩护&lt;/h1&gt;
&lt;p&gt;我们在上篇文章&lt;a href="https://mp.weixin.qq.com/s?__biz=MzU4NzY2OTk4NA==&amp;amp;mid=2247483657&amp;amp;idx=1&amp;amp;sn=8674959e1312517aedca707822b37d7c&amp;amp;chksm=fde9c986ca9e4090491912999a74bb694bfd63463dd9f1fb48db4ead41a75f49c469688f635e&amp;amp;scene=0#rd"&gt;hard fun&lt;/a&gt;里提到:  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Scratch社区里一个12岁的女孩，在制作有两名角色的动画故事时，为了让角色在同一时间在屏幕的特定地点碰面，她必须学会时间、速度和距离的关系;一名9对的女孩，想为三年级的课制作一份以《夏绿蒂的网》为主题的动画版读书报告，为了让动物在合适的距离出现，她必须学会艺术上有关透视、以及数学上有关比例的概念。这样的学习并不容易。但这些故事里的孩子，非常努力学习变量、速度、透视、比例；他们是为了自己在乎的项目，在努力学习。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这些例子验证了杜威的看法，追逐兴趣、动手操作的过程中，孩子们往往会进入学习知识的过程。&lt;/p&gt;
&lt;p&gt;在Scratch线上社区中的探索和创造过程中，并没有教育者&lt;code&gt;指导儿童的活动，使它们沿着一定方向运行&lt;/code&gt;,但在电脑会馆中，情况则更接近杜威提倡的教育方式。&lt;/p&gt;
&lt;p&gt;和杜威面对的诘难一样，电脑会馆被认为是以一种"没有结构"的学习方法为基础的。言下之意是如此粗率，如此不规则，如此散乱，如此没有经过设计。&lt;/p&gt;
&lt;p&gt;米切尔辩称说: &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;电脑会馆与传统的学校教室非常不同，我们不想让老师站在房间前面讲课，不想提供标准化的课程，要求所有俱乐部成员都在同一时间以同样的顺序干同样的事。但我更倾向于认为，电脑会馆有着与学校不同的结构，而并非没有结构。&lt;br /&gt;
我们向成员展示项目，激发他们的想象力，这是一种结构; 我们组织特别的活动，让成员展示他们自己的作品，这也是一种结构; 我们安排成人志愿者帮助成员完成他们的项目，这又是一种结构。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我另想补充一点是，Scratch这个工具本身也是经过精心设计的，并非"没有结构"，它吸收了艾伦凯在创造Smalltalk时的许多设计原则和天才创见，关于如何编程、如何支持和呈现创意。学习者在Scratch中的创作过程尽管自由，但在Ta追逐兴趣去创作的时候，却必然会掌握内化在工具里的逻辑和计算思维。这呼应了杜威说的&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;如果我们有设备和材料的结构，在我们面前就开辟了另一条路径。我们可以指导儿童的活动，使它们沿着一定方向运行，把它们渐渐引导到这条道路逻辑上必然要达到的目标上。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;为了鼓励追逐兴趣，我们需要某种松散而自由的环境；而为了让孩子在这个过程中学到必要的知识，我们又需要精心设计的结构。&lt;/p&gt;
&lt;p&gt;这两者的平衡大多时候是很微妙的，于是有时我们感慨:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;教育是一门艺术&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;分寸的拿捏十分不易。结构太多，人们就无法从事他们想做的事，结构太少，人们往往无从下手，对很多人来说，在创意项目刚开始时，一张白纸是最令人抓狂的。&lt;/p&gt;
&lt;p&gt;在少儿编程领域，我认为有两大阵营。其一是code.org阵营，在这个阵营里，知识被分解到精心设计的游戏关卡中，这是一种高度结构化的学习环境，它强调知识，但对创造并不友好；另一个则是Scratch阵营，它极度自由，在这里你可以创造出一部电影大片或是一个大型游戏，但新手往往不知所措。&lt;/p&gt;
&lt;p&gt;在这两个阵营里，我更看好Scratch。Scratch团队已经意识到他们的不足，他们需要更好地帮助新手起步，在技术上，这可能是个提供脚手架的工作，不算太难，我近期一直在跟进他们的开发进度，在开发分支上，已经有非常令人振奋的雏形了，我相信在明年初，新社区正式上线前，他们会给出漂亮的答卷。&lt;/p&gt;
&lt;p&gt;我在之后的时间里，也将在这一块做些探索和尝试：）&lt;/p&gt;
&lt;p&gt;少儿编程在全球掀起了热潮。近来，国内各路玩家也纷纷上场，做起了各种课程和竞赛，大有编程要成为下一个奥数的架势，这是我能想到的最糟糕的做法。&lt;/p&gt;
&lt;p&gt;最后我想以伯特兰·罗素《论教育》中的一段来结束本文:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;尊重他人是需要想像力和必要的热情的；特别是对于那些取得了些微实际成就和有权力的人来说，尊重他人就更需要想像力了。孩子是弱者，而且有些肤浅愚笨；而教师是强者，并且在各方面都比孩子更聪明。由于儿童外在的弱势，不尊重人的教师和不尊重人的官僚，动辄就会蔑视孩子。他认为，塑造孩子是他的责任。在想像中，他将自己当作一个拿着泥土的陶器匠。于是，他把孩子捏成某种不自然的形状。随着年龄的增长，这种形状会坚固起来．并且产生出紧张和精神上的愤懑，滋生出残忍和嫉妒，而且孩子长大后会认为，必须强迫其他人也要经受同样的扭曲。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--学习知识 可以被设计 microworld引导--&gt;

&lt;!--
米切尔也提到刚到电脑会馆工作的新员工和志愿者也时常会有误解。

当他们所到电脑会馆鼓励年轻人发展自己的兴趣时，他们认为成年人需要让路，让学员自己去做任何事情。例如，一位志愿者提议开办一个工作坊，来帮助俱乐部成员学习如何制作电子漫画书。一名工作人员最初反驳了这个想法，他解释道:“我们不在电脑会馆里开办工作坊，我们让电脑会馆成员发展自己的兴趣。”

米切尔以为这是对俱乐部教学方式的误解。如果电脑会馆要组织一个强制性的工作坊，让所有成员都必须学习制作漫画书，他肯定会反对。但只要成员们可以自行选择参加或不去参加，那么我认为给他们开办工作坊是个好主意。这样的工作坊可以帮助成员发现他们感兴趣的领域，并帮助他们学习新的技能，有助于他们发展自己的兴趣。
--&gt;

&lt;!--

# 伯特兰·罗素
《论教育》

为了教会孩子一些东西，某种偏离完全自由的做法就显然仍是不可避免的

在教育领域中充斥着政府部门发布的规章制度、庞大的班级、一成不变的课程、不堪重负的老师，以及一定要生产出水平完全一致的能说会道的庸才。凡此种种，唯独缺少对于孩子的尊重，这几乎成了普遍现象。

尊重他人是需要想像力和必要的热情的；特别是对于那些取得了些微实际成就和有权力的人来说，尊重他人就更需要想像力了。孩子是弱者，而且有些肤浅愚笨；而教师是强者，并且在各方面都比孩子更聪明。由于儿童外在的弱势，不尊重人的教师和不尊重人的官僚，动辄就会蔑视孩子。他认为，塑造孩子是他的责任。在想像中，他将自己当作一个拿着泥土的陶器匠。于是，他把孩子捏成某种不自然的形状。随着年龄的增长，这种形状会坚固起来．并且产生出紧张和精神上的愤懑，滋生出残忍和嫉妒，而且孩子长大后会认为，必须强迫其他人也要经受同样的扭曲。

庞大的班级和由于经济窘迫造成的教师工作负担过重，是导致学校必须要求服从的原因。从事活灵活现的讲课工作需要付出多么大的精力，这对于没有教学经验的人来说是很难想像的。他们以为，教师的工作就像银行出纳员一样，让他干许多钟头的活儿是合理的。这样做的结果是导致了极度的疲乏和易怒的神经，教师只好不得不机械地应付日常工作。于是，不强行让学生服从，机械性的工作就无法进行。

理想的纪律属于这样一种类型，它来自人们的内心；作为一种毅力，它执著地追求遥远的目标，在前进的征途上历经磨难。它要求用意志去控制冲动，并且导致一种指导力量，即依靠具有创造力的追求去指导行动，即便当这种追求还不是那么生动清晰的时候，也依旧如此。

对于那些能力较强的孩子来说，从他们跨入学校的那一刻起，直到离开大学校门，他们都没有时间去思考，也无暇耽迷于智力的趣味。自始至终，没有别的东西，而只有苦役般的一连串考试和背书。最后，就连最聪明的孩子也腻味了学习，只盼着忘掉功课，快些逃入实际生活中去。然而，在实际生活中也同从前一样，经济机器又把他关入牢笼，他们全部的自发兴趣又被碰得鼻青脸肿，遭到挫折。

考试制度和训导授课（它是培养大活人的主要手段），使得孩子们从纯粹功利的观点出发，把知识看作是赚钱的门路，而不是通往智慧的大门。如果这只对毫无智力兴趣的人发生作用，那倒也无所谓。但不幸的是，它也影响了那些智力兴趣极强的人，因为正是在后一种人身上，考试施加了非常严酷的压力。对于这种人，教育明显地表现为成为人上人的手段。对于其他所有人而言，教育在某种程度上也是如此。不平等的社会荣誉感和残酷性无所不在地影响着教育。

比起成年男女，精神探索的欢乐在孩子中间远非罕见。在寻求信仰和易于幻想的童年，孩子们自然而然会生发出精神探索的欢乐，这是常见之事。随着岁月的推移，这种欢愉日益罕见，那是因为教育扼杀了精神探索的欢乐。

这种类型的纪律是完全必要的。但它只能产生于一种强烈的愿望——即对于达到暂时还无法企及的目标的愿望。教育只有培养这种愿望，才能产生有益的纪律。但是，现在的教育几乎做不到这一点。这种纪律来自人的内心，而不是来自外部的权威。大多数学校所要求的纪律不属于这种类型，但正是这种纪律，在我看来才与恶行无缘。

存在某种神圣的东西；它捉摸不定，无以限量，具有某种个性，又神奇珍贵

为了孩子的热情，我以罗素在论教育中的一段来结尾

&gt;  具有尊重感的人则不认为塑造青年人是他的责任。他感到在所有生物中间，特别是在人类中，最重要的是在孩子里，存在某种神圣的东西；它捉摸不定，无以限量，具有某种个性，又神奇珍贵；生命的真谛由此孕育；断然的沉默体现了与世界的奋争。在孩子面前，他感到一种无以名状的自卑——这是用任何理由都不易抗拒的惭愧，然而它比起许多家长和教师油然而生的自信心却更接近明智。孩子们外在的无助和对于依赖的呼吁，使他产生了托付人的责任感。他的想像力为他展现出孩子可能发生的变化：孩子或是变善，或是变恶；孩子的进取心将如何得以发展，或是如何遭到挫折；孩子的希望将如何必定变得黯然无望，生活将如何渐失生气；孩子的信任感将如何遭受打击，活泼机敏的欲望将如何被深沉阴暗的念头所取代。凡此种种都使他渴望站在孩子一边，在儿童自己的战场上助其一臂之力。他将为孩子提供装备，增添力量。这倒不是为了国家或没有人情味的当局从局外提出的目标，而是为了孩子在茫然中的精神求索。只有感受到这一点的人才能发挥教育的权威作用，并且不会违背自由的原则。

--&gt;

&lt;h1 id="_3"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;米切尔·雷斯尼克《终生幼儿园》&lt;/li&gt;
&lt;li&gt;约翰·杜威《学校与社会》&lt;/li&gt;
&lt;li&gt;伯特兰·罗素《论教育》《论教育》&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Sun, 26 Aug 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-08-26:interest-based-learning.html</guid><category>scratch</category></item><item><title>彩虹🌈的旋律</title><link>/scratch3-rainbow.html</link><description>&lt;blockquote&gt;
&lt;p&gt;阳光总在风雨后, 请相信有彩虹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/rainrow_324b7eb0.png" /&gt;&lt;/p&gt;
&lt;p&gt;我喜欢这个粉色少女心的题目&lt;/p&gt;
&lt;h1 id="_1"&gt;演示&lt;/h1&gt;
&lt;p&gt;我们先来看看演示效果：在桌子上一字排开彩虹糖，按照你喜欢的颜色去摆放，这些彩虹糖将被演奏为一首音乐&lt;/p&gt;
&lt;video width=600px src="http://scratch3-files.just4fun.site/scratch_rainrow.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;h1 id="_2"&gt;缘起&lt;/h1&gt;
&lt;p&gt;我非常喜欢Scratch团队成员&lt;a href="https://github.com/ericrosenbaum"&gt;Eric Rosenbaum&lt;/a&gt;发起的&lt;a href="https://www.ericrosenbaum.com/color-code/"&gt;颜色编程&lt;/a&gt;项目。&lt;a href="https://www.ericrosenbaum.com/color-code/"&gt;颜色编程&lt;/a&gt;的基本想法是使用日常物体表面的颜色与计算机中的虚拟事物进行互动&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.ericrosenbaum.com/color-code/"&gt;颜色编程&lt;/a&gt;由一系列的实验构成:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Twinkle&lt;/li&gt;
&lt;li&gt;Color Code&lt;/li&gt;
&lt;li&gt;Scratch Color Code&lt;/li&gt;
&lt;li&gt;Programming with Color&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我们下边将逐一做个简单介绍&lt;/p&gt;
&lt;!--
写给普通用户
在scratch社区去推广
--&gt;

&lt;!--腾讯视频--&gt;

&lt;h3 id="twinkle"&gt;Twinkle&lt;/h3&gt;
&lt;p&gt;Twinkle 使用一个颜色传感器将颜色序列转化为一首旋律，于是你可以将一幅画、一个乐高建筑以及你身上衬衫上的条纹演奏为一首歌&lt;/p&gt;
&lt;video width=500px src="http://wwj-tmp-video.just4fun.site/10697723.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;h3 id="color-code"&gt;Color Code&lt;/h3&gt;
&lt;p&gt;Color Code 的想法是: 物体的颜色可以控制屏幕里的运动，于是你可以利用这个概念创造从乒乓球游戏、音序器以及人工生命模拟。&lt;/p&gt;
&lt;video width=600px src="http://wwj-tmp-video.just4fun.site/Color%20Code.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;h3 id="scratch-color-code"&gt;Scratch Color Code&lt;/h3&gt;
&lt;p&gt;Scratch Color Code则将Color Code的想法带入到Scratch中，如此一来，人们可以使用友好的scratch图形化编程环境来创建项目，与外部世界的彩色物体交互&lt;/p&gt;
&lt;p&gt;视频里展示的例子包括一个cookie怪物游戏、一个叶子平台游戏，以及一个糖果鼓机(candy drum machine)&lt;/p&gt;
&lt;video width=600px src="http://wwj-tmp-video.just4fun.site/Scratch%20Color%20Code.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;h3 id="programming-with-color"&gt;Programming with Color&lt;/h3&gt;
&lt;p&gt;Programming with Color将前头的概念延伸到最远处:使用颜色来编程，用Scratch Color Code来创造一个微型编程语言，在这门语言里颜色代表着指令。&lt;/p&gt;
&lt;video width=600px src="http://wwj-tmp-video.just4fun.site/Programming%20with%20color.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;这是个极为有趣的想法，我们来看看这个想法的细节&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;一个小角色在屏幕移动，画出一条线；&lt;/li&gt;
&lt;li&gt;一个黑色箭头在屏幕的底部，从左向右滑动，读取由彩色物体组成的“程序”。&lt;/li&gt;
&lt;li&gt;当黑色箭头碰到红色时，小角色向右转。&lt;/li&gt;
&lt;li&gt;当黑色箭头碰到绿色时，小角色正在绘制的线条会改变颜色。&lt;/li&gt;
&lt;li&gt;箭头碰到黄色时小角色向左转，碰到蓝色时小角色回到初始位置重新开始。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这是一种有形的编程语言，指令由对象表示，即便在程序运行时也可以重新排列程序(如果你是一名职业程序员，可能想到了热重载或者LISP)。&lt;/p&gt;
&lt;p&gt;与其他有形编程语言不同的是，指令块可以由任何对象来表示，不必是特定的指令块，只要颜色对了就行。对比&lt;a href="https://4ok.jp/pets/en/"&gt;PETS&lt;/a&gt;和&lt;a href="https://www.primotoys.com/zh/"&gt;Cubetto&lt;/a&gt;，我们可以看到它们的目标上的相似，以及策略上的差别&lt;/p&gt;
&lt;p&gt;与其他编程语言不同，Programming with Color的指令具有连续的效应，举例来说明：红色物体越宽，角色右转的时间越长。&lt;/p&gt;
&lt;p&gt;这些属性为创造新的编程语言提供了一些有趣的探索。&lt;/p&gt;
&lt;h1 id="scratch"&gt;Scratch颜色编程&lt;/h1&gt;
&lt;p&gt;本文主要受&lt;code&gt;Scratch Color Code&lt;/code&gt;的启发，准备在最新发布的Scratch3.0，使用彩虹糖来演奏乐曲，这便是少女心题目&lt;code&gt;彩虹的旋律&lt;/code&gt;之来由&lt;/p&gt;
&lt;h3 id="_3"&gt;原理&lt;/h3&gt;
&lt;p&gt;在&lt;code&gt;Programming with Color&lt;/code&gt;部分其实已经将原理说清楚了，在此我们将原理与当前项目:&lt;code&gt;彩虹🌈的旋律&lt;/code&gt;结合起来说明&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;彩虹糖在桌子上排成一列，使用摄像头对着它们, 彩虹糖被投影到scratch舞台&lt;/li&gt;
&lt;li&gt;一个粉色箭头在屏幕中间，从左向右滑动&lt;/li&gt;
&lt;li&gt;当粉色箭头碰到不同颜色的彩虹糖时，演奏不同旋律的音符&lt;/li&gt;
&lt;/ol&gt;
&lt;!--

学习音乐 note

音符
    https://en.scratch-wiki.info/wiki/MIDI_Notes
    c 60 62 64 65 67 69 71  

颜色编程 .sb3 

,你也可以将彩虹糖视为指令颗粒，用它来编程
--&gt;

&lt;p&gt;接着，让我们一起动起手来&lt;/p&gt;
&lt;h3 id="_4"&gt;需要的材料&lt;/h3&gt;
&lt;p&gt;&lt;img width=500px src="http://wwj-fig-bed.just4fun.site/candy_410c19cf.png"/&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;一些彩虹糖&lt;/li&gt;
&lt;li&gt;一个usb摄像头&lt;/li&gt;
&lt;li&gt;一台笔记本电脑(安装chrome浏览器)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="do-re-mi"&gt;Do-Re-Mi&lt;/h3&gt;
&lt;p&gt;让我们从音乐届的&lt;code&gt;hello world&lt;/code&gt;开始： 演奏:&lt;code&gt;Do Re Mi&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;回顾下原理，看看我们都需要做些什么：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;彩虹糖在桌子上排成一列，使用摄像头对着它们, 彩虹糖被投影到scratch舞台&lt;/li&gt;
&lt;li&gt;一个粉色箭头在屏幕中间，从左向右滑动&lt;/li&gt;
&lt;li&gt;当粉色箭头碰到不同颜色的彩虹糖时，演奏不同旋律的音符&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;动起手来，首先取出三种颜色的彩虹糖，在桌子上摆开，使用摄像头对着它们，我原先准备使用乐高积木搭建一个摄像头支架，由于心急想快些看到效果，于是我给了我同事一颗彩虹糖，让他帮我拿着USB摄像头&lt;/p&gt;
&lt;p&gt;摆好彩虹糖和摄像头后，就可以开始在&lt;a href="https://beta.scratch.mit.edu/"&gt;scratch&lt;/a&gt;里开始编写程序了&lt;/p&gt;
&lt;p&gt;接下来需要在scratch的角色库里选择一个粉色箭头精灵，只所以把他们称为精灵，是因为游戏里的角色在传统上都被称为精灵。&lt;/p&gt;
&lt;p&gt;&lt;img width=600px src="http://wwj-fig-bed.just4fun.site/scratch_rainrow_91b32f58.png"/&gt;&lt;/p&gt;
&lt;p&gt;聪明的你可能要打破沙锅，问为何它们在传统上会被称为精灵呢？我想，可能是因为这些角色和童话里的精灵一样，它们会运动，会生气，会砰地一声消失不见。你通过编程来操控这些精灵，就这点来说，编程和魔法是很相似的，这是个很好的隐喻。你写出一串咒语，然后故事里的精灵就动了起来、远处的灯亮了、而手中的飞行器嗖地飞上了天，这是今天利用程序能做到的事，在&lt;code&gt;很久很久以前的&lt;/code&gt;这种开头的故事里，这种事情往往是魔法师的专属权力。我相信今天程序做到的事情，会让历史上每一位伟大的巫师/魔法师大为震惊，这些魔法师不只是大卫·科波菲尔，也包括哈利.波特&lt;/p&gt;
&lt;p&gt;选择好精灵之后，我们就开始来为精灵编程了，在开始编写程序之前，我们先想想我们希望精灵做什么事呢&lt;/p&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;一个粉色箭头在屏幕中间，从左向右滑动，读取由彩虹糖组成的“程序”。&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;p&gt;我们希望粉色箭头在屏幕中间从左向右滑动，目标明确之后，我们就开始动手写程序&lt;/p&gt;
&lt;p&gt;&lt;img width=600px src="http://wwj-fig-bed.just4fun.site/scratch_rainrow_17ae4f7d.png"/&gt;&lt;/p&gt;
&lt;p&gt;上边这段程序表达的意思是:&lt;code&gt;箭头&lt;/code&gt;不断往右边移动，如果到了舞台边缘就回到初始位置。怎么知道哪儿是舞台边缘呢？这就是程序里看起来奇怪的数字&lt;code&gt;212&lt;/code&gt;出现的原因。212是&lt;code&gt;坐标&lt;/code&gt;值，如果你不知道坐标的概念也没关系，知道212表示&lt;code&gt;舞台上右边缘的位置&lt;/code&gt;就行。写出有趣的程序和数学好不好并没什么太大关系，别听信大家恐吓你数学不好就学不好编程。如果你喜欢编程，你的数学很可能会得到提高，但你目前的数学不好却不意味着你不适合编程，它可能更多意味着你的数学老师上课太无聊。数学课大多情况下总是那么无聊，这也是我们喜欢在编程中学习的原因&lt;/p&gt;
&lt;p&gt;运行程序，我们就看到箭头完成了我们期望它做的事情：不断从左往右滑动&lt;/p&gt;
&lt;p&gt;&lt;img width=600px src="http://wwj-tmp-video.just4fun.site/%E5%BD%A9%E8%99%B9%E7%B3%96_arrow2.gif"/&gt;&lt;/p&gt;
&lt;p&gt;下边来实现最后一步&lt;/p&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;当粉色箭头碰到不同颜色的彩虹糖时演奏不同旋律的音符&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;p&gt;为了实现这一步，我们需要先启用摄像头，让糖果投影到屏幕上, 首先选择scratch扩展里的&lt;code&gt;视频侦测&lt;/code&gt;插件&lt;/p&gt;
&lt;p&gt;&lt;img width=600px src="http://wwj-fig-bed.just4fun.site/scratch_rainrow_11d35b9d.png"/&gt;&lt;/p&gt;
&lt;p&gt;接着编写碰到不同颜色时演奏不同旋律的代码&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;黄色对应"Do"&lt;/li&gt;
&lt;li&gt;橙色对应"Re"&lt;/li&gt;
&lt;li&gt;褐色对应"Mi"&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img width=600px src="http://wwj-fig-bed.just4fun.site/scratch_rainwor_e87b2bf8.png"/&gt;&lt;/p&gt;
&lt;p&gt;现在就可以开始&lt;code&gt;Do Re Mi&lt;/code&gt;的演奏啦：&lt;/p&gt;
&lt;video width=600px src="http://wwj-tmp-video.just4fun.site/%E5%BD%A9%E8%99%B9%E7%B3%96123.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;h3 id="_5"&gt;欢乐颂&lt;/h3&gt;
&lt;p&gt;我们来演奏贝多芬《欢乐颂》的开头: &lt;code&gt;33455432&lt;/code&gt;&lt;/p&gt;
&lt;video width=600px src="http://scratch3-files.just4fun.site/scratch_rainrow.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;挑一首你自己喜欢的乐曲，试着用彩虹糖演奏它&lt;/p&gt;
&lt;h1 id="_6"&gt;想象空间&lt;/h1&gt;
&lt;p&gt;程序是一种指令序列，上边的教程里，我们已经学会了将彩虹糖映射为一个指令(演奏旋律)，我们当然也可以将彩虹糖映射为其他指令，诸如&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;映射为画笔移动&lt;/li&gt;
&lt;li&gt;映射为机器人的移动&lt;/li&gt;
&lt;li&gt;映射为智能家居的设备行为&lt;/li&gt;
&lt;li&gt;...&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如此一来我们就可以在桌子上摆放彩虹糖，去探索绘画、音乐和改造你的家庭&lt;/p&gt;
&lt;p&gt;我们甚至可以用彩虹糖去制作了一门新的编程语言： &lt;code&gt;Candy Language&lt;/code&gt;&lt;/p&gt;
&lt;!--
### cozmo
[PETS](https://4ok.jp/pets/en/)

我之前实验python写过一个简单的[pets模拟器](https://gist.github.com/wwj718/3ade708bc6e7f3cf669dc38a998000cd)

控制cozmo 移动  前后左右（四种颜色） 实验adapter

我们


整个游戏过程都鼓励小朋友多尝试。移动方块，按按按钮，看看会发生什么？

Cubetto 和 Geppetto（制造匹诺曹的老爷爷）押韵。

Cubetto 套件抛弃了屏幕

### 增强现实
[COLOR CODE](https://www.ericrosenbaum.com/color-code/)
--&gt;

&lt;h1 id="_7"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.ericrosenbaum.com/color-code/"&gt;COLOR CODE&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://musiclab.chromeexperiments.com/About"&gt;musiclab&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.primotoys.com/zh/"&gt;primotoys&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://tech2ipo.com/10020774"&gt;如何教 3 岁小孩学编程，不用电脑&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://sonic-pi.net/"&gt;sonic-pi&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Wed, 08 Aug 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-08-08:scratch3-rainbow.html</guid><category>scratch</category></item><item><title>分析scratch3.0与micro:bit的通信</title><link>/scratch3-microbit-analysis.html</link><description>&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/scratch_microbit_0f5be12b.png" width=600 /&gt; &lt;/p&gt;
&lt;p&gt;Scratch在七月底举行了一个大会:&lt;a href="https://scratch.mit.edu/conference"&gt;conference&lt;/a&gt;, 大会上, scratch团队向大家介绍了即将推出的Scratch 3.0, 赶在会议开始之前，scratch团队完成了对micro:bit的官方支持，项目页连同使用说明也正式上线:&lt;a href="[scratch.mit.edu/microbit](https://scratch.mit.edu/microbit)"&gt;microbit&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;scratch与micro:bit作为全球最有名的两个少儿编程项目（分别是软件和硬件），能够结合在一起，太振奋人心。之前社区里大家就围绕这块在做许多探索，如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;基于&lt;a href="https://github.com/WebBluetoothCG/web-bluetooth/blob/gh-pages/implementation-status.md#chrome"&gt;web bluetooth&lt;/a&gt;的&lt;a href="https://blog.just4fun.site/scratch3-microbit.html"&gt;scratch3.0 + micro:bit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/usage/"&gt;scratch3-adapter&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="_1"&gt;尝鲜&lt;/h1&gt;
&lt;p&gt;只要你手边有micro:bit就可以开始体验了.&lt;/p&gt;
&lt;p&gt;按照&lt;a href="https://scratch.mit.edu/microbit"&gt;使用说明&lt;/a&gt;，将micro:bit接入scratch3.0毫无障碍:&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/scratch_microbit_0f5be12b.png" width=600 /&gt; &lt;/p&gt;
&lt;p&gt;完成连接后就可以开始你的创作了，&lt;a href="https://scratch.mit.edu/microbit"&gt;使用说明&lt;/a&gt;页面里给出了几个例子,大家可以从这儿入手&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/scratch_heart_a30a52b1.png" width=600 /&gt; &lt;/p&gt;
&lt;h1 id="_2"&gt;原理&lt;/h1&gt;
&lt;p&gt;体验完scratch与micro:bit的互动，我们来分析一下官方是如何做到的。&lt;/p&gt;
&lt;p&gt;回顾&lt;a href="https://scratch.mit.edu/microbit"&gt;使用说明&lt;/a&gt;和体验过程，容易猜到Scratch Link起代理的作用，Scratch Link在内部跑了一个websocket服务，允许网页与其交互，同时在启动时扫描周围的BLE设备&lt;/p&gt;
&lt;p&gt;思路和&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;几乎完全一致&lt;/p&gt;
&lt;p&gt;Scratch Link与&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;的不同之处有：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Scratch Link目前不支持扩展，似乎也没计划开源，原因可能我猜测是Scratch Link将支持乐高机器人，而乐高机器人是闭源商业项目。&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;允许你自行扩展&lt;/li&gt;
&lt;li&gt;Scratch Link在使用上更为简易&lt;/li&gt;
&lt;li&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;兼容更多的系统环境以及支持所有的开源硬件&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Scratch Link在易用性上做得非常好，这也&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;准备向它学习的地方。&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;的目标之一是完全兼容Scratch Link的功能&lt;/p&gt;
&lt;p&gt;这篇文章就来分析一下官方在这块的巧思。以便于我们可以将其用到其他地方。&lt;/p&gt;
&lt;h1 id="_3"&gt;分析&lt;/h1&gt;
&lt;h3 id="_4"&gt;推断&lt;/h3&gt;
&lt;p&gt;从scratch的&lt;a href="https://github.com/LLK/scratch-vm/blob/develop/src/extensions/scratch3_microbit/index.js"&gt;micro:bit extension&lt;/a&gt;来看，Scratch Link仅仅只是一个代理，scratch与micro:bit的交互逻辑都在&lt;a href="https://github.com/LLK/scratch-vm/blob/develop/src/extensions/scratch3_microbit/index.js"&gt;micro:bit extension&lt;/a&gt;中。&lt;/p&gt;
&lt;p&gt;所以我们暂时不必使用&lt;a href="https://www.wireshark.org/download.html"&gt;wireshark&lt;/a&gt;抓包分析，而仅仅通过阅读&lt;a href="https://github.com/LLK/scratch-vm/blob/develop/src/extensions/scratch3_microbit/index.js"&gt;micro:bit extension&lt;/a&gt;，应该就能知道通信的细节，之后我们使用gatttool来验证。&lt;/p&gt;
&lt;p&gt;如果你对BLE/GATT相关的概念不熟悉，可以看看我之前的文章:&lt;a href="https://blog.just4fun.site/ble-notes.html"&gt;BLE学习笔记&lt;/a&gt;&lt;/p&gt;
&lt;!--adapter与硬件直接是不是只是代理  建立连接，转发消息--&gt;

&lt;h3 id="bleuuid"&gt;&lt;a href="https://github.com/LLK/scratch-vm/blob/develop/src/extensions/scratch3_microbit/index.js#L35"&gt;BLEUUID&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;从&lt;a href="https://github.com/LLK/scratch-vm/blob/develop/src/extensions/scratch3_microbit/index.js"&gt;micro:bit extension源码&lt;/a&gt;里我们可以找到micro:bit里跑的服务和属性的uuid，也正是这个证据，让我们猜测Scratch Link只是个透明代理&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;const BLEUUID = {
    service: 0xf005,
    rxChar: &amp;#39;5261da01-fa7e-42ab-850b-7c80220097cc&amp;#39;,
    txChar: &amp;#39;5261da02-fa7e-42ab-850b-7c80220097cc&amp;#39;
};
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;对比lancaster大学的&lt;a href="https://lancaster-university.github.io/microbit-docs/resources/bluetooth/bluetooth_profile.html"&gt;Bluetooth Developer Studio Level 3 Profile Report&lt;/a&gt;,可知scratch自己重写了很多东西，而没有使用现成的UART service，这点我颇为不解。&lt;/p&gt;
&lt;h3 id="_5"&gt;展开追踪&lt;/h3&gt;
&lt;p&gt;我们接着来跟踪一下&lt;code&gt;A button pressed？&lt;/code&gt;这个积木涉及的通信过程，从一个具体例子里突破。经过这个例子，我们对整个通信流程应该会有一个整体的了解，之后我们再对不同类型的积木逐类探索。&lt;/p&gt;
&lt;p&gt;GATT 通信的双方是 C/S 关系, 为了知道micr:bit上A按钮的状态，一般采用两种方式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;其一是利用GATT的通知机制，每当按钮状态变化时，通知给电脑(Scratch Link会把消息代理给scratch)&lt;/li&gt;
&lt;li&gt;其二是每当&lt;code&gt;A button pressed？&lt;/code&gt;积木被触发时，主动去read相应的属性值。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="https://llk.github.io/scratch-gui/microbit"&gt;scratch-gui/microbit&lt;/a&gt;应该是用这两种方式中的一种&lt;/p&gt;
&lt;p&gt;但&lt;a href="https://github.com/LLK/scratch-vm/blob/develop/src/extensions/scratch3_microbit/index.js"&gt;micro:bit extension&lt;/a&gt;有些特殊，它构建了UART service，之后的的数据都走UART service，逻辑上这更像经典的串口通信。只是实现在GATT上而已。&lt;/p&gt;
&lt;p&gt;从源码中可以看到buttonA是否按下取决于 &lt;a href="https://github.com/LLK/scratch-vm/blob/develop/src/extensions/scratch3_microbit/index.js#L491"&gt;this._device.buttonA&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;而&lt;a href="https://github.com/LLK/scratch-vm/blob/develop/src/extensions/scratch3_microbit/index.js#L323"&gt;this._device = new MicroBit(this.runtime, Scratch3MicroBitBlocks.EXTENSION_ID);&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;顺藤摸瓜，可以跟踪到&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="cm"&gt;/**&lt;/span&gt;
&lt;span class="cm"&gt;     * Process the sensor data from the incoming BLE characteristic.&lt;/span&gt;
&lt;span class="cm"&gt;     * @param {object} base64 - the incoming BLE data.&lt;/span&gt;
&lt;span class="cm"&gt;     * @private&lt;/span&gt;
&lt;span class="cm"&gt;     */&lt;/span&gt;
    &lt;span class="nx"&gt;_processSessionData&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;base64&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="c1"&gt;// parse data&lt;/span&gt;
        &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;Base64Util&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;base64ToUint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;base64&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;tiltX&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;tiltX&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;tiltX&lt;/span&gt; &lt;span class="o"&gt;-=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;tiltY&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;tiltY&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;tiltY&lt;/span&gt; &lt;span class="o"&gt;-=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;buttonA&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;buttonB&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;

        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;touchPins&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;touchPins&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;touchPins&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;

        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;gestureState&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;

        &lt;span class="c1"&gt;// cancel disconnect timeout and start a new one&lt;/span&gt;
        &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;clearInterval&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_timeoutID&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_timeoutID&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setInterval&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;disconnectSession&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;bind&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="nx"&gt;BLETimeout&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;注释里说得很清楚:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;     * Process the sensor data from the incoming BLE characteristic.
     * @param {object} base64 - the incoming BLE data.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;从逻辑和语义上，可以看出&lt;code&gt;_processSessionData&lt;/code&gt;是个回调函数，micro:bit会通过串口源源不断把它自身的状态数据(sensor data)不断发给&lt;code&gt;_processSessionData&lt;/code&gt;,  如此一来，scratch就能得知microbit的A按钮是否按下，为了验证我们的想法，我们得继续跟踪:&lt;code&gt;this._ble.read(BLEUUID.service, BLEUUID.rxChar, true, callback);&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="cm"&gt;/**&lt;/span&gt;
&lt;span class="cm"&gt;     * Starts reading data from device after BLE has connected to it.&lt;/span&gt;
&lt;span class="cm"&gt;     */&lt;/span&gt;
    &lt;span class="nx"&gt;_onSessionConnect&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;callback&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_processSessionData&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;bind&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_ble&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;BLEUUID&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;service&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;BLEUUID&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;rxChar&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;callback&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_timeoutID&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setInterval&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;disconnectSession&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;bind&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="nx"&gt;BLETimeout&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;_ble看去是个通用的抽象io(BLESession)，&lt;code&gt;_ble.read&lt;/code&gt;在语义上类似UART read，只是实现上是基于GATT的，如果你熟悉GATT，至此应该基本都猜到了。当然我们会继续剖析。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    /**
     * Called by the runtime when user wants to scan for a device.
     */
    startDeviceScan () {
        this._ble = new BLESession(this._runtime, {
            filters: [
                {services: [BLEUUID.service]}
            ]
        }, this._onSessionConnect.bind(this));
    }
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;跟踪到BLESession类里， &lt;code&gt;BLESession&lt;/code&gt;继承自&lt;code&gt;JSONRPCWebSocket&lt;/code&gt;, 这里提示我们scratch与Scratch Link是如何通信的，基于WebSocket，同时使用远程调用的概念, RPC使用起来要比流简单很多。这是scratch官方很聪明的举措之一，我们在文末的tips里还将列出官方其他的聪明做法&lt;/p&gt;
&lt;p&gt;如果你不打算自己实现类似Scratch Link的东西，JSONRPCWebSocket不必太关注。我实现了类似Scratch Link的&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter&lt;/a&gt;，但使用的是消息通信，策略上和scratch团队不大一样。这块我们先不细说&lt;/p&gt;
&lt;p&gt;回到BLESession上边，我们前头关注&lt;code&gt;_ble.read&lt;/code&gt;,在此将看到它的实现:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="nx"&gt;read&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;serviceId&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;characteristicId&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;optStartNotifications&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;onCharacteristicChanged&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;params&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;serviceId&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="nx"&gt;characteristicId&lt;/span&gt;
        &lt;span class="p"&gt;};&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;optStartNotifications&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;params&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;startNotifications&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_characteristicDidChangeCallback&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;onCharacteristicChanged&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;sendRemoteRequest&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;read&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;params&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sendError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
            &lt;span class="p"&gt;});&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;a href="https://github.com/LLK/scratch-vm/blob/develop/src/extensions/scratch3_microbit/index.js"&gt;micro:bit extension&lt;/a&gt;对它的调用是:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;this._ble.read(BLEUUID.service, BLEUUID.rxChar, true, callback);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;至此，我们就搞懂了&lt;code&gt;A button pressed？&lt;/code&gt;是如何实现的，optStartNotifications被设置为True，语义上是接受通知，当micro:bit上数据变化时，及时通知给scratch。技术层面使用了GATT的&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;客户端可以请求服务器通知一项特征&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;关于这点，我们在&lt;a href="https://blog.just4fun.site/ble-notes.html"&gt;BLE学习笔记&lt;/a&gt;有提到&lt;/p&gt;
&lt;p&gt;因为弄懂了&lt;code&gt;A button pressed？&lt;/code&gt;，所以&lt;code&gt;When A button pressed&lt;/code&gt;积木也不难理解，当然这需要你熟悉：scatch的HAT类型的积木(事件风格)。源码一目了然&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="nx"&gt;whenButtonPressed&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;args&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;BTN&lt;/span&gt; &lt;span class="o"&gt;===&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;any&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_device&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;buttonA&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_device&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;buttonB&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;args&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;BTN&lt;/span&gt; &lt;span class="o"&gt;===&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_device&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;buttonA&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;args&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;BTN&lt;/span&gt; &lt;span class="o"&gt;===&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_device&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;buttonB&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="write"&gt;关于write&lt;/h3&gt;
&lt;p&gt;既然我们分析完read，顺手看一下write的实现,直接上源码&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="nx"&gt;write&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;serviceId&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;characteristicId&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;message&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;encoding&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;params&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;serviceId&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;characteristicId&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;message&lt;/span&gt;&lt;span class="p"&gt;};&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;encoding&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;params&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;encoding&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;encoding&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;sendRemoteRequest&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;write&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;params&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sendError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
            &lt;span class="p"&gt;});&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;没什么需要特别说的&lt;/p&gt;
&lt;p&gt;我们以一个使用write的积木为例，来看看具体的细节,以display text为例：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="nx"&gt;displayText&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;text&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;output&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;text&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;let&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="nx"&gt;text&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;output&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;text&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;charCodeAt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_writeSessionData&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;BLECommand&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;CMD_DISPLAY_TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;output&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="nx"&gt;_writeSessionData&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;command&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;message&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getPeripheralIsConnected&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;output&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;message&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="nx"&gt;output&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;command&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;// attach command to beginning of message&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;let&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="nx"&gt;message&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;output&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;message&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;Base64Util&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;uint8ArrayToBase64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;output&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_ble&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;BLEUUID&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;service&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;BLEUUID&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;txChar&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;base64&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;使用display text打印&lt;code&gt;hello&lt;/code&gt;字符串，观察websocket传输的数据:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;jsonrpc&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;2.0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;method&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;write&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;params&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:{&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;serviceId&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;61445&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;characteristicId&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;5261da02-fa7e-42ab-850b-7c80220097cc&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;message&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;gWhlbGxv&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;encoding&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;base64&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这里值得一提的是编码方式:&lt;a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array"&gt;Uint8Array&lt;/a&gt;:  Uint8Array 数组类型表示一个8位无符号整型数组，创建时内容被初始化为0&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.w3school.com.cn/js/jsref_charCodeAt.asp"&gt;charCodeAt&lt;/a&gt;: 方法可返回指定位置的字符的 Unicode 编码。这个返回值是 0 - 65535 之间的整数。&lt;/p&gt;
&lt;p&gt;硬件的通信使用的编码可能部位web开发者熟悉，我对底层编码也不熟，多是现学现用，基本也够用.说到编码，想起一本书特别赞:&lt;a href="https://book.douban.com/subject/4822685/"&gt;编码&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="gatttool"&gt;使用gatttool做些实验&lt;/h3&gt;
&lt;p&gt;我在&lt;a href="https://blog.just4fun.site/ble-notes.html"&gt;BLE学习笔记&lt;/a&gt;有演示gatttool的使用&lt;/p&gt;
&lt;p&gt;我们在分析了Scratch/Scratch Link与micro:bit的通信之后，使用ble工具来做些分析，我在树莓派里使用gatttool，你可可以选择其他工具&lt;/p&gt;
&lt;p&gt;首先扫描micro:bit的地址&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pi@cozmo1:~ $ sudo hcitool lescan
DF:48:87:86:93:20 BBC micro:bit [zuzop]
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;连接它并进入交互模式:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pi@cozmo1:~ $ gatttool -I -b DF:48:87:86:93:20 -t random
[DF:48:87:86:93:20][LE]&amp;gt; connect
Attempting to connect to DF:48:87:86:93:20
Connection successful
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;连接成功！&lt;/p&gt;
&lt;p&gt;接着我们来看一下UART service的相关信息:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[DF:48:87:86:93:20][LE]&amp;gt; primary 0xf005 # 输入0xf005和f005相同，都被处理为16进制
Starting handle: 0x0013 Ending handle: 0xffff
[DF:48:87:86:93:20][LE]&amp;gt; char-desc 0x0013 0xffff
handle: 0x0013, uuid: 00002800-0000-1000-8000-00805f9b34fb
handle: 0x0014, uuid: 00002803-0000-1000-8000-00805f9b34fb
handle: 0x0015, uuid: 5261da01-fa7e-42ab-850b-7c80220097cc
handle: 0x0016, uuid: 00002902-0000-1000-8000-00805f9b34fb
handle: 0x0017, uuid: 00002803-0000-1000-8000-00805f9b34fb
handle: 0x0018, uuid: 5261da02-fa7e-42ab-850b-7c80220097cc
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;前头我们从源码里读到:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;BLEUUID&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;service&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mh"&gt;0xf005&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;rxChar&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;5261da01-fa7e-42ab-850b-7c80220097cc&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;txChar&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;5261da02-fa7e-42ab-850b-7c80220097cc&amp;#39;&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可知我们的猜测完全正确！Scratch Link是个透明代理。&lt;/p&gt;
&lt;p&gt;接着让我们来读取micro:bit的sensor数据,&lt;code&gt;rxChar: '5261da01-fa7e-42ab-850b-7c80220097cc'&lt;/code&gt;对应的handle为&lt;code&gt;0x0015&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[DF:48:87:86:93:20][LE]&amp;gt; char-read-hnd 0x0015
Characteristic value/descriptor: 00 5f ff f3 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;当我们按住按钮A时读到的数据为&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[DF:48:87:86:93:20][LE]&amp;gt; char-read-hnd 0x0015
Characteristic value/descriptor: 00 44 fe 57 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;多次按下和松开，并观察，我们猜测按钮存储在&lt;code&gt;00 44 fe 57 01&lt;/code&gt;中的&lt;code&gt;1&lt;/code&gt;这个位置上&lt;/p&gt;
&lt;p&gt;回忆一下前头的&lt;code&gt;_processSessionData&lt;/code&gt;函数，据此我们就弄懂了数据的编解码方式，我们可以还原出从rxChar读到的经base64编码的数据&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="nx"&gt;_processSessionData&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;base64&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="c1"&gt;// parse data&lt;/span&gt;
        &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;Base64Util&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;base64ToUint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;base64&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;tiltX&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;tiltX&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;tiltX&lt;/span&gt; &lt;span class="o"&gt;-=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;tiltY&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;tiltY&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;tiltY&lt;/span&gt; &lt;span class="o"&gt;-=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;buttonA&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;buttonB&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;

        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;touchPins&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;touchPins&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;touchPins&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;

        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_sensors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;gestureState&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;

        &lt;span class="c1"&gt;// cancel disconnect timeout and start a new one&lt;/span&gt;
        &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;clearInterval&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_timeoutID&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_timeoutID&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setInterval&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;disconnectSession&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;bind&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="nx"&gt;BLETimeout&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;我们也可以开启通知 &lt;!--0100还是0200完全是猜的，有依据吗--&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[DF:48:87:86:93:20][LE]&amp;gt; char-write-req 0x0016 0100
Characteristic value was written successfully
Notification handle = 0x0015 value: 00 29 00 8b 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Notification handle = 0x0015 value: 00 2d 00 85 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Notification handle = 0x0015 value: 00 2d 00 85 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Notification handle = 0x0015 value: 00 2d 00 86 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Notification handle = 0x0015 value: 00 2d 00 8b 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Notification handle = 0x0015 value: 00 2c 00 8d 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Notification handle = 0x0015 value: 00 2a 00 8d 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Notification handle = 0x0015 value: 00 2c 00 89 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
&lt;/pre&gt;&lt;/div&gt;


&lt;!--使用pygatt读取数据，使用BLED112 跨平台， 使用scratch3-adapter
mac下使用BLED112 https://github.com/peplin/pygatt/issues/159
 vim /usr/local/lib/python3.6/site-packages/pygatt/backends/bgapi/bgapi.py
adapter.scan() ok
但connect有问题
python  Byte Array to Hex String

https://stackoverflow.com/questions/19210414/byte-array-to-hex-string
--&gt;

&lt;p&gt;接着试试使用pygatt+BLED112在macOS下与micro:bit通信，使用BLED112，我们可以在mac/windows/linux下与ble设备通信&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pygatt&lt;/span&gt;
&lt;span class="n"&gt;adapter&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pygatt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;BGAPIBackend&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="c1"&gt;# 使用BLED112&lt;/span&gt;
&lt;span class="n"&gt;adapter&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="c1"&gt;# pygatt在macOS下有bug需要hack start函数: https://github.com/peplin/pygatt/issues/159， 也可以参考：https://github.com/jannopet/LEGO-WeDo-2.0-Python-SDK/blob/master/wedo2/smarthub.py#L20&lt;/span&gt;

&lt;span class="n"&gt;DEVICE_ADDRESS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;DF:48:87:86:93:20&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;ADDRESS_TYPE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pygatt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;BLEAddressType&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;random&lt;/span&gt;
&lt;span class="n"&gt;device&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;adapter&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;DEVICE_ADDRESS&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;address_type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ADDRESS_TYPE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;#value = device.char_read(&amp;quot;5261da01-fa7e-42ab-850b-7c80220097cc&amp;quot;)&lt;/span&gt;

&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;binascii&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;hexlify&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;handle_data&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;handle&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;    handle -- integer, characteristic read handle the data was received on&lt;/span&gt;
&lt;span class="sd"&gt;    value -- bytearray, the data returned in the notification&lt;/span&gt;
&lt;span class="sd"&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Received data: &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;hexlify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="c1"&gt;# todo 模仿前头js源码，对数据进行解包&lt;/span&gt;

&lt;span class="n"&gt;device&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subscribe&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;5261da01-fa7e-42ab-850b-7c80220097cc&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                     &lt;span class="n"&gt;callback&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;handle_data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;运行后，输出为:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Received data: b&amp;#39;00ab003600000000000000000000000000000000&amp;#39;
Received data: b&amp;#39;00ad003200000000000000000000000000000000&amp;#39;
Received data: b&amp;#39;00ad003000000000000000000000000000000000&amp;#39;
Received data: b&amp;#39;00ad003700000000000000000000000000000000&amp;#39;
Received data: b&amp;#39;00ad003700000000000000000000000000000000&amp;#39;
Received data: b&amp;#39;00ad003900000000000000000000000000000000&amp;#39;
Received data: b&amp;#39;00ad003900000000000000000000000000000000&amp;#39;
Received data: b&amp;#39;00ad003c00000000000000000000000000000000&amp;#39;
Received data: b&amp;#39;00ad003900000000000000000000000000000000&amp;#39;
Received data: b&amp;#39;00ad003700000000000000000000000000000000&amp;#39;
Received data: b&amp;#39;00ad003900000000000000000000000000000000&amp;#39;
Received data: b&amp;#39;00ad003c00000000000000000000000000000000&amp;#39;
Received data: b&amp;#39;00a9003d00000000000000000000000000000000&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如此一来我们就可以自己写Scratch Link了，而不必使用官方的！例如在scratch3-adapter中将microbit作为一个extension. 我最近正在将这部分写为一个python库。感兴趣的同学可以一起参与:&lt;a href="https://github.com/wwj718/scratch-microbit-python-sdk"&gt;scratch-microbit-python-sdk&lt;/a&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;接着我们来实验往microbit中写数据，我们前头提道display text积木，我们对其稍作调整,使其可在console运行，观察编码后的内容是什么:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cm"&gt;/**&lt;/span&gt;
&lt;span class="cm"&gt; * Enum for micro:bit BLE command protocol.&lt;/span&gt;
&lt;span class="cm"&gt; * https://github.com/LLK/scratch-microbit-firmware/blob/master/protocol.md&lt;/span&gt;
&lt;span class="cm"&gt; * @readonly&lt;/span&gt;
&lt;span class="cm"&gt; * @enum {number}&lt;/span&gt;
&lt;span class="cm"&gt; */&lt;/span&gt;

&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;CMD_DISPLAY_TEXT&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mh"&gt;0x81&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;


&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;Uint8ToBase64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;u8Arr&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;CHUNK_SIZE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mh"&gt;0x8000&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;//arbitrary number&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;length&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;u8Arr&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;slice&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;index&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;slice&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;u8Arr&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;subarray&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;index&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;Math&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;min&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;index&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;CHUNK_SIZE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt; 
    &lt;span class="nx"&gt;result&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="nb"&gt;String&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;fromCharCode&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;apply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;slice&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="nx"&gt;index&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="nx"&gt;CHUNK_SIZE&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;btoa&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;result&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;


&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;displayText&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;text&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;output&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;text&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;let&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="nx"&gt;text&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;output&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;text&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;charCodeAt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;_writeSessionData&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;CMD_DISPLAY_TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;output&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;function&lt;/span&gt;  &lt;span class="nx"&gt;_writeSessionData&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;command&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;message&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;output&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;message&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="nx"&gt;output&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;command&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;// attach command to beginning of message&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;let&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="nx"&gt;message&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;output&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;message&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="c1"&gt;// const data = Base64Util.uint8ArrayToBase64(output);&lt;/span&gt;
        &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;Uint8ToBase64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;output&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

        &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;output&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="c1"&gt;// return this._ble.write(BLEUUID.service, BLEUUID.txChar, data, &amp;#39;base64&amp;#39;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nx"&gt;displayText&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;hello&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; 
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;hello&lt;/code&gt;被编码后的为&lt;code&gt;gWhlbGxv&lt;/code&gt;，发现和前头websocket捕获的一致:&lt;code&gt;gWhlbGxv&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;但base64应该是Scratch Link与scratch通信时的编解码方式，为了使用gatttool与micro:bit通信，我们需要猜测Scratch Linkmicro:bit里的固件是如何如何约定编解码的，关于这点，官方采取了闭源的策略，估计是有意为之，我们稍后来hack它&lt;/p&gt;
&lt;p&gt;&lt;code&gt;hello&lt;/code&gt; 被编码后分别为：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gWhlbGxv //base64
Uint8Array(6) [129, 104, 101, 108, 108, 111]  //Uint8Array
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;试着以几种方式将他们转为16进制，都没有成功在micro:bit中显示&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;char-write-cmd 0x0018  xxx
&lt;/pre&gt;&lt;/div&gt;


&lt;!--
const resetEnergyExpended = new Uint8Array([1]);
    // resetEnergyExpended 的值是'1'，表示重置
    return characteristic.writeValue(resetEnergyExpended);

    是啥 会变为16进制吗

function buf2hex(buffer) { // buffer is an ArrayBuffer
  return Array.prototype.map.call(new Uint8Array(buffer), x =&gt; ('00' + x.toString(16)).slice(-2)).join('');
}

// EXAMPLE:
const buffer = new Uint8Array([129, 97]).buffer;
console.log(buf2hex(buffer)); // = 8161
--&gt;

&lt;p&gt;这导致我们需要使用一些嗅探工具抓包(BLE Sniffer)，之后用&lt;a href="https://www.wireshark.org/download.html"&gt;wireshark&lt;/a&gt;来分析，不过我手边暂时没有相应硬件，准备淘宝上买一个&lt;/p&gt;
&lt;p&gt;破解纯粹出于好玩，我们理解了官方的思路之后，自己重写一个micro:bit固件和是适配器也许比破解来得简单.使用makecode可以很轻松把gatt服务都搭了出来, 参考:&lt;a href="https://github.com/jaafreitas/scratch-microbit-extension/tree/master/firmware"&gt;scratch-microbit-extension&lt;/a&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;---2018年8月2号更新---&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;我昨晚回去路上一致在想如何在没买到嗅探工具之前，进行破解，网购到货得几天，路上想到几个策略，洗澡的时候又想到几个策略，兴奋不易，可惜晚上没带电脑和树莓派回去，没法做实验&lt;/p&gt;
&lt;p&gt;我想到的策略有：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;观察micro:bit ble 的extension是如何将Uint8Array数据write到txChar，这个extension不包含Scratch Link，源码都在js中，所以即便加密，策略也可以被看出，而micro:bit固件不太可能重写，如果弄清楚micro:bit ble 的extension的机制，估计就能hack官方的机制&lt;/li&gt;
&lt;li&gt;使用树莓派伪装成micro:bit，从js可以可以看出，只要能自定义service uuid就可以骗过官方插件，于是引诱它将数据写入树莓派中，如果有加密，有了加密前后的数据，就可以猜测加密的规则。但这样做的一个风险是Scratch Link可能会检验sensor数据的合法性（我在scratch3-adapter中就考虑了这个机制），如果不合法，可能会断开连接。当然这些需要做实验才知道&lt;/li&gt;
&lt;li&gt;等待官方完成wedo2的插件，由于它们共用Scratch Link，如果有加密，加密的机制很可能被抽象得一样，而wedo2已经被破解了，所以可以逆向分析出micro:bit部分的加密方式&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;今早一来试了下第一条猜想就成功了，事实证明我想多了，官方并没有做加密&lt;/p&gt;
&lt;p&gt;我们来看看在micro:bit ble extension中，官方是如何发送display text数据的&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nx"&gt;displayText&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;text&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;String&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;args&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;substring&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;19&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;output&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;text&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="nx"&gt;output&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;BLECommand&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;CMD_DISPLAY_TEXT&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;let&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="nx"&gt;text&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;output&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;text&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;charCodeAt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;postMessage&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="nx"&gt;type&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;command&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;buffer&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;output&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;*&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;addEventListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;message&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;event&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;event&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;type&lt;/span&gt; &lt;span class="o"&gt;===&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;command&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                &lt;span class="nx"&gt;txChar&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;writeValue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;event&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;event&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;type&lt;/span&gt; &lt;span class="o"&gt;===&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;status&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;event&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;status&lt;/span&gt; &lt;span class="o"&gt;===&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;connected&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gui.menuBar.bluetoothIndicator&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;src&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;greenIndicatorIcon&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;event&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;status&lt;/span&gt; &lt;span class="o"&gt;===&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;disconnected&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gui.menuBar.bluetoothIndicator&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;src&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;orangeIndicatorIcon&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可以看出官方啥也没做: &lt;code&gt;txChar.writeValue(event.data.buffer);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;我们从简单的字符串分析入手，先试试&lt;code&gt;a&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;websocket显示从前端发往Scratch Link的是：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;jsonrpc&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;2.0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;method&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;write&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;params&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:{&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;serviceId&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;61445&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;characteristicId&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;5261da02-fa7e-42ab-850b-7c80220097cc&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;message&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;gWE=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;encoding&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;base64&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在前端被编码后结果分别为：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gWE= //base64
Uint8Array(2) [129, 97]  //Uint8Array
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;我们只需要把buffer转为hex就行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;buf2hex&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;// buffer is an ArrayBuffer&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;Array&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;prototype&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;map&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;call&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="nx"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;00&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;x&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;toString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;)).&lt;/span&gt;&lt;span class="nx"&gt;slice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)).&lt;/span&gt;&lt;span class="nx"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;// EXAMPLE:&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;buffer&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;129&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;97&lt;/span&gt;&lt;span class="p"&gt;]).&lt;/span&gt;&lt;span class="nx"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;// display a -&amp;gt; [129, 97]&lt;/span&gt;
&lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;buf2hex&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt; &lt;span class="c1"&gt;// = 8161&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在树莓派的gatttool中：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[DF:48:87:86:93:20][LE]&amp;gt; char-write-cmd 0x0018 8161
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/microbit_scratch_2de5e6c9.png" width=500 /&gt;&lt;/p&gt;
&lt;p&gt;大功告成！&lt;/p&gt;
&lt;!--
read和write都是sendRemoteRequest 到 scratch link，关注语义，所以在scratch link中只需要关注read write！使用jsonrpc确实更合适，比消息简单--&gt;

&lt;h1 id="tips"&gt;tips&lt;/h1&gt;
&lt;p&gt;记录一些scratch团队的机智做法&lt;/p&gt;
&lt;h3 id="_6"&gt;连接设备&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://github.com/LLK/scratch-vm/blob/develop/src/extensions/scratch3_microbit/index.js#L116"&gt;startDeviceScan&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;用户选中extesion之后开始连接，只扫描出extension对应的设备，而不是把周围的BLE都扫描出来，体验十分友好&lt;/p&gt;
&lt;h3 id="https"&gt;https校验问题&lt;/h3&gt;
&lt;p&gt;由于网站都逐渐过渡到https，而Scratch Link是个本地websocker server，要让Scratch Link与浏览器通信，需要使用wss协议。而本地websocker server采用openssl本地自生成的证书的话，浏览器要让用户在一个新页面里点击高级设置才行，体验很不友好&lt;/p&gt;
&lt;p&gt;scratch团队的解决方案十分聪明, 让&lt;code&gt;device-manager.scratch.mit.edu&lt;/code&gt;这个域名指向&lt;code&gt;127.0.0.1&lt;/code&gt;，websocker server就可以使用这个域名的证书。&lt;/p&gt;
&lt;h4 id="scratch-link"&gt;Scratch Link的内部服务怎么写&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://github.com/LLK/scratch-vm/blob/develop/src/io/bleSession.js#L3"&gt;ScratchLinkWebSocket&lt;/a&gt;对应的server为&lt;code&gt;'wss://device-manager.scratch.mit.edu:20110/scratch/ble'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;BLESession的定位是:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A BLE device session object.  It handles connecting, over web sockets, to BLE devices, and reading and writing data to them.  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;看去是透明代理&lt;/p&gt;
&lt;p&gt;所以根据js的接口，要独立实现Scratch Link应该不难&lt;/p&gt;
&lt;h1 id="_7"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://scratch.mit.edu/microbit"&gt;scratch.mit.edu/microbit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://scratch.mit.edu/conference"&gt;conference&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://lancaster-university.github.io/microbit-docs/resources/bluetooth/bluetooth_profile.html"&gt;Bluetooth Developer Studio Level 3 Profile Report&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/ble-notes.html"&gt;BLE学习笔记&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://cn0xroot.com/2016/06/12/ble-hacking%EF%BC%9Able-scan-and-sniffer-withubertooth-one/"&gt;BLE Hacking：使用Ubertooth one扫描嗅探低功耗蓝牙&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://draapho.github.io/2016/11/15/1616-python-ble/"&gt;使用python实现BLE通讯&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/peplin/pygatt"&gt;pygatt&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Wed, 01 Aug 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-08-01:scratch3-microbit-analysis.html</guid><category>scratch</category></item><item><title>scratch社区一览</title><link>/scratch-community-analyze.html</link><description>&lt;p&gt;&lt;img alt="主页" src="http://wwj-fig-bed.just4fun.site/scratch_c_4915ab49.png" width=600 /&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Imagine, Program, Share&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;维基百科的&lt;code&gt;scratch&lt;/code&gt;词条里提到:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Scratch 设立了一个线上社群，其口号为“想像･程序･分享”，分享和创意是 Scratch 最重要的理念...线上社群中有不同类型的项目，范围包括游戏、动画、演示稿和聊天机器人。所有项目都以知识共享的特许方式发布&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;scratch社区是目前编程领域最庞大也最为活跃的社区之一，在少儿编程领域，更是一骑绝尘&lt;/p&gt;
&lt;p&gt;本文将对scratch社区做一番介绍，带领大家一览社区风采；同时我们也关心scratch社区的一些量化数据，并据此做一些解读和分析&lt;/p&gt;
&lt;p&gt;本文不是一篇scratch入门教程，入门引导可以参考&lt;a href="https://scratch.mit.edu/projects/236614170/#editor"&gt;开始使用 Scratch&lt;/a&gt;。 如果你对scratch的诞生和背后故事感兴趣，可以参考:&lt;a href="https://blog.just4fun.site/scratch.html"&gt; Scratch的前世今生&lt;/a&gt;&lt;/p&gt;
&lt;!--作为《少儿编程指北》的第一篇文章--&gt;

&lt;h1 id="scratch"&gt;走进scratch社区&lt;/h1&gt;
&lt;p&gt;MIT媒体实验室(&lt;a href="https://www.media.mit.edu/"&gt;Media Lab&lt;/a&gt;)主任&lt;a href="https://zh.wikipedia.org/zh-hans/%E4%BC%8A%E8%97%A4%E7%A9%B0%E4%B8%80"&gt;伊藤穰一&lt;/a&gt;在《爆裂》一书里提到:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;这个软件大受欢迎背后的真正原因是：一个全球范围的孩子社区，他们在其中分享建议、评论，同时支持Scratch的一项特殊功能——合成（Remix），即他们作品背后的源代码。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="scratch_1"&gt;&lt;a href="https://scratch.mit.edu/community_guidelines"&gt;scratch社区准则&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;scratch社区的繁荣离不开&lt;a href="https://scratch.mit.edu/community_guidelines"&gt;scratch社区准则&lt;/a&gt;，正如一个国家的繁荣离不开它的法律保障，也正是如此，&lt;a href="https://zh.wikipedia.org/zh/%E6%A2%AD%E4%BC%A6"&gt;梭伦&lt;/a&gt;作为立法者，为雅典人民所铭记&lt;/p&gt;
&lt;p&gt;我们来看看scratch社区有哪些&lt;a href="https://scratch.mit.edu/community_guidelines"&gt;准则&lt;/a&gt;: &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;我们需要彼此协助，才能让 Scratch 成为一个友善与富创造力的社区，我们欢迎不同背景与兴趣的人加入。

要有礼貌。
在分享项目或是发表评论时，请考虑到观看的人们遍布各个年龄层、来自不同生活背景。

我们富有建设性。
在别人的项目上发表时，说说你喜欢这个项目的原因，也给予一些建议。

共享
您可以自由的改编，像是构想、图案…任何 Scratch 项目中找到的东西都可以。不过，要记得尊重并感谢别人，你分享的项目也有可能会有被改编的时候。

将个人信息设为不公开。
基于安全性，请不要提供任何可用于私人通信的信息，例如真实姓名、电话、住址、信箱、社交媒体账号、或是聊天网站。

要有诚信。
不要冒充其他 Scratcher，或是随意散播谣言，甚至做欺骗整个社区的事情。

我们帮助维护站点的友好性。
如果你认为项目或评论的内容不恰当，像是过于血腥、暴力、色情，你可以点击「检举」按钮让我们处理。

任何人都可使用 Scratch，不分性别、年龄、种族、信仰和能力。
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这些准则写得十分富有智慧，保障了社区活跃而友好的气氛&lt;/p&gt;
&lt;h3 id="_1"&gt;&lt;a href="https://scratch.mit.edu/"&gt;社区主页&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;scratch&lt;a href="https://scratch.mit.edu/"&gt;社区主页&lt;/a&gt;如图所示：&lt;/p&gt;
&lt;p&gt;&lt;img alt="主页" src="http://wwj-fig-bed.just4fun.site/scratch_c_4915ab49.png" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;以下是我登陆之后，所看到的内容:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;正在发生的事？ : 显示了Scratchers最近的活动&lt;/li&gt;
&lt;li&gt;Scratch新闻 : Scratch团队在这里发布短消息&lt;/li&gt;
&lt;li&gt;精选项目:  Scratch团队所喜欢的项目&lt;/li&gt;
&lt;li&gt;特色工作室: 由Scratch团队挑选出的工作室&lt;/li&gt;
&lt;li&gt;PillowySleep挑选的项目:  由&lt;a href="https://en.scratch-wiki.info/wiki/Curator_(front_page)"&gt;策展人&lt;/a&gt;整理的项目，策展人有期任期&lt;/li&gt;
&lt;li&gt;Scratch设计室 - From Dusk 'Till Dawn:  随机显示当前Scratch Design Studio中的一些项目&lt;/li&gt;
&lt;li&gt;关注的工作室的项目:  与当前登录用户有关&lt;/li&gt;
&lt;li&gt;大家在改编的项目:  显示过去十天内被改编(Remix)最多的项目&lt;/li&gt;
&lt;li&gt;大家在赞的项目:  显示了过去十天中最受欢迎的项目&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="_2"&gt;&lt;a href="https://scratch.mit.edu/explore/projects/all"&gt;发现页&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;主页给用户推可送Ta可能感兴趣的项目(有点feed流的意味)，如果用户意犹未尽，可以进入&lt;a href="https://scratch.mit.edu/explore/projects/all"&gt;发现页&lt;/a&gt;去探索海量的社区作品，截止到今天(2018.07.18)，scratch社区里一共有&lt;code&gt;2930万&lt;/code&gt;用户分享了&lt;code&gt;3275万&lt;/code&gt;个项目。稍后我们将结合scratch的后台运营数据，做一些有趣的分析。&lt;/p&gt;
&lt;p&gt;发现页包含七个标签:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;全部&lt;/li&gt;
&lt;li&gt;动画&lt;/li&gt;
&lt;li&gt;艺术&lt;/li&gt;
&lt;li&gt;游戏&lt;/li&gt;
&lt;li&gt;音乐&lt;/li&gt;
&lt;li&gt;故事&lt;/li&gt;
&lt;li&gt;教程&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;你可以选择标签查看对应分类的项目。&lt;/p&gt;
&lt;p&gt;&lt;a href="https://scratch.mit.edu/explore/projects/all"&gt;发现页&lt;/a&gt;鼓励你去发现有趣的&lt;a href="https://scratch.mit.edu/explore/projects/all/"&gt;项目&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="projects" src="http://wwj-fig-bed.just4fun.site/scratch_c_c4943467.png" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;我们之前用Python写了个&lt;a href="https://zh.wikipedia.org/zh-hans/%E7%B6%B2%E8%B7%AF%E7%88%AC%E8%9F%B2"&gt;爬虫&lt;/a&gt;，爬取了&lt;a href="https://scratch.mit.edu/explore/projects/all/"&gt;项目&lt;/a&gt;每个标签下前9000个最流行的项目，共计5万余个。之后使用python对这些数据做了简单的分析和数据可视化，发现不少有趣的东西，这部分之后有机会单独写一篇文章来讨论&lt;/p&gt;
&lt;p&gt;发现页也鼓励你去寻找有趣的&lt;a href="https://scratch.mit.edu/explore/studios/all/"&gt;工作室&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="studio" src="http://wwj-fig-bed.just4fun.site/scratch_c_1d42cc6d.png " width=600 /&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://en.scratch-wiki.info/wiki/Studio"&gt;工作室&lt;/a&gt;可以将多个项目汇集在一起(可以视为一个收藏夹)。在Scratch 2.0之前，被称为galleries。大多数工作室都有一个特定的项目主题，诸如&lt;a href="https://scratch.mit.edu/studios/5047558/"&gt;Scratch Day Celebrations!&lt;/a&gt;汇集了Scratch Day庆祝活动相关的项目；而&lt;a href="https://scratch.mit.edu/studios/4982024/"&gt;Earth Day 2018&lt;/a&gt;汇集了2018地球日相关的项目:&lt;/p&gt;
&lt;p&gt;&lt;img alt="studio" src="http://wwj-fig-bed.just4fun.site/scratch_studio_21efe52b.png" width=600 /&gt;&lt;/p&gt;
&lt;!--
主题
    介绍以及如何使用这个社区
    不讨论如何使用scratch

内举不避亲 adapter

scratch社区是目前，少儿编程社区

--&gt;

&lt;h1 id="_3"&gt;社区的运营数据&lt;/h1&gt;
&lt;p&gt;简单介绍完社区，接着让我们根据scratch的&lt;a href="https://scratch.mit.edu/statistics/"&gt;后台运营数据&lt;/a&gt;，来对社区做个定量的了解。scratch团队公开了他们十多年来的运营数据。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;注意&lt;/strong&gt;:  数据采集的时间为本文写作时间: 2018.07.18&lt;/p&gt;
&lt;!--

https://scratch.mit.edu/statistics/data/monthly/
    age_distribution_data
    使用jupyter做些分析
        requests拿到json
--&gt;

&lt;h3 id="_4"&gt;统计概览&lt;/h3&gt;
&lt;p&gt;scratch社区包含:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;3275万 个分享项目&lt;/li&gt;
&lt;li&gt;2931万 名注册用户&lt;/li&gt;
&lt;li&gt;1亿6259万 条评论&lt;/li&gt;
&lt;li&gt;467万 个工作室&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="20186"&gt;2018年6月份网站流量&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;2亿5410万 页面浏览次数&lt;/li&gt;
&lt;li&gt;4652万 网站访问次数&lt;/li&gt;
&lt;li&gt;2343万 访客人数&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;scratch社区不愧是曾拖垮MIT学校内网的项目 :）&lt;/p&gt;
&lt;h3 id="_5"&gt;月活动趋势&lt;/h3&gt;
&lt;p&gt;&lt;img alt="studio" src="http://wwj-fig-bed.just4fun.site/scratch_data_08b8c476.png" width=800 /&gt;&lt;/p&gt;
&lt;p&gt;从图中我们可以看出，2018年5月份：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;新增项目 115万&lt;/li&gt;
&lt;li&gt;新增用户 113万&lt;/li&gt;
&lt;li&gt;新增评论 378万&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;从新增评论数可以看出，社区非常活跃&lt;/p&gt;
&lt;p&gt;新增项目、新增用户、新增评论三条曲线几乎保持同步，这也在情理之中&lt;/p&gt;
&lt;p&gt;从图中我们还可看出，2013.05对社区来说是个关键节点，从这个时间节点之后，社区用户迅速增长。我暂时还不清楚2013年的夏天scratch团队如何如此有力地推动社区的发展，了解这段历史的小伙伴欢迎来补充。&lt;/p&gt;
&lt;h3 id="_6"&gt;月活跃用户&lt;/h3&gt;
&lt;p&gt;&lt;img alt="studio" src="http://wwj-fig-bed.just4fun.site/scratch_data_a256ba33.png" width=800 /&gt;&lt;/p&gt;
&lt;p&gt;从图中发现有个现象很有趣，每年的5-8月份，社区活跃度开始下降，8月份之后才开始回升&lt;/p&gt;
&lt;p&gt;我们综合社区发布的所有数据来推测一下原因: 从scratch社区用户空间分布我们得知，社区用户主体在美国(46.14%),接近总体用户的一半;  从用户年龄分布我们得知，80%以上的用户处于k12阶段(下文有详细数字)，接着查阅美国的中小学学期表，我们发现，美国中小学从5月下旬开始陆续放假，到9月份开学(和中国类似)。由此我猜测，美国学生多数在假期里放下了学习。想来是没什么scratch暑期补习班的&lt;/p&gt;
&lt;p&gt;这个现象可能给美国面向K12的编程教育公司的启示是:  暑假期间不宜做活动和宣传，用户参与度不高&lt;/p&gt;
&lt;h3 id="_7"&gt;用户年龄分布&lt;/h3&gt;
&lt;p&gt;&lt;img alt="studio" src="http://wwj-fig-bed.just4fun.site/scratch_data_997edfe4.png" width=600 /&gt;&lt;/p&gt;
&lt;!--写个server 查询区间人数--&gt;

&lt;p&gt;用户数随年龄的分布呈钟形曲线&lt;/p&gt;
&lt;p&gt;我在jupyter中用Python拿到原始数据之后，做了些简单的数据分析，发现不少有趣的信息:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;社区里，12岁用户人群最大，有301.8万，占总用户数的11.1%&lt;/li&gt;
&lt;li&gt;K–12(从幼儿园（Kindergarten，通常5-6岁）到十二年级（grade 12，通常17-18岁）)用户人群是scratch社区的主体，人数为2220.8万，占总人数的81.7%&lt;/li&gt;
&lt;li&gt;scratch宣称主要为8-16的孩子设计。从数据中我们看到，这个人群的数量为1841万,比例占全体的67.7%&lt;/li&gt;
&lt;li&gt;8岁以下的低龄用户达124万。随着为低龄化用户设计的scratchjr的流行，低龄用户比例应该还会降低。&lt;/li&gt;
&lt;li&gt;从图中，我们看到18岁用户人数很突兀，按照钟形曲线的趋势，18岁用户人群数，应该在90万左右，但实际人数竟达到了204万,2倍不只于预期人数。我对美国的教育不大了解，此中原因我还猜不出&lt;/li&gt;
&lt;li&gt;18岁以上的成年用户，有695万，超过总人数的四分之一，由此可见，scratch远不只是少儿编程社区&lt;/li&gt;
&lt;li&gt;社区用户年龄的中位数为14岁。社区用户的平均年龄为16.3岁&lt;/li&gt;
&lt;li&gt;令人震惊的是，年龄60岁以上的用户竟也有16万！不禁令人想到scratch之父在&lt;a href="blob:https://embed.ted.com/607e7bc6-7a0d-4a69-8463-dc45bcfa8462"&gt;Learn to Code, Code to Learn&lt;/a&gt;中提到，他年迈的老母亲在他生日的时候，用scratch制作了一张电子贺卡送给他&lt;/li&gt;
&lt;li&gt;80岁用户有2473人！&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="_8"&gt;用户空间分布&lt;/h3&gt;
&lt;p&gt;&lt;img alt="studio" src="http://wwj-fig-bed.just4fun.site/scratch_data_014a18d3.png" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;从图中我们可以看出，社区用户主体在美国(46.14%),接近总体用户的一半。&lt;/p&gt;
&lt;p&gt;中国用户数为31.6万，占社区用户的1.09%&lt;/p&gt;
&lt;p&gt;根据我所了解的一些信息，我猜测国内使用scratch的用户不只十倍于这个数量，他们没有进入scratch社区可能的原因有&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;国内网络访问社区不流畅&lt;/li&gt;
&lt;li&gt;使用scratch的离线版本&lt;/li&gt;
&lt;li&gt;用户被分流到国内不同平台&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="_9"&gt;每月项目分享情况&lt;/h3&gt;
&lt;p&gt;&lt;img alt="studio" src="http://wwj-fig-bed.just4fun.site/scratch_data_b58c596d.png" width=800 /&gt;&lt;/p&gt;
&lt;p&gt;从图中我们可以看出，新增的改编(Remix)项目 略多于 新增白板项目 的1/3，社区成员积极地利用社区已有项目来开展自己的工作，我觉得这是个很好的现象。&lt;/p&gt;
&lt;p&gt;但这个比例不算太高，远低于github社区里的代码重用率，github社区成员重用了社区里80%以上的代码（2017年数据）。其中的原因有很多，它向我们揭示了scratch社区的一些不足，也给我们指明了改进scratch社区的一些方向: &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;如何让用户更容易找到与它们目标相关的项目，以便于他们能在他人工作的基础上开始新的编程。&lt;/li&gt;
&lt;li&gt;如何更方便地重用代码，目前只有Remix一条策略，积木化代码难以片段式地复制和重用&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;我想到一些改进的思路和策略，包括:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;引入自然语言分析、图像识别以及增强推荐系统来解决第一个问题&lt;/li&gt;
&lt;li&gt;引入代码片段的收藏机制&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我们之后会构建一个面向国内用户的scratch社区，会在那儿实践这些想法&lt;/p&gt;
&lt;h3 id="_10"&gt;每月评论&lt;/h3&gt;
&lt;p&gt;&lt;img alt="studio" src="http://wwj-fig-bed.just4fun.site/scratch_data_aba5d56e.png" width=800 /&gt;&lt;/p&gt;
&lt;p&gt;从数据我们可以看出，社区成员之间的交流十分广泛，远不止限于讨论项目，而是深度参与其中。&lt;/p&gt;
&lt;!--
### all
https://api.scratch.mit.edu/explore/projects?limit=16&amp;offset=0&amp;language=en&amp;mode=trending&amp;q=*

### games
https://api.scratch.mit.edu/explore/projects?limit=16&amp;offset=0&amp;language=en&amp;mode=trending&amp;q=games

### popular and games
https://api.scratch.mit.edu/explore/projects?limit=16&amp;offset=0&amp;language=en&amp;mode=popular&amp;q=games

词云

---

看一下对github的分析  可视化

看不同的图表

看一个典型数据
--&gt;

&lt;h1 id="_11"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/wiki/K%E2%80%9312"&gt;K–12&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/zh-cn/Scratch"&gt;Scratch&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://scratch.mit.edu/"&gt;scratch.mit.edu&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://wiki.scratch.mit.edu/"&gt;Scratch Wiki&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://scratch.mit.edu/community_guidelines"&gt;Scratch Community Guidelines&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/whiplash.html"&gt;读书摘记 爆裂&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://en.scratch-wiki.info/wiki/Front_Page"&gt;scratch-wiki Front Page&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://en.scratch-wiki.info/wiki/Studio"&gt;scratch-wiki Studio&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://en.scratch-wiki.info/wiki/Explore"&gt;scratch-wiki Explore&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.zhihu.com/question/20690652"&gt;什么叫feed流？&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/zh-hans/%E7%B6%B2%E8%B7%AF%E7%88%AC%E8%9F%B2"&gt;网络爬虫&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://scratch.mit.edu/statistics/"&gt;scratch statistics&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://scratch.mit.edu/studios/4982024/"&gt;Earth Day 2018&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://scratch.mit.edu/studios/5047558/"&gt;Scratch Day Celebrations!&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!--    
爆裂中关于社区的讨论：
    *  由权威向“涌现”的转变中，另外一个重要因素便是免费和便宜的在线教育和社区教育的普及。这不仅包括edX等正式课程，也包括可汗学院（Khan Academy）等教育网站、创客空间（hackerspaces）的实践课、通过网络开展的或面对面的非正式同伴辅导等。人们学习新技能的机会越多，创新能力就越强
    *  弱连接——连接点头之交和朋友的朋友——在连接社区和创造陌生人之间的信任和联系方面有巨大的潜力。因此，具有广泛弱连接的人有更多机会从他们的人际关系网络中获取资源。正如马尔康姆·格拉德维尔（Malcolm Gladwell）指出的，我们的点头之交是我们获取新想法和资讯的最大来源。
    *  扎克发现了这个软件大受欢迎背后的真正原因：一个全球范围的孩子社区，他们在其中分享建议、评论，同时支持Scratch的一项特殊功能——合成（Remix），即他们作品背后的源代码。
--&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Wed, 18 Jul 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-07-18:scratch-community-analyze.html</guid><category>scratch</category></item><item><title>两种硬件编程风格的比较</title><link>/Hardware-Programming-style.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/message_a34afc78.png" /&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;人的心智活动透过简单的概念而发挥它的力量，方法主要可分为三种：第一，把数个简单的概念组合成一个复合的概念，于是所有复杂的概念成焉。第二，将两个概念，不论简单或复杂，不将它们结合，而是同时并列在一起观察，如此就能得知何为相互关联。第三，把某些概念，与伴随它们其他真实存在的概念区隔出来，称为这抽象艺术化，所有一般化，概化的概念皆是由此而生  - 约翰·洛克《人类理解论》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在&lt;a href="https://blog.just4fun.site/scratch3-microbit.html"&gt;scratch3.0 + micro:bit&lt;/a&gt;中，我们提到&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;在少儿编程/硬件编程教育领域，硬件编程有两种风格，我将这两种风格分别称为&lt;code&gt;灌入式&lt;/code&gt;和&lt;code&gt;交互式&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我相信就编程教育而言，&lt;code&gt;交互式&lt;/code&gt;优于&lt;code&gt;灌入式&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;这篇文章我们将讨论这两种编程风格给学习者的编程体验 以及心理状态所带来的影响。所谈论的很多内容，在编程语言的发展历史中都被反复讨论过。&lt;/p&gt;
&lt;p&gt;本文中，我们只讨论图形化硬件编程，但得出的结论并不局限于此&lt;/p&gt;
&lt;h3 id="_1"&gt;灌入式&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;灌入式&lt;/code&gt;阵营有名的图形化项目包括：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.microsoft.com/en-us/makecode"&gt;makecode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/bbcmicrobit/PythonEditor"&gt;PythonEditor&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://mixly.org/"&gt;mixly&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;以及国内大多数项目(makeblock、mcookie...)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;事实上，几乎所有传统的硬件编程都是灌入式的&lt;/p&gt;
&lt;h5 id="_2"&gt;编程方式&lt;/h5&gt;
&lt;p&gt;我们以&lt;a href="https://pxt.microbit.org/"&gt;makecode microbit&lt;/a&gt;为例，来展示灌入式编程的编程方式.&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/microbit_gr_de9399e6.png" width=500 /&gt;&lt;/p&gt;
&lt;p&gt;在&lt;a href="https://pxt.microbit.org/"&gt;makecode microbit&lt;/a&gt;中，通过拖拽积木，拼搭出我们的程序，接着将程序下载到本地（程序在线上完成编译），最后将下载的文件拖入micro:bit，即可运行。&lt;/p&gt;
&lt;p&gt;将代码/固件灌入硬件中，代码(代码编译出的固件)将在硬件运行。我将这种编程风格称为&lt;code&gt;灌入式&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;如果你熟悉blockly,你会发现这是一种典型的blockly风格(当然，blockly也可以写出交互式风格的blockly app)&lt;/p&gt;
&lt;h3 id="_3"&gt;交互式&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;交互式&lt;/code&gt;阵营的图形化编程项目有:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.anki.com/en-us/cozmo/code-lab"&gt;Cozmo code lab&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://en.scratch-wiki.info/wiki/PicoBoard"&gt;scratch Picoboard&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://s4a.cat/"&gt;S4A&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://llk.github.io/scratch-gui/microbit/"&gt;scratch microbit extension&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/lab/scratch3-adapter-docs/"&gt;scratch3-adapter&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id="_4"&gt;编程方式&lt;/h5&gt;
&lt;p&gt;我们以&lt;a href="https://www.anki.com/en-us/cozmo/code-lab"&gt;cozmo code lab&lt;/a&gt;为例，来展示&lt;code&gt;交互式&lt;/code&gt;编程的编程方式.&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/cozmof70f49bd.png" /&gt;&lt;/p&gt;
&lt;p&gt;在&lt;a href="https://www.anki.com/en-us/cozmo/code-lab"&gt;cozmo code lab&lt;/a&gt;中，你同样身处积木化的编程界面里，通过拖拽积木，拼搭出所需的程序，点击运行，cozmo即可按照程序的逻辑运行。&lt;/p&gt;
&lt;p&gt;程序运行在ipad/手机上，每个积木在实际执行的时候，将消息发给cozmo，从而控制cozmo，这是我将这种风格程序成为&lt;code&gt;交互式&lt;/code&gt;的原因&lt;/p&gt;
&lt;p&gt;在&lt;a href="https://www.anki.com/en-us/cozmo/code-lab"&gt;cozmo code lab&lt;/a&gt;中一个非常惊艳的编程体验是:如果你不知道一个积木有什么作用，你不必去翻说明书，你只需要点击一下这个积木，cozmo立马执行这个积木的逻辑，你可以直观地理解陌生的积木。交互式编程所具有的及时反馈特性，鼓励学习者去探索。这是交互式编程给学习者心理上带来的影响之一。&lt;/p&gt;
&lt;p&gt;&lt;a href="https://zh.wikipedia.org/wiki/%E5%BB%BA%E6%A7%8B%E4%B8%BB%E7%BE%A9_(%E5%AD%B8%E7%BF%92%E7%90%86%E8%AB%96)"&gt;建构主义&lt;/a&gt;者(如皮亚杰、艾伦凯、派普特)应该会喜欢这种风格&lt;/p&gt;
&lt;p&gt;如果你熟悉scratch，你会发现这是一种典型的&lt;code&gt;scratch&lt;/code&gt;风格（对象响应消息，很&lt;a href="https://zh.wikipedia.org/zh-hans/Smalltalk"&gt;Smalltalk&lt;/a&gt;）。关于scratch风格和blockly风格的比较可以参考我之前的文章:&lt;a href="https://blog.just4fun.site/scratch3-blockly.html"&gt;Blockly与Scratch3.0的比较分析及选型建议&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="_5"&gt;对比分析&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;真理越辩越明&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--
我很喜欢柏拉图《对话录》里苏格拉底对战普罗塔戈拉那一卷

工程师小普和小苏分别拥护`灌入式`和`交互式`，他们决定cosplay苏格拉底对战普罗塔戈拉来一场辩论

小苏:  好久不见啊小普，近来忙些什么

小普:  
--&gt;

&lt;p&gt;在此我们来对比分析一下&lt;code&gt;灌入式&lt;/code&gt;和&lt;code&gt;交互式&lt;/code&gt;各自的优势&lt;/p&gt;
&lt;p&gt;灌入式阵营可能列出的优势有:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;灌入式可以离线运行，只需要将代码烧入进去，即可脱离编程工具&lt;/li&gt;
&lt;li&gt;灌入式将带来优于交互式的实时性&lt;/li&gt;
&lt;li&gt;灌入式因为需要generate代码，学生可以查看代码&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;如果有遗漏，欢迎拥护&lt;code&gt;灌入式&lt;/code&gt;编程的小伙伴来信(wuwenjie718@gmail.com)补充&lt;/p&gt;
&lt;p&gt;由于我拥护&lt;code&gt;交互式&lt;/code&gt;编程，所以我准备在下文里，反驳&lt;code&gt;灌入式&lt;/code&gt;的优势，并指出&lt;code&gt;交互式&lt;/code&gt;所具有的优势。如果你不赞同，欢迎来信反驳，观点合理的话，我会及时更新到本文，如有必要，我们也可以使用&lt;a href="https://www.kialo.com/"&gt;理性辩论的平台 Kialo&lt;/a&gt;来进行辩论&lt;/p&gt;
&lt;h3 id="_6"&gt;反驳灌入式的优势&lt;/h3&gt;
&lt;p&gt;我们针对上边&lt;code&gt;灌入式&lt;/code&gt;阵营提出的三条优势，逐条反驳&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;灌入式可以离线运行，只需要将代码烧入进去，即可脱离编程工具&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这个论述本身并没有需要反驳的地方，它只是陈述了一个事实，在此我想提出的是，对于教育而言，&lt;code&gt;离线运行&lt;/code&gt;不是很重要的特性，如果是工业级的项目或者解决具体问题的硬件产品，离线运行可能是重要的，但对于教育项目而言，我认为这个特性并不重要，如果你实在不愿意一直开着电脑，你可以把上位机运行在树莓派里，若嫌贵，可以使用荔枝派(只要9块9哦)。但需要提醒的是，为了得到&lt;code&gt;离线运行&lt;/code&gt;的特性，我们很可能会失去交互性(这个问题不是很好讨论，如果需要,我们之后专门来说说这两个特性在什么情况可能冲突，而不可兼得)。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;灌入式将带来优于交互式的实时性&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;和上一条观点一样，我认为严格的&lt;code&gt;实时性&lt;/code&gt;在编程教育中并不重要，交互式理论上足以提供毫秒级别的实时性，更高的实时性在教育中是否必要，我持怀疑态度。我将&lt;code&gt;离线运行&lt;/code&gt;和&lt;code&gt;实时性&lt;/code&gt;视为一种对机器性能的优化，前者节约资源、后者节约时间，但这种节约下来的时间，短得也许人类不能感知。我承认在一些竞技类的比赛中，&lt;code&gt;实时性&lt;/code&gt;是至关重要的，但在教育中，尤其是低龄化编程教育中，被教育者是这件事的核心，我认为这些特性并不重要，尤其是考虑到这些特性可能和交互性冲突&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;灌入式因为需要generate代码，学生可以查看代码&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;给用户呈现积木所对应的代码，是个帮助用户从图形化过度到文本编程的好办法. 但generate代码这件事并不限于&lt;code&gt;灌入式&lt;/code&gt;,&lt;code&gt;交互式&lt;/code&gt;的编程界面里，虽然你并不需要generate代码，但如果愿意，完全可以为每个积木生成对应的代码，而且可以是&lt;code&gt;任何语言，任何抽象粒度&lt;/code&gt;。&lt;code&gt;灌入式&lt;/code&gt;阵营的小伙伴可能会反驳说，你们generate的代码并不是真正用于运行的。我会回答说: 对，我恰恰认为，不该把真正执行的代码generate出来给用户看。积木之所以是个好工具，正是因为它能自如地隐藏复杂度，暴露出合适粒度的概念颗粒，积木并不只是帮助我们省去记忆语法规则，更重要的是，它允许我们根据学生所处的阶段，给予他不同抽象程度的积木。我很喜欢来自lisp社区的忠告:&lt;code&gt;表达你的意图，而不是操作过程，这样有助于我们能站在更高的抽象层面上&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;关于这一点，&lt;a href="code.org"&gt;code.org&lt;/a&gt;给了我们很好的示范，一个学习者，在&lt;a href="code.org"&gt;code.org&lt;/a&gt;里在拖拽了两个积木之后，他看到页面里愤怒的小鸟往东飞一步，接着又往北飞一步，最后成功击中了小猪。&lt;/p&gt;
&lt;p&gt;如果学习者愿意，他可以看看与积木等价的代码：&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/codeorg_9b3de524.png" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;我们看到，这些代码隐藏了很多实现的细节，你也许要抱怨说code.org在欺骗学习者，这并不是真正运行的代码，&lt;code&gt;真正的代码&lt;/code&gt;是由js在操控svg的元素，但你确定你要给出这个粒度的东西吗？&lt;code&gt;真正的代码&lt;/code&gt;也许是一串&lt;code&gt;001101101...&lt;/code&gt;. 我认为平台给出合适抽象粒度的积木在编程教育里是至关重要的&lt;/p&gt;
&lt;p&gt;就这点而言，目前很多灌入式的图形化编程并不适合编程教育，尤其不适合少儿编程，他们直接把驱动硬件代码包装到积木下就了事了，积木颗粒在抽象程度上与硬件文本编程无异。如何设计出合适抽象粒度的积木块，不是个简单的问题，我认为这块的从业者都该多看看cozmo和makecode&lt;/p&gt;
&lt;h3 id="_7"&gt;交互式的优势&lt;/h3&gt;
&lt;p&gt;反驳完灌入式的优势，接着我们来谈谈&lt;code&gt;交互式&lt;/code&gt;的优势何在，我先简单列出，之后逐条陈述&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;及时的反馈&lt;/li&gt;
&lt;li&gt;允许单步调试&lt;/li&gt;
&lt;li&gt;软件编程和硬件编程，不必区分，虚拟人物与现实硬件能彼此联动&lt;/li&gt;
&lt;li&gt;强大的可扩展性&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;罗列完&lt;code&gt;交互式&lt;/code&gt;的优势后，我们来逐条陈述它们.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;及时的反馈&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我认为这一条，对编程教育是至关重要的。&lt;/p&gt;
&lt;p&gt;我们从&lt;code&gt;REPL&lt;/code&gt;（Read-Eval-Print-Loop）说起，&lt;a href="https://zh.wikipedia.org/wiki/LISP"&gt;LISP&lt;/a&gt;最早为我们带来&lt;a href="https://zh.wikipedia.org/zh-hans/%E8%AF%BB%E5%8F%96%EF%B9%A3%E6%B1%82%E5%80%BC%EF%B9%A3%E8%BE%93%E5%87%BA%E5%BE%AA%E7%8E%AF"&gt;REPL&lt;/a&gt;。REPL是个交互式的编程环境，用户输入的表达式及时被求值运行，并输出，这对于学习一门新的编程语言有很大的帮助，因为它能立刻对初学者做出回应，所以这个概念被移植到很多编程语言环境里（Python, Scala , Java(since jdk-9)...）。这种交互式的编程环境使得探索性的编程和调试更加便捷，因为“读取-求值-输出”循环通常会比经典的“编辑-编译-运行-调试”模式要更快，这两者的差异很像&lt;code&gt;交互式&lt;/code&gt;和&lt;code&gt;灌入式&lt;/code&gt;的差异。我自己使用REPL的一个强烈感受是，在REPL环境中（如ipython），我更乐于探索，对于不懂的api，我会直接做个实验，看看效果，获得直观感受。REPL鼓励每个人在探索中成为自己知识的构建者。而这点正式是早期致力于推广少儿编程的先驱们(艾伦凯、派普特)所追求的&lt;/p&gt;
&lt;p&gt;我将硬件编程里的&lt;code&gt;交互式&lt;/code&gt;编程方式，视为一种硬件编程的&lt;code&gt;REPL&lt;/code&gt;。如同我在前头举例说的&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;在&lt;a href="https://www.anki.com/en-us/cozmo/code-lab"&gt;cozmo code lab&lt;/a&gt;中一个非常惊艳的编程体验是:如果你不知道一个积木有什么作用，你不必去翻说明书，你只需要点击一下这个积木，cozmo立马执行这个积木的逻辑，你可以直观地理解陌生的积木。交互式编程所具有的及时反馈特性，鼓励学习者去探索系统。这是交互式编程给学习者心理上带来的影响之一。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;对教学和平台而言，及时的反馈也能带来诸多好处，有了来自硬件的反馈信息，我们可以在平台中给出更多的提示信息，来指导学生修正错误，或者引导他抵达目标，目前国外社区已经有这块的试水者，我正在关注，之后有机会专门写一篇文章。&lt;/p&gt;
&lt;p&gt;--- 2019.01.26更新&lt;/p&gt;
&lt;p&gt;Bret Victor在&lt;a href="https://www.youtube.com/watch?v=PUv66718DII"&gt;Inventing on Principle&lt;/a&gt;支持了这个观点。及时的反馈对于创造是非常重要的。&lt;/p&gt;
&lt;p&gt;“创造者需要即时的反馈” &lt;/p&gt;
&lt;p&gt;“如果你无法即时看到东西，就无法找到你要的灵感”&lt;/p&gt;
&lt;p&gt;“你应该看到你做出的改变对系统的即时影响”&lt;/p&gt;
&lt;p&gt;“想法需要一个环境，创作者可以培育它们”&lt;/p&gt;
&lt;!--媒体连接原则， 创作者需要看到什么 看到时间和世界线
if there is something in the world you feel the wrong and you have a vision for what a better world could be
what matters you？ what you believe in？ what you might fight for？
--&gt;

&lt;blockquote&gt;
&lt;p&gt;允许单步调试&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;如果学习者写了一段较为复杂的代码，运行时没有达到预期效果，人们往往无法通过阅读代码找出问题（错误往往揭示了知识或思维盲区），它需要逐行运行代码，看看效果，然后判断究竟是哪一步出了问题，这就是单步调试之所以如此重要的原因，即便对于专业程序员，也是如此。在&lt;code&gt;灌入式&lt;/code&gt;中我们无法做到单步调试，因为代码是一股脑灌入硬件的。但&lt;code&gt;交互式&lt;/code&gt;允许我们这样做，因为每次都是消息通信，所以编程界面可以逐步地给硬件发送控制指令。如果你观察过学生在code.org中通过单步调试找到问题，并顺利前行，你就知道这个特性有多棒&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;软件编程和硬件编程，不必区分，虚拟角色与现实硬件能彼此联动&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在图形化编程这块，学习者很可能是先学了软件编程，通过闯关式的学习，利用积木控制虚拟角色来达到目标，在这个过程中掌握编程概念。&lt;code&gt;交互式&lt;/code&gt;硬件编程允许你把硬件也接入到这些web平台里。如此一来，无论是教学软件还是硬件，平台架构上将毫无差别，学生的编程体验也几乎没有差别。它们学习软件编程所积累的知识完全可以用于硬件部分。&lt;/p&gt;
&lt;p&gt;而在创作类平台中(比如scratch)，&lt;code&gt;交互式&lt;/code&gt;编程允许虚拟角色与物理硬件彼此沟通，你可以自由联通虚拟与现实世界，制作体感游戏和富有表现力的故事。这将为我们带来更高的&lt;code&gt;高天花板&lt;/code&gt;和更多的趣味性，从而点燃大家的热情&lt;/p&gt;
&lt;p&gt;关于这块的有趣例子可以参考:&lt;a href="https://codelab-adapter-docs.codelab.club/user_guide/gallery/"&gt;scratch3-adapter-docs gallery&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;强大的可扩展性&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;交互式&lt;/code&gt;还将为我们带来强大的可扩展性，&lt;a href="https://zh.wikipedia.org/zh-hans/ROS"&gt;ROS(Robot Operating System)&lt;/a&gt;和&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;scratch3_adapter&lt;/a&gt;是很好的两个例子。因为基于消息通信，各个部分彼此解耦，这些系统本质上是分布式的，你可以接入任何东西，在&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;scratch3_adapter&lt;/a&gt;中，硬件方面,我们已经接入了:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://microbit.org/"&gt;micro:bit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.anki.com/en-us/cozmo"&gt;Cozmo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://store.sphero.com/products/bb-8-by-sphero"&gt;BB8&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.raspberrypi.org/"&gt;树莓派&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/scratch3-smart-home.html"&gt;智能家居&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;AI方面，我们接入了:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://azure.microsoft.com/zh-cn/services/cognitive-services/"&gt;微软认知服务&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://js.tensorflow.org/"&gt;本地化的机器视觉&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://opencv.org/"&gt;opencv&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://pjreddie.com/darknet/yolo/"&gt;实时物体检测&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;一些简单的本地自然语言处理(移植了mit media lab的实验项目)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果你愿意，你可以将小时候的玩具四驱车接入进来。&lt;/p&gt;
&lt;h1 id="_8"&gt;如何实现&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;everything is message&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;天色已晚，明天要早起，这部分就不多写了，之后单独讨论&lt;/p&gt;
&lt;p&gt;如果你熟悉LISP,为了实现一个 LISP REPL，只需要实现read、eval、print三个函数和一个不停轮询的函数(loop)即可,一个基本的REPL可以用如下的简单形式表达：(loop (print (eval (read))))&lt;/p&gt;
&lt;p&gt;一旦你理解了这个概念，就可以自己动手去硬件上实现了。&lt;/p&gt;
&lt;p&gt;事实上，社区里的交互式项目(如S4A、snap4arduino、s4m)思路基本都是一样的&lt;/p&gt;
&lt;p&gt;我们自己动手实现了&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;scratch3_adapter&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;我把思考和构建&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;scratch3_adapter&lt;/a&gt;的过程都记录在博客里，如果你有兴趣，也可以根据我的架构设计，自己实现:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/scratch3-plugin-1.html"&gt;为Scratch3.0设计的插件系统(上篇)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/scratch3-plugin-2.html"&gt;为Scratch3.0设计的插件系统(下篇)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/Scratch3-Lab.html"&gt;Scratch3 Lab: 将Scratch3接入开源硬件及AI的实验项目&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;scratch3-adapter-docs&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;当然我更鼓励你加入我们，我们已经为开发者准备好了&lt;a href="https://codelab-adapter-docs.codelab.club/dev_guide/helloworld/"&gt;开发手册&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;我私下认为&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;scratch3_adapter&lt;/a&gt;基于zeromq的实现也许是目前扩展性最好的，欢迎入坑 ：）&lt;/p&gt;
&lt;!--
### 可扩展性
ROS和adapter是个很好的例子，可以做出任意复杂的东西，

这背后的想法是，硬件只是更大系统的一部分  观察传感器的状态

你可以把利用云端的AI，利用本地的摄像头 来自不同的硬件 当温度30度时  人物说很热


这是一种，ROS的策略，adapter在架构上，很多地方模仿了ROS，关于这点，参考:[]()

在体验式，引导你尝试，而这是少儿编程的开创者们所鼓励的 在实践中去把我概念

当温度25度时 打开空调

# 为何交互式是更好的模式
学习硬件本身 还是利用硬件做出其他应用

我为何要知道串口式什么

就像我们教学python的时候，不会教学它的C实现  操作系统原理

adapter致力于将万物积木化，在adapter你可以让google的AI与小米的智能家居互动，这是scratch的思路

mixly则是一个blockly app，致力于映射，你可以将硬件抽象为积木

# microbit
用键盘控制micro:bit

使用消息  可以控制粒度

使用烧录，必须控制串口

总是能写出server代码的，但设计上 这块应该被抽象

--&gt;

&lt;h1 id="_9"&gt;补遗&lt;/h1&gt;
&lt;h3 id="_10"&gt;通讯补丁&lt;/h3&gt;
&lt;p&gt;灌入式编程在一定程度上，也可以实现&lt;code&gt;交互&lt;/code&gt;特性，一种策略是采用&lt;code&gt;通讯变量&lt;/code&gt;的概念, makeblock的mblock很好地利用了这点&lt;/p&gt;
&lt;p&gt;利用通讯变量，你可以让上下位机实现彼此沟通&lt;/p&gt;
&lt;p&gt;技术实现的话，也不会太难，在硬件里跑一个独立的通信进程就行，之后通过uart或其他通道与上位机沟通就行&lt;/p&gt;
&lt;p&gt;你最好将这种方式视为一种补丁，&lt;code&gt;通讯变量&lt;/code&gt;是一种补充策略，通过这种补丁，你无法做到&lt;code&gt;交互式&lt;/code&gt;的所有特性，但这依然不失为一种很聪明的做法&lt;/p&gt;
&lt;h3 id="_11"&gt;关于灌入式与交互式的混合&lt;/h3&gt;
&lt;p&gt;如何看待一个编辑器同时支持灌入式与交互式风格？&lt;/p&gt;
&lt;p&gt;我的看法是:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;do one thing and do it well&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;大体来说，我不认同这种做法。我不知道什么是好的方案来协调这两者，能兼得二者的好处，如果你有好的建议，愿意分享就太棒啦。&lt;/p&gt;
&lt;p&gt;我目前只看到一些&lt;a href="https://zh.wikipedia.org/wiki/%E5%8F%8D%E9%9D%A2%E6%A8%A1%E5%BC%8F"&gt;反模式(anti-pattern)&lt;/a&gt;。为了同时支持灌入式与交互式，意味着需要模式的切换，无论这种切换是不是智能的。都会导致积木无法彼此兼容(当然你可以做到局部兼容)，用户如果希望组合两类积木来实现创意，在UI上他们的确拼在一起了，语义上也正确，这时编辑器弹出错误提示说: 灌入式积木与交互式积木无法组合使用，用户会非常沮丧，而且摸不着头脑。此外，有些积木两种模式都能用(诸如逻辑积木、数字积木)，而有些积木则不行(有些需要灌入硬件，有些需要在网页emit消息)，那么使用者还要时刻担心这种组合是否合适，提心吊胆倒也罢了，更糟的是错误出现的时候，他不知道是究竟是自己逻辑错了，还是混搭错了种类。这是对使用者的影响。&lt;/p&gt;
&lt;p&gt;接下来说说它如何增加编辑器的复杂度。&lt;/p&gt;
&lt;p&gt;以上问题当然有解决方案，诸如增强check功能、强化积木的&lt;code&gt;类型&lt;/code&gt;，用做一个IDE的策略来做，上边列出的冲突总能够得到某种程度的缓和。但就这个编辑器本身而言，复杂度的提升，软件一致性的削弱，意味着出bug概率增多。&lt;/p&gt;
&lt;p&gt;如果非要在一个编辑器中兼容这两种模式，有3种方案不算太坏：&lt;/p&gt;
&lt;p&gt;其一是&lt;code&gt;通讯补丁&lt;/code&gt;的策略，在这种模式下，用户的编程范式不需要变换，本质是交互式。灌入代码是为了获得交互的能力。&lt;/p&gt;
&lt;p&gt;其二是显式地切换模式。诸如一些公司用&lt;a href="https://electronjs.org/"&gt;electron&lt;/a&gt;打包&lt;a href="https://github.com/LLK/scratch-gui"&gt;scratch3.0&lt;/a&gt;，通过切换target来切换模式，同时禁用其他积木。&lt;/p&gt;
&lt;p&gt;其三是单向切换:&lt;code&gt;积木&lt;/code&gt;-&amp;gt;&lt;code&gt;代码&lt;/code&gt;。 这种方案在技术上可以做到完美无bug，但依然无法解决用户心理模型的问题。&lt;/p&gt;
&lt;p&gt;值得注意的是，scratch3.0的插件系统架构并不基于target。scratch3.0的插件系统架构本质上适合&lt;code&gt;交互式&lt;/code&gt;。这是官方团队权衡后的结果。&lt;/p&gt;
&lt;p&gt;在我看来，这是一种强行整合，丝毫没有理念上的一致性，它致力于达到"我有这个功能"。&lt;/p&gt;
&lt;p&gt;总而言之，我不赞同兼容这两者的方案。&lt;/p&gt;
&lt;p&gt;关于这个话题的更多内容，参考&lt;a href="https://forums.codelab.club/t/topic/60"&gt;我和@Cyke的这个讨论&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="_12"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://en.wikipedia.org/wiki/Protocol"&gt;Protocol&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://hintjens.com/blog:_unprotocols"&gt;unprotocols&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://en.scratch-wiki.info/wiki/PicoBoard"&gt;PicoBoard&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/sparkfun/PicoBoard"&gt;sparkfun/PicoBoard&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.raspberrypi.org/blog/scratch-2-raspberry-pi/"&gt;scratch-2-raspberry-pi&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://s4a.cat/"&gt;S4A&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zhuanlan.zhihu.com/p/24770930"&gt;Mixly，初学Arduino的最佳图形化编程工具&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/firmata/protocol"&gt;Firmata&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://snap4arduino.rocks/"&gt;snap4arduino&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://nick.zoic.org/art/micropython-webusb/"&gt;MicroPython with WebUSB!&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://hackernoon.com/software-development-at-1-hz-5530bb58fc0e"&gt;Software development at 1 Hz&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://developers.google.com/web/updates/2016/03/access-usb-devices-on-the-web"&gt;Access USB Devices on the Web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://wicg.github.io/webusb/"&gt;WebUSB API&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/zh-hans/%E8%AF%BB%E5%8F%96%EF%B9%A3%E6%B1%82%E5%80%BC%EF%B9%A3%E8%BE%93%E5%87%BA%E5%BE%AA%E7%8E%AF"&gt;读取﹣求值﹣输出循环(REPL)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/wiki/LISP"&gt;LISP&lt;/a&gt; &lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/wiki/%E5%BB%BA%E6%A7%8B%E4%B8%BB%E7%BE%A9_(%E5%AD%B8%E7%BF%92%E7%90%86%E8%AB%96)"&gt;建构主义 (学习理论)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.feld.com/archives/2018/07/the-repl-for-hardware.html"&gt;The REPL For Hardware&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/zh-hans/%E5%8F%8D%E9%9D%A2%E6%A8%A1%E5%BC%8F"&gt;反面模式&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Tue, 10 Jul 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-07-10:Hardware-Programming-style.html</guid><category>scratch</category></item><item><title>使用micro:bit自制PPT翻页笔</title><link>/microbit-ppt.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/ppt_f5a212e3.png" /&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Word的成功是形式对内容的胜利&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;近期偶尔到高校做些技术分享。我不喜欢写PPT，Word/PowerPoint是我最厌恶的几个软件，对Keynote也没有好感，没什么耐心在这些软件里点来点去&lt;/p&gt;
&lt;p&gt;但我并不排斥为讨论和演讲做些书面上的准备。如果可以专注在内容，以Markdown来写作，而不必分心到排版和样式这些事情上，写完演讲所需要的内容之后，PPT能自动从markdown文本中生成，那该多怯意&lt;/p&gt;
&lt;h1 id="_1"&gt;要有光&lt;/h1&gt;
&lt;p&gt;幸运的是，&lt;a href="http://jupyter.org/"&gt;jupyter&lt;/a&gt;允许我们这样做。&lt;/p&gt;
&lt;p&gt;&lt;a href="http://jupyter.org/"&gt;jupyter&lt;/a&gt;是个令人振奋的项目，如果要挑选出我最喜欢的几个工具，&lt;a href="http://jupyter.org/"&gt;jupyter&lt;/a&gt;应该会排在前三&lt;/p&gt;
&lt;p&gt;如果你来自 生物科学/物理学/人工智能/数据分析/量化 社区，&lt;a href="http://jupyter.org/"&gt;jupyter&lt;/a&gt;可能已经在你的工具箱里了，如果你平时喜欢探索性的编码工作，那么你值得花一些时间上手&lt;a href="http://jupyter.org/"&gt;jupyter&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="jupyterppt"&gt;用jupyter写PPT&lt;/h3&gt;
&lt;p&gt;首先安装jupyterlab: &lt;code&gt;pip3 install jupyterlab&lt;/code&gt;，jupyterLab是jupyter的下一代用户界面。安装完成之后，即可运行:&lt;code&gt;jupyter lab&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/microbitslide_3f5f1127.png" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;接着创建一个notebook，你就可以开始用Markdown写作PPT了&lt;/p&gt;
&lt;p&gt;你可以把每个cell视为一页PPT，使用markdown在其中写作或代码，就像写博客，写完之后，点击右边栏的&lt;code&gt;Cell Tools&lt;/code&gt;, 来设置cell&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/microbitslides_47c7c5c3.png" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;每个cell可以设置为以下多种类型：&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/microbitslide_2dcbd1f4.png" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;写作完毕，选择导出为Slides:&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/microbitslide_18fe0a6e.png" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;导出文件为html，依赖于&lt;a href="https://github.com/hakimel/reveal.js/"&gt;reveal.js&lt;/a&gt;（没有使用CDN），所以你需要在导出文件的同级别目录放置&lt;a href="https://github.com/hakimel/reveal.js/"&gt;reveal.js&lt;/a&gt;（下载后解压即可）。&lt;/p&gt;
&lt;p&gt;之后打开下载的html文件，你就可以在浏览器里看到使用jupyter写的PPT了，你可以把它们称为web PPT，演示的时候将浏览器全屏即可。&lt;/p&gt;
&lt;h1 id="_2"&gt;翻页笔&lt;/h1&gt;
&lt;p&gt;PPT翻页笔大约长这样:&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/ppt_c7c6b349.png" width=400 /&gt;&lt;/p&gt;
&lt;p&gt;你在台上演讲时，手握翻页笔，可以无线切换PPT，从而使PPT内容与你的演讲进度同步。&lt;/p&gt;
&lt;h3 id="microbit-ppt"&gt;micro:bit PPT翻页笔&lt;/h3&gt;
&lt;p&gt;&lt;img src="http://tech.microbit.org/docs/hardware/assets/microbit-overview.png" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;因为micro:bit中有蓝牙模块，所以我们可以利用micro:bit的蓝牙功能，来实现无线通讯；它还自带两个按钮，很适合用于制作翻页笔（前后翻页）&lt;/p&gt;
&lt;p&gt;制作过程十分简单:&lt;/p&gt;
&lt;p&gt;首先下载&lt;a href="https://raw.githubusercontent.com/wwj718/slide_microbit/master/FD18_NRF51_MICROBIT.hex"&gt;microbit固件&lt;/a&gt;到本地，然后拖拽到micro:bit中&lt;/p&gt;
&lt;p&gt;完成之后，micro:bit将对外提供&lt;a href="https://en.wikipedia.org/wiki/Bluetooth_Low_Energy"&gt;ble&lt;/a&gt;按钮服务，之后我们利用&lt;a href="https://github.com/WebBluetoothCG/web-bluetooth/blob/gh-pages/implementation-status.md#chrome"&gt;web bluetooth&lt;/a&gt;可以将浏览器，连上micro:bit，从而让micro:bit与js交互，而&lt;a href="https://revealjs.com/"&gt;reveal.js&lt;/a&gt;有js api， 这就是micro:bit PPT翻页笔的原理.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;注意&lt;/strong&gt;:注意: &lt;a href="https://github.com/WebBluetoothCG/web-bluetooth/blob/gh-pages/implementation-status.md#chrome"&gt;web bluetooth&lt;/a&gt;目前只支持macOS、chrome OS、安卓三个平台下的 Chrome浏览器,暂不支持Windows系统 &lt;/p&gt;
&lt;p&gt;这块所需的js代码，我已经写好的。在你写作PPT时，只需在jupyter lab的第一个cell里贴上如下代码&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# 连接micro:bit
*  打开电脑的蓝牙
*  点击右边的连接按钮

&lt;span class="nt"&gt;&amp;lt;button&lt;/span&gt; &lt;span class="na"&gt;id=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ble_button&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;style=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;color:blue&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;连接&lt;span class="nt"&gt;&amp;lt;/button&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;script&lt;/span&gt; &lt;span class="na"&gt;src=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;microbit_ble.js&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然后把&lt;a href="https://raw.githubusercontent.com/wwj718/slide_microbit/master/microbit_ble.js"&gt;microbit_ble.js&lt;/a&gt;下载到jupyter lab导出的slide同级目录即可&lt;/p&gt;
&lt;p&gt;听起来很绕的话，直接看&lt;a href="https://github.com/wwj718/slide_microbit"&gt;源代码&lt;/a&gt;可能更清楚&lt;/p&gt;
&lt;h3 id="_3"&gt;开始使用&lt;/h3&gt;
&lt;p&gt;打开导出的slide，点击连接，选择micro:bit&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/microbitslide_0c59526e.png" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;至此，你就可以手握micro:bit开始你的演讲啦，使用电池供电，你就可以带着micro:bit在台上四处走啦&lt;/p&gt;
&lt;video width=300 src="http://scratch3-files.just4fun.site/microbitslide.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;h3 id="_4"&gt;想象空间&lt;/h3&gt;
&lt;p&gt;如果你和我一样，是scratch和micro:bit的粉丝。你可以将microbit当作PPT翻页笔，而用scratch演示PPT。&lt;/p&gt;
&lt;p&gt;具体策略有很多，最有趣的一种是直接用scratch创作动态内容，而将micro:bit作为一种体感设备，如此一来，你可以与你的PPT进行富有表现里的互动。如果你愿意，你可以选择跳一跳切屏或摇一摇抽奖&lt;/p&gt;
&lt;p&gt;另一种策略，要简单一些，表现力也更弱，和传统PPT无异:将你的PPT转为&lt;code&gt;480x360&lt;/code&gt;的图片，之后将图片作为背景导入scratch即可。然后使用我在&lt;a href="https://blog.just4fun.site/scratch3-microbit.html"&gt;scratch3.0 + micro:bit&lt;/a&gt;所介绍的方法，将micro:bit与scratch3.0连起来&lt;/p&gt;
&lt;!--
形式与内容的分离

Word是内容与形式同时处理

Word是所见即所得


# 使用

日本的文章
官方接口

--&gt;

&lt;h1 id="_5"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://sspai.com/post/37340"&gt;反思Markdown：Markdown的长与短&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/wwj718/slide_microbit"&gt;slide_microbit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/document-factory-pandoc.html"&gt;文档格式转化神器pandoc&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://jupyter.org/"&gt;jupyter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://revealjs.com/"&gt;reveal.js&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/microbit-notes.html"&gt;micro:bit使用笔记&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Tue, 10 Jul 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-07-10:microbit-ppt.html</guid><category>microbit</category></item><item><title>scratch3.0 + micro:bit</title><link>/scratch3-microbit.html</link><description>&lt;p&gt;scratch官方称，在scratch3.0发布的时候会携带&lt;a href="https://medium.com/scratchteam-blog/3-things-to-know-about-scratch-3-0-18ee2f564278"&gt;micro:bit插件&lt;/a&gt;，这意味这你可以轻松将scratch延伸到物理世界。&lt;/p&gt;
&lt;h1 id="_1"&gt;两种硬件编程风格&lt;/h1&gt;
&lt;p&gt;在少儿编程/硬件编程教育领域，硬件编程有两种风格，我将这两种风格分别称为&lt;code&gt;灌入式&lt;/code&gt;和&lt;code&gt;交互式&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;scratch3.0为我们带来的micro:bit硬件编程，采用&lt;code&gt;交互式&lt;/code&gt;风格。&lt;/p&gt;
&lt;p&gt;我相信就少儿编程教育而言，&lt;code&gt;交互式&lt;/code&gt;远远优于&lt;code&gt;灌入式&lt;/code&gt;，我最近正在写一篇文章谈论这个话题(《两种硬件编程风格的比较》)&lt;/p&gt;
&lt;p&gt;我准备讨论这两种编程风格给学习者的编程体验 以及心理状态状态所带来的影响。所谈论的很多内容，在编程语言的发展历史中都被反复讨论过。&lt;/p&gt;
&lt;p&gt;下边我们来简单看看两个阵营都有哪些代表性项目。&lt;/p&gt;
&lt;p&gt;在硬件图形化编程项目中，&lt;code&gt;灌入式&lt;/code&gt;阵营有名的项目包括：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.microsoft.com/en-us/makecode"&gt;makecode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/bbcmicrobit/PythonEditor"&gt;PythonEditor&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://mixly.org/"&gt;mixly&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;以及国内大多数的其他项目(makeblock、mcookie...)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;事实上，所有传统的硬件编程都是灌入式的，&lt;/p&gt;
&lt;p&gt;&lt;code&gt;交互式&lt;/code&gt;阵营的项目有:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.anki.com/en-us/cozmo/code-lab"&gt;Cozmo code lab&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://en.scratch-wiki.info/wiki/PicoBoard"&gt;scratch Picoboard&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://s4a.cat/"&gt;S4A&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/lab/scratch3-adapter-docs/"&gt;scratch3-adapter&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;交互式&lt;/code&gt;阵营近期还将迎来下边两个项目：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://llk.github.io/scratch-gui/microbit/"&gt;scratch microbit extension&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.media.mit.edu/projects/scratch-pad/overview/"&gt;ScratchBit&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果你尝试过&lt;a href="https://www.anki.com/en-us/cozmo/code-lab"&gt;Cozmo code lab&lt;/a&gt;的编程体验，你就知道&lt;code&gt;交互式&lt;/code&gt;可以做到何等优秀。Cozmo几乎在任何方面都一骑绝尘。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;灌入式&lt;/code&gt;和&lt;code&gt;交互式&lt;/code&gt;带来截然不同的编程体验，对此有兴趣的同学，可以等我&lt;a href=""&gt;近期的文章&lt;/a&gt;，我对这个话题十分感兴趣，也欢迎你来信讨论&lt;/p&gt;
&lt;h1 id="scratch30-microbit"&gt;scratch3.0 + micro:bit尝鲜&lt;/h1&gt;
&lt;p&gt;尽管scratch3的micro:bit插件还没有正式发布，但目前我们以及可以尝鲜了&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;注意&lt;/strong&gt;: 目前只支持macOS、chrome OS、安卓三个平台下的 Chrome浏览器,暂不支持Windows系统 （因为用到&lt;a href="https://github.com/WebBluetoothCG/web-bluetooth/blob/gh-pages/implementation-status.md#chrome"&gt;web bluetooth&lt;/a&gt;)&lt;/p&gt;
&lt;h3 id="_2"&gt;下载并烧入固件&lt;/h3&gt;
&lt;p&gt;下载&lt;a href="http://scratch3-files.just4fun.site/scratch-microbit-firmware-combined.hex"&gt;scratch-microbit-firmware-combined.hex&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;将scratch-microbit-firmware-combined.hex拖到microbit里&lt;/p&gt;
&lt;h3 id="_3"&gt;连接&lt;/h3&gt;
&lt;p&gt;打开系统蓝牙&lt;/p&gt;
&lt;p&gt;打开&lt;a href="https://llk.github.io/scratch-gui/microbit"&gt;llk microbit&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;点击连接蓝牙:&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/microbitble_42d40f81.png" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;连接完成之后，我们就可以开始在scratch3.0中为microbit编程了&lt;/p&gt;
&lt;p&gt;由于是&lt;code&gt;交互式&lt;/code&gt;风格，我们可以轻松做出互动式的体感游戏之类富有想象里的东西。&lt;/p&gt;
&lt;h3 id="_4"&gt;开始编程&lt;/h3&gt;
&lt;p&gt;首先在extensions中选择micro:bit扩展:&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/microbitble_209445f2.png" width=600 /&gt;&lt;/p&gt;
&lt;p&gt;下边让我们写个简单的程序，用micro:bit来控制scratch3.0中的人物左右移动:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/microbitble_e7747878.png" /&gt;&lt;/p&gt;
&lt;p&gt;让我们来看看实际效果:&lt;/p&gt;
&lt;video src="http://scratch3-files.just4fun.site/microbitble.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;h3 id="_5"&gt;技术视角&lt;/h3&gt;
&lt;p&gt;scratch3.0的micro:bit采用&lt;a href="https://github.com/WebBluetoothCG/web-bluetooth/blob/gh-pages/implementation-status.md#chrome"&gt;web-bluetooth&lt;/a&gt;。这是一种激进的策略，&lt;a href="https://github.com/WebBluetoothCG/web-bluetooth/blob/gh-pages/implementation-status.md#chrome"&gt;web-bluetooth&lt;/a&gt;目前的跨平台兼容并不好，各个平台的进展可以参考&lt;a href="https://github.com/WebBluetoothCG/web-bluetooth/blob/gh-pages/implementation-status.md#chrome"&gt;这儿&lt;/a&gt;，目前只在macOS、chrome OS以及安卓上可以正常使用，最终scratch3.0稳定版中micro:bit extension是否会采用web-bluetooth的连接策略还不得而知（但他们显然偏好这种方式，他们自己准备推出的硬件：&lt;a href="https://www.media.mit.edu/projects/scratch-pad/overview/"&gt;ScratchBit&lt;/a&gt;也采用这种策略）。官方可能采用的另一个策略是&lt;a href="https://llk.github.io/microbit-extension/"&gt;microbit-extension&lt;/a&gt;,这种方式的跨平台兼容性好，原理上和&lt;a href="https://blog.just4fun.site/lab/scratch3-adapter-docs/"&gt;scratch3-adapter&lt;/a&gt;相同&lt;/p&gt;
&lt;p&gt;和scratch官方一样，我也相信web-bluetooth是硬件编程教育的未来，采用这种方式，只需要你有一个chrome浏览器，就可以直接操控硬件！&lt;/p&gt;
&lt;p&gt;我的&lt;a href="https://blog.just4fun.site/lab/scratch3-adapter-docs/"&gt;scratch3-adapter&lt;/a&gt;采用了比较折中的策略，没有强行要求使用web-bluetooth，而是把连接的策略推迟给开发者，让他们自行选择。&lt;/p&gt;
&lt;h1 id="_6"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://qiita.com/asondemita/items/b8e7f3ad63ccb0baec3a"&gt;Scratch3.0+micro:bit の接続手順&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://llk.github.io/scratch-gui/microbit"&gt;llk microbit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://khanning.github.io/scratch-gui/microbit-pro/"&gt;khanning microbit-pro&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://khanning.github.io/scratch-gui/scratchbit/"&gt;khanning scratchbit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.media.mit.edu/projects/scratch-pad/overview/"&gt;ScratchBit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://support.microbit.org/support/solutions/articles/19000026080-can-i-use-the-micro-bit-with-scratch-"&gt;Can I use the micro:bit with Scratch?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/WebBluetoothCG/web-bluetooth/blob/gh-pages/implementation-status.md#chrome"&gt;WebBluetoothCG/web-bluetooth&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://microbit.org/scratch/"&gt;Scratch cards for micro:bit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://medium.com/scratchteam-blog/3-things-to-know-about-scratch-3-0-18ee2f564278"&gt;3 Things To Know About Scratch 3.0&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/lab/scratch3-adapter-docs/"&gt;scratch3-adapter&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Sun, 01 Jul 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-07-01:scratch3-microbit.html</guid><category>scratch</category></item><item><title>micro:bit与事件驱动</title><link>/microbit-event-driven.html</link><description>&lt;p&gt;在微软的&lt;a href="https://makecode.microbit.org/"&gt;makecode&lt;/a&gt;编辑器中，我们可以轻松为micro:bit写出这种事件驱动风格的代码:&lt;code&gt;当按钮A被按下的时候打印字符A，当按钮B被按下的时候打印字符B&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="makecode" src="http://wwj-fig-bed.just4fun.site/microbit_30bab0ff.png" /&gt;&lt;/p&gt;
&lt;p&gt;生成的代码(javascript)十分简单:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nx"&gt;input&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;onButtonPressed&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;Button&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;A&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;basic&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;showString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;A&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;})&lt;/span&gt;
&lt;span class="nx"&gt;input&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;onButtonPressed&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;Button&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;B&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;basic&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;showString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;B&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;})&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;当我们使用Python来为micro:bit编程时，却很难写出这种事件驱动风格的代码，如果我们要做到上边类似的事，一般的教程里会让你用&lt;code&gt;while+if/else&lt;/code&gt;来做。尽管可以做到类似的事，但思维方式/语义其实并不相同。&lt;/p&gt;
&lt;h1 id="why"&gt;Why&lt;/h1&gt;
&lt;p&gt;makecode将积木映射为JavaScript代码，JavaScript是一个事件驱动型语言，所以在makecode可以很轻松进行事件驱动风格的编程。而Python对事件驱动的关注主要集中在网络编程方面，在Python中做事件驱动风格的编程，并不是那么常见。&lt;/p&gt;
&lt;p&gt;要在图形化中，自动生成事件驱动风格的代码，自然就更不易了&lt;/p&gt;
&lt;p&gt;我们看到micro:bit官方的&lt;a href="https://github.com/bbcmicrobit/PythonEditor"&gt;bbcmicrobit/PythonEditor&lt;/a&gt;中积木化界面(blockly)就不支持:&lt;code&gt;当按钮A被按下的时候打印字符A，当按钮B被按下的时候打印字符B&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="microbit site" src="http://wwj-fig-bed.just4fun.site/microbit_4110fba9.png" /&gt;&lt;/p&gt;
&lt;h1 id="how"&gt;how&lt;/h1&gt;
&lt;p&gt;由于目前micro:bit的&lt;a href="https://github.com/bbcmicrobit/micropython"&gt;micropython固件&lt;/a&gt;并不支持多线程(pyboard倒是有个固件支持&lt;code&gt;_thread&lt;/code&gt;)，要实现事件驱动，可能只有协程供你选择了。&lt;/p&gt;
&lt;p&gt;micro:bit官方对此并没有很好的解决方案&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.mblock.cc/zh-home/"&gt;mblock/makeblock&lt;/a&gt;的方案倒是十分漂亮，值得我们好好学习（ps:mblock在工程上十分出色，有许多聪明的做法值得学习）&lt;/p&gt;
&lt;p&gt;我们先在mblock中来为micro:bit编写事件驱动风格的程序&lt;/p&gt;
&lt;p&gt;&lt;img alt="mblock 积木" src="http://wwj-fig-bed.just4fun.site/mblock_05c523d5.png" /&gt;&lt;/p&gt;
&lt;p&gt;接着我们来看看积木generate出的Python代码:&lt;/p&gt;
&lt;p&gt;&lt;img alt="mblock 代码" src="http://wwj-fig-bed.just4fun.site/mblock_fdfa7d4f.png" /&gt;&lt;/p&gt;
&lt;p&gt;代码十分规整，规整的好处是从积木到代码的转化将很简单。这种从积木generate出代码的方式，是典型的blockly app风格，尽管长着scratch3.0的样子，关于两者的差异可以参考我此前的文章:&lt;a href="https://blog.just4fun.site/scratch3-blockly.html"&gt;Blockly与Scratch3.0的比较分析及选型建议&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;观察这个代码（注意&lt;code&gt;yeild&lt;/code&gt;），如果你熟悉python的协程，应该可以轻松猜到，mblock很聪明地使用协程来做事件驱动风格的编程&lt;/p&gt;
&lt;p&gt;至于为何不用async/await，是因为MicroPython是Python 3.4的一个实现，在python3.4中，你不能使用async/await关键字，直到Python在3.5版本才引入关于协程的语法糖async和await&lt;/p&gt;
&lt;p&gt;这段代码尽管十分工整，但它并不能运行，它需要一个调度器来调度它们。&lt;/p&gt;
&lt;p&gt;经过预处理之后，可运行代码为：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;microbit&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;music&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;on_callback_button_a&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;display&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;scroll&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;wait&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;loop&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;on_coroutine_button_a&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;button_a&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;is_pressed&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
            &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;on_callback_button_a&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;yield&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;on_callback_button_b&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;display&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;scroll&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;wait&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;loop&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;on_coroutine_button_b&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;button_b&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;is_pressed&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
            &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;on_callback_button_b&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;yield&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;coroutine_start_go&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;coroutine_v0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;coroutine_v1&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;

    &lt;span class="n"&gt;coroutine_v0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;coroutine_v1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;n&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
       &lt;span class="n"&gt;coroutine_v0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
       &lt;span class="n"&gt;coroutine_v1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="n"&gt;coroutine_init0&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;on_coroutine_button_a&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;coroutine_init1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;on_coroutine_button_b&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;coroutine_start_go&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;coroutine_init0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;coroutine_init1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;当然，在进入micro:bit之前，它要连同内核一同被编译为hex文件。&lt;/p&gt;
&lt;p&gt;可以看出，mblock在generate出代码之后，还有一个预处理的过程（实际上webduino也干过类似的事，我之前的分析有分析过，他们的做法如出一辙）。&lt;/p&gt;
&lt;p&gt;尽管我们可以用一些hack的手段拿到这部分的源码，但我们不打算在此讨论细节（mblock这部分并未开源，出于尊重和规避法律风险的考虑，我们不准备公开他们这部分的代码。大家自己动手去实现吧，按照以上分析，这部分实现起来十分简单，mblock是个很酷的团队，也许之后会开放）&lt;/p&gt;
&lt;p&gt;mblock对程序进行预处理的部分使用js来做，如下图，大家把这个转化器当黑盒来看吧&lt;/p&gt;
&lt;p&gt;&lt;img alt="预处理" src="http://wwj-fig-bed.just4fun.site/makecode_21978b84.png" /&gt;&lt;/p&gt;
&lt;p&gt;通过简单的正则，你很快可以写出来:)&lt;/p&gt;
&lt;h3 id="_1"&gt;参考&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/microbit-notes.html"&gt;micro:bit使用笔记&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/micropython-notes.html"&gt;MicroPython使用笔记&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/micropython/micropython"&gt;micropython&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/bbcmicrobit/micropython"&gt;bbcmicrobit/micropython&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/bbcmicrobit/PythonEditor"&gt;bbcmicrobit/PythonEditor&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Tue, 19 Jun 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-06-19:microbit-event-driven.html</guid><category>microbit</category></item><item><title>scratch3-adapter的移动端解决方案</title><link>/scratch3-adapter-mobile.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/ipad_4b1c9636.png" /&gt;&lt;/p&gt;
&lt;p&gt;今天花了半天功夫，解决scratch3-adapter在移动端使用的问题，我在roadmap里有提到过这个计划:&lt;a href="https://blog.just4fun.site/lab/scratch3-adapter-docs/about/roadmap/"&gt;Roadmap 移动端&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;中途陷到几个坑里边，花了不少时间，做个笔记&lt;/p&gt;
&lt;h1 id="why"&gt;Why&lt;/h1&gt;
&lt;p&gt;对于初学者而言(尤其是初次接触计算机的孩子而言)，平板电脑是比电脑更为友好的工具。 &lt;/p&gt;
&lt;p&gt;&lt;code&gt;平板 + 积木 + 图标&lt;/code&gt;，可以让一个不识字的孩子直接动手编程，孩子使用手指拖拽带有图标的积木，即可通过一个个的关卡，在操作中掌握所需的概念&lt;/p&gt;
&lt;p&gt;&lt;img src="http://wwj-fig-bed.just4fun.site/codeorg_91677138.png" width=800 /&gt;&lt;/p&gt;
&lt;p&gt;目前大多数的家庭里，儿童的学习工具并不是PC，可能主要是ipad，至少我周围是这样（对于培训和课堂我强烈推荐树莓派）&lt;/p&gt;
&lt;p&gt;scratch3目前正在做跨平台的一些工作，平板电脑将得到良好的支持。尽管目前的计划里，手机端暂时还不会成为操作界面(但官方会将其作为play界面)，但在未来，也可能会作为创作平台(目前编程猫已经先行探路)&lt;/p&gt;
&lt;p&gt;scratch3-adapter的兴趣是将scratch3.0连接到更广阔的区域，目前我们已经发布了几大主流平台的客户端，详情见:&lt;a href="https://blog.just4fun.site/lab/scratch3-adapter-docs/user_guide/install/"&gt;scratch3-adapter-docs 安装(install)&lt;/a&gt;。对移动端的支持，当然也是我们的目标。&lt;/p&gt;
&lt;h1 id="pc"&gt;移动端和PC的差异&lt;/h1&gt;
&lt;p&gt;移动端和PC在学习体验上的差异，前人述备矣，在此不多讨论&lt;/p&gt;
&lt;p&gt;这里只谈谈，对于scratch3-adapter而言，这类设备在技术层面有什么差异&lt;/p&gt;
&lt;p&gt;scratch3-adapter基于python，通过插件系统，我们允许scratch3-adapter与任何开放的设备相连，连接的方式也很自由：wifi、usb、bluetooth都行&lt;/p&gt;
&lt;p&gt;在PC上，scratch3-adapter几乎可以干任何事，操控wifi、usb、bluetooth都没问题，主流的硬件无非这几种连接方法。但在移动端则不同&lt;/p&gt;
&lt;p&gt;让我们以cozmo为例，说明这种不同。在PC端，可我们以使用usb连接控制cozmo的手机，进而使用&lt;a href="https://github.com/anki/cozmo-python-sdk"&gt;cozmo-python-sdk&lt;/a&gt;控制cozmo&lt;/p&gt;
&lt;p&gt;但在移动端，我们无法这样做，因为连接cozmo需要一个usb接口，cozmo作为案例向我们揭示了：我们无法预估来自现实世界的硬件采用怎样的连接方式&lt;/p&gt;
&lt;p&gt;尽管我已经让scratch3-adapter运行在安卓上。但如果你要操控移动端的硬件(wifi、bluetooth）（usb目前无法使用)，你需要写一个app，抛开工作量不谈，scratch3-adapter根本也不想这样做，scratch3-adapter希望学习平台是在web上，而不是包装为app，scratch3-adapter只是将web延伸出来。我们热爱开放的互联网&lt;/p&gt;
&lt;p&gt;我们最终决定学习home assistant的策略（scratch3-adapter在很多层面和home assistant都很相似），让scratch3-adapter跑在树莓派上，而移动端只需要使用树莓派的web服务即可，硬件都被暴露在这些服务中&lt;/p&gt;
&lt;p&gt;因为树莓派可以连接wifi、usb、bluetooth，以及更多的其他设备(树莓派有引脚！)，所以你在移动端的浏览器上也能操控所有这些设备！&lt;/p&gt;
&lt;p&gt;我相信，就学习编程而言，树莓派是个十分理想的环境。我们已经基于树莓派，利用&lt;a href="https://github.com/PiNet/PiNet"&gt;PiNet&lt;/a&gt;完成了编程教室解决方案，这部分工作由@suli完成.这部分的文章，我之后有时间也梳理一下&lt;/p&gt;
&lt;h1 id="_1"&gt;思路&lt;/h1&gt;
&lt;p&gt;确定了方向之后，我们再来把思路理一下。&lt;/p&gt;
&lt;p&gt;在此我们以cozmo为例，解释我们如何让scratch3-adapter支持移动端。最后我们会给一个演示视频，视频里，一个类似code.org这样的平台，可以直接将cozmo设计在教学关卡中！在这个视频我相信是会同时让code.org和cozmo社区震惊（cozmo英文社区已经期待很久了），我近期也准备写一篇英文文章发到cozmo社区里，英文比较渣，挤牙膏似的还蛮辛苦的&lt;/p&gt;
&lt;p&gt;首先我们按照cozmo官方的&lt;a href="http://cozmosdk.anki.com/docs/"&gt;http://cozmosdk.anki.com/docs/install-linux.html&lt;/a&gt;，在树莓派里配置&lt;a href="https://github.com/anki/cozmo-python-sdk"&gt;cozmo-python-sdk&lt;/a&gt;。树莓派官方的最新镜像，默认带有python3.5，我们直接使用这个版本就够了.&lt;/p&gt;
&lt;p&gt;安装依赖十分简单:&lt;code&gt;pip3 install --user 'cozmo[camera]'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;由于我使用安卓手机连接cozmo（社区里很多人用亚马逊$35的那款），所以需要安装一下adb:&lt;code&gt;sudo apt-get install android-tools-adb&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;至此，我们就可以使用树莓派操作cozmo了&lt;/p&gt;
&lt;p&gt;我们在树莓派里让cozmo_server开机启动，cozmo_server是一个代理了cozmo的python进程&lt;/p&gt;
&lt;p&gt;scratch3-adapter以cli模式开机启动，启动时默认加载cozmo插件。&lt;/p&gt;
&lt;p&gt;之后我们打开网站，点击页面按钮连接树莓派，就可以在ipad中使用浏览器打开网站，直接操控cozmo了，&lt;/p&gt;
&lt;p&gt;我们来看看演示效果:&lt;/p&gt;
&lt;video src="http://scratch3-files.just4fun.site/blockly_cozmo.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;ps: 因为是web控制cozmo，所以我就不必要使用ipad演示了（毕竟原理没差别）&lt;/p&gt;
&lt;p&gt;演示视频里，学生在网页中的编程关卡里，拖好积木块，点击运行，就可以同时控制虚拟角色和cozmo执行任务，这个过程是实时双向通信！所以我们能将评分之类的机制都加进来，我在之前的文章: &lt;a href="https://blog.just4fun.site/scratch3_adapter-blockly.html"&gt;使用scratch3_adapter连接blockly与硬件&lt;/a&gt;里说:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;这部分值得玩味的地方是，你可以在网页上做所有的教学，无论是结合某一款开源硬件还是某一个AI系统。而scratch3_adapter将允许你用积木来驱动它们，你也能拿到积木/代码在外部系统的执行结果，判断学生是否掌握该知识点，而这对教学可能是很重要的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id="_2"&gt;一些坑和需要解决的问题&lt;/h1&gt;
&lt;p&gt;思路和原理都很简单，但在实际使用中，有几个问题需要我们解决。这些问题主要是提升易用性和用户体验，毕竟树莓派运行着linux（raspbian），我们总不能把操作流程用bash来写，让孩子ssh进树莓派操作，尽管我们鼓励他们能力提高之后大胆去尝试。&lt;/p&gt;
&lt;p&gt;所以我们做到了&lt;code&gt;all in web&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;这篇文章以cozmo为例，来展示scratch3-adapter的移动端的解决方案。我们有意选择了cozmo，因为这个例子代表了&lt;code&gt;最为复杂的情况&lt;/code&gt;，如果cozmo的连接都顺利，那么其他情况将变得十分简单(诸如micro:bit).所以如果你觉得这篇文章有些复杂是正常的，因为cozmo本身的连接方式很复杂，还会牵扯一些adb的问题&lt;/p&gt;
&lt;h3 id="adb"&gt;adb的坑&lt;/h3&gt;
&lt;p&gt;当你把手机连上树莓派之后，&lt;code&gt;adb devices&lt;/code&gt;会跟你说没有认证(unauthorized)，社区给出了解决方案：&lt;code&gt;kill and restart&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;adb kill-server  
adb start-server  
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;你需要在开机启动时把这个加上启动项上&lt;/p&gt;
&lt;h3 id="wifi"&gt;接入wifi&lt;/h3&gt;
&lt;p&gt;如何将树莓派接入局域网，此前是个困难的问题。&lt;/p&gt;
&lt;p&gt;如果你把树莓派用作一个网关，分发给普通用户，那么你就需要让这个过程变得简单易用。这一块目前的最佳实践是：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;以某种方式连接网关&lt;ul&gt;
&lt;li&gt;智能家居设备一般会让你使用蓝牙连接设备&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;将密码传入设备&lt;/li&gt;
&lt;li&gt;重启设备，接入wifi&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="https://github.com/resin-io/resin-wifi-connect"&gt;resin-wifi-connect&lt;/a&gt;完美得解决了这个问题。不过这个项目目前有些bug，还在改进中&lt;/p&gt;
&lt;h3 id="_3"&gt;开机自启 &amp;amp; 掉线重连&lt;/h3&gt;
&lt;p&gt;开启自启，我们统一使用supervisor来做，并且暴露出9001端口来管理进程，即便中途出现了意外，我们也可以轻松在web页面重启进程，而无需进入树莓派&lt;/p&gt;
&lt;h3 id="https"&gt;https&lt;/h3&gt;
&lt;p&gt;scratch3-adapter的https模式在PC上使用正常，但在ipad上会报一个错误: &lt;code&gt;WebSocket OSStatus error -9807&lt;/code&gt;,ipad对https证书有要求，尽管我们可以使用nginx代理scratch3-adapter来解决这个问题(tls v1.2)。但使用http可能更为简易&lt;/p&gt;
&lt;h3 id="mdns-hostname"&gt;mDNS &amp;amp; hostname&lt;/h3&gt;
&lt;p&gt;mDNS允许你在局域网内，通过机器名找到它的ip地址，在智能家居中使用广泛。&lt;/p&gt;
&lt;p&gt;对于课堂和机构的教学，我们可能希望，每个树莓派都有唯一标识，可以区分彼此，最好这个名字可以自定义，便于记忆。&lt;code&gt;mDNS &amp;amp; hostname&lt;/code&gt;是这个问题的绝佳的解决方案。直接使用&lt;code&gt;sudo raspi-config&lt;/code&gt;设置好hostname，重启即可&lt;/p&gt;
&lt;p&gt;尽管大多时候你无需注意&lt;code&gt;mDNS&lt;/code&gt;,因为大多数系统和路由器都支持，但值得注意的是一些老旧的安卓系统和windows并不支持，如果你使用windows，先安装一些这个软件:&lt;a href="https://support.apple.com/kb/DL999?viewlocale=zh_CN&amp;amp;locale=en_US"&gt;Bonjour Print Services (Windows)&lt;/a&gt;. 安装之后，重启电脑即可&lt;/p&gt;
&lt;p&gt;此外补充一些tips: 你可以把hostname和wifi热点名贴在树莓派外壳上，便于使用。如果你在做一个课堂解决方案，这块可能出现的问题和to c很不一样,值得注意&lt;/p&gt;
&lt;h1 id="_4"&gt;后话&lt;/h1&gt;
&lt;p&gt;前边这些配置看去比较繁琐，我之后会把这些东西做成镜像，大家直接往树莓派烧录我制作的镜像即可&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Fri, 08 Jun 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-06-08:scratch3-adapter-mobile.html</guid><category>scratch</category></item><item><title>使用scratch3_adapter连接blockly与硬件</title><link>/scratch3_adapter-blockly.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/blockly_698b1f0a.png" /&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;everything is message&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我们在&lt;a href="https://blog.just4fun.site/lab/scratch3-adapter-docs/"&gt;scratch3_adapter的项目介绍&lt;/a&gt;中说 &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我们不想针对某个硬件产品发布一个客户端，我们相信创意来自广泛的连接，我们致力于做一个&lt;code&gt;中立&lt;/code&gt;的东西，将Scratch3.0连接到更广阔的领域，我们想做到&lt;a href="http://learn.media.mit.edu/lcl/weeks/week5/"&gt;宽围墙&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;事实上，scratch3_adapter比我们所描述的还有更中立一些。它中立起来，连自己的名字(&lt;code&gt;scratch3&lt;/code&gt;_adapter)都忘了，scratch3_adapter不止可以将Scratch3.0接入各种有趣的硬件和AI中(如它的名字所暗示的)，也可以连接Blockly和各种有趣的硬件/AI&lt;/p&gt;
&lt;p&gt;在这篇文章中，我们将介绍如何使用&lt;code&gt;scratch3_adapter&lt;/code&gt;连接blockly与micro:bit。利用文章演示的方法，你可以将blockly接入到其他有趣的系统中，远不止是micro:bit&lt;/p&gt;
&lt;p&gt;也许在此我们应该叫它:&lt;code&gt;blockly_adapter&lt;/code&gt; :)&lt;/p&gt;
&lt;h1 id="_1"&gt;初心&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;模仿是最大的致敬&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;构建&lt;code&gt;scratch3_adapter&lt;/code&gt;之前的一段时间，我有两个周末沉迷于《ROS机器人编程实践》，为这套系统的架构所折服，看到作者设计得正交且清晰的API时，叹服之余，也暗自坐在书店地上设想: API的背后是怎样的？如果我来做，我会怎么实现它？而后带着自己的设想，和作者源码做对照。&lt;/p&gt;
&lt;p&gt;看这本书之前我正巧看完Pieter Hintjens的《ZeroMQ：云时代极速消息通信库》,zeromq是个极其灵活、强大的工具，健壮有力而优美。有了zeromq这把称心的斧头，那段时间里我倾向于把一切都视为钉子(everything is message)，于是我决定把整个ROS视为一个消息系统。&lt;/p&gt;
&lt;p&gt;开始重造轮子时，从sub和pub入手，觉得无碍; 到了重构rescore命令行工具时，我将其视为一个服务发现组件，挑选工具时，在python原生的dict和redis中犹豫，最终决定选择redis。&lt;/p&gt;
&lt;p&gt;后来在翻阅ROS的资料时，发现作者也正在重构ROS(ROS2),他说ROS本质上时一个匿名的消息系统，早年他在构建ROS时，由于社区里工具的匮乏，他造了很多轮子，如果ROS写于今天，他会选择zeromq和redis（为了实时性，他最终选了DDS）。看到这儿我颇为振奋，觉得方向猜的还挺准&lt;/p&gt;
&lt;p&gt;我把早先的尝试放在&lt;a href="https://github.com/wwj718/ROLS"&gt;ROLS&lt;/a&gt;(Robot Operating Lite System),往后折腾的时候发现，重造一个ROS比我想象的要复杂得多。那段时间，我正好在考虑为Scratch3.0写一个插件系统，发现可以模仿ROS的局部设计来做这个插件系统。于是决定先放下ROLS，在插件系统这个更有实际价值的场景里，去实践从ROS学来的东西&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ROS本质上是一个匿名的消息系统&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ROS作者阐述的ROS消息的匿名性以及由此带来的回报，令我着迷。以至于我一直试图将scratch3_adapter设计为一个匿名的消息系统，就像你刚看完一本精彩的小说，恨不得说话的语气都模仿喜欢的角色。在设计scratch3_adapter时，我有一天跟@izuo说，也许我们不该叫它&lt;code&gt;scratch3_adapter&lt;/code&gt;，因为Scratch3.0仅仅是它的一个client，并不占主体地位，&lt;code&gt;scratch3_adapter&lt;/code&gt;可以对接到blockly或者任何其他的地方，没有任何差异。&lt;/p&gt;
&lt;p&gt;但我后来意识到(在实际使用extension时)，匿名性对我们价值并不大，在scratch3_adapter的使用场景里，各个节点并不是对等的，它其实不是一个分布式的系统(ROS本质却是一个分布式的系统)。scratch3_adapter有它的中心，积木化界面就是它的中心。于是我们着手开始削弱匿名性，如果你看到代码的变迁过程，就会看到想法的变迁过程&lt;/p&gt;
&lt;p&gt;尽管我们已经削弱了它的匿名性，也继续沿用&lt;code&gt;scratch3_adapter&lt;/code&gt;这个名字，但它依然有很强的适应性，本质的原因我想源自它是一个消息系统。&lt;/p&gt;
&lt;p&gt;在使用scratch3_adapter的时候，你可以很轻松将scratch3替换为blockly，使用scratch3_adapter连接你的blockly和其他系统(硬件或AI)，而几乎不会有任何损失。&lt;/p&gt;
&lt;h1 id="why-blockly"&gt;why blockly&lt;/h1&gt;
&lt;p&gt;谈论怎么做之前，我们先来谈谈为何要这么做。&lt;/p&gt;
&lt;p&gt;那么，我们为何要连接blockly和硬件/AI？&lt;/p&gt;
&lt;p&gt;我认为最重要的一个原因是，blockly是少儿编程领域，大多数教学平台的基础。而教学平台除了教学软件相关的课程，也希望教学硬件和AI。&lt;/p&gt;
&lt;p&gt;ps:值得一提的是，scratch-blocks本质上是blockly，而不是Scratch3.0，关于这一点，常常会引起一些混乱&lt;/p&gt;
&lt;p&gt;如果你问blockly为何是少儿编程领域内，大多数教学平台的基础？&lt;/p&gt;
&lt;p&gt;这个问题会逼着我们思考讨论的特性和差异，我之前做过这个讨论: &lt;a href="https://blog.just4fun.site/scratch3-blockly.html"&gt;Blockly与Scratch3.0的比较分析及选型建议&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;尽管原因很多（如我前边谈的），但重要的原因，简而言之，是因为blockly和Scratch3.0的定位不同，Scratch3.0定位为playground，而blockly只是个轻巧的编辑器。所以blockly可以承载更多个性化的定制部分，教育很难千篇一律，大家倾向一个轻巧灵活的工具以适应课程。&lt;/p&gt;
&lt;p&gt;不过，目前的少儿编程教育蛮千篇一律的 :) &lt;/p&gt;
&lt;p&gt;你会看到少儿编程这个领域，目前似乎只有两种模式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;一种是playground式的，国外如scratch，国内如编程猫&lt;ul&gt;
&lt;li&gt;我认为playground的价值在于"低门槛、高天花板、宽围墙"，而开放和社区是核心，所以我正在写一篇文章:《为何你应该选择Scratch3.0作为playground》&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;一种是关卡式的，如code.org、Tynker&lt;ul&gt;
&lt;li&gt;关卡式的平台其实很套路，架构一个这样的平台基本可以分三步走完成，这部分我们之后有机会再细说&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;scratch3_adapter是个中立的系统，以上两种模式的平台我们都支持&lt;/p&gt;
&lt;h1 id="blocklymicrobit"&gt;连接blockly与micro:bit&lt;/h1&gt;
&lt;h2 id="_2"&gt;目标&lt;/h2&gt;
&lt;p&gt;构建一个blockly积木块，用来在micro:bit上打印任意字符串&lt;/p&gt;
&lt;h2 id="_3"&gt;动起手来&lt;/h2&gt;
&lt;p&gt;下边跟着我一起动起手来，脖子扭扭屁股扭扭&lt;/p&gt;
&lt;h4 id="1-blockly"&gt;步骤1:  编写blockly源码&lt;/h4&gt;
&lt;p&gt;在此假设你对blockly开发有基本的了解，如果你blockly开发并不了解，可以看我的系列教程:&lt;a href="https://blog.just4fun.site/blockly-overview.html"&gt;blockly入门与介绍&lt;/a&gt; (教程链接在文末）&lt;/p&gt;
&lt;p&gt;我们先直接上源码，稍后讲解:&lt;a href="https://github.com/wwj718/blockly_dev/blob/master/src/blockly_2.2_custom_block_run_js_with_interpreter/index.html#L92"&gt;blockly_2.2_custom_block_run_js_with_interpreter&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;除去html和无关紧要的部分，将scratch3_adapter接入blockly的核心源码就几行：&lt;/p&gt;
&lt;p&gt;首先是建立连接:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;var&lt;/span&gt; &lt;span class="nt"&gt;socket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nt"&gt;io&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ws://127.0.0.1:12358&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/test&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="n"&gt;transports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;websocket&amp;#39;&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这一行代码，将blockly课程或创作平台与scratch3_adapter进行连接。&lt;/p&gt;
&lt;p&gt;ps: scratch3_adapter用到好几个端口，12358是其中一个，scratch3_adapter中端口的选择藏着彩蛋 :) 有兴趣的小伙伴可以自己去解读&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;wrapper&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;text&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;text&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;emit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;actuator&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                         &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;id&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;microbit&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                          &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;text&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                          &lt;span class="nx"&gt;topic&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;actuators/say&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;
      &lt;span class="p"&gt;};&lt;/span&gt;

      &lt;span class="nx"&gt;interpreter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setProperty&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;scope&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;say&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nx"&gt;interpreter&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;createNativeFunction&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;wrapper&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这是我们使用blockly积木控制micro:bit（硬件）的关键所在，如果你是个有经验的程序员，我已不必多说什么了，你已经可以使用scratch3_adapter将blockly接入任何硬件/AI &lt;/p&gt;
&lt;p&gt;enjoy it ~&lt;/p&gt;
&lt;h4 id="2-scratch3_adaptermicrobit"&gt;步骤2: 打开scratch3_adapter,选择内置的micro:bit插件&lt;/h4&gt;
&lt;p&gt;&lt;img width="300px" src="http://wwj-fig-bed.just4fun.site/microbit_bb63ac6b.png"/&gt;&lt;/p&gt;
&lt;p&gt;此刻你应该看到micro:bit背后的信号灯在高频闪烁，如果它没有高频闪烁，则按一下micro:bit背部的复位按钮&lt;/p&gt;
&lt;h4 id="3"&gt;步骤3: 运行!&lt;/h4&gt;
&lt;p&gt;点击运行blockly积木块，你将看到blockly已经能成功驱动micro:bit了&lt;/p&gt;
&lt;video src="http://scratch3-files.just4fun.site/microbit_blockly.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;你可以把blockly接入更多的硬件，包括控制你的蓝牙硬件、你的ROS机器人、你那跑着opencv的树莓派或者你童年那辆心爱的玩具四驱车，可以参考我们的:&lt;a href="https://blog.just4fun.site/lab/scratch3-adapter-docs/dev_guide/helloworld/"&gt;开发手册&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="_4"&gt;想象空间&lt;/h3&gt;
&lt;p&gt;我们把scratch3_adapter设计为一个独立的小工具(10M左右)，而不是连同Scratch3.0一起用electron打包在一起，个中原因除了&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;人生苦短、我用Python&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;更重要的是，我们想让它成为一个通用的工具，无论你的网站是什么，无论你使用scratch3.0、blockly还是某种自主研发的其他什么东西，你都无需做什么伤筋动骨的事，只需要在网站中写一些js代码，你就能将网站接入scratch3_adapter，进而与各类开源硬件/AI相连。&lt;/p&gt;
&lt;p&gt;这部分值得玩味的地方是，你可以在网页上做所有的教学，无论是结合某一款开源硬件还是某一个AI系统。而scratch3_adapter将允许你用积木来驱动它们，你也能拿到积木/代码在外部系统的执行结果，判断学生是否掌握该知识点，而这对教学可能是很重要的。&lt;/p&gt;
&lt;p&gt;scratch3_adapter在向ROS学习，我们之后将引入action，如此一来你甚至可以设置开放性的课程，诸如某个关卡是要求学生用积木写一个智能体，让它走出现实世界的迷宫，里边可能涉及到各种复杂的策略和不可预期的情况，这种系统必须是异步的，最好带有状态机，ROS在这块做得十分惊艳。ROS的的action适合这种任务。尽管scratch3_adapter目前也能支持，但可能需要你写比较多的代码。对智能的关注是我的兴趣之一，我之后会来增强这块。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Tue, 29 May 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-05-29:scratch3_adapter-blockly.html</guid><category>scratch</category></item><item><title>发布scratch3_adapter</title><link>/scratch3_adapter.html</link><description>&lt;p&gt;项目从构思到发布，一路写了好几篇文章:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/scratch3-plugin-1.html"&gt;为Scratch3.0设计的插件系统(上篇)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/scratch3-plugin-2.html"&gt;为Scratch3.0设计的插件系统(下篇)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/Scratch3-Lab.html"&gt;Scratch3 Lab: 将Scratch3接入开源硬件及AI的实验项目&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这几篇文章基本回答了why、what、how的问题&lt;/p&gt;
&lt;p&gt;废话不说，直接上项目地址，欢迎使用和吐槽 ：）&lt;/p&gt;
&lt;h1 id="_1"&gt;项目地址&lt;/h1&gt;
&lt;p&gt;托管了相同的两份，一份放在github上，一份放在香港的服务器上,大家任选一个访问即可&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;scratch3-adapter-docs(香港服务器)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.just4fun.site/lab/scratch3-adapter-docs/"&gt;scratch3-adapter-docs(Github)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Sat, 26 May 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-05-26:scratch3_adapter.html</guid><category>scratch</category></item><item><title>Blockly与Scratch3.0的比较分析及选型建议</title><link>/scratch3-blockly.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/thdfebdb2d.png" /&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;可是时间究竟是什么？没有人问我，我倒清楚，有人问我，我想给他解释，却茫然不解了 --奥古斯丁&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id="blocklyscratch30"&gt;Blockly与Scratch3.0的比较分析&lt;/h1&gt;
&lt;p&gt;在我们分析Blockly与Scratch3.0之前，我们需要先阐述一下，Scratch3.0与Blockly分别是什么&lt;/p&gt;
&lt;h3 id="blockly"&gt;Blockly是什么&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;The web-based visual programming editor&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;blockly将自己定位为一个编辑器。这个描述再精当不过&lt;/p&gt;
&lt;p&gt;我在之前的文章: &lt;a href="http://blog.just4fun.site/blockly-overview.html"&gt;blockly入门与介绍&lt;/a&gt;里说:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;blockly作为编辑器，它的输入为用户的拖曳（拖曳作为一种输入，可以类比为普通编辑器的键盘输入），输出为生成的代码。使用blockly可以快速打造一个特定领域的可视化 块编程 编辑器&lt;/p&gt;
&lt;p&gt;至于每个积木（block）如何生成代码，代码用于什么用途，blockly则通通不关心，用户自己掌控。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我们可以简单将blockly视为积木化的编辑器，编辑器的输出只有代码。&lt;code&gt;Do one thing&lt;/code&gt;的原则让它成为一个灵活小巧的库，而不是框架，可以轻松与其他工具整合&lt;/p&gt;
&lt;h3 id="scratch30"&gt;Scratch3.0是什么&lt;/h3&gt;
&lt;p&gt;那么Scratch3.0是什么呢，相比于&lt;code&gt;Blockly是什么&lt;/code&gt;，这个问题要难回答很多，可能的答案有:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Scratch3.0是Scratch2.0的下一个版本，使用html5构建&lt;/li&gt;
&lt;li&gt;Scratch3.0是个&lt;code&gt;低门槛、宽围墙、高天花板&lt;/code&gt;的playground&lt;/li&gt;
&lt;li&gt;Scratch3.0是一个Blockly APP&lt;/li&gt;
&lt;li&gt;Scratch3.0是scratch-gui + scratch-vm + scratch-render + ...&lt;/li&gt;
&lt;li&gt;Scratch3.0是那种你用过就知道是什么的东西&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这几条阐述颇有盲人摸象的味道，我们站在不同侧面去阐述我们看到的Scratch3.0&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;其触牙者，即言象形如莱茯根；其触耳者，言象如箕；其触头者，言象如石；其触鼻者，言象如杵；其触脚者，言象如木臼；其触脊者，言象如床；其触腹者，言象如瓮；其触尾者，言象如绳&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;盲人摸象的比喻异常深刻，不盲的我们，看到&lt;code&gt;真实的事物&lt;/code&gt;是经过这样一个过程：可见光进入视网膜，经过神经元对光信号的解释和传递，在大脑渲染出一个图景,尽管隔了这么多层，我们坚信看到了所谓的&lt;code&gt;真实&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;我们可能确实看到了&lt;code&gt;真实&lt;/code&gt;，毕竟我们有阐述&lt;code&gt;真实&lt;/code&gt;的权利:)&lt;/p&gt;
&lt;p&gt;下边我们来逐条阐述&lt;code&gt;Scratch3.0是什么&lt;/code&gt;&lt;/p&gt;
&lt;h5 id="scratch30scratch20html5"&gt;Scratch3.0是Scratch2.0的下一个版本，使用html5构建&lt;/h5&gt;
&lt;p&gt;这条侧重在解释&lt;code&gt;3.0&lt;/code&gt;，Scratch3.0是对Scratch2.0的升级，3.0基于html5技术构建，可以跨平台运行&lt;/p&gt;
&lt;p&gt;这条回答站在Scratch发展过程的视角来看，如果你是Scratch的老用户，这句话也许足以让你醍醐灌顶。但新认识Scratch3.0的小伙伴对这个阐述应该不会感到满意。&lt;/p&gt;
&lt;p&gt;学习哲学的一种好办法是学习哲学史，溯本求源常常是个不错的方法，对scratch前世今生的追溯，可以参考我之前的这篇文章:&lt;a href="http://blog.just4fun.site/scratch.html"&gt;Scratch的前世今生&lt;/a&gt;&lt;/p&gt;
&lt;h5 id="scratch30playground"&gt;Scratch3.0是个&lt;code&gt;低门槛、宽围墙、高天花板&lt;/code&gt;的playground&lt;/h5&gt;
&lt;p&gt;这个比喻精彩之极，它阐述了Scratch的设计哲学。&lt;/p&gt;
&lt;p&gt;Scratch被设计为一个playground，一个playground应该尽可能提供丰富的基础设施，供它的使用者们嬉戏玩乐和探索。所以我们在Scratch3.0中看到了丰富的积木块和富有表现力的舞台效果，以及强大的可扩展性&lt;/p&gt;
&lt;p&gt;关于这点，&lt;a href="http://learn.media.mit.edu/lcl/weeks/week5/"&gt;Learning Creative Learning 第五周的课里&lt;/a&gt;里Scratch的创始人做了精彩的阐述&lt;/p&gt;
&lt;h5 id="scratch30blockly-app"&gt;Scratch3.0是一个Blockly APP&lt;/h5&gt;
&lt;p&gt;就这篇文章而言，这是个不错的答案，它甚至应该放到下文&lt;code&gt;Blockly与Scratch3.0的比较分析&lt;/code&gt;的部分里&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Scratch3.0是一个Blockly APP&lt;/code&gt;这句话的意思是，Scratch3.0基于&lt;code&gt;Blockly&lt;/code&gt;构建，就是说Scratch3.0中包含了Blockly。&lt;/p&gt;
&lt;p&gt;那么什么是&lt;code&gt;Blockly APP&lt;/code&gt;呢，按blockly官方说法，你需要做以下三步：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;集成blockly编辑器&lt;/li&gt;
&lt;li&gt;定义你的app里的功能块（block）&lt;/li&gt;
&lt;li&gt;构建app的其余部分，blockly仅充当代码生成器，你需要决定这些用户生成的代码用于做什么，这也是你的app的核心功能所在&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Scratch之前并不是基于Blockly构建的，3.0的版本里，才这样做，为何之前的Scratch不基于Blockly呢，因为Scratch这个项目比Blockly更早诞生，Scratch前几个版本的积木块都是自己造的轮子。现在Blockly几乎是公认最好的积木化编辑器，所以Scratch在3.0里把轮子换成Blockly&lt;/p&gt;
&lt;p&gt;说&lt;code&gt;Scratch3.0基于Blockly构建&lt;/code&gt;依然显得含糊其辞，Scratch3.0是个庞大的项目，包含了很多组件，只有其中的scratch-blocks基于Blockly，&lt;/p&gt;
&lt;h5 id="scratch30scratch-gui-scratch-blocks-scratch-vm-scratch-render"&gt;Scratch3.0是scratch-gui + scratch-blocks + scratch-vm + scratch-render + ...&lt;/h5&gt;
&lt;p&gt;这条阐述是程序员视角，站在Scratch3.0的项目结构上解释它&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Talk is cheap , show me the code&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我们直接打开&lt;a href="https://github.com/LLK"&gt;Scratch在github的主页&lt;/a&gt;，就可以看到相关的项目细节，源码一览无余都在其中, scratch wiki中对此也有&lt;a href="https://en.scratch-wiki.info/wiki/Scratch_Source_Code"&gt;介绍&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这也是程序员们理解一个项目最常用的一种方式，这种方式给了你一种安全感，你看到了项目&lt;code&gt;内部&lt;/code&gt;的细节，源代码不会骗人，代码也不会给你看一堆有的没的PPT，或像我一样，扯一些有的没的形而上学&lt;/p&gt;
&lt;p&gt;代码虽然不会骗人，但庞大的代码，在没有架构描述，没有好的文档的时候，对新手而言，跟读天书也差不太多，它不骗你，它只是让你晕头转向，Scratch团队目前要忙的使其实在太多，限于人力，你不能在短期内指望他们提供文档&lt;/p&gt;
&lt;p&gt;尽管没有文档，我们要一窥Scratch3.0的整体组成还是不难的，scratch-gui聚合了其他的组件:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;scratch-vm&lt;/li&gt;
&lt;li&gt;scratch-blocks&lt;/li&gt;
&lt;li&gt;scratch-render&lt;/li&gt;
&lt;li&gt;scratch-storage&lt;/li&gt;
&lt;li&gt;scratch-audio&lt;/li&gt;
&lt;li&gt;...&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;构成了完整的Scratch3.0&lt;/p&gt;
&lt;h5 id="scratch30_1"&gt;Scratch3.0是那种你用过就知道是什么的东西&lt;/h5&gt;
&lt;p&gt;这个阐述比较抖机灵，就像说&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;诗是那些翻译之后就消失的东西&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;或者&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;风景是拍进照片就不见的那些东西&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这些阐述有某种禅的味道，或者是对其进行的恶意模仿&lt;/p&gt;
&lt;p&gt;但我相信这个阐述会得到让·皮亚杰、Papert和艾伦.凯的赞同，你可以轻松在使用过程中掌握一个概念或工具，而很难在一种概念的文本化阐述中掌握它。关于这点皮亚杰做了精彩的论述，但是他的书真是太难读了。大家有兴趣可以看看：&lt;a href="http://blog.just4fun.site/scratch.html"&gt;Scratch的前世今生&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="_1"&gt;比较分析&lt;/h3&gt;
&lt;p&gt;一圈阐述下来，我们对Blockly的理解相对清晰: 这是一个积木化代码编辑器&lt;/p&gt;
&lt;p&gt;对于Scratch3.0，我们从很多个侧面试着阐述它。Scratch3.0是复杂的，我觉得没有必要回避这一点，对于复杂事物，相比于下个断言，我更愿意从不同侧面观察它。&lt;/p&gt;
&lt;p&gt;现在我们来比较一下这两者，这些比较的视角，是我临时拍脑袋想到的一些方面，有了前边对二者的分析和阐述，你其实也可以写出一大堆的比较分析。&lt;/p&gt;
&lt;p&gt;我们可以把Blockly视为一个库，而把Scratch3.0视为一个框架。一个库往往遵循&lt;code&gt;Do one thing&lt;/code&gt;的Unix哲则，你可以轻松将它组合到你的项目中，Blockly库只负责从积木中生成代码，怎么去使用这些代码？这些代码是控制虚拟角色还是实际的硬件？它何时被解释运行？是否支持并行？代码运行生命周期是怎样的？解释器在本地还是在另一个硬件上？Blockly通通不关心。Blockly给予你自由，同时你也不得不肩负起自己的责任，你需要去考虑构建一个Blockly APP剩下的部分，当然一个典型的Blockly APP我相信是有最佳实践的，目前我认为这里边存在需要解决的大的问题有且仅有3大类，这个话题与本文关系不大，之后有机会再说。值得提醒的是，你遇到的一些觉得难以绕过困难，可能是一些构建一个解释器会遇到的困难，这个困难和普通的编写程序很不一样，因为大部分时间里，我们都是在使用解释器，而不是构建一个，这可能是让很多开发者不知所措的地方。&lt;/p&gt;
&lt;p&gt;相比于Blockly，Scratch3.0则更像一个框架，Scratch3.0几乎开箱可用，它有各个组件，你可以通过修改这些组件来定制它，当然你需要先理解它。你可以通过插件系统加入自己的扩展，无论是软件还是硬件，你都可以进行拓展。如果是对硬件的扩展，你可以考虑基于我们的工作来做，会轻松很多，参考:&lt;a href="http://blog.just4fun.site/Scratch3-Lab.html"&gt;Scratch3 Lab: 将Scratch3接入开源硬件及AI的实验项目&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;说Scratch3.0是框架，侧重在强调它的结构完整性和灵活性，它不是vue、django那种框架，Scratch3.0介于框架和项目之间，它给予你的自由度要比一般意义上的框架要小&lt;/p&gt;
&lt;p&gt;Scratch3.0的解释器相关部分:scratch-vm 十分强大和灵活，要做到这点很不容易。如果你在做和Scratch3.0类似的事，最后不要重造轮子。已经有大厂试着从Blockly开始，重造一个Scratch3.0，他们确实也造出来了。很难的工作在于重写scratch-vm。在一个典型blockly APP中，大家一般使用官方推荐的interpreter来解释执行代码，但在一个复杂项目中，可能是不够的。如果你准备重写scratch-vm，最好有懂解释器的人。而且最好不要去做这件事，尽管你可能做得到，但它的灵活性很难有scratch-vm那么好。&lt;/p&gt;
&lt;h1 id="_2"&gt;选型建议&lt;/h1&gt;
&lt;p&gt;那么我们究竟什么时候选择Blockly，而在另一些时候选择Scratch3.0？&lt;/p&gt;
&lt;p&gt;这恐怕是不容易说清楚的问题，我试着给出一些建议。大多时候需要你对自己正在做的事情有清晰的阐述之后，才好给具体建议。&lt;code&gt;认识你自己&lt;/code&gt;总是没错的&lt;/p&gt;
&lt;p&gt;简单地说如果你才涉足积木化编程这一块，那么从Blockly开始常常是个好建议，因为Scratch3.0很复杂，除非你想原原本本地使用Scratch3.0,否则对它的任何修改，对早期团队来说都是艰难的；你折腾任何积木化编程项目的时候，可能都会遇到一些共性的问题，如我前头提到的那一大串，Scratch3.0在这块探索了很久，也给出了很多优秀的解决方案，但你一来就读Scratch3.0相关组件的源码，很可能云里雾里，你可能先要从钻木取火开始（从Blockly基础项目开始），等你意识到这个问题域的常见困境之后，才会意识到什么好的解决方案。在困境出现之前，好的解决方案会被看作一种过度复杂的设计&lt;/p&gt;
&lt;p&gt;也许你最终选择使用Scratch3.0，但Scratch3.0基于Blockly构建，对Blockly的早期投入，总是能帮助到你理解Scratch3.0的&lt;/p&gt;
&lt;p&gt;关于如何开始Blockly的旅程的教程目前少的可怜，如果你愿意可以从我之前写得东西入手，源码和文章都有：&lt;a href="http://blog.just4fun.site/blockly-overview.html"&gt;blockly入门与介绍&lt;/a&gt;, 文末附有教程和源码&lt;/p&gt;
&lt;p&gt;前边只是泛泛地建议说你应该从Blockly开始，对于你最终应该选择什么，并没有给出具体建议&lt;/p&gt;
&lt;p&gt;让我们假设你已经对Blockly和Scratch3.0都有了清晰的了解，这时候的选型问题，就取决于你要做的具体事情了，我们来讨论一些典型的场景&lt;/p&gt;
&lt;p&gt;比如你想做一个code.org或者Tynker这类网站，Blockly是个理想的选择，事实上，code.org或者Tynker也确实是这样做的，&lt;code&gt;Blockly+interpreter&lt;/code&gt;是这类网站理想的解决方案，简单灵活。code.org和Tynker中的每个关卡都是一个典型的Blockly APP。当然如果你愿意，你也可以使用scratch-blocks来做，深圳已经有公司这样做，你可以将scratch-blocks视为Blockly的定制版（使用scratch-blocks和使用blockly几乎没有区别，我在教程里也写了这部分），只是改了积木的UI风格，但它们依然可以被当作干净的库使用，而不牵扯太多Scratch3.0的其他东西，至于generate代码的功能也完全一样&lt;/p&gt;
&lt;p&gt;假如你想做一个机器人控制/教学平台，两者都可选，目前市面上的机器人使用scratch2.0控制的居多(部分原因是Blockly出现的比较迟)。新出的机器人使用两者的都有，使用Blockly的优势，如前边说的：轻量，自由，但也意味着你要去操心更多解释和实现上的细节工作，这是个复杂的工作，有机会单独讨论；使用scratch的话，你只要专心写插件部分就好了，如果你的机器人是交互式的，比如Cozmo（我已经把它接入Scratch3中)，关于代码如何被vm解释运行，如何控制生命周期，如何支持事件和并行，scratch-vm都帮你做了！&lt;/p&gt;
&lt;p&gt;关于积木化编程工具与硬件/机器人交互的话题，涉及很多典型问题：代码灌入式的还是服务风格的？通信方式是什么？基于web控制还是基于APP控制？是否支持事件风格编程？值得专门写一片文章谈论&lt;/p&gt;
&lt;h1 id="_3"&gt;尾声&lt;/h1&gt;
&lt;p&gt;这篇文章，拖了好久才写完，写这篇文章的时候，我在碧山，阿朱阿碧的碧，满目山河的山，写完后，我下午该从这儿离开了，昨晚下了一夜的雨&lt;/p&gt;
&lt;p&gt;我晚上撑着伞，走过村头巷尾，路过一户人家的厨房，很旧的房子，门很小，雨很大，我在门口站了一会儿就走了&lt;/p&gt;
&lt;p&gt;上次夜里路过一户人家厨房的时候，你说着彼得潘的故事，我这回在这儿读完了彼得潘&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;只有一个陌生的小男孩，从窗外向里张望。他的乐趣数也数不清，那是别的孩子永远得不到的。但是，只有这一种快乐，他隔窗看到的那种快乐，他却被关在了外面，永远也得不到&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!-- 
当人们问scratch是什么是，他所期待的可能是"scratch"为何有如此的魔力，这个问题在我看来是个形而上问题，我无法回答

诗是什么的时候，你告诉它格律是什么是不够的

那么诗是什么，诗是`诗是翻译之后就消失的哪些东西`这样的俏皮话，让人会心一笑

那么阐述是什么意思，阐述意思是你可以用一件事来解释另一件事，但这是可能的吗？ 这些问题留给该死的哲学家吧

# 选型建议

积木化编程有且仅有几类问题

    *  软件 游戏引擎
    *  硬件 通信
    *  一个平台

用积木表达原语
解释、执行 vm

是不是许多事件和多线程 

硬件应该是 server

协议设计
我的手机  11:01:26
那scratch3.0是什么呢
是个blockly app
但这句话包含的信息很少

就像你问我，keras
是什么的呢，我说是一个Python项目

关于scratch，我只是说了，它包含了blockly而已

如果你是一个开发者，你会觉得我说得太少了

那么你在什么情况下选择blockly

设计出正交而富有表现力的积木 并不容易

block只是scratch的编辑器

怎么并行，把破坏控制在局部

有哪些接口，操作原语
是否需要并行
是否支持事件
交互  
解释器在哪里
是否与外部通信


事实上大多数的读者们，并不知道scratch是什么，要回答scratch是什么，最好的方法之一，是去读一读media lab的《爆裂》一书，scratch也诞生自这个实验室

阐述是一件很有趣的活动，阐述这个要求你用一件事来解释另一件事，如果你是个怀疑论者，你会说，为何我们可以用一件事去解释另一件事，这个问题留给该死的哲学家们，就我们来说，这种解释
--&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Mon, 30 Apr 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-04-30:scratch3-blockly.html</guid><category>scratch</category><category>blockly</category></item><item><title>积木化编程与智能家居</title><link>/scratch3-smart-home.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/smart-homeda856b95.png" /&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;1.1 世界是事实的总和，而非物(das Ding)的总和   -- 维特根斯坦《逻辑哲学论》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我在上篇文章: &lt;a href="http://blog.just4fun.site/Scratch3-Lab.html"&gt;Scratch3 Lab: 将Scratch3接入开源硬件及AI的实验项目&lt;/a&gt;里写道:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我们的兴趣是将Scratch3.0连接到有趣的开源硬件和AI上，甚至也包括接入你童年的那辆玩具四驱车&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;但你知道，&lt;code&gt;有趣的硬件&lt;/code&gt;和&lt;code&gt;开源&lt;/code&gt;有时候不是并肩而行的，好在开放似乎正在成为一种趋势和竞争优势，商家们即便不开源他们的硬件,却也为了扩大自己的影响力和市场份额，积极地以各种方式开放自己的一部分，以便与外部连接。为了让事情变得更有趣，我们决定进一步扩大Scratch3.0的连接范围，除了&lt;code&gt;开源硬件&lt;/code&gt;之外，也接入遵循标准协议或提供sdk的硬件&lt;/p&gt;
&lt;p&gt;我们最近接入的一套硬件是米家的智能家居礼品装，它长这样&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch3-homec5c1f139.png" /&gt;&lt;/p&gt;
&lt;p&gt;套件里包含：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;米家多功能网关&lt;/li&gt;
&lt;li&gt;米家智能插座&lt;/li&gt;
&lt;li&gt;米家无线开关&lt;/li&gt;
&lt;li&gt;米家人体传感器&lt;/li&gt;
&lt;li&gt;米家门窗传感器&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="_1"&gt;智能家居&lt;/h1&gt;
&lt;p&gt;在这个被媒体称为&lt;code&gt;人工智能&lt;/code&gt;的时代，每个人对&lt;code&gt;智慧&lt;/code&gt;/&lt;code&gt;智能&lt;/code&gt;都能说出自己的一堆见解、偏见或幻想&lt;/p&gt;
&lt;p&gt;以至于一大堆标着&lt;code&gt;智慧&lt;/code&gt;前缀的酒瓶里，有卖假酒的、有卖碳酸饮料的、有卖来自阿尔卑斯山脉的矿物质水的，以及卖梦想的&lt;/p&gt;
&lt;p&gt;维基百科上与&lt;code&gt;智能家居&lt;/code&gt;最近的一个词条是&lt;a href="https://zh.wikipedia.org/wiki/%E6%99%BA%E6%85%A7%E5%AE%B6%E5%BA%AD"&gt;智慧家庭&lt;/a&gt;,其中这个阐述，我觉得很清晰:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;家庭自动化 (Home automation) ，是指家庭中的建筑自动化，也被称作智慧家庭 (Smart home)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;相比于智能，自动化的可操作性要强很多&lt;/p&gt;
&lt;p&gt;在技术视角下，今天的智能家居往往是那些用于实现家庭自动化的家庭设备，他们是一些传感器和执行器。它们与网关进行通信，所以智能家居一般作为物联网的子概念&lt;/p&gt;
&lt;h1 id="_2"&gt;智能家居的痛点&lt;/h1&gt;
&lt;h3 id="_3"&gt;碎片化&lt;/h3&gt;
&lt;p&gt;目前市面上有琳琅满目的智能家居设备，碎片化问题十分严重&lt;/p&gt;
&lt;p&gt;如维基百科所言:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;虽然目前有很多竞争厂商，然而却没有多少世界共通的工业标准，智慧家庭空间严重的被碎片化。[2] 制造商有时会透过扣留文件以及诉讼来阻止独立的实作。[3]&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这些散落的设备虽然像莱布尼茨的单子一样受到欲求（appetition）的驱动（主要是受到&lt;code&gt;提高销量&lt;/code&gt;的欲求的驱动），但却不像莱布尼茨的单子那样，肯多去和其他单子交流&lt;/p&gt;
&lt;p&gt;如果你买到手的智能家居之间无法协同工作，&lt;STRIKE&gt;那它们和咸鱼有什么区别,&lt;/STRIKE&gt;那它们还怎么用来实现家庭自动化？仅仅是因为你买了A厂家的智慧灯泡，B厂家的智慧开关，你按下开关，得到的却是404，你此刻得到的除了对google的思念之外还有啥。你恨不能拿一瓶涂改液把外包装上的&lt;code&gt;智能&lt;/code&gt;改为&lt;code&gt;智障&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;智能家居目前处在诸侯割据，度量衡没有统一的战国。这个问题该如何是好？&lt;/p&gt;
&lt;h3 id="_4"&gt;要有光&lt;/h3&gt;
&lt;p&gt;让我们抡起技术的锤子，来看看有什么钉子值得敲一敲。&lt;/p&gt;
&lt;p&gt;对一个程序员来说，首先想到的可能是&lt;STRIKE&gt;&lt;a href="https://github.com/nvbn/thefuck"&gt;thefuck&lt;/a&gt;&lt;/STRIKE&gt;代理(proxy),我们只要把各家的硬件放在代理之下，似乎就能在上层抽象地调用它们，你在代理中去实现各个硬件的通信细节，对外都暴露统一的的接口，对于一盏灯，我至少应该能调用两种接口/服务:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;open&lt;/li&gt;
&lt;li&gt;close&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;对于功能更强的，还可以控制亮度和颜色。&lt;/p&gt;
&lt;p&gt;至于功能更强的，我还可以让它播放一首歌，购买一个商品，或是让它去兜售我的隐私,哦不对，兜售隐私似乎是个互联网软件都能做，不需要很强的功能；对于更强的，我还可以对他说&lt;code&gt;hi 神灯，我能实现你的三个愿望&lt;/code&gt;， 再做下去，功能冗杂得要像某宝和某信了，我们不需要一个伪装成操作系统的电灯：）&lt;/p&gt;
&lt;p&gt;事实上，如果一件事值得做，很可能已经有人在做它了，你与这些成熟项目的距离只差google和github。一个叫Paulus的程序员实现了上边的这些，他构建了一个叫&lt;a href="https://www.home-assistant.io/"&gt;home-assistant&lt;/a&gt;的Python程序，把各个碎片拼在了一起，home-assistant可以接入所有主流的智能家居设备&lt;/p&gt;
&lt;p&gt;home-assistant的核心是个事件系统，它使用状态机来管理设备，系统代理了设备，对外提供服务，它的架构图如下：&lt;/p&gt;
&lt;p&gt;&lt;img alt="架构图" src="https://d33wubrfki0l68.cloudfront.net/2b58a392636b4cd35eeb4e69c73326479ea44bda/21f5b/images/architecture/component_interaction.png" /&gt;&lt;/p&gt;
&lt;p&gt;关于home-assistant，Paulus的&lt;a href="https://youtu.be/Cfasc9EgbMU"&gt;这个演讲&lt;/a&gt;十分精彩,视频的20:49中，Paulus熄灭hello，world文件被创建的一瞬，Paulus如同表演了一场街头魔术，观众的掌声里，Paulus的反应十分有趣: 从惊喜到羞涩再到得意。演示亲手构建的程序有时候和表演一场魔术带来的喜悦是很相似的：你对精心设计的魔法颇为自得，观众在演出里，被你带入预设的情境下，他们陷入谜团，感受震撼和惊喜&lt;/p&gt;
&lt;p&gt;home-assistant的架构和我为&lt;a href="http://blog.just4fun.site/scratch3-plugin-2.html"&gt;Scratch3插件系统&lt;/a&gt;做的架构设计十分相似&lt;/p&gt;
&lt;p&gt;这两个系统本质上都是事件系统，也都基于Python构建&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;生命苦短，我用Python&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我把事件构建在消息之上(zeromq的世界观是&lt;code&gt;everything is message&lt;/code&gt;)，我想让这个插件系统是跨语言的，而zeromq是我觉得最佳的解耦方案。Paulus选择在Python语言层做这件事，当然Paulus也做到了跨语言，通过对外提供服务实现。&lt;/p&gt;
&lt;p&gt;维特根斯坦在《逻辑哲学论》的第一个论题里说&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;1 世界就是所发生的一切东西&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;接着他阐述:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;1.1 世界是事实的总和，而非物(das Ding)的总和&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;他在论题2中阐述&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;2 那发生的东西，即事实，就是原子事实的存在&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这或许可以解释为何事件系统和状态机拥有如此强大的表现力&lt;/p&gt;
&lt;h3 id="_5"&gt;自动化规则&lt;/h3&gt;
&lt;p&gt;智能家居允许你自定义规则来实现家庭自动化，你可能会定义出如下的规则:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;当我到家的时候，把空调打开&lt;/li&gt;
&lt;li&gt;当我离开房间的时候，把灯关了&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如何为普通用户提供一个友好的的界面，让他们方便地定义规则，这不是件容易的事。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;定义规则&lt;/code&gt;，听起来很适合用代码来做这件事，但大众不会编程，这句话没有指责或沾沾自喜的意味，在此我并不是说大众是麻瓜。会编程是一件挺酷的事，它极大地赋予了你创造的可能，但这个和会写作、会钢琴、会滑雪没有本质区别，你通过练习获取一项技能来取悦自己。另有些人把时间花在了博览言情小说或纸飞机制作上。每个人的际遇和兴趣各不相同，并不是所有人都有机会写代码，也不是所有人都觉得这是一件和旅行、看电影一样有趣的事。&lt;/p&gt;
&lt;p&gt;我们这些会编程的人如何为他人提供一个不错的工具，就像他们为我们提供的好看的旅行照片和影评那样，让他们解决家庭自动化的问题同时也领略编程乐趣。&lt;/p&gt;
&lt;p&gt;市面上的解决方案，我觉得都不大理想，如果你用过&lt;code&gt;米家&lt;/code&gt;你就知道我在说什么（事实上它已经是这个行业目前最好的方案之一了），在&lt;code&gt;米家&lt;/code&gt;中你为你的智能家居设备们编写规则，仿佛是在进行中文编程，一个页面只够你表达一个if-else逻辑，为了实现&lt;code&gt;如果开关打开，就把灯打开&lt;/code&gt;这个逻辑，你可能需要来回切换5、6个页面。这里只连接了2设备，只有一个if逻辑！&lt;/p&gt;
&lt;p&gt;如果你有3个房间的设备，为它们编写一天时段里的自动化规则，你可能需要先考虑升级一下大脑&lt;/p&gt;
&lt;p&gt;同样是上边的规则，我把&lt;code&gt;米家的智能家居套件&lt;/code&gt;接入Scratch3之后，可使用如下积木来表达&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/scratch3-home1eb5c560.png" /&gt;&lt;/p&gt;
&lt;p&gt;你在&lt;code&gt;米家&lt;/code&gt;里拖拽来回切换5、6个页面折腾出的东西，和上边拖2个积木表达的语义是完全相同的。但撰写规则的过程要舒服很多。不仅编程规则要直观和舒适很多，你还可以在Scratch中即时对每个不熟悉的积木做实验，而不必等你把规则一次写完才能看效果，这很像程序员使用REPL时的愉快感受。你对每个积木的属性一览无余，之后在一个界面中，去拼搭组合它们，而不必在多个页面中来回切换。撰写规则变成了轻松的堆叠积木&lt;/p&gt;
&lt;p&gt;Scratch社区有许多案例和报告，解释为何积木化是适合普通人编程的方式，关于这点，之后有空细说&lt;/p&gt;
&lt;p&gt;我们把&lt;code&gt;米家的智能家居套件&lt;/code&gt;接入Scratch3之后，它获得了更多的扩展性，诸如下边的视频里，我们演示如何让你徒手隔空为水壶通电并开灯&lt;/p&gt;
&lt;video src="http://wwj-tmp-video2.just4fun.site/scratch-smart-home.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;我在Scratch的舞台上中拖拽了两个按钮，当我的手在视频里按下左边的按钮，则开灯并让水壶开始烧水,而我隔空按下右边的按钮，就将它们都断电&lt;/p&gt;
&lt;p&gt;技术层面，通过运动检测来做到这点，而运动监测在scratch3里也只是一个积木块而已&lt;/p&gt;
&lt;p&gt;在Scratch3 Lab中，我们将把各类有趣的开放硬件和AI接入，允许你做各种有趣的事情,目前接入的硬件和AI在陆续增多，&lt;code&gt;米家的智能家居套件&lt;/code&gt;是我门接入智能家居的第一步&lt;/p&gt;
&lt;h1 id="_6"&gt;空间编程&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;空间编程&lt;/code&gt;是一个让我着迷的概念，你的空间会对你的行为做出相应的反应，诸如在你的房间里，当你睡觉的时候，灯光自动熄灭，当你起床时，窗帘自动打开。&lt;/p&gt;
&lt;p&gt;可如何判断你何时是"睡觉模式"呢？&lt;/p&gt;
&lt;p&gt;你当然可以用一些生物传感器来做(事实上我正准备买这些东西)，或者简单地使用机器视觉来做，你可以教会机器什么时睡觉模式，诸如你躺下盖了被子时候，告诉Scratch这是睡觉状态，起床掀开被子后告诉Scratch，这是起床模式，这变成了一个很简单的二值分类问题，你需要的样本数据和计算量都很小，目前在本地网页里很轻松就做到了，如果使用我之前设计的Scratch插件系统，更复杂的机器视觉可以移到另一台机器做也没问题，对用户你只需暴露出Scratch3的积木。这块我在自己的房间里实现了，目前还没有上线到Scratch3 Lab。&lt;/p&gt;
&lt;p&gt;为一个空间编程常常需要AI和物联网的配合&lt;/p&gt;
&lt;p&gt;AI善于提取出模式，对这个模式做出怎样的响应，可以通过调度物联网里的硬件实现。而空间所拥有的智慧，则是这些彼此响应的事件关系网。&lt;/p&gt;
&lt;p&gt;我和几个朋友一起在南京开了家青旅，开业小半个月，还蛮热闹的，我们想在这个空间里做一些好玩的尝试。我们都是二楼南书房的忠实粉丝，我们在青旅里做了很多有意思的小空间，让大家方便看书和讨论，也会定期组织一些周末沙龙和电影放映活动。如果你也喜欢看书或旅行，你有好的想法，都欢迎过来玩&lt;/p&gt;
&lt;p&gt;我准备在青旅里边做一些有意思的空间编程尝试，诸如当你夜里坐下翻开书的瞬间，灯才为你打开，而你合上书思考的时候，灯将熄灭，你将沉浸在自己的世界里 ：）&lt;/p&gt;
&lt;p&gt;Just for fun&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Sun, 22 Apr 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-04-22:scratch3-smart-home.html</guid><category>scratch</category><category>blockly</category></item><item><title>Scratch3 Lab: 将Scratch3接入开源硬件及AI的实验项目</title><link>/Scratch3-Lab.html</link><description>&lt;p&gt;&lt;img alt="" src="https://codelab-adapter-docs.codelab.club/img/scratch3-extensions.png" /&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;如果你想走得快，一个人走; 如果你想走得远，一群人走&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;hi 大家好，我们最近在构建一个好玩的项目&lt;/p&gt;
&lt;p&gt;我在前边花了两篇文章在架构上论述了如何为Scratch3.0设计一个通用的插件系统，让Scratch3.0能与物理世界的万物互联，并为它们编程:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://blog.just4fun.site/scratch3-plugin-1.html"&gt;为Scratch3.0设计的插件系统(上篇)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://blog.just4fun.site/scratch3-plugin-2.html"&gt;为Scratch3.0设计的插件系统(下篇)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这个通用的插件系统已基本完成，最近在做一些收尾的工作、重构以及撰写文档，我们之后计划将它开源并围绕它构建社区，如此一来，将你感兴趣的硬件接入Scratch3.0，将成为一件有趣的举手之劳&lt;/p&gt;
&lt;p&gt;利用这个插件系统，我们已将cozmo和microbit接入到scratch3中。你可以让cozmo、microbit与scratch3.0中的所有积木互动，做出令人惊叹的效果，边界是你的想象力！我们正将这两个项目作为插件案例，写入文档，向开发者们描述如何利用插件系统，通过短短的数行代码，将你的新硬件或任何其他好玩的东西接入Scrach3.0&lt;/p&gt;
&lt;p&gt;我们的兴趣是将Scratch3.0连接到有趣的开源硬件和AI上，甚至也包括接入你童年的那辆玩具四驱车&lt;/p&gt;
&lt;h1 id="scratch3-lab"&gt;Scratch3 Lab&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://scratch3.codelab.club/"&gt;Scratch3 Lab&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!--
以上其实是同一个网站，都是Scratch3 Lab。如果你能打开第一个地址最好不过了，服务器在香港，国内可能不能访问。因为这个原因，我顺便把Scratch3 Lab部署到了github上，国内还算稳定，方便大家访问。

最后一个地址是http的，用于测试http和https的差异，我们希望插件系统能尽可能支持更多的网站。Scratch3 Lab主要用于做各种好玩的实验--&gt;

&lt;!--由于没在国内备案，带来的不便给各位道歉。当然，该道歉的也许不该是我们 ：）--&gt;

&lt;p&gt;如果你有什么有趣的东西想接入Scratch3，欢迎与我们联系，如果我们也觉得好玩，可能会和你一起将它接入Scratch3，如果我们兴趣不大，那欢迎你自己亲自动手啦&lt;/p&gt;
&lt;p&gt;我们的口号是: Just for fun&lt;/p&gt;
&lt;h3 id="_1"&gt;技术视角&lt;/h3&gt;
&lt;p&gt;Scratch3 Lab采用Scratch官方最新的源码，使用官方的develop分支，我们尽量做到每个月都跟进官方的开发分支，如果有一些有趣的特性，我们会采用更快的更新频率&lt;/p&gt;
&lt;p&gt;Scratch3 Lab目前已经以extensions的形式整合了2个硬件插件和一个图像识别插件，一个文本情感分析插件，一个语音插件，一个运动检测插件&lt;/p&gt;
&lt;p&gt;AI相关的几个项目来自MIT media lab，我们之后准别采用他们的思路来接入国内好玩的AI平台，此外跑在本地的AI也是我们的关注方向。&lt;/p&gt;
&lt;p&gt;我们想让这个项目在没有互联网的环境也能正常使用，所以我们尽力做出替代云的AI插件，至少不影响概念的讲解和教学，当然趣味性也不能少，关于这一点，AI社区已经有很多有趣的尝试，这部分有空细说。我们这样做的目标是让Scratch3 Lab能完全跑在树莓派上，这样即便没有网络的贫困山区，也能完整得到极具趣味和表现力的Scratch3&lt;/p&gt;
&lt;p&gt;目前我们正在接入IoT(通过mqtt)和BB8(通过web bluetooth)，物联网也是Scratch3的兴趣之一&lt;/p&gt;
&lt;h1 id="_2"&gt;插件系统&lt;/h1&gt;
&lt;p&gt;目前你可以看到插件系统的文档：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://codelab-adapter-docs.codelab.club/"&gt;codelab-adapter docs&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="_3"&gt;更新&lt;/h1&gt;
&lt;p&gt;Scratch3 Lab目前是&lt;a href="https://www.codelab.club/"&gt;codelab&lt;/a&gt;的一部分&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;Just for you :)&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Sun, 08 Apr 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-04-08:Scratch3-Lab.html</guid><category>scratch</category></item><item><title>为Scratch3.0设计的插件系统(下篇)</title><link>/scratch3-plugin-2.html</link><description>&lt;blockquote&gt;
&lt;p&gt;Imagine, Program, Share&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在&lt;a href="http://blog.just4fun.site/scratch3-plugin-1.html"&gt;上篇文章&lt;/a&gt;里，关于Scratch3.0如何与外部硬件(设备/玩具)通信，我们梳理了社区里的常见做法&lt;/p&gt;
&lt;p&gt;在这篇文章中，准备写写我的架构设计,文中会给出架构图，解释这样设计的原因，以及不采用目前主流做法的原因。&lt;!--unix哲学--&gt;&lt;/p&gt;
&lt;h1 id="_1"&gt;设计原则与初衷&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;编程是伪装成艺术的科学&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;近来在编程方面，对我影响最深的一本书是《ROS机器人编程实践》。在这本书里，我们看到通过遵循Unix哲学可以构建出何等强大、灵活而简单的系统(Unix哲学在《Unix编程艺术》中被阐述得很精彩)&lt;/p&gt;
&lt;p&gt;当然，ROS的&lt;code&gt;简单&lt;/code&gt;，是指它在面对所处理的问题时，已尽可能地简单，这个系统本身还是有一定复杂度的。当我们在说《哲学问题》把哲学阐述如此清晰、简单时，其中的简单也是这个意思。你不能指望一本书能把N-S方程的推导过程讲解得和天线宝宝的情节一样简单。如果有作者声称他能，要么他是骗子，要么他是疯子，要么他是伯特兰·罗素&lt;/p&gt;
&lt;p&gt;Unix哲学里鼓励如何构建一个系统呢？&lt;/p&gt;
&lt;p&gt;我很喜欢&lt;a href="https://github.com/booksbyus/zguide"&gt;zguide&lt;/a&gt;（zguide是ZeroMQ的教材，写得几乎和ZeroMQ这个项目一样出色）中的这个阐述&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The physics of software is not algorithms, data structures, languages and abstractions. These are just tools we make, use, throw away. The real physics of software is the physics of people--specifically, our limitations when it comes to complexity, and our desire to work together to solve large problems in pieces. This is the science of programming: make building blocks that people can understand and use easily, and people will work together to solve the very largest problems.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;作为社会成员的我们，在遇到一个高度复杂的问题时，我们会群策群力，分工合作，将问题拆分为若干个部分，一起解决。这里就体现了编程的科学：创建一组小型的构建模块，让人们易于理解和使用，那么大家就会一起用它来解决问题。&lt;/p&gt;
&lt;p&gt;想想你的Unix工具箱中的grep/find/awk/sed组合起来时何等地强大。当一堆的小工具能彼此沟通时，事情就变得有趣了。&lt;/p&gt;
&lt;p&gt;和ROS一样，我们鼓励社区的参与，我们想设计一个开放的系统，允许更多的插件加入进来，允许你去连接更多有趣的设备，在这个架构中鼓励人们重用社区的经验，在别人的基础上工作，也方便人们将自己的工作分享给社区。&lt;/p&gt;
&lt;p&gt;我们不想构建一个封闭、精致且庞大的系统。&lt;/p&gt;
&lt;h1 id="_2"&gt;插件系统功能描述&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;连接scratch3.0与来自物理世界的各种硬件及开放系统&lt;/li&gt;
&lt;li&gt;可以配合scratch3.0官方网站使用。自行架设的scratch3.0网站如果与官方插件系统兼容，那么你也能直接使用这套插件系统。就是说等scratch3.0发布之后，任何采用官方扩展机制的网站，都能使用这套插件系统，而无须hack核心源码&lt;/li&gt;
&lt;li&gt;允许你为系统写扩展插件，将任何你能操控的系统接入Scratch3.0中&lt;/li&gt;
&lt;li&gt;当然如果你有兴趣，甚至可以把这套系统接入Scratch3.0之外的地方，比如你想把它接入Blockly或者node-red中，插件系统虽然最初是为Scratch3.0而做，但Scratch3.0并不特殊，它仅仅是一个消息订阅者和发布者而已&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="_3"&gt;思路&lt;/h1&gt;
&lt;p&gt;项目的架构思路主要来自ROS(Robot Operating System)。ROS是个复杂系统，当今世上有趣和复杂机器人大多都运行着ROS，从国际空间站的R2机器人到一些路上自动驾驶的汽车。我觉得ROS系统中处理的很多问题，在使用Scratch驱动外部设备/机器人时也会遇到，尤其当你不甘于只是简单地灌入代码、想做出交互性更好的机器人时(比如Cozmo)。这些问题包括：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;传感器的数据发布机制；&lt;/li&gt;
&lt;li&gt;服务(service)与动作(action)的区分，以及各自处理的问题；&lt;/li&gt;
&lt;li&gt;如何重用消息结构，让一套积木块能将相同的语义传递给不同的硬件，只需调整最末端的驱动代码便可控制天上飞的、地上走的、水里游的。&lt;/li&gt;
&lt;li&gt;...&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Cozmo显然就是利用这些概念构建了令人惊叹的操作体验&lt;/p&gt;
&lt;p&gt;我最近在构建一个叫ROLS(Robot Operating Lite System)的项目，从名字可以看出，这个项目是想做个轻量级的ROS,目前只开了个坑:&lt;a href="https://github.com/wwj718/ROLS"&gt;ROLS&lt;/a&gt;。在github上创建项目的动机常常是，想到了一个好名字，不知道你们有没有这种情况&lt;/p&gt;
&lt;p&gt;ROS的作者也在重写这个项目，如他自己在ROS2.0的设计文档中说的其实ROS的核心是一个&lt;code&gt;匿名的发布-订阅中间件系统&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;本文为Scratch3.0设计的插件系统本质上便是一个匿名的发布-订阅中间件系统，组件之间通过消息彼此沟通。系统中所有的节点都对等，即便是Scratch3.0也不特殊。&lt;/p&gt;
&lt;p&gt;至于为这个系统提供更多好用的小工具(诸如roscore、rosrun、rostopic等)，我会在&lt;a href="https://github.com/wwj718/ROLS"&gt;ROLS&lt;/a&gt;中陆续折腾出来它们的轻量级替代品&lt;/p&gt;
&lt;h1 id="_4"&gt;架构图&lt;/h1&gt;
&lt;p&gt;&lt;img alt="scratch3.0插件系统" src="http://wwj-tmp-video2.just4fun.site/%E6%8F%92%E4%BB%B6%E7%B3%BB%E7%BB%9F.png" /&gt;&lt;/p&gt;
&lt;p&gt;我们自上往下看。&lt;/p&gt;
&lt;p&gt;首先看Scratch3.0部分。在Scratch3.0中，我们需要写一个js插件，这个插件就像特洛伊木马，作为我们的&lt;code&gt;内应&lt;/code&gt;，之后它将负责与外部沟通。如果你对这部分不熟悉，应该先去看看官方文档:&lt;a href="https://github.com/LLK/scratch-vm/wiki/Scratch-3.0-Extensions-Specification"&gt;Scratch 3.0 Extensions Specification
&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这部分是Scratch3.0的原生扩展机制。目前官方已经完成了好几个扩展，有兴趣的话，可以自行阅读源码。其中wedo2的扩展很值得一读。&lt;/p&gt;
&lt;p&gt;你在Scratch3.0中写js扩展时，除了要定义出积木块的样式之外，还需要定义出opcode(语义)和它的具体实现，这部分将在vm中执行，我们参考了wedo2的机制，采用
socketio来传递消息(当然你也可以直接使用websocket)。&lt;/p&gt;
&lt;p&gt;插件系统中有一个websocket server(这个架构很像jupyter)，与vm进行双向通信。&lt;/p&gt;
&lt;p&gt;websocket server采用zeromq来sub/pub消息&lt;/p&gt;
&lt;p&gt;而每个硬件被程序代理，代理程序也采用zeromq来sub/pub消息&lt;/p&gt;
&lt;p&gt;系统看去有些啰嗦，比如代理程序似乎是不必要的。如果你为scratch3.0写过插件，你可能会想，我们为何不把websocket server视为vm的延伸，如果vm的概念延伸到物理机器上，不就具备了和硬件交互的能力！(已经从浏览器蔓延到了系统进程中)那么为何还需要多一层硬件代理。原因是为了构建一个匿名的发布-订阅系统，以便解耦和重用。&lt;/p&gt;
&lt;h3 id="_5"&gt;具体实现&lt;/h3&gt;
&lt;p&gt;上图是一张语言无关的架构图，你可以用任何你喜欢的语言去实现它，下边说说我们目前自己的实现（这部分由@izuo和我一起实现）：&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-tmp-video2.just4fun.site/%E6%88%91%E7%9A%84%E5%AE%9E%E7%8E%B0.png" /&gt;&lt;/p&gt;
&lt;p&gt;在少儿编程领域，microbit，scratch，Cozmo是我最喜欢的三个项目，所以我们第一步先做了microbit的scratch插件 ，下一步计划是把cozmo也带入scratch中&lt;/p&gt;
&lt;p&gt;相比于js，我更偏好python，所以在具体实现上，我没有选择electron，而是使用python来构建，之后使用pyinstaller打包分发到各个平台 (目前我们完成了mac系统和win10系统的打包，更多的环境还在陆续添加，因为scratch3.0正式发布还远，所以平台兼容这块，倒也不急，但会考虑服务于国内教育环境(比如对windows 32位系统的兼容))&lt;/p&gt;
&lt;!--
我们要做什么: 为scratch构建插件系统，使其能与物理世界连接
--&gt;

&lt;h1 id="why-and-why-not"&gt;why and why not&lt;/h1&gt;
&lt;p&gt;原本想回答一些why的问题，这些问题我和@izuo讨论了许多，但一时半会可能也不好说清，天色已晚，今天写几个对why not的思考，就该睡了。&lt;/p&gt;
&lt;h3 id="why-not-web-bluetooth"&gt;why not Web Bluetooth&lt;/h3&gt;
&lt;p&gt;Web Bluetooth个很棒的方案，我们目前正在这块做一些实验，Web Bluetooth让vm可以直接与硬件交互！&lt;/p&gt;
&lt;p&gt;这个方案另一个好处是对移动端友好，安卓中你甚至只需要浏览器，就能控制硬件，ios中，浏览器目前不支持 Web Bluetooth，你需要包装成app。apple正在成为过去的微软&lt;/p&gt;
&lt;p&gt;不过并非所有人都喜欢蓝牙，也不是所有场景都适合蓝牙，如果我们想把cozmo和microbit接入scratch，我们就做不到（microbit通过一些方式可能能做到，不过会有一些其他问题）&lt;/p&gt;
&lt;p&gt;要把bb8接入，倒是做得到的，bb8支持ble(Web Bluetooth需要ble)&lt;/p&gt;
&lt;p&gt;此外值得一提的是，来自国内的mCookie用到了Web Bluetooth的策略.此外有趣的是他们用了NW.js而不是electron&lt;/p&gt;
&lt;h3 id="why-not-chrome-serial"&gt;why not chrome serial&lt;/h3&gt;
&lt;p&gt;这也是个有趣方案，我们也在关注和实验&lt;/p&gt;
&lt;p&gt;这个方案对chrome的版本要求比Web Bluetooth低，对老机器支持比较好，不过需要安装浏览器插件&lt;/p&gt;
&lt;h3 id="websocket-server"&gt;为何不在websocket server中直接操控硬件&lt;/h3&gt;
&lt;p&gt;除了前头解释过的原因之外，还有一个异步执行的问题，这个问题我在jupyter的架构中讨论过，有兴趣的话可以翻翻那篇文章。jupyter和我们遇到相似的问题，这部分的架构也基本一样&lt;/p&gt;
&lt;h3 id="_6"&gt;采用基于消息的架构，对社区有什么好处&lt;/h3&gt;
&lt;p&gt;最坏情况下(比如大家没有好的协同习惯)，社区依然能够共享大多的经验，因为架构强行使用消息来通信，你可以看到任何组件是如何收发消息的(通过源码或是类似rostopic的工具)。而在最好的情况下，如果大家都共用消息结构，引入一个新的硬件，你通常只需要需要修改最底层驱动的几行代码&lt;/p&gt;
&lt;p&gt;这种架构的灵活性，ROS已经向我们充分显示了。当然设计出色且通用的消息体又是另一个话题了&lt;/p&gt;
&lt;h3 id="_7"&gt;为何要做成一个开放的系统，而不是发布一个针对某个具体产品的软件&lt;/h3&gt;
&lt;p&gt;我不喜欢封闭的系统&lt;/p&gt;
&lt;p&gt;我们处在一个封闭、占地为王、屁股决定脑袋的世界。open source、重用、fork...这些概念在软件行业之外的领域，受到猛烈抨击。如果你在开源社区之外去做这些事，不只是政治不正确，你还可能吃官司。关于这些话题，到处都是屁股决定脑袋的言论&lt;/p&gt;
&lt;p&gt;我们喜欢scratch社区的口号：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Imagine, Program, Share&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!--
# todo
思考对移动端的支持: web bluetooth等

如果你对Scratch3.0已有的插件机制不熟悉，恐怕这篇文章无法教会你用Scratch3.0来驱动硬件

why

在这个架构之下 scratch也仅是一个组件而已

raspberry4pi

vm的延迟

就像很多人会怀念忙碌的高中一样
如果你不知道要干嘛

关注是差异的开始

驯服 建立联系
订阅

一些你可能会遇到的坑

如果你的硬件和cozmo一样复杂

mblock的做法  通讯变量
你需要ros

‌你不能指望一本书能把傅立叶讲解得和天线宝宝的情节一样简单
‌如果作者说它能
‌要么他是个骗子 要么他是个疯子  要么他是波特兰罗素
‌
‌
scratch源码是复杂的 

它复杂到 甚至发了izuo不短的一段时间去理解它
‌要么这个作者是罗素
‌要么
--&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Mon, 26 Mar 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-03-26:scratch3-plugin-2.html</guid><category>scratch</category></item><item><title>为Scratch3.0设计的插件系统(上篇)</title><link>/scratch3-plugin-1.html</link><description>&lt;blockquote&gt;
&lt;p&gt;我们每个人在内心深处都怀有一个梦想: 希望创造出一个鲜活的世界，一个宇宙。处在我们生活的中间、被训练为架构师的那些人，拥有这样的渴望: 在某一天，在某一个地方，因为某种原因，创造出了一个不可思议的、美丽的、摄人心魄的场所，在那里人们可以漫步，可以梦想，历经很多世纪绵延不绝.  --Christopher Alexander&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id="scratch"&gt;Scratch是一个游乐场&lt;/h1&gt;
&lt;p&gt;在我心目中，Scratch便是这样的一个美丽的场所，孩子们和保持着童真的成年孩子们在其中漫步、游戏以及梦想。Ta们在Scratch这个游乐场中创造并分享着乐趣&lt;/p&gt;
&lt;p&gt;&lt;a href="https://scratch.mit.edu/"&gt;Scratch&lt;/a&gt;是一个伟大的项目，无论从它最初的愿景(在&lt;a href="http://web.media.mit.edu/~mres/papers/scratch-proposal.pdf"&gt;A Networked, Media-Rich Programming Environment to Enhance Technological Fluency at After-School Centers in Economically-Disadvantaged Communities&lt;/a&gt;这篇提案中有详述最初的构想和愿景），还是它后来的实现，无论就它的软件设计，还是项目影响力而言，都堪称杰作。&lt;/p&gt;
&lt;p&gt;如果你对Scratch的前世今生感兴趣，可以翻翻我之前的这篇文章:&lt;a href="http://blog.just4fun.site/scratch.html"&gt;Scratch的前世今生&lt;/a&gt;, 当时刚读完《爆裂》，借助《爆裂》一书提供的线索和借助互联网，我沿着理念传承这条线，从雷斯尼克的Scratch追溯到派珀特的Logo语言，之后抵达皮亚杰的认知论（再往前甚至将追溯到洛克的经验论）&lt;/p&gt;
&lt;p&gt;将于今年8月发布的Scratch3.0无疑将延续这个传统，继续做出振奋人心的东西。&lt;/p&gt;
&lt;p&gt;Scratch是个游乐场，而且是一个设施完善的游乐场，你可以在其中发挥天马行空的想象力，创造出属于你的世界。&lt;/p&gt;
&lt;h1 id="scratch_1"&gt;Scratch是个像素世界&lt;/h1&gt;
&lt;p&gt;唯一的遗憾是，这个世界以像素的形式出现。当然你可能觉得这哪是什么遗憾，像素世界比身边这个原子世界广阔多了。去过四维空间的人，回到三维空间，即便漂浮于太空，外面是浩瀚的星空，仍会觉得逼仄得很，一些人的星辰大海只不过是囚禁另一些人的牢笼。这是一种患有幽闭恐惧症的感受。同样，如果你在虚拟世界浪荡久了，回到现实中来，可能也会觉得匮乏，饭居然是要一口一口吃的！我明明都已经完整吃了一口了，这个世界甚至都不提供一个for循环积木块！&lt;/p&gt;
&lt;p&gt;但现在是三月，江南的三月，鸡鸣寺樱花盛开的三月，站在鸡鸣寺下、玄武湖前的樱花树下，无论阴雨还是春风，你都很难不被这个由原子而非像素构成的世界所打动。&lt;/p&gt;
&lt;p&gt;虽然这个原子世界的确可能就是像素构成的...anyway，先抛开你的怀疑论，让我们进入正题。&lt;/p&gt;
&lt;p&gt;我们说了这个多科幻的内容，正题并不是你期待的《三体》，这篇文章准备讨论的是如何为Scratch3.0构建一个通用的插件系统，让Scratch3.0能与来自物理世界的硬件打交道&lt;/p&gt;
&lt;p&gt;我们准备构建一个通道，连接原子和像素世界&lt;/p&gt;
&lt;h1 id="_1"&gt;来自物理世界的硬件&lt;/h1&gt;
&lt;p&gt;物理世界有许多参数，诸如温度、湿度、磁场、速度、光照强度...以及，你喜欢的姑娘身上特有的香味&lt;/p&gt;
&lt;p&gt;这些参数可以被各种各样的传感器所捕获(你身上的绅士风度属于不可知论范畴，不能被物理参数描述)，一旦你能捕捉到现实世界的各种参数，你就能做出许许多多好玩的东西，诸如，通过捕捉楼道的声音，你可以做到: 当楼道里有声响时，把楼道里的灯打开，这样一来你就做出了声控灯。可是你不想白天楼道里也亮着灯，怎么办呢？ 你可以把光照的信息也捕捉了，这样一来你就可以在光线不足且有人经过的时候才开灯,这样一来就节约了电力。注意我说的是光线不足就开灯，而不是晚上，为什么呢，因为我们希望光线昏暗的时候，都能为行人提供照明，而不只是晚上，我们通过获取光线而不是根据昼夜时间来决定是否亮灯。这样系统可以在大白天里黑云压城的时候，也能贴心地为行人亮起灯，这便是所谓的"科技以人为本"&lt;/p&gt;
&lt;p&gt;Scratch是个教育项目，如果它能更多地和现实发生关联，一个孩子在Scratch中创作的作品，能对接到各种硬件，在Ta现实中被使用，这些作品帮助了Ta的父母和邻居解决生活问题，Ta的学习热情将将被噼里啪啦点燃。关于这方面的描述，PC之父Alan Curtis Kay和LOGO语言之父Papert都有过精彩论述&lt;/p&gt;
&lt;p&gt;我们结下来要做的，就是实现这样一种架构，在这个架构之下，各种硬件(小车、四轴飞行器、cozmo、microbit、Circuit Playground Express)都能与Scratch3.0交互，而且这个架构将基于消息，利用pub/sub的机制，降低构件的耦合，提高系统健壮性和可重用性&lt;/p&gt;
&lt;h1 id="scratch30"&gt;为Scratch3.0设计的插件系统&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;Make everything as simple as possible, but not simpler&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="scratch30_1"&gt;Scratch3.0&lt;/h3&gt;
&lt;p&gt;Scratch3.0基于html5构建，能轻松支持多平台运行，十分可期，而且带来了多项有趣的改进。目前的开发版可以在&lt;a href="https://llk.github.io/scratch-gui/"&gt;这儿尝鲜&lt;/a&gt;. 对源码有兴趣的小伙伴，想围观或者参与，都可以&lt;a href="https://github.com/LLK"&gt;戳这里&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;社区里不少公司已经用Scratch3.0作出了许多令人惊叹的东西，Cozmo是其中的佼佼者&lt;/p&gt;
&lt;p&gt;Scratch3.0原计划在今年春季正式发布，春天来了，樱花如期盛开，Scratch3.0却跳票了，推迟到8月份发布&lt;/p&gt;
&lt;p&gt;人面不知何处去，桃花依旧笑春风&lt;/p&gt;
&lt;h3 id="scratch30_2"&gt;Scratch3.0的插件机制&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;自由有时候是一种负担&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我们的目标是为Scratch3.0做一个插件系统，准确地说是做一个连接Scratch3.0与外围硬件的插件系统.&lt;/p&gt;
&lt;p&gt;Scratch3.0已经有它自己的插件机制。Scratch3.0的插件机制比较简单，它允许你写一个自己的插件，这个插件在UI层面表现为自定义的积木块，你在积木块中定义好自己的原语(opcode),之后这个积木块和Scratch中默认的积木块一样，可以被用户拿来拼拼搭搭。用户拼搭的过程中，积木块的组合形式也就是&lt;code&gt;程序&lt;/code&gt;将语义以json的形式传到&lt;a href="https://github.com/LLK/scratch-vm"&gt;scratch-vm&lt;/a&gt;,它们在vm中被解释运行，至于你在页面上看到的小猫的运动和声音，则是scratch-vm中程序的output：output的具体实现是&lt;a href="https://github.com/LLK/scratch-audio"&gt;scratch-audio&lt;/a&gt;和&lt;a href="https://github.com/LLK/scratch-render"&gt;scratch-render&lt;/a&gt;的东西.这些属于实现细节，跟着官方的插件走一遍就行。&lt;/p&gt;
&lt;p&gt;如果你熟悉scratch2和&lt;a href="https://github.com/LLK/scratchx"&gt;scratchx&lt;/a&gt;项目，你会发现，scratch3.0的插件机制和之前相似&lt;/p&gt;
&lt;p&gt;从上边的描述中，我们可以发现，Scratch3.0的插件机制对于你应该如何与外部硬件设备交互，啥都没说。&lt;/p&gt;
&lt;p&gt;在官方的插件机制中，你有极大的自由，因为它无为而治。有时候自由是一种负担，自由意味着你自己得作出选择，并承担所有的风险。&lt;/p&gt;
&lt;h3 id="_2"&gt;官方的尝试&lt;/h3&gt;
&lt;p&gt;说官方对Scratch3.0如何与外部硬件设备交互只字未提，可能会遭到官方的反驳，毕竟他们为乐高的wedo2机器人写了一个Scratch3.0插件（目前源码已经基本完成了，只是官方没有启用这个插件），通过这个插件，我们可以在Scratch3.0中操控wedo2机器人。这个插件的源码向你展示了Scratch3.0是如何与硬件交互的，但这个插件也还是缄默多于言说，目前开发文档几乎保持空白，Scratch官方似乎在有一种向维特根斯坦的恶意模仿&lt;/p&gt;
&lt;p&gt;wedo2的源码很好读，写的也漂亮，虽说乐高赞助了mit media lab一个教授席位，但wedo2的源码并没有获得特殊待遇，而是用了标准的插件机制。如前所述，插件提供了wedo2的编程积木块，这些积木块的语义将传递到scratch-vm中执行，其中最关键的一步是通过socketio将语义传递给硬件。当然上边的说法过于笼统，我跟踪了这个过程，websocket管道的那端并不是直接连着wedo2机器人，而是连着一个本地插件，这个本地插件接着通过蓝牙连接wedo2. 这个本地插件本质上是个代理。&lt;/p&gt;
&lt;p&gt;我之前的的blockly4pi和wedo2的设计几乎一样，这个项目之后我应该会开源出来，之前在jupyter的架构分析的文章中提到过，如果你有兴趣可以翻阅我之前的文章&lt;/p&gt;
&lt;h3 id="_3"&gt;社区的尝试&lt;/h3&gt;
&lt;p&gt;在说我的设计之前，我们来看看社区上已有的方案&lt;/p&gt;
&lt;p&gt;目前把Scratch3.0玩得很溜的，国外有Cozmo，而国内有makeblock和kittenbot&lt;/p&gt;
&lt;p&gt;我去年长途旅行经过深圳时，和makeblock和kittenbot在Maker Faire上碰过面，两个团队都非常优秀&lt;/p&gt;
&lt;h4 id="cozmo"&gt;Cozmo&lt;/h4&gt;
&lt;p&gt;先从Cozmo说起，Cozmo一骑绝尘，从产品、sdk源码到体验都惊艳之极。Cozmo的目前只公开了python SDK源码，从源码中我们可以看出，Cozmo的server里藏有一个ROS（Robot Operating System），这个ROS应该在它的APP里，这也是它为何如此依赖于APP的原因以及APP如此臃肿的原因。而它的Scratch3.0界面与它的ROS通信，我接下来准备提出的插件架构，本质上是我对Cozmo架构的猜想，因为它的源码未开放，我暂时没办法验证，但我们可以断言的是，cozmo的scratch是以消息的方式与硬件交互的（这是ROS系统的核心），这和wedo2很像，实际上在这一类项目目前只有两种架构风格。大分类下，wedo2和cozmo属于一类，下边我们要说的makeblock和kittenbot是另一类&lt;/p&gt;
&lt;p&gt;我最近花了1.5个周末读完《ROS机器人编程实践》才理解了Cozmo的架构设计（至少在逻辑上），这里边的很多问题，并不是Scratch图形化编程的问题，而是ROS的问题，所以至今Cozmo并无对手。毫无疑问，Cozmo对Scratch3.0的应用上也是一骑绝尘的。这让人想起那句称赞约翰·麦卡锡的那句话&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;巨人随手丢下的鹅软石都是巨石&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id="mblock"&gt;mblock&lt;/h4&gt;
&lt;p&gt;接下来我们说说makeblock对Scratch3.0的应用，这里我们只关心mblock操作程小奔（硬件机器人）相关的部分，AI和DL部分有空再说&lt;/p&gt;
&lt;p&gt;插个题外话，mblock中有许多精彩的工作，其中我最喜欢的一个部分是，他们顺利做到让microbit支持多任务(甚至事件)，这个microbit官方目前都还做不到（在python中），实现机制十分精巧，经过逆向分析，我们可以看到具体的代码实现（实际是用正则做预处理），不过即便不通过逆向分析，我们通过观察积木块生成的python代码，也能猜到预编译的机制，关于这块我们之后有空再说&lt;/p&gt;
&lt;p&gt;mblock对硬件的操作是通过将scratch3.0积木generate出python代码来做的，之后将代码灌入他们的硬件机器人（程小奔）中，也就是说在mblock中，Scratch3.0被当作blockly来使用(典型的blcokly app风格)。此外值得一提的是，mblock中有一个叫做&lt;code&gt;通讯变量&lt;/code&gt;的概念，这个概念很有趣，它能把硬件和scratch连通。限于篇幅和我困了，也之后再说&lt;/p&gt;
&lt;p&gt;程小奔使用micropython构建，可能是目前最大的micropython项目之一，关于硬件这块，这里也没空多说，前头废话说了太多，对不起诸位。我们之后找个时间来说说mblock是如何使用esp32板子做出程小奔的，当然很多部分是我的实验加猜测，毕竟源码mblock还没有开放。&lt;/p&gt;
&lt;p&gt;mblock和程小奔在工程上都是漂亮的作品，给工程团队打call！&lt;/p&gt;
&lt;h4 id="kittenbot"&gt;kittenbot&lt;/h4&gt;
&lt;p&gt;小喵家的公众号我一直是关注的，小喵们做了许多geek且有趣的工作。团队人不多，但做出的东西却很赞！此处星星眼&lt;/p&gt;
&lt;p&gt;kittenbot之前是open source，新的版本似乎没开放，不过mblock和kittenbot对开源社区都很友好，之后会开放也未可知。&lt;/p&gt;
&lt;p&gt;kittenblcok中之前对microbit的操作也是generate成python再灌入的，这点和mblock相似。最近我没怎么用kittenblcok，不知道最近是不是有调整，等我有空试完再补充。&lt;/p&gt;
&lt;h3 id="_4"&gt;我的设计&lt;/h3&gt;
&lt;p&gt;写到这里都半夜了，只好把这篇文章拆分为二了，有空再来补上我的自己的插件架构设计&lt;/p&gt;
&lt;p&gt;在这个设计之上，我们已经作出了一个具体的实现(scratch3.0和microbit的互操作)，准备以软件包的形式发布(正在制作)，可见我们是吃自己的狗粮的&lt;/p&gt;
&lt;p&gt;架构层面主要受ROS和jupyter的影响&lt;/p&gt;
&lt;p&gt;我们下篇里见&lt;/p&gt;
&lt;blockquote&gt;&lt;/blockquote&gt;
&lt;!--
如果你对Scratch3.0已有的插件机制不熟悉，恐怕这篇文章无法教会你用Scratch3.0来驱动硬件

why

在这个架构之下 scratch也仅是一个组件而已

raspberry4pi

vm的延迟

就像很多人会怀念忙碌的高中一样
如果你不知道要干嘛

关注是差异的开始

驯服 建立联系
订阅

一些你可能会遇到的坑

如果你的硬件和cozmo一样复杂

mblock的做法  通讯变量
你需要ros

‌你不能指望一本书能把傅立叶讲解得和天线宝宝的情节一样简单
‌如果作者说它能
‌要么他是个骗子 要么他是个疯子  要么他是波特兰罗素
‌
‌
scratch源码是复杂的 

它复杂到 甚至发了izuo不短的一段时间去理解它
‌要么这个作者是罗素
‌要么
--&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Tue, 20 Mar 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-03-20:scratch3-plugin-1.html</guid><category>scratch</category></item><item><title>blockly开发之使用python驱动浏览器中的turtle(2)</title><link>/blockly-dev-python-browser-turtle.html</link><description>&lt;p&gt;这篇文章我们将使用blockly来做一个完整的项目。&lt;/p&gt;
&lt;p&gt;这篇教程涵盖以下内容：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;从拼搭好的积木块中，生成(generate)python代码&lt;/li&gt;
&lt;li&gt;自定义自己的积木块, 并生成对应python代码&lt;/li&gt;
&lt;li&gt;在浏览器中运行python代码&lt;/li&gt;
&lt;li&gt;整合以上部分，使用积木块驱动turtle&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="_1"&gt;效果展示&lt;/h1&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-tmp-video2.just4fun.site/blockly_turtle.gif" /&gt;&lt;/p&gt;
&lt;p&gt;生成的代码为:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/blockly7f8f7d33.png" /&gt;&lt;/p&gt;
&lt;h1 id="turtle"&gt;关于turtle&lt;/h1&gt;
&lt;p&gt;turtle是编程教学中的一个经典概念(另一个经典概念是&lt;code&gt;猫&lt;/code&gt;(来自Scratch))，turtle最初由Papert在他的&lt;a href="https://zh.wikipedia.org/zh-hans/Logo%E8%AF%AD%E8%A8%80"&gt;Logo语言&lt;/a&gt;引入，Logo内置一套海龟绘图（Turtle Graphics）系统，通过向海龟发送命令，用户可以直观地学习程序的运行过程，关于这块的历史沿革，可以参考我之前的文章&lt;a href="http://blog.just4fun.site/scratch.html"&gt;Scratch的前世今生&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="blockly-generate-python"&gt;利用blockly generate python代码&lt;/h1&gt;
&lt;p&gt;如何使用blockly generate代码，我们已经在&lt;a href="http://blog.just4fun.site/blockly-dev-run-code.html"&gt;blockly开发之生成并运行js代码(1)&lt;/a&gt;做了手把手教学。&lt;/p&gt;
&lt;p&gt;在&lt;a href="http://blog.just4fun.site/blockly-dev-run-code.html"&gt;blockly开发之生成并运行js代码(1)&lt;/a&gt;中，我们将积木块generate成js代码。blockly默认支持将积木块generate成以下6种代码:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;JavaScript&lt;/li&gt;
&lt;li&gt;Python&lt;/li&gt;
&lt;li&gt;PHP&lt;/li&gt;
&lt;li&gt;Lua&lt;/li&gt;
&lt;li&gt;Dart&lt;/li&gt;
&lt;li&gt;XML&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;你可以在&lt;a href="https://blockly-demo.appspot.com/static/demos/code/index.html"&gt;Code Editor&lt;/a&gt;中体验&lt;/p&gt;
&lt;p&gt;本章的目标是generate出python代码，过程十分简洁，你只需要做2件事：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;引入&lt;code&gt;python_compressed.js&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;generate出python代码:&lt;code&gt;var code = Blockly.Python.workspaceToCode(demoWorkspace);&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;完整的代码参考:&lt;a href="https://github.com/wwj718/blockly_dev/blob/master/src/blockly_3_1_generate_python/index.html"&gt;blockly_3_1_generate_python&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;你要做的只有这些&lt;/p&gt;
&lt;h1 id="_2"&gt;自定义自己的积木块&lt;/h1&gt;
&lt;p&gt;blockly只提供了基础的积木块（基本的语言结构），你常常需要定义自己的积木块。&lt;/p&gt;
&lt;p&gt;自定义积木块时你实际在做两件事:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;定义积木的外观&lt;/li&gt;
&lt;li&gt;定义出当前积木对应的代码&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;判断一袋狗粮好不好吃的一种方法是看制造者自己吃不吃，我们知道Python社区用Python实现了Python(pypi)。blockly社区中自定义积木外观的工具也是用blockly实现的: &lt;a href="https://blockly-demo.appspot.com/static/demos/blockfactory/index.html"&gt;Blockly Developer Tools&lt;/a&gt;，文档参考:&lt;a href="https://developers.google.com/blockly/guides/create-custom-blocks/blockly-developer-tools"&gt;Blockly Developer Tools docs&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/blockly2c0249f1.png" /&gt;&lt;/p&gt;
&lt;p&gt;通过拖拽积木，你就能轻松定义出积木的外观。&lt;/p&gt;
&lt;p&gt;截图中有两处值得注意：&lt;/p&gt;
&lt;p&gt;&lt;a href="http://wwj-fig-bed.just4fun.site/blockly2af54b72.png"&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;红色框中是你自定义积木外观的代码描述，有两种风格你可以选择（js/json），使用json风格你会得到一个好处:可以随时将json贴回Blockly Developer Tools，从而得到对应的积木。在你生成自定义积木的时候，建议取得分享链接，以便于日后对积木做调整。&lt;/p&gt;
&lt;p&gt;而绿色框中则是该积木generate出的代码，你可以选择目标语言,在此我选择Python&lt;/p&gt;
&lt;p&gt;在&lt;a href="https://github.com/wwj718/blockly_dev/blob/master/src/blockly_3_2_custom_block_generate_python/index.html"&gt;blockly_3_2_custom_block_generate_python&lt;/a&gt;中展示了一个完整的自定义积木，如下:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;//外观 使用js风格的描述&lt;/span&gt;
&lt;span class="nx"&gt;Blockly&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;Blocks&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;draw_stamp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;init&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setColour&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;160&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;appendDummyInput&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;appendField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;stamp&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setPreviousStatement&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setNextStatement&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;},&lt;/span&gt;

&lt;span class="c1"&gt;//generate Python&lt;/span&gt;
&lt;span class="nx"&gt;Blockly&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;Python&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;draw_stamp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;a&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;Blockly&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;Python&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;definitions_&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;import_turtle&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;import turtle\nturtle=turtle.Turtle()&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;turtle.stamp()\n&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;关于自定义积木的话题很大，我们找机会专门讨论，在此就不展开&lt;/p&gt;
&lt;h1 id="python"&gt;浏览器中运行python&lt;/h1&gt;
&lt;p&gt;目前有好几个项目允许你在浏览器中运行python，其中最流行的解决方案是:&lt;a href="https://github.com/skulpt/skulpt"&gt;skulpt&lt;/a&gt;，也许也是目前最成熟的解决方案,好些大型项目都在用它,诸如:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.tynker.com/"&gt;tynker&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.coursera.org/learn/interactive-python-1"&gt;coursera&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://trinket.io/"&gt;trinket&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;浏览器无处不在，如果能在浏览器中直接运行python，不仅免去了新用户安装环境的麻烦，教学者还可以利用js的动态性，灵活地设计课程并与用户交互，很方便对用户做引导。skulpt的主要使用场景是教学，以上便是原因。&lt;/p&gt;
&lt;p&gt;skulpt使用js实现了python解释器(python2.x)，让python能运行在所有主流浏览器中，如此一来，你就可以轻松在pc/手机/ipad的浏览器中学习python&lt;/p&gt;
&lt;p&gt;skulpt是一个强大而灵活的项目，自带很多电池，且有很好的可扩展性(自定义模块)，如果你有兴趣，可以参考:&lt;a href="http://www.skulpt.org/"&gt;skulpt官网&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;turtle是skulpt自带的模块，你可以在&lt;a href="http://interactivepython.org/runestone/static/thinkcspy/PythonTurtle/OurFirstTurtleProgram.html"&gt;Our First Turtle Program&lt;/a&gt;体验它&lt;/p&gt;
&lt;p&gt;在浏览器中使用python驱动turtle，官方给出了示例源码:&lt;a href="https://gist.githubusercontent.com/bnmnetp/4650616/raw/cea29122971db097c9ccb9fdfccd3c0c9bf81edf/simpleskulpt.html"&gt;simpleskulpt&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="_3"&gt;整合&lt;/h1&gt;
&lt;p&gt;经过上边的一圈探索，来看看我们现在能够做到哪些事:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;从拼搭好的积木块中，生成(generate)python代码&lt;/li&gt;
&lt;li&gt;自定义自己的积木块, 并生成对应python代码&lt;/li&gt;
&lt;li&gt;在浏览器中运行python代码&lt;/li&gt;
&lt;li&gt;使用python控制浏览器中turtle&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;接下来，整合以上部分，使用blockly积木块来驱动turtle，最小原型参考:&lt;a href="https://github.com/wwj718/blockly_dev/tree/master/src/blockly_4_run_python_in_browser_simple"&gt;blockly_4_run_python_in_browser_simple&lt;/a&gt; &lt;/p&gt;
&lt;p&gt;上边的最小原型修改自&lt;a href="https://gist.githubusercontent.com/bnmnetp/4650616/raw/cea29122971db097c9ccb9fdfccd3c0c9bf81edf/simpleskulpt.html"&gt;simpleskulpt&lt;/a&gt;。修改之处仅有: 把&lt;code&gt;var prog = document.getElementById("yourcode").value;&lt;/code&gt;改为blockly生成的代码:&lt;code&gt;var prog = Blockly.Python.workspaceToCode(demoWorkspace);&lt;/code&gt; , 如此干净整洁!&lt;/p&gt;
&lt;p&gt;这个例子中，我们可以看出blockly的灵活性，如我们在&lt;a href="http://blog.just4fun.site/blockly-overview.html"&gt;blockly入门与介绍&lt;/a&gt;中所言，blockly是个编辑器，只负责生成代码，至于代码之后用与干吗，它通通不关心。如此一来，就不产生耦合了。&lt;/p&gt;
&lt;p&gt;要了让blockly能做出丰富的东西，我们需要把turtle的所有操作原语全都暴露为积木块，这个工作我偷了个懒，直接抠了&lt;a href="https://hourofpython.trinket.io/from-blocks-to-code-with-trinket#/blocks/dragging-and-dropping"&gt;trinket&lt;/a&gt;的源码。完整的代码参考:&lt;a href="https://github.com/wwj718/blockly_dev/tree/master/src/blockly_5_run_python_in_browser_turtle_finish"&gt;blockly_5_run_python_in_browser_turtle_finish&lt;/a&gt;。积木部分参考:&lt;a href="https://github.com/wwj718/blockly_dev/blob/master/src/blockly_5_run_python_in_browser_turtle_finish/my_blocks.js"&gt;my_blocks.js&lt;/a&gt;（js代码中变量被压缩过，可读性不大好）&lt;/p&gt;
&lt;p&gt;如此一来我们就完成了整个项目. &lt;/p&gt;
&lt;p&gt;这个项目很有代表性，使用blockly制作一个application的步骤，我们在以上过程中都经历了&lt;/p&gt;
&lt;p&gt;这些步骤官方描述为:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;集成blockly编辑器&lt;/li&gt;
&lt;li&gt;定义你的app里的功能块（block）&lt;/li&gt;
&lt;li&gt;构建app的其余部分，blockly仅充当代码生成器，你需要决定这些用户生成的代码用于做什么，这也是你的app的核心功能所在&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;关于最后一点，blockly官方说的很笼统，针对少儿编程这一领域，第三点往往可以拆解为几类典型问题。这方面我们之后有空再谈&lt;/p&gt;
&lt;!--
# 总结

phaser/snap

Blockly/Scratch 在少儿编程中的应用: 积累问题
--&gt;

&lt;h1 id="_4"&gt;相关源码&lt;/h1&gt;
&lt;p&gt;以下源码展示了渐进的学习过程:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/wwj718/blockly_dev/tree/master/src/blockly_3_1_generate_python"&gt;blockly_3_1_generate_python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/wwj718/blockly_dev/tree/master/src/blockly_3_2_custom_block_generate_python"&gt;blockly_3_2_custom_block_generate_python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/wwj718/blockly_dev/tree/master/src/blockly_4_run_python_in_browser_simple"&gt;blockly_4_run_python_in_browser_simple&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/wwj718/blockly_dev/tree/master/src/blockly_5_run_python_in_browser_turtle_finish"&gt;blockly_5_run_python_in_browser_turtle_finish&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Sun, 25 Feb 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-02-25:blockly-dev-python-browser-turtle.html</guid><category>blockly</category></item><item><title>blockly开发之生成并运行js代码(1)</title><link>/blockly-dev-run-code.html</link><description>&lt;p&gt;如blockly文档的&lt;a href="https://developers.google.com/blockly/guides/configure/web/code-generators"&gt;Code Generators&lt;/a&gt;章节里所说，用户在blockly编辑器中写好了程序之后(积木组合)，程序往往需要被转化为某一门编程语言（JavaScript, Python, PHP, Lua, Dart等），以便于执行它&lt;/p&gt;
&lt;p&gt;比如我们在&lt;a href="http://blog.just4fun.site/blockly-dev-hello-world.html"&gt;blockly开发之hello world(0)&lt;/a&gt;中写的这个程序&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/blockly4b406de9.png" /&gt;&lt;/p&gt;
&lt;p&gt;我们想运行它，以便检验你的数学能力&lt;/p&gt;
&lt;h1 id="_1"&gt;运行代码&lt;/h1&gt;
&lt;p&gt;分几个步骤&lt;/p&gt;
&lt;h2 id="generate"&gt;generate (从积木中生成代码)&lt;/h2&gt;
&lt;h3 id="_2"&gt;原始版本&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;meta&lt;/span&gt; &lt;span class="na"&gt;charset&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;utf-8&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;title&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Blockly Demo: Fixed Blockly&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;title&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt; &lt;span class="na"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;../../blockly_compressed.js&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt; &lt;span class="na"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;../../blocks_compressed.js&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt; &lt;span class="na"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;../../msg/js/en.js&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;style&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;body&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="k"&gt;background-color&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mh"&gt;#fff&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="k"&gt;font-family&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;sans-serif&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="nt"&gt;h1&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="k"&gt;font-weight&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;normal&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="k"&gt;font-size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;140&lt;/span&gt;&lt;span class="kt"&gt;%&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;style&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;https://developers.google.com/blockly/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Blockly&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;../index.html&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Demos&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt; Fixed Blockly&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;This is a simple demo of injecting Blockly into a fixed-sized &amp;#39;div&amp;#39; element.&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;span class="ni"&gt;&amp;amp;rarr;&lt;/span&gt; More info on &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;https://developers.google.com/blockly/guides/configure-blockly/web/fixed-size&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;injecting fixed-sized Blockly&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;span class="ni"&gt;&amp;amp;hellip;&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt; &lt;span class="na"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;blocklyDiv&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;style&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;height: 480px; width: 600px;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;xml&lt;/span&gt; &lt;span class="na"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;toolbox&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;style&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;display: none&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;controls_if&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;logic_compare&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;controls_repeat_ext&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;math_number&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;math_arithmetic&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;text&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;text_print&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;xml&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;demoWorkspace&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;Blockly&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;inject&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;blocklyDiv&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nx"&gt;media&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;../../media/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
          &lt;span class="nx"&gt;toolbox&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;toolbox&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)}&lt;/span&gt;
        &lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="_3"&gt;增加的部分&lt;/h3&gt;
&lt;p&gt;参考: &lt;code&gt;blockly/demos/generator/index.html&lt;/code&gt;&lt;/p&gt;
&lt;h4 id="_4"&gt;引入依赖&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;&amp;lt;script src="../../javascript_compressed.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;这个js文件的功能是用于生成&lt;code&gt;&amp;lt;script src="../../blocks_compressed.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;/code&gt;预定义的积木对应的js代码&lt;/p&gt;
&lt;p&gt;此外通过引入其他语言模块，我们还可以将&lt;code&gt;blocks_compressed.js&lt;/code&gt;预知的积木块生成python、Python, PHP, Lua, Dart等待&lt;/p&gt;
&lt;p&gt;&lt;code&gt;javascript_compressed.js&lt;/code&gt;需要在&lt;code&gt;blockly_compressed.js&lt;/code&gt;之后被引用&lt;/p&gt;
&lt;h4 id="_5"&gt;生成代码&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;showCode&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="c1"&gt;// Generate JavaScript code and display it.&lt;/span&gt;
      &lt;span class="nx"&gt;Blockly&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;JavaScript&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;INFINITE_LOOP_TRAP&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;code&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;Blockly&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;JavaScript&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;workspaceToCode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;demoWorkspace&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;code&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/blockly44c459cd.png" /&gt;&lt;/p&gt;
&lt;h4 id="_6"&gt;运行代码&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;runCode&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="c1"&gt;// Generate JavaScript code and run it.&lt;/span&gt;
      &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;LoopTrap&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="nx"&gt;Blockly&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;JavaScript&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;INFINITE_LOOP_TRAP&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;
          &lt;span class="s1"&gt;&amp;#39;if (--window.LoopTrap == 0) throw &amp;quot;Infinite loop.&amp;quot;;\n&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;code&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;Blockly&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;JavaScript&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;workspaceToCode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;demoWorkspace&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="nx"&gt;Blockly&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;JavaScript&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;INFINITE_LOOP_TRAP&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nb"&gt;eval&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;code&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;alert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4 id="_7"&gt;添加按钮&lt;/h4&gt;
&lt;p&gt;添加两个按钮把事件关联起来&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;button&lt;/span&gt; &lt;span class="na"&gt;onclick&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;showCode()&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Show JavaScript&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;button&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;button&lt;/span&gt; &lt;span class="na"&gt;onclick&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;runCode()&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Run JavaScript&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;button&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="_8"&gt;完整版本&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;meta&lt;/span&gt; &lt;span class="na"&gt;charset&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;utf-8&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;title&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Blockly Demo: Fixed Blockly&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;title&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt; &lt;span class="na"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;../../blockly_compressed.js&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt; &lt;span class="na"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;../../blocks_compressed.js&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt; &lt;span class="na"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;../../javascript_compressed.js&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt; &lt;span class="na"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;../../msg/js/en.js&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;style&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;body&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="k"&gt;background-color&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mh"&gt;#fff&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="k"&gt;font-family&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;sans-serif&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="nt"&gt;h1&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="k"&gt;font-weight&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;normal&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="k"&gt;font-size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;140&lt;/span&gt;&lt;span class="kt"&gt;%&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;style&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;https://developers.google.com/blockly/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Blockly&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;../index.html&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Demos&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt; Fixed Blockly&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;This is a simple demo of injecting Blockly into a fixed-sized &amp;#39;div&amp;#39; element.&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;span class="ni"&gt;&amp;amp;rarr;&lt;/span&gt; More info on &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;https://developers.google.com/blockly/guides/configure-blockly/web/fixed-size&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;injecting fixed-sized Blockly&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;span class="ni"&gt;&amp;amp;hellip;&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;button&lt;/span&gt; &lt;span class="na"&gt;onclick&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;showCode()&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Show JavaScript&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;button&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;button&lt;/span&gt; &lt;span class="na"&gt;onclick&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;runCode()&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Run JavaScript&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;button&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt; &lt;span class="na"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;blocklyDiv&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;style&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;height: 480px; width: 600px;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;xml&lt;/span&gt; &lt;span class="na"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;toolbox&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;style&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;display: none&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;controls_if&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;logic_compare&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;controls_repeat_ext&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;math_number&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;math_arithmetic&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;text&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;text_print&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;xml&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;demoWorkspace&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;Blockly&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;inject&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;blocklyDiv&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nx"&gt;media&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;../../media/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
          &lt;span class="nx"&gt;toolbox&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;toolbox&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)}&lt;/span&gt;
        &lt;span class="p"&gt;);&lt;/span&gt;



    &lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;showCode&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="c1"&gt;// Generate JavaScript code and display it.&lt;/span&gt;
      &lt;span class="nx"&gt;Blockly&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;JavaScript&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;INFINITE_LOOP_TRAP&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;code&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;Blockly&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;JavaScript&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;workspaceToCode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;demoWorkspace&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;code&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;runCode&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="c1"&gt;// Generate JavaScript code and run it.&lt;/span&gt;
      &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;LoopTrap&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="nx"&gt;Blockly&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;JavaScript&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;INFINITE_LOOP_TRAP&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;
          &lt;span class="s1"&gt;&amp;#39;if (--window.LoopTrap == 0) throw &amp;quot;Infinite loop.&amp;quot;;\n&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;code&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;Blockly&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;JavaScript&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;workspaceToCode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;demoWorkspace&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="nx"&gt;Blockly&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;JavaScript&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;INFINITE_LOOP_TRAP&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nb"&gt;eval&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;code&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;alert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="run"&gt;run&lt;/h2&gt;
&lt;p&gt;以js运行&lt;/p&gt;
&lt;p&gt;如果你回答对了:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/blockly2d377f4e.png" /&gt;&lt;/p&gt;
&lt;p&gt;如果你答错了: &lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/blockly3e120875.png" /&gt;&lt;/p&gt;
&lt;h1 id="_9"&gt;延伸&lt;/h1&gt;
&lt;p&gt;我最近在写一份blockly的入门和进阶教程，这个官方教程也被我纳入其中，在教程的第二节&lt;a href="https://github.com/wwj718/blockly_dev/tree/master/src/blockly_2_generate_and_run_js"&gt;blockly_2_generate_and_run_js&lt;/a&gt;，目前教程以源码的形式出现:&lt;a href="https://github.com/wwj718/blockly_dev"&gt;wwj718/blockly_dev&lt;/a&gt;，还没写成博客。大家能阅读js的话，可以自行阅读。或者等我有空补上文章。&lt;/p&gt;
&lt;h1 id="_10"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://developers.google.com/blockly/guides/configure/web/code-generators"&gt;Code Generators&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Sun, 21 Jan 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-01-21:blockly-dev-run-code.html</guid><category>blockly</category></item><item><title>blockly开发之hello world(0)</title><link>/blockly-dev-hello-world.html</link><description>&lt;!--公司内部分享: file:///Users/wwj/workplace/code_org/presentation-blockly/blockly.slides.html#/--&gt;

&lt;p&gt;之前在&lt;a href="http://blog.just4fun.site/blockly-overview.html"&gt;blockly入门与介绍&lt;/a&gt;中，对blockly做了一番介绍，讨论了在技术视角之下，blockly是什么、可以做哪些有趣的事&lt;/p&gt;
&lt;p&gt;在这篇文章里，我们将以一个开发者的视角，开始blockly之旅&lt;/p&gt;
&lt;h1 id="_1"&gt;开始之前&lt;/h1&gt;
&lt;p&gt;关于blockly是什么，上边的文章里提到过，在此重申一下（敲黑板）: blockly是一个编辑器&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The web-based visual programming editor&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;blockly作为编辑器，它的输入为用户对积木的拖曳操作（用户拖曳积木作为一种输入，可以类比为用户在普通编辑器的键盘输入），输出为积木的组合方式(可转化为对应代码)。使用blockly可以快速打造一个特定领域的可视化 块编程 编辑器&lt;/p&gt;
&lt;p&gt;至于积木（block）如何生成代码，代码用于什么用途，blockly则通通不关心，由用户自己掌控。&lt;/p&gt;
&lt;h1 id="quickstart"&gt;quickstart&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git clone https://github.com/google/blockly --depth=1
cd blockly/demos
# open index.html
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;打开&lt;code&gt;index.html&lt;/code&gt;之后，将看到&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/blockly3e33e71a.png" /&gt;&lt;/p&gt;
&lt;p&gt;这儿给出了一些很棒的案例，供开发者入门&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Fixed Blockly&lt;/code&gt;是最简单的例子，可以视为blockly的hello world (把blockly编辑器注入到html中的div标签中:&lt;code&gt;id="blocklyDiv"&lt;/code&gt;)&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/blockly3ff212dd.png" /&gt;&lt;/p&gt;
&lt;p&gt;我们用这个编辑器来写一个简单的程序: &lt;code&gt;如果5+6等于11就输出"恭喜你, 蒙对啦"，否则输出"小学数学是语文老师教的吗"&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/blockly4b406de9.png" /&gt;&lt;/p&gt;
&lt;p&gt;目前这段程序还不能运行，在之后的章节里，之后我们会让它run起来&lt;/p&gt;
&lt;p&gt;查看源码也只短短的一屏:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;meta&lt;/span&gt; &lt;span class="na"&gt;charset&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;utf-8&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;title&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Blockly Demo: Fixed Blockly&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;title&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt; &lt;span class="na"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;../../blockly_compressed.js&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt; &lt;span class="na"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;../../blocks_compressed.js&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt; &lt;span class="na"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;../../msg/js/en.js&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;style&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;body&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="k"&gt;background-color&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mh"&gt;#fff&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="k"&gt;font-family&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;sans-serif&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="nt"&gt;h1&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="k"&gt;font-weight&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;normal&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="k"&gt;font-size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;140&lt;/span&gt;&lt;span class="kt"&gt;%&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;style&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;https://developers.google.com/blockly/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Blockly&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;../index.html&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Demos&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt; Fixed Blockly&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;This is a simple demo of injecting Blockly into a fixed-sized &amp;#39;div&amp;#39; element.&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;span class="ni"&gt;&amp;amp;rarr;&lt;/span&gt; More info on &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;https://developers.google.com/blockly/guides/configure-blockly/web/fixed-size&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;injecting fixed-sized Blockly&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;span class="ni"&gt;&amp;amp;hellip;&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt; &lt;span class="na"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;blocklyDiv&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;style&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;height: 480px; width: 600px;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;xml&lt;/span&gt; &lt;span class="na"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;toolbox&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;style&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;display: none&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;controls_if&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;logic_compare&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;controls_repeat_ext&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;math_number&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;math_arithmetic&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;text&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;text_print&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;block&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;xml&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;demoWorkspace&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;Blockly&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;inject&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;blocklyDiv&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nx"&gt;media&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;../../media/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
          &lt;span class="nx"&gt;toolbox&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;toolbox&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)}&lt;/span&gt;
        &lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这些代码里，真正有用的只有一半，分以下几块说明:&lt;/p&gt;
&lt;h3 id="_2"&gt;依赖文件&lt;/h3&gt;
&lt;p&gt;head中只有这几个依赖&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  &lt;span class="nt"&gt;&amp;lt;script&lt;/span&gt; &lt;span class="na"&gt;src=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;../../blockly_compressed.js&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;script&lt;/span&gt; &lt;span class="na"&gt;src=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;../../blocks_compressed.js&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;script&lt;/span&gt; &lt;span class="na"&gt;src=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;../../msg/js/en.js&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;分别说明:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;script src="../../blockly_compressed.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;/code&gt; 是Blockly内核文件。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;script src="../../blocks_compressed.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;/code&gt; 是基础积木集(blocks_compressed中定义了一些基础积木: 类似print、if、list等，我们可以在自己的js脚本中自定义更多的积木)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;script src="../../msg/js/en.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;/code&gt;是英语语言包。目前40多门语言&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;js脚本名称中的&lt;code&gt;compressed&lt;/code&gt;表示它们都被压缩过，可读性差。如果你想看积木积木是怎么定义的，可以使用chrome开发者面板的pretty print功能查看源码&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/blockly61f553fb.png" /&gt;&lt;/p&gt;
&lt;h3 id="toolbox"&gt;积木箱(toolbox)&lt;/h3&gt;
&lt;p&gt;在积木面板中引入我们需要的积木&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  &lt;span class="nt"&gt;&amp;lt;xml&lt;/span&gt; &lt;span class="na"&gt;id=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;toolbox&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;style=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;display: none&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;block&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;controls_if&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&amp;lt;/block&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;block&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;logic_compare&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&amp;lt;/block&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;block&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;controls_repeat_ext&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&amp;lt;/block&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;block&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;math_number&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&amp;lt;/block&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;block&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;math_arithmetic&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&amp;lt;/block&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;block&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;text&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&amp;lt;/block&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;block&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;text_print&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&amp;lt;/block&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;/xml&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这些积木都预定义在&lt;code&gt;&amp;lt;script src="../../blocks_compressed.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;至于如何自定一自己的积木，我们也放到之后的章节中说明. 诚信写作:)，说好写hello world，就绝不不引入太多概念&lt;/p&gt;
&lt;h3 id="_3"&gt;往页面注入编辑器&lt;/h3&gt;
&lt;p&gt;页面中准备好注入点: &lt;code&gt;&amp;lt;div id="blocklyDiv" style="height: 480px; width: 600px;"&amp;gt;&amp;lt;/div&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;之后将编辑器注入页面即可&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;demoWorkspace&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;Blockly&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;inject&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;blocklyDiv&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nx"&gt;media&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;../../media/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
          &lt;span class="nx"&gt;toolbox&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;toolbox&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)}&lt;/span&gt;
        &lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这段js代码的语意是：往blocklyDiv中注入Blockly编辑器，积木箱的id为toolbox，media文件目录为&lt;code&gt;../../media/&lt;/code&gt;（包括一些图标文件和声音文件）&lt;/p&gt;
&lt;!--

# 定一个小目标



# 进阶

# 添砖加瓦
Python表达

js运行

跟踪过程



# 探索更多
下载`https://github.com/google/closure-library` zip文件，与blockly目录同级(参考[blockly: Closure Library](https://developers.google.com/blockly/guides/modify/web/closure),不要使用`ln -s`)


wzxhzdk:5


![](http://wwj-fig-bed.just4fun.site/blockly078869e4.png)

--&gt;

&lt;h1 id="_4"&gt;总结&lt;/h1&gt;
&lt;p&gt;在这篇文章我们看到了一个blockly的最小案例。&lt;/p&gt;
&lt;p&gt;在下一篇系列文章中，我们准备让上边写的那么程序run起来，使用这个程序来看看你的小学数学是不是语文老师教的&lt;/p&gt;
&lt;!-- 下篇文章中我们将定义一个自己的积木块，并生成python代码 --&gt;

&lt;!-- 选择是否，生成python代码 实际意义 import time;time.sleep(5) --&gt;

&lt;h1 id="_5"&gt;延伸&lt;/h1&gt;
&lt;p&gt;我最近在写一份blockly的入门和进阶教程，这个官方例子都被我纳入教程中，作为blockly hello world:&lt;a href="https://github.com/wwj718/blockly_dev/blob/master/src/blockly_1_hello_world/index.html"&gt;blockly_1_hello_world&lt;/a&gt;，目前教程以源码的形式出现:&lt;a href="https://github.com/wwj718/blockly_dev"&gt;wwj718/blockly_dev&lt;/a&gt;，还没写成博客。大家能阅读js的话，可以自行阅读。或者等我有空补上文章&lt;/p&gt;
&lt;h1 id="_6"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/google/blockly"&gt;github blockly&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://developers.google.com/blockly/guides/overview"&gt;Google for Education : Blockly&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="https://developers.google.com/blockly/guides/configure/web/fixed-size"&gt;Fixed-sized Workspace&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://developers.google.com/blockly/guides/configure/web/toolbox"&gt;Toolbox&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://groups.google.com/forum/#!forum/blockly"&gt;blockly 开发者论坛&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Wed, 03 Jan 2018 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2018-01-03:blockly-dev-hello-world.html</guid><category>blockly</category></item><item><title>micro:bit使用笔记</title><link>/microbit-notes.html</link><description>&lt;p&gt;折腾micro:bit过程中记录的笔记。涉及资源、工具、文档等。&lt;/p&gt;
&lt;p&gt;如果你想获取更多micro:bit相关资源，可以到&lt;a href="https://github.com/wwj718/awesome-microbit-zh"&gt;awesome-microbit-zh&lt;/a&gt;里淘金&lt;/p&gt;
&lt;h1 id="microbit"&gt;micro:bit概述&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;micro:bit是一个小型的可编程计算机，旨在使学习与教学变得轻松有趣&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;micro:bit是一款由BBC（英国广播电视公司）推出的为青少年编程教育设计的微型电脑开发板(43 mm × 52 mm), 集成了ARM Cortex-M0处理器、低功耗蓝牙，加速度计，磁力计，三个按钮，5 x 5 LED点阵以及GPIO。&lt;/p&gt;
&lt;p&gt;使用micro:bit可以快速地把你脑子中好玩的想法付诸实践，做出酷炫的小发明。&lt;/p&gt;
&lt;p&gt;microbit官网有许多统计数据表明这个板子取得的教育成就和受欢迎程度:&lt;a href="http://microbit.org/teach/"&gt;Research Findings&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="_1"&gt;技术参数&lt;/h3&gt;
&lt;p&gt;&lt;img alt="" src="http://tech.microbit.org/docs/hardware/assets/microbit-overview.png" /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;5x5 LED点阵&lt;/li&gt;
&lt;li&gt;3个按钮（2个用于用户操作，1个用于复位）&lt;/li&gt;
&lt;li&gt;23个GPIO引脚&lt;/li&gt;
&lt;li&gt;Nordic nRF51822 - 16 MHz 32位ARM Cortex-M0 微控制器，256 KB 闪存，16 KB RAM，2.4 GHz 蓝牙低功耗无线网络。ARM内核可以在16 MHz或32.768 kHz之间切换. 实际运行代码的地方&lt;/li&gt;
&lt;li&gt;NXP/Freescale KL26Z - 接口芯片／接口MCU. 48MHz 的ARM Cortex-M0+ 内核微控制器，其中有全速USB 2.0 OTG控制器，用作USB和Nordic nRF51822控制器之间的通信接口&lt;/li&gt;
&lt;li&gt;NXP/Freescale MMA8652 - 3轴加速度传感器(I²C总线)&lt;/li&gt;
&lt;li&gt;NXP/Freescale MAG3110 - 3轴磁力仪传感器I²C总线（用作指南针和金属探测器）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;microbit有两个两个MCU(nRF51822/KL26Z)，可能一开始会让人有点疑惑，它们的关系如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;     PC
      ^                                                    +----------------------------+
      |        +---------------------+                     |       TARGET MCU           |
      |        |   INTERFACE MCU     |                     | +------------------------+ |
      |        |                     |                     | |      Application       | |
      |        | +-----------------+ |     SWD             | +------------------------+ |
      |  USB   | |                 | +---------------------+ | micro:bit runtime DAL  | |
      +--------+ |    DAPLink      | &amp;lt;----------+          | +------------------------+ |
        * Mass | +-----------------+ |     UART |          | |          | |           | |
        Storage| +-----------------+ |          |          | |   mbed   | | SoftDevice| |
               | |   Bootloader    | |          +------------&amp;gt;          | |           | |
        * UART | +-----------------+ |                     | +----------+ +-----------+ |
               +---------------------+                     +----------------------------+
        * CMSIS-DAP
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;更多细节参考:&lt;a href="http://tech.microbit.org/software/daplink-interface/"&gt;DAPlink and the USB interface&lt;/a&gt;&lt;/p&gt;
&lt;!--
### 历史
micro:bit旨在鼓励孩子开始编程和构建新事物，而不是成为软件/媒体消费者.它可以与树莓派协同工作。
--&gt;

&lt;h3 id="_2"&gt;开放性&lt;/h3&gt;
&lt;h4 id="_3"&gt;硬件开源&lt;/h4&gt;
&lt;p&gt;关于硬件部分，两部分关键信息可以一窥Microbit 的内部设计:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://tech.microbit.org/hardware/schematic/"&gt;线路图(schematics)&lt;/a&gt;, 可以看到主要零件的链接方式及设计.&lt;/li&gt;
&lt;li&gt;&lt;a href="http://tech.microbit.org/hardware/reference-design/"&gt;reference design&lt;/a&gt;, 这部分的数据可以帮助进一步了解Microbit 的设计及变更&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;关于硬件部分更多的描述参考:&lt;a href="http://tech.microbit.org/hardware/"&gt;Hardware Description&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;兰卡斯特大学（Lancaster University）构建了完整的microbit的硬件抽象（C/C++），包括一个事件调度器和消息总线，这对个人用户和更高级的语言都是有用的（比如Python），这儿有完整的&lt;a href="https://lancaster-university.github.io/microbit-docs/ubit/"&gt;API文档&lt;/a&gt;和&lt;a href="http://lancaster-university.github.io/microbit-docs/online-toolchains/"&gt;入门指南&lt;/a&gt;&lt;/p&gt;
&lt;h4 id="_4"&gt;软件开源&lt;/h4&gt;
&lt;p&gt;而为micro:bit编程的软件/web平台，目前基本都开源&lt;/p&gt;
&lt;h1 id="_5"&gt;开始编程&lt;/h1&gt;
&lt;h3 id="_6"&gt;可选编程工具&lt;/h3&gt;
&lt;p&gt;有多种工具可以为microbit编程，包括图形化界面(makecode等)、Python、C++等。我们先在架构层面关注一下microbit的运行时，如下图:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://tech.microbit.org/docs/software/assets/dal-4032c.png" /&gt;&lt;/p&gt;
&lt;p&gt;代码的执行过程为(如果你对更多细节感兴趣，可以参考&lt;a href="http://tech.microbit.org/software/"&gt;the micro:bit Software Ecosystem&lt;/a&gt;):&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://tech.microbit.org/docs/software/assets/overview.png" /&gt;&lt;/p&gt;
&lt;p&gt;尽管有许多可选工具，官方推荐我们使用两种工具来为microbit编程:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;由微软打造的&lt;a href="https://makecode.microbit.org/#"&gt;JavaScript Blocks Editor(makecode)&lt;/a&gt;: makecode是一个图形化工具，对新手友好&lt;/li&gt;
&lt;li&gt;来自python社区的&lt;a href="http://python.microbit.org/v/1"&gt;Python Editor&lt;/a&gt;: 使用python代码驱动microbit，适合进阶的孩子&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果你偏好使用离线的编辑器,推荐&lt;a href="https://codewith.mu/"&gt;Mu&lt;/a&gt;和&lt;a href="http://kittenbot.cn/bbs/forum.php?mod=viewthread&amp;amp;tid=156&amp;amp;highlight=makecode"&gt;Makecode离线版本&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;更多可选择的编程工具，你可以参考这里:&lt;a href="https://github.com/wwj718/awesome-microbit-zh#%E7%BC%96%E7%A8%8B"&gt;awesome-microbit-zh 编程&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="_7"&gt;图形化编程&lt;/h3&gt;
&lt;p&gt;如果你选择图形化编程,目前的可选方案有几个:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://makecode.microbit.org/"&gt;makecode&lt;/a&gt;： 提供一个基于浏览器的模拟器和积木编程环境，堆叠好的积木块最终将生成JavaScript (TypeScript)代码。PXT支持代码的双向转换！&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.microbit.co.uk/app/#create:tomwku"&gt;Code Kingdoms&lt;/a&gt; - 基于图形界面的编程工具，帮助用户从拖曳式编程到文本编程(JavaScript)的过渡.&lt;/li&gt;
&lt;li&gt;&lt;a href="http://lab.open-roberta.org/"&gt;Open Roberta Lab&lt;/a&gt; - 为机器人编程设计的积木时编程环境, 通过将堆叠好的积木生成MicroPython代码来支持microbit.&lt;/li&gt;
&lt;li&gt;&lt;a href="http://microbit.site/editor-zh-hans.html"&gt;microbit zh&lt;/a&gt;: 国内社区提供的在线工具,堆叠好的积木块生成python代码&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在浏览器中的编程环境内置了编译器（可离线使用，十分适合在教室或公共计算机上使用）,代码块转换为hex文件的过程如下&lt;/p&gt;
&lt;p&gt;更多细节,参考这里:&lt;a href="http://tech.microbit.org/docs/software/assets/browser-build-pipeline.png"&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="python"&gt;Python 编程&lt;/h3&gt;
&lt;p&gt;microbit上跑了一个MicroPython解释器(一个移植版本):&lt;a href="https://github.com/bbcmicrobit/micropython"&gt;bbcmicrobit/micropython&lt;/a&gt;.这一点可以通过上边那张关于运行时的图种看出&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/bbcmicrobit/micropython"&gt;bbcmicrobit/micropython&lt;/a&gt;源码中包含了很多使用python驱动microbit的&lt;a href="https://github.com/bbcmicrobit/micropython/blob/master/examples/"&gt;examples&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;既然microbit上跑了MicroPython，那我们就可以用为MicroPython打造的工具来为microbit编程(诸如picocom),关于MicroPython相关的工具和资源，我之前写了这篇文章:&lt;a href="http://blog.just4fun.site/micropython-notes.html"&gt;MicroPython使用笔记&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这儿有一些工具方便在python脚本和hex文件中转化:&lt;a href="https://github.com/bbcmicrobit/micropython/tree/master/tools"&gt;tools&lt;/a&gt;、&lt;a href="https://github.com/ntoll/uflash"&gt;uflash&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;microbit所有可用的python模块:&lt;a href="http://microbit-micropython.readthedocs.io/en/latest/microbit.html"&gt;Microbit Module&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;如果需要传输复杂的数据，你无法使用json，可以试试&lt;code&gt;str/eval&lt;/code&gt;&lt;/p&gt;
&lt;h3 id="_8"&gt;一些有趣项目&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/wwj718/bitio"&gt;bitio&lt;/a&gt;: 把bitio当成一个IO设备。可以用这库很方便地与电脑脚本，把bitio当成可编程的外设，强烈推荐！&lt;/li&gt;
&lt;li&gt;&lt;a href="http://tech.microbit.org/bluetooth/apps-and-examples/"&gt;Bluetooth Apps and Examples&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="http://www.bittysoftware.com/"&gt;bitty software apps&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/wwj718/scratch2-microbit"&gt;scratch2-microbit&lt;/a&gt;: 使用microbit来控制scratch2中的角色&lt;/li&gt;
&lt;li&gt;&lt;a href="http://microbit.org/en/2017-06-01-will-txting/"&gt;MicroPython Txting Package for micro:bit&lt;/a&gt;: 用radio收发信息&lt;/li&gt;
&lt;li&gt;&lt;a href="http://microbit.org/en/2017-05-17-joseph-post/"&gt;Joseph's Micro:bit Python Utilities Package&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="_9"&gt;课程&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://microbit.org/zh-CN/teach/"&gt;microbit teach&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://microbit.org/zh-CN/teach/code-org-fundamentals/"&gt;Micro:bit Lessons Aligned to Code.org's CS Fundamentals&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="http://microbit.org/zh-CN/2017-12-04-code_org_loops_2/"&gt;Course E - Loops 2 - Nested Loops and Scoreboards&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://microbit.org/zh-CN/2017-12-04-code_org_conditionals-1/"&gt;Course F - Conditionals 1 - Conditionals with the Weather Predictor&lt;/a&gt;:有配套的教师资源&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://microbit-playground.co.uk/"&gt;python游乐场&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="https://microbit-playground.co.uk/components/PIR-sensor"&gt;PIR Sensor&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://groklearning.com/learn/microbit-starter-blockly/w1p2/1/"&gt;BBC micro:bit Starter (Blockly)&lt;/a&gt;: 模拟器、作业、slides&lt;/li&gt;
&lt;li&gt;&lt;a href="https://groklearning.com/learn/hoc-virtual-pet/intro/3/"&gt;Hour of Code: Virtual Pet&lt;/a&gt;： 虚拟宠物&lt;/li&gt;
&lt;li&gt;&lt;a href="https://makecode.microbit.org/projects"&gt;Microsoft 14 Week Curriculum&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.microbit.co.uk/STEM"&gt;STEM Centre Lessons&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="https://microbit0.blob.core.windows.net/pub/hohwmegr/STEM-Learning-Acceleration-lesson-plan.pdf"&gt;Acceleration&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="http://microbit.org/assets/documents/us_stem_curriculum/stem-acceleration-teacher-notes.pdf"&gt;Acceleration STEM Experiment 教师笔记&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="faq"&gt;FAQ&lt;/h1&gt;
&lt;h3 id="arduino"&gt;与Arduino对比&lt;/h3&gt;
&lt;p&gt;相比与Arduino，micro:bit具有免装驱动,易上手，电子模块集成度高，支持时下热门的多种编程语言等优势，节省了教学资源成本的同时也大大增加了可玩性和拓展空间。关于这方面的讨论可以参考:&lt;a href="http://kittenbot.cn/bbs/forum.php?mod=viewthread&amp;amp;tid=81"&gt;Microbit和arduino有什么关系？&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="microbithex"&gt;microbit在拖入hex文件后将自动弹出并自动运行程序&lt;/h3&gt;
&lt;p&gt;microbit的flash文件系统完全是虚拟，这就是为什么在写入新文件之后驱动器会自动弹出，当你把hex文件拖到MICROBIT上，它并没有被写入到闪存里，而是直接流到nRF51822(target MCU)中&lt;/p&gt;
&lt;p&gt;这方便的讨论参考:&lt;a href="http://tech.microbit.org/software/daplink-interface/"&gt;DAPlink and the USB interface|Files on the MICROBIT Drive&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="_10"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://en.wikipedia.org/wiki/Micro_Bit"&gt;wikipedia Micro Bit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://tech.microbit.org/"&gt;microbit developer community&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="http://tech.microbit.org/software/"&gt;he micro:bit Software Ecosystem&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://tech.microbit.org/hardware/"&gt;Hardware Description&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="http://tech.microbit.org/software/runtime-mbed/"&gt;The micro:bit runtime and mbed programming&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.cnblogs.com/TWmicrobit/p/6984285.html"&gt;Microbit 硬件架构介绍&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/wwj718/awesome-microbit-zh"&gt;awesome-microbit-zh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://microbit.hackster.io/"&gt;microbit.hackster.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://mc.dfrobot.com.cn/forum.php?mod=viewthread&amp;amp;tid=23903"&gt;BBC Micro:bit是什么和microbit怎么玩起来 中文教程&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://kittenbot.cn/bbs/forum.php?mod=viewthread&amp;amp;tid=81"&gt;Microbit和arduino有什么关系？&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://tech.microbit.org/software/daplink-interface/"&gt;DAPlink and the USB interface&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://lancaster-university.github.io/microbit-docs/online-toolchains/"&gt;Web-based C/C++ environments supporting the runtime&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!--
https://github.com/bbcmicrobit/micropython/blob/master/tools/pyboard.py  是一个分支

http://mc.dfrobot.com.cn/forum.php?mod=viewthread&amp;tid=30029  电子琴


http://mc.dfrobot.com.cn/forum.php?mod=viewthread&amp;tid=30010  计步器


https://sites.google.com/site/hardwaremonkey/home/handshake  实际使用 实验


https://github.com/lancaster-university/quiz-bit  投票程序


https://github.com/ubirch/pxt-ubirch 发送数据到云端

http://warksjammy.blogspot.kr/2017/07/bitio-blogs-in-one-place.html?view=timeslide  例子 用于控制minecrft  树莓派

图形化

http://www.micropython.org.cn/bbs/forum.php?mod=viewthread&amp;tid=273&amp;extra=

microbit和scratch连接

https://github.com/vecsei/Scratchbit

https://www.youtube.com/watch?v=nJengUwURdE&amp;feature=youtu.be

https://github.com/wwj718/scratch2-microbit  成功！！！ 非常酷

https://mryslab.github.io/s2m/
--&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Sun, 24 Dec 2017 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2017-12-24:microbit-notes.html</guid><category>microbit</category></item><item><title>Cozmo what is this</title><link>/cozmo_what_is_this.html</link><description>&lt;h1 id="_1"&gt;前言&lt;/h1&gt;
&lt;p&gt;Cozmo官方在11月15号发&lt;a href="https://developer.anki.com/blog/news/cozmo-code-lab/"&gt;博文&lt;/a&gt;称2017.12.05号这天将会发布一个大版本，在这个版本中Code Lab将会得到极大的增强，最大的更新是界面中将增加Constructor Mode。&lt;/p&gt;
&lt;p&gt;它长这样:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://i0.wp.com/developer.anki.com/app/uploads/2017/11/Codelab-Vert_TinyOrchestra_UI_Zoom-IN.jpg?resize=1024%2C768&amp;amp;ssl=1" /&gt;&lt;/p&gt;
&lt;p&gt;Constructor Mode增加了更多的编程积木，包括条件语句、数学操作符、变量函数等等，高阶用户将能做出更具表现力的东西。&lt;/p&gt;
&lt;p&gt;而原先基于图标的编程界面也将保留，对于低龄用户和新手，它更为友好和直观。&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://i2.wp.com/developer.anki.com/app/uploads/2017/11/code-lab.png?resize=1024%2C768&amp;amp;ssl=1" /&gt;&lt;/p&gt;
&lt;p&gt;顺便一提，如此惊艳而流畅的操作界面基于scratch3.0。&lt;/p&gt;
&lt;p&gt;我数着日子等呀等，到了12.04号，一早跑到二楼南书房，打开Google Play，心想官方说不定想给大家一个惊喜，提前一天发布了更新。于是我有些手抖地在Google Play输入Cozmo，等待进度条加载的时候，就像等待期末考试突击科目的成绩，真是坐立难安，恨不能找个插件以刮奖的方式查看结果。&lt;/p&gt;
&lt;p&gt;哈，还好没更新，不然我都没有做好心理准备，要怎么来表现我的开心。这就像表白的时候，心理有个声音说拒绝我吧拒绝我吧，不然我开心得不知道下一步该干嘛。&lt;/p&gt;
&lt;p&gt;这样一来我就有足足一天的时间迎接cozmo的大版本更新！我打开之前用Cozmo Python SDK写过的项目，突然想到大版本更新之后，对我之前的作品不兼容怎么办？&lt;/p&gt;
&lt;p&gt;我赶紧整理了一下做过的好玩项目，趁它更新之前，发布到&lt;a href="https://github.com/wwj718/Cozmo-What-Is-This"&gt;github&lt;/a&gt;和&lt;a href="https://forums.anki.com/t/cozmo-what-is-this-use-inception-v3-model-to-identify-objects/11059"&gt;官方论坛&lt;/a&gt;里。&lt;/p&gt;
&lt;h1 id="cozmo-what-is-this"&gt;Cozmo what is this&lt;/h1&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/cozmodc8e1dad.png" /&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;- Cozmo, what is this ?
- Let me see! Oh, it is the coffee mug.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;我们来看看实际效果。（只录了cozmo回答的部分，声音可能有点小，记得调大你的音量呢。）&lt;/p&gt;
&lt;video src="http://wwj-tmp-video.just4fun.site/1512735476179.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;p&gt;我来简单介绍一下这个项目。一开始，Cozmo安静地呆在桌子上，你可以向它发号施令，Cozmo虽然脾气有点坏，不过目前还不会像吴克群那样抱怨说:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;我是个小兵
我绷紧了神经
在战场上拼命
听谁在发号施令
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;所以你可以放心命令它左走右走，前进后退。如果你愿意你还可以问它:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;能不能为我再跳一支舞，你记否千百年前借伞的西湖。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我很恶俗地改了歌词。为了让它跳舞，你只要说:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;cozmo dances.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ps: 我为它增加了中文支持，目前的语义处理很弱，所以你说出我上边那段恶俗的歌词，它可能还真会为你跳一支舞 :)&lt;/p&gt;
&lt;p&gt;我们可以发号施令，让cozmo在桌子上四处游荡，当它来到一个咖啡杯面前时，你可以问它:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Cozmo, what is this?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;它会站在咖啡杯面前，若有所思说:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Let me see... Oh, it is the coffee mug.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;如此一来你可以让Cozmo在屋子里来回走动，询问它都看到些什么。&lt;/p&gt;
&lt;p&gt;目前我已经把项目源码放在了github上:&lt;a href="https://github.com/wwj718/Cozmo-What-Is-This"&gt;Cozmo-What-Is-This&lt;/a&gt;,同时也发到了Cozmo官方社区里:&lt;a href="https://forums.anki.com/t/cozmo-what-is-this-use-inception-v3-model-to-identify-objects/11059"&gt;Cozmo What Is This: use Inception-v3 model to identify objects&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;社区里有个国外小哥，run了这个项目，还录了视频发到了YouTube:&lt;a href="https://www.youtube.com/watch?v=L1GTnhmoxXA"&gt;cozmo AI voice command and image recognition&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;如果你访问不了YouTube也没关系，因为这个小哥拍的实在有点烂，我原本想跟他说你在视频下放上我的源码库链接吧，这样其他感兴趣的小伙伴可以自己run起来。后来看了视频后，觉得还是不要让大家知道这个视频与我的项目有关为好。&lt;/p&gt;
&lt;h3 id="_2"&gt;灵感来自组合&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://github.com/wwj718/Cozmo-What-Is-This"&gt;Cozmo-What-Is-This&lt;/a&gt;实际组合了社区里的两个项目。&lt;/p&gt;
&lt;p&gt;其一是CrowdFlower的创始人Lukas之前做过的一个爆款项目: &lt;a href="https://www.oreilly.com/learning/how-to-build-a-robot-that-sees-with-100-and-tensorflow"&gt;How to build a robot that “sees” with $100 and TensorFlow&lt;/a&gt;，这个项目让树莓派机器人在屋子里游荡，每当看到什么东西在面前，它就会说 "I am thinking... it is xxx", 这个机器人好像一个吟游诗人，在它所行之处，赋予所见之物以名字。&lt;/p&gt;
&lt;p&gt;这个机器人在说"I am thinking..."的时候，我简直被为作者的机智所折服。该项目用到了inception-v3 model，树莓派上跑神经网络很慢，于是作者在让机器人先说出"I am thinking...",这段时间树莓派实际是在缓慢地跑神经网络模型来识别拍摄的图片，而观众会以为机器人真的在思考（因为它就是那样说的啊，而且还真的低头沉思），尽管时间有点久，大家的好奇心反而加重，不会表现出不耐烦，等它终于说出正确的结果，观众会觉得刚才果真是在深思呢！（《银河系漫游指南》里deepThought在回答&lt;code&gt;The answer to life, universe and everything is 42&lt;/code&gt;可是用了750万年 : ）&lt;/p&gt;
&lt;p&gt;"I am thinking..."这个心理学小技巧也被我纳入到&lt;a href="https://github.com/wwj718/Cozmo-What-Is-This"&gt;Cozmo-What-Is-This&lt;/a&gt;项目里。&lt;/p&gt;
&lt;p&gt;由于Lukas没有开放源代码，我自己复现了这个项目的核心部分,有兴趣的同学可以戳这里:&lt;a href="http://blog.just4fun.site/raspberrypi-tensowflow-robot.html"&gt;基于树莓派和Tensowflow的物体识别-brain&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;灵感来源的第二个项目是&lt;a href="https://github.com/rizal72/Cozmo-Voice-Commands"&gt;Cozmo-Voice-Commands&lt;/a&gt;
,这个项目写的很棒，让Cozmo能接收语音指令。&lt;/p&gt;
&lt;p&gt;这个项目也是&lt;a href="https://github.com/wwj718/Cozmo-What-Is-This"&gt;Cozmo-What-Is-This&lt;/a&gt;的基础骨架，我fork了它，整个控制流程用的是该项目，在原本的基础上我做了两个工作:其一是加入中文支持(目前加上中文之后，一共支持5门语言)；其二是加入了&lt;code&gt;cozmo what is this&lt;/code&gt;这条语音指令。&lt;/p&gt;
&lt;p&gt;这种组合已有的社区项目，在它们基础上去实现自己的想法，是开源社区常见的做法。有人统计过，github上代码重复率很高，对这个研究有兴趣的朋友可以戳这篇论文:&lt;a href="http://link.zhihu.com/?target=http%3A//janvitek.org/pubs/oopsla17b.pdf"&gt;A Map of Code Duplicates on GitHub&lt;/a&gt;，研究称&lt;code&gt;GitHub 上 82% 的代码是重复代码&lt;/code&gt;，我觉得是一件好事，说明大家都在高效地复用代码，而不是闭上门来钻木取火。&lt;/p&gt;
&lt;h1 id="run-it"&gt;run it&lt;/h1&gt;
&lt;p&gt;接下来假设你也是一个Cozmo玩家，我来教你如何把这个项目跑起来。&lt;/p&gt;
&lt;p&gt;首先你当然得有一台Cozmo ， 没有的同学可以关上电脑洗洗睡了 ：）&lt;/p&gt;
&lt;h3 id="1cozmo-python-sdk"&gt;1.安装Cozmo Python SDK&lt;/h3&gt;
&lt;p&gt;Cozmo Python SDK的安装方法&lt;a href="http://cozmosdk.anki.com/docs/"&gt;官方文档&lt;/a&gt;里写的很详细,结合你的操作系统和移动设备,跟着教程来即可。如果你在安装的过程有遇到什么困难，可以到社区里求助，当然也可以给我发邮件，我会尽量为你提供帮助。&lt;/p&gt;
&lt;h3 id="2portaudio"&gt;2.安装portaudio&lt;/h3&gt;
&lt;p&gt;安装方式根据你的操作系统不同而不同。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MacOS:  &lt;code&gt;brew install portaudio&lt;/code&gt; (当然你首先需要安装了&lt;a href="http://brew.sh/index_it.html"&gt;Homebrew&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;Linux:  &lt;code&gt;sudo apt-get install flac portaudio19-dev python-all-dev python3-all-dev &amp;amp;&amp;amp; pip3 install --user PyAudio&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Windows: 你需要安装一下&lt;a href="https://git-scm.com/download/win"&gt;git&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="3"&gt;3.克隆项目&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;git clone https://github.com/wwj718/Cozmo-What-Is-This&lt;/code&gt;&lt;/p&gt;
&lt;h3 id="4"&gt;4.安装依赖&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cd Cozmo-What-Is-This
pip install -r requirements.txt (python3.5 virtual env)
python classify_image.py --model_dir tf/imagenset/
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="_3"&gt;就绪&lt;/h2&gt;
&lt;p&gt;一切就绪，就可以运行这个项目啦: &lt;code&gt;python cvc.py&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;之后程序让你选择使用一门语言来控制Cozmo。（我一般用英文或中文）&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/cozmoec2ddcfe.png" /&gt;&lt;/p&gt;
&lt;p&gt;现在你可以问Cozmo：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Cozmo, what is this?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;或者&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;小不点，这是什么&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;感觉&lt;code&gt;小不点&lt;/code&gt;不大好听，起名果然是最难的事情之一，岂止是为变量起名。&lt;/p&gt;
&lt;p&gt;Enjoy yourself :)&lt;/p&gt;
&lt;h1 id="todo"&gt;Todo&lt;/h1&gt;
&lt;p&gt;我准备把唤醒词和判断语音终止的功能加入这个项目里，如此一来交互过程将更为自然。这块的功能去扒智能音响类项目的代码就好了,&lt;a href="https://github.com/wzpan/dingdang-robot"&gt;dingdang-robot&lt;/a&gt;是个不错的选择，代码清晰明了。我最近比较忙，如果你提前做好了，到时候给我提个PR呢 : )&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Fri, 08 Dec 2017 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2017-12-08:cozmo_what_is_this.html</guid><category>cozmo</category></item><item><title>Scratch的前世今生</title><link>/scratch.html</link><description>&lt;blockquote&gt;
&lt;p&gt;学习编程能帮你组织、表达和分享你的想法，就像学习写作一样。这对于所有人来说都很重要&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img alt="" src="https://wiki.scratch.mit.edu/w/images/Scratch_3.0_Prototype.png" /&gt;&lt;/p&gt;
&lt;h1 id="_1"&gt;前言&lt;/h1&gt;
&lt;h3 id="_2"&gt;人海擦肩&lt;/h3&gt;
&lt;p&gt;说起Scratch，很早就有注意到它，它时常以不同方式出现在视野里，从知乎编程入门类问题的回答，到树莓派里自带的教育软件，以及各种玩具的操作界面，都有它的身影。&lt;/p&gt;
&lt;p&gt;Scratch的反复刷脸成功引起了我的注意，曾经试着用过一段时间，对其的理解却一致停留在"图形化编程，拖拖拽拽，可以做游戏和动画，更像玩具，而不是严肃的编程"。（从编程语言的历史来看，每当有新的编程语言／范式出现，"更像玩具，而不是严肃的编程"这句话以各种表述形式伴随着出现:）&lt;/p&gt;
&lt;p&gt;当你谈及Scratch，我脑子里浮现出基于Scratch的学生作品，如果要对它们做个贴便签式的群嘲，我大概会选"画风简陋而随意"&lt;/p&gt;
&lt;p&gt;于是对于它的流行(已翻译成 40 种以上的语言，在超过 150 个国家上被使用，在过去的一年里，平均每月新增人数为 53 万，平台已经发布的共享程序超过 2233 万个)，我更多抱着一种"时无英雄使竖子成名“的态度&lt;/p&gt;
&lt;h3 id="_3"&gt;路转粉&lt;/h3&gt;
&lt;p&gt;我从路人转为Scratch粉丝，主要因为&lt;a href="https://zh.wikipedia.org/wiki/%E4%BC%8A%E8%97%A4%E7%A9%B0%E4%B8%80"&gt;伊藤穰一&lt;/a&gt;(Joi Ito)的《爆裂》(Whiplash：How to Survive Our Faster Future) 一书（ps：近期在Cozmo Code Lab中的编程体验也让我对Scratch好感倍增）&lt;/p&gt;
&lt;p&gt;伊藤穰一现任MIT Media Lab（麻省理工媒体实验室）主管，而Scratch诞生自MIT Media Lab "终生幼儿园"（Lifelong Kindergarten）小组，《爆裂》一书以一种内部视角，向我们揭示了Scratch的诞生过程、初心和设计原则。&lt;/p&gt;
&lt;p&gt;从4P(Projects, Passion, Peers, and Play)到"低门槛，高天花板，宽围墙"的设计理念，以及Scratch对这些理念的实践，无不令我震惊和心动. &lt;/p&gt;
&lt;h1 id="_4"&gt;历史沿革&lt;/h1&gt;
&lt;h3 id="_5"&gt;台上台下&lt;/h3&gt;
&lt;p&gt;1982年春天，偶然的机会，有一位青年记者听了Logo编程语言发明者&lt;a href="https://en.wikipedia.org/wiki/Seymour_Papert"&gt;西摩·派珀特(Seymour Papert)&lt;/a&gt;的一次主题演讲。这次演讲完全改变了他对计算机的认知。&lt;/p&gt;
&lt;p&gt;大部分人谈论计算机的方式都是将计算机当成工具，一种完成任务的方法，但在派珀特眼中，计算机能帮助我们用全新的方式认识世界，它将成为儿童表达想法的媒介&lt;/p&gt;
&lt;p&gt;故事听起来颇有武侠小说开篇的味道。台上道骨仙风的开山鼻祖，台下骨骼清秀的求知青年，一段演讲中完成了衣钵传承&lt;/p&gt;
&lt;p&gt;次年，这位青年拿到MIT一年期的奖学金，于是他报名参加了派珀特的研讨班，并被深深吸引。在这里一待就是三十寒暑。&lt;/p&gt;
&lt;p&gt;当时台下的那个青年记者，便是后来的"Scratch之父" -- &lt;a href="https://en.wikipedia.org/wiki/Mitchel_Resnick"&gt;米奇·雷斯尼克(Mitchel Resnick)&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="logo"&gt;派珀特与Logo语言&lt;/h3&gt;
&lt;p&gt;雷斯尼克创造的Scratch受派珀特和他的Logo语言影响至深，派珀特对计算机的看法对他的影响则更为深刻。这些我们放在后边再说，现在来说说派珀特和他的传承。&lt;/p&gt;
&lt;p&gt;派珀特是近代人工智能领域的先驱者之一，20世纪60年代初，他与&lt;a href="https://zh.wikipedia.org/wiki/%E9%A9%AC%E6%96%87%C2%B7%E9%97%B5%E6%96%AF%E5%9F%BA"&gt;马文·明斯基&lt;/a&gt;在MIT创办了人工智能实验室(Artificial Intelligence Laboratory)，他们还合著过 Perceptrons 一书，，当今深度学习三大权威之一Yann LeCun在读大学的时候因为听说了「perceptron」的概念，激发了对学习型机器的热情，派珀特可算他的启蒙老师。&lt;/p&gt;
&lt;p&gt;派珀特也是前边提到的MIT Media Lab创建者之一，且一直在该实验室工作&lt;/p&gt;
&lt;p&gt;他曾师从瑞士哲学家、心理学家&lt;a href="https://zh.wikipedia.org/wiki/%E8%AE%93%C2%B7%E7%9A%AE%E4%BA%9E%E5%82%91"&gt;让·皮亚杰&lt;/a&gt;，皮亚杰曾说&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;从来没有人能够象西摩·派珀特那样理解我的思想&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;1958——1963年，派珀特和皮亚杰在日内瓦大学共事。皮亚杰将84年人生中的大部分时间和精力都花在了研究儿童或者进一步说成年人是如何形成对世界的认识上面。人类从幼年开始构建不同的心智模式（mental model）解释自己周围的现象，比如加速的汽车、猫粗糙的舌头。随着逐渐长大，我们的经验和这些模式产生碰撞，迫使我们调整模式以适应不断变化的现实。如此说来，儿童玩耍就是不断创建和再创建自己心智模式的行为，以此更好地认识世界&lt;/p&gt;
&lt;p&gt;对于派珀特来说，计算机可以对照这些模式和经验，是兼顾玩耍和学习的完美载体。派珀特将皮亚杰的这些理念融入Logo语言（他在1968年从LISP语言的基础里创立Logo编程语言）：比如，孩子认识到通过几行简单的代码可以让屏幕上的光标画出一个正方形，甚至是一朵花。如果这样做，就会出现那样的画面。最有价值的是，他们也会认识到，有时这样做可能不会出现那样的画面，这时他便主动寻求身旁的程序员的帮助。这个过程就是提出一种假设，然后去验证，再去修正得到新的假设。通过Logo语言，每个孩子都可以变成经验主义者。&lt;/p&gt;
&lt;p&gt;他在其著作《头脑风暴：儿童、计算机及充满活力的创意》（Mindstorms:Children, Computers, and PowerfulIdeas）中，系统阐述了自己的建构主义观: "在制作中学习"（Learning by making），在他看来，好的教育不是如何让老师教得更好，而是如何提供充分的空间和机会让学习者去构建自己的知识体系(伊藤穰一也提到: 学习而不是教育)。当孩子们在制作一些对自己有意义的作品时，如编故事、编程序、或是音乐创作时，孩子们正处于学习知识的最佳状态。他被自己的热情所驱动，主动地去获取知识而不是痛苦地被填鸭。关于这点雷斯尼克在他的一个TED演讲中有动人的例子: &lt;a href="https://www.ted.com/talks/mitch_resnick_let_s_teach_kids_to_code"&gt;Let's teach kids to code&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;米奇·雷斯尼克后来成了派珀特的学生，他评价说:"派珀特是第一个预见计算机可以用来帮助孩子们学习的人,他相信计算机可以让孩子们主动构建知识"&lt;/p&gt;
&lt;h3 id="_6"&gt;&lt;a href="https://zh.wikipedia.org/wiki/%E8%AE%93%C2%B7%E7%9A%AE%E4%BA%9E%E5%82%91"&gt;让·皮亚杰&lt;/a&gt;与儿童心理学&lt;/h3&gt;
&lt;p&gt;前头说到Scratch之父雷斯尼克 对计算机和编程教育的理解 受派珀特和他的Logo语言的影响很深，而派珀特在创造Logo语言的时候，则主要是受皮亚杰的启发，并将他的思想融入到Logo语言中。那么我们自然追溯到&lt;a href="https://zh.wikipedia.org/wiki/%E8%AE%93%C2%B7%E7%9A%AE%E4%BA%9E%E5%82%91"&gt;让·皮亚杰&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;让·皮亚杰自1921年开始从事儿童心理学的研究，从智能的早期形态入手，目的在于由此探讨认知论的问题。&lt;/p&gt;
&lt;p&gt;我最近在读他的《发生认识论原理》，这本书论述了认识是怎样形成的，智力是怎么发展、构建的。于我而言，这本书内容十分新颖（不过阅读体验并不好，作者对一些哲学内容的表述，远没有罗素式的清晰和友好），在认识论方面，我之前受洛克、休谟（经验论者）影响较多，而皮亚杰在这本书的英译本序言里说&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我不是经验论者&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;但他认同洛克、休谟、斯宾诺莎这些经验论者创立的"伟大传统"，即把对认识的分析放在研究认识的心理发展这个基础之上。令皮亚杰遗憾的是经验论者竟然没有进行详细的实验，而这个正是皮亚杰的前进的方向。&lt;/p&gt;
&lt;p&gt;之后皮亚杰在丰富的实验基础上，阐释他的认识论，他把结构主义与建构主义紧密地结合起来。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;认知的结构既不是在客体中预先形成了的，因为这些客体总是被同化到那些超越了客体之上的逻辑数学框架中去，也不是在必须不断地进行重新组织的主体中预先形成了的。因此，认识的获得必须用一个将结构主义和建构主义紧密的结合起来的理论来说明，也就是说，每一个结构都是心理发生的结果，而心理发生就是从一个较初级的结构过渡到一个较复杂的结构。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;皮亚杰把适应看作智力的本质，他把儿童看成建造自己的个人知识理论的小哲学家和科学家。他认为活动即是感知的源泉，又是思维发展的基础。&lt;/p&gt;
&lt;p&gt;从皮亚杰的理论里，我们可以看到Logo和Scratch的世界观和灵魂所在：对活动/交互的重视、让孩子在玩耍中不断创建和调整心智模式。&lt;/p&gt;
&lt;p&gt;尽管Logo有各种分支和方言，尽管Scratch经历了几次技术变革(即将迎来3.0版本)，也许在将来，从外表上你甚至不能一眼认出他们。但他们内核的东西一直如初：对皮亚杰认知理论的实践，将计算机作为一种理想的媒介，让孩子们在活动中去构建和调整心智模型。以理解和适应外部环境&lt;/p&gt;
&lt;p&gt;皮亚杰对计算机的影响远不只在编程教育这个领域。除了派普特根据皮亚杰的理论开发了Logo编程语言之外。Alan Kay以皮亚杰的理论为基础，开发了Dynabook编程概念。以上这两项技术，都是现今我们日常使用的图形使用者界面（GUI）的基础技术，使电脑从文字界面过渡至图形界面，改写了电脑技术的发展路向。&lt;/p&gt;
&lt;h1 id="_7"&gt;青出于蓝&lt;/h1&gt;
&lt;p&gt;前边我们沿着理念传承这条线，一路从雷斯尼克的Scratch追溯到派珀特的Logo语言，之后抵达皮亚杰的认知论（再往前甚至将追溯到洛克的经验论）&lt;/p&gt;
&lt;p&gt;接着我们横向来看看Scratch对他同一谱系的前辈LOGO语言做了那些改进&lt;/p&gt;
&lt;p&gt;雷斯尼克认为Scratch从Logo语言止步的地方继续前进，将Logo语言带入未来，他们的传承关系可想而知，相似之处且多于不同。&lt;/p&gt;
&lt;h3 id="scratchlogo"&gt;Scratch对Logo的改进&lt;/h3&gt;
&lt;h4 id="_8"&gt;更加直观&lt;/h4&gt;
&lt;p&gt;Scratch基于图形化的编程方式，通过拖拽、拼搭积木的方式，让整个编程过程十分直观，很像在玩乐高积木。这并不是偶然，雷斯尼克一直与乐高公司保持密切合作，乐高机器人便是他与导师派珀特密切合作研发的。乐高积木对Scratch的影响很深，或者说它们彼此影响很深&lt;/p&gt;
&lt;p&gt;关于这一点在Scratch诞生之前给国家科学基金会提交了一份&lt;a href="http://web.media.mit.edu/~mres/papers/scratch-proposal.pdf"&gt;提案&lt;/a&gt;里可以看出。其中提到他们在乐高机器人这块的研究工作将帮助他们构建Scratch&lt;/p&gt;
&lt;p&gt;这份提案里还指出&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;This approach eliminates the possibility of syntax errors (which have proven to be a major obstacle for learning text-based languages)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;基于文本的编程可能带来的语法错误正是孩子们入门编程的主要困难所在。基于图形化的Scratch能避开这点&lt;/p&gt;
&lt;p&gt;这份提案有许多有趣的地方，诸如为了让Scratch卓有成效，需要做到的几点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;这个工具得与孩子们的感兴趣和有热情的事情产生关联，他们才会认为这个工具很酷&lt;/li&gt;
&lt;li&gt;孩子们要能一眼就看到工具的价值和潜力(不必费劲地琢磨)&lt;/li&gt;
&lt;li&gt;可以很方便地用它创建第一个项目（低门槛）&lt;/li&gt;
&lt;li&gt;可以创建出向他人炫耀的作品&lt;/li&gt;
&lt;li&gt;能支持不同类型的活动（宽围墙）&lt;/li&gt;
&lt;li&gt;能吸引不同背景、文化的孩子&lt;/li&gt;
&lt;li&gt;可以逐步(渐进式)学习工具的特性（不必一次学完）&lt;/li&gt;
&lt;li&gt;随着时间的推移，可以越来越复杂地使用这个工具（高天花板）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这份提案在2003年提到的这些理念和设计思路在今天看来很是很有启发性，十分值得一读！&lt;/p&gt;
&lt;h4 id="_9"&gt;更宽的围墙&lt;/h4&gt;
&lt;p&gt;Logo语言的特色是派珀特所说的“低门槛”（易于学习）和雷斯尼克所称的“宽围墙”（不束缚儿童的想象）&lt;/p&gt;
&lt;p&gt;相比于Logo，Scratch的围墙则更宽，你可以在其中做更多你想做的事&lt;/p&gt;
&lt;p&gt;除了控制角色移动、画画之外，你还可以创作你自己的音乐、故事、电影、动画或者游戏&lt;/p&gt;
&lt;p&gt;并不是每个孩子的兴趣都一样，作为一个优秀的工具，应该把“围墙”做宽，而不应该把孩子围在一个狭小的区域里，你应该给他整个游乐场，而不是一间活动室&lt;/p&gt;
&lt;p&gt;关于"宽围墙"的意义，&lt;a href="http://learn.media.mit.edu/lcl/"&gt;Learning Creative Learning&lt;/a&gt; &lt;a href="http://learn.media.mit.edu/lcl/weeks/week5/"&gt;第五周的课里&lt;/a&gt;讲的很清楚&lt;/p&gt;
&lt;h4 id="_10"&gt;更丰富的媒介和更强的表现力&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;Taking advantage of the extraordinary processing power of current computers, Scratch will support new programming paradigms and activities that were previously infeasible, making it much better positioned to succeed than previous initiatives to introduce programming to youth.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;计算机技术日新月异，Logo并没有跟上时代，Scratch试图将更多的多媒体元素吸收进来，以便孩子们能轻易地创作更具表现力的作品，"可以向他人炫耀的作品"&lt;/p&gt;
&lt;p&gt;在Scratch你能够轻松地导入或绘制人物、录制并调制声音、调用摄像头或是现实中的各种传感器！&lt;/p&gt;
&lt;h4 id="_11"&gt;社区: 分享与合作&lt;/h4&gt;
&lt;p&gt;雷斯尼克和同事在编写和设计Scratch软件的4年里，波士顿众多计算机俱乐部的孩子们经常在他们的办公室穿梭，带给他们很多灵感，Scratch是很多人共同努力的结晶，他们在Scratch中将社群功能融入软件的核心&lt;/p&gt;
&lt;p&gt;Scratch的口号是:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Imagine, Program, Share&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;对"Share"的重视可以追溯到开源运动和黑客文化。Scratch诞生自MIT，而MIT有着悠久的黑客文化&lt;/p&gt;
&lt;p&gt;60年代初，第一批"MIT黑客"将他们写的程序存储在磁带上，随意的放在实验室的抽屉里，任何人都可以自由地使用磁带，将其放到自己的计算机里，学习代码、更新和改进，然后再将传给磁带留给下一个人，大家在这个过程中互相学习，共同改进程序，他们认为这是学习编程最佳的方法。在《大教堂与集市》中，作者从经济学角度论证了，这也是构建高质量软件的最佳方法&lt;/p&gt;
&lt;p&gt;弗莱德·摩尔曾明确地将家酿计算机俱乐部定位成一个信息交换中心。信息应该在俱乐部成员之间自由传递，就像在一台精心设计的计算机内无拘无束流动着的二进制位一样。黑客们都奉行与计算机本身雅致的逻辑相一致的理念——共享、开放、分权，以及亲自动手改进机器并改善整个世界&lt;/p&gt;
&lt;p&gt;这种分享与合作的的精神一直在黑客社区流传，之后的开源运动、今天的github都是它的产物。对这段历史有兴趣的同学可以参看《黑客:计算机革命的英雄》。&lt;/p&gt;
&lt;p&gt;人工智能的开拓者马文·明斯基曾说："Logo语言的问题是它只有语法而没有文本。" 他的意思是，Logo语言缺少被认可、推崇和复制的可能性，这样一来Share变的艰难。而Scratch改进了这点,它继承了这种合作、开放、分享的黑客文化，在Scratch中你可以从0开始一个自己的项目，也可以看看是不是有其他人做过你想做的事，尝试在Ta的基础上做些调整以符合自己的需要。如果遇到问题，便在社区中和作者交流。当然反馈你更好的解决方法，他将因为作品被改进而感激你。如此一来，社区成为了淘金、合作、激发热情和学习技巧的绝佳场所。&lt;/p&gt;
&lt;p&gt;关于合作与分享，雷斯尼克在&lt;a href="http://learn.media.mit.edu/lcl/weeks/week4/"&gt;LCL peers&lt;/a&gt;中有做深入探讨&lt;/p&gt;
&lt;h1 id="scratch30"&gt;未来 : Scratch3.0&lt;/h1&gt;
&lt;p&gt;Scratch经历了基于Squeak编写的1.x版本；基于ActionScript编写的2.0版本(依赖flash)，如今即将迈向3.0（明年春发布）&lt;/p&gt;
&lt;p&gt;Scratch将基于html5技术，能够轻松跨平台运行，十分可期。目前的开发版可以在&lt;a href="https://llk.github.io/scratch-gui/"&gt;这儿尝鲜&lt;/a&gt;. 对源码有兴趣的小伙伴，想围观或者参与，都可以&lt;a href="https://github.com/LLK"&gt;戳这里&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Google与MIT Media Lab将共同开发Scratch Blocks，Scratch Blocks使用谷歌的可视化编程语言Blockly(关于Blockly可以看我之前的这篇文章: &lt;a href="http://blog.just4fun.site/blockly-overview.html"&gt;blockly入门与介绍&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;使用Blockly积木块之后，Scratch将变的更加灵活、美观和易拓展，拼搭好的积木块可以直接转译为6门语言，而这些语言将直接运行在合适的地方（目前许多硬件都能直接运行Python和JavaScript）。Scratch将出现在更多的现实场景中，也许某一天你可以通过拖拽积木来自定义你的新家或是为你的机器管家编程，而目前你已经可以用它控制Cozmo、四轴飞行器。目前也有一些AI公司尝试用积木来封装他们的AI接口，让用户可以更方便地搭建出他们的AI项目。&lt;/p&gt;
&lt;p&gt;所有试图将复杂度隐藏、给用户暴露出直观易用接口、同时还想保留足够灵活度的项目，都可能受益于Scratch/Blockly&lt;/p&gt;
&lt;p&gt;积木化的编程方式是领域无关的，这种封装/抽象的思想，能恰当地屏蔽复杂度，仅将用户需要的东西暴露为可组合的积木块（很符合Unix设计哲学），如果我们使用得当，我们可以将大多数的事物封装为Scratch积木，任何对创造有热情的人都可以去自定义和改写他的生活，这大概是maker们梦想的天堂。&lt;/p&gt;
&lt;h1 id="_12"&gt;尾声&lt;/h1&gt;
&lt;p&gt;我们以雷斯尼克的一次演讲来结束本文&lt;/p&gt;
&lt;p&gt;雷斯尼克在一次演讲中，一位听众起身问了一个问题&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;西蒙·派珀特20年前不也在做同样的事情吗？&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这句话当然不是恭维，而是暗示雷斯尼克的想法已经过时了。&lt;/p&gt;
&lt;p&gt;雷斯尼克回答说&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;对，我做的正是西蒙·派珀特20年前做的事情。我认为这是值得继续做的事。我们正在取得一些进展。如果我的余生一直做这些事，我会感到快乐和自豪，因为它们重要到我非做不可。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id="_13"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/wiki/%E4%BC%8A%E8%97%A4%E7%A9%B0%E4%B8%80"&gt;wikipedia 伊藤穰一&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/wiki/%E9%BA%BB%E7%9C%81%E7%90%86%E5%B7%A5%E5%AA%92%E4%BD%93%E5%AE%9E%E9%AA%8C%E5%AE%A4"&gt;wikipedia 麻省理工媒体实验室&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/wiki/Scratch"&gt;wikipedia Scratch&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.ted.com/talks/mitch_resnick_let_s_teach_kids_to_code"&gt;Let's teach kids to code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://en.wikipedia.org/wiki/Mitchel_Resnick"&gt;Mitchel Resnick&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://wiki.scratch.mit.edu/wiki/Scratch_3.0"&gt;Scratch 3.0&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://en.wikipedia.org/wiki/Seymour_Papert"&gt;Seymour Papert&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/zh-hans/Logo%E8%AF%AD%E8%A8%80"&gt;Logo语言&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/wiki/%E8%AE%93%C2%B7%E7%9A%AE%E4%BA%9E%E5%82%91"&gt;wikipedia 让·皮亚杰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/wiki/%E5%8F%91%E5%B1%95%E5%BF%83%E7%90%86%E5%AD%A6发展心理学"&gt;wikipedia 发展心理学&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/wiki/%E8%AA%8D%E7%9F%A5%E7%99%BC%E5%B1%95%E8%AB%96"&gt;wikipedia 认知发展论&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zh.wikipedia.org/zh-hans/%E5%BB%BA%E6%A7%8B%E4%B8%BB%E7%BE%A9_(%E5%AD%B8%E7%BF%92%E7%90%86%E8%AB%96)"&gt;wikipedia 建构主义&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.yangfenzi.com/news/64397.html"&gt;人工智能先驱、LOGO语言创始人西蒙·派珀特(Papert)去世&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://web.media.mit.edu/~mres/papers/scratch-proposal.pdf"&gt;A Networked, Media-Rich Programming Environment to Enhance Technological Fluency at After-School Centers  in Economically-Disadvantaged Communities&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://learn.media.mit.edu/lcl/"&gt;Learning Creative Learning&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Thu, 07 Dec 2017 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2017-12-07:scratch.html</guid><category>scratch-history</category></item><item><title>cozmo系列之入门 - 有性格且可编程的机器人</title><link>/cozmo-hello-world.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/cozmo92f55c7b.png" /&gt;&lt;/p&gt;
&lt;p&gt;可编程的机器人不少，灵活而友好的却不多&lt;/p&gt;
&lt;p&gt;不智障的机器人不多，有性格的就更少&lt;/p&gt;
&lt;p&gt;可爱的机器人中我最中意2款: BB8和cozmo&lt;/p&gt;
&lt;p&gt;BB8可爱且呆，cozmo可爱又任性&lt;/p&gt;
&lt;p&gt;来个它们的合影&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/cozmo1a05d914.png" /&gt;&lt;/p&gt;
&lt;h1 id="_1"&gt;你的电子宠物&lt;/h1&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/cozmoba993abb.png" /&gt;&lt;/p&gt;
&lt;p&gt;这个憨态可掬的机器人，有些像微缩版的瓦力，不过它可没瓦力乖巧&lt;/p&gt;
&lt;p&gt;它从睡眼惺忪中醒来，伸伸懒腰，便下床(充电座)自顾自地玩耍，它有自个儿的玩具(发光方块)，如果你有时间，愿意陪它做游戏，它会很开心，赢了得意忘形，输了就捶胸顿足，得失心这么重，恐怕不适合炒股&lt;/p&gt;
&lt;p&gt;如果你没空陪它，也无妨，它闲庭信步，吹吹口哨、哼哼小曲儿;闲着无聊，便来回搬运自己的玩具，堆叠起来或是一把推翻，自得其乐。除了不尿裤子，其他方面都像极了你六岁时的样子&lt;/p&gt;
&lt;p&gt;想找你玩，而你又没空的时候，它会来一出苦情戏，走到桌子边缘，假装要掉下去，真站到边缘，又会被自己吓一跳，忙往回缩，这样的演技恐怕只适合拍偶像剧了&lt;/p&gt;
&lt;h2 id="_2"&gt;唤醒&lt;/h2&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/cozmo15948ba5.png" /&gt;&lt;/p&gt;
&lt;p&gt;将cozmo放在通电的基座上，手机连上cozmo发射出来的wifi热点(形如Cozmo_542CA8),打开app(Cozmo)选择连接，cozmo将被唤醒：睡眼惺忪，伸伸懒腰，懒洋洋地下床&lt;/p&gt;
&lt;p&gt;你家里从此多了一个调皮的小伙伴&lt;/p&gt;
&lt;h2 id="_3"&gt;下床(自主模式）&lt;/h2&gt;
&lt;p&gt;Cozmo下床之后，默认的模式是自顾自的玩耍（自主模式），它四处打量着新家，充满了好奇，遇到新奇之物，忍不住要发出"哇"的赞叹，尾音拖的老长，赞叹之情想来发自肺腑。&lt;/p&gt;
&lt;p&gt;你可以将家庭成员录入它的视觉系统，这样在它玩耍之余，看到熟人，会有礼貌地打个招呼，只是在它喊出名字的时候，略带一点外星口音。你会慢慢习惯的，如果你在银河系漫游久了就知道，带点自己母星的口音再正常不过了。不过Cozmo的一些自言自语我还不大能听懂，《银河系漫游指南》里也没做记载。&lt;/p&gt;
&lt;h2 id="_4"&gt;交互&lt;/h2&gt;
&lt;p&gt;新版的app(我的当前版本是2.0.2)相比1.0有明显调整，显著的变化是更强调陪伴和共同成长。它就像你的宠物一样，你得注意它是不是生病了(需要修复)，是不是饿了(给它喂食)，如果它饥寒交加，身体不适，它是拒绝同你一起做游戏的.&lt;/p&gt;
&lt;h3 id="_5"&gt;被驯服的小狐狸&lt;/h3&gt;
&lt;p&gt;Cozmo有时候像一只被驯服的小狐狸&lt;/p&gt;
&lt;p&gt;有一回小狐狸对小王子解释&lt;code&gt;驯服&lt;/code&gt;二字的含义(《小王子》)&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;这是已经早就被人遗忘了的事情……它的意思就是'建立联系'……对我来说，你还只是一个小男孩，就像其他千万个小男孩一样。我不需要你,你也同样用不着我。对你来说，我也不过是一只狐狸，和其他千万只狐狸一样。但是，如果你驯服了我，我们就互相不可缺少了。对我来说，你就是世界上唯一的了；我对你来说，也是世界上唯一的了。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;你们相处愉快，每天一起玩耍，它虽时而捣蛋，在你忧愁的时候也是很乐意取悦你的，你可以要求它：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Cozmo给我表演一下叠罗汉&lt;/li&gt;
&lt;li&gt;Cozmo我要看你鲤鱼打挺&lt;/li&gt;
&lt;li&gt;Cozmo过来我们击个拳&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;cozmo的技能树十分丰富，需要你和它共同点亮&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/cozmo12cebfe0.png" /&gt;&lt;/p&gt;
&lt;h3 id="_6"&gt;一起做游戏&lt;/h3&gt;
&lt;p&gt;Cozmo自娱自乐玩腻了，会主动邀请你跟它一起玩游戏，就像你儿时玩伴那样。cozmo随身携带的三个积木，将成为你们的游戏道具，你们将狭路相逢，比拼记忆力或反应速度，调动你的肌肉和大脑，记得当心Cozmo的小心思！它可是会耍诈的&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/cozmo8de54d8a.png" /&gt;&lt;/p&gt;
&lt;p&gt;做游戏时，你会注意到Cozmo的表情变化非常微妙，在游戏中聚精会神，不时皱起眉头思考。小胜一局，虽不至手舞足蹈，却也是难掩喜悦之情，眼睛弯成了月牙，若大获全胜，便开心得非原地大转三圈不可。如果你技高一筹，Cozmo极是不甘，愁眉苦脸也只是一时之态，一会儿便重振旗鼓，立马拉着你再战一局，像不像被你带着打排位赛却铩羽而归的徒弟&lt;/p&gt;
&lt;h3 id="_7"&gt;听我指挥&lt;/h3&gt;
&lt;p&gt;Cozmo想不想当将军我不清楚，但据我所知，它目前是一个好士兵(听从指挥)&lt;/p&gt;
&lt;p&gt;你可以用三种方式指挥cozmo:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在app中拖拽积木来指挥cozmo(用到blockly)&lt;/li&gt;
&lt;li&gt;在Explorer模式下驾驶cozmo&lt;/li&gt;
&lt;li&gt;使用SDK为Cozmo编程&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我们先来说说第一种，在app中拖拽积木来指挥cozmo&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/cozmo63e5b91e.png" /&gt;&lt;/p&gt;
&lt;p&gt;在这个被称为&lt;code&gt;Code Lab&lt;/code&gt;的界面里，包含了许多用来控制cozmo的积木。你可以让Cozmo前进两步，然后左拐避开前方的障碍物(一袋咖啡)，再前进，像这样&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/cozmof70f49bd.png" /&gt;&lt;/p&gt;
&lt;p&gt;你也可以把它放在餐桌上，环顾四周，清点下用餐人数，然后告诉服务员要几份米饭。 这个任务稍微复杂些，会用到视觉、语音和移动模块，但即便是一个不识字的小孩，操作起来也无碍。所有的编程积木都带有形象化的图案，一目了然&lt;/p&gt;
&lt;h3 id="_8"&gt;小鬼当家&lt;/h3&gt;
&lt;p&gt;我大约9岁那年看了小鬼当家，对其中带有摄像头的遥控车念念不忘。&lt;/p&gt;
&lt;p&gt;9岁的时候不是那种能做到&lt;code&gt;想要的都拥有，得不到的都释怀&lt;/code&gt;的小孩，这件事一直放在心上，后来看到&lt;code&gt;带有摄像头的遥控车&lt;/code&gt;总忍不住要多看几眼，但都不是心里想要的，要么太过笨重，要么不够好看，机身如此不够灵巧，摄像头如此昭然若揭，这可怎么和坏人斗智斗勇&lt;/p&gt;
&lt;p&gt;直到在Cozmo中发现它的Explorer模式，才有&lt;code&gt;终于等到你&lt;/code&gt;的感觉。&lt;/p&gt;
&lt;p&gt;在Explorer模式中，你可以驾驶着Cozmo在自家的庭院或房间里冒险。&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/cozmo858d7212.png" /&gt;&lt;/p&gt;
&lt;p&gt;你拉上窗帘，手握ipad，如坐在星际战舰的指挥室里，窗外的星光稀疏极了，毕竟身处银河系荒凉偏僻的旋臂上。屏幕里展示着Cozmo从前线发来的视频信号。屏幕上光线晦暗，你手握方向盘，指挥着cozmo继续探索这片应许之地,突然，屏幕中一闪而过一个庞然大物，距离近时，身躯之大，足足占了屏幕的1/3。而动作敏捷，倏忽之间，跃出屏幕之外，来去无影，着实吓了你一跳。气势真如沈复说的"忽有庞然大物，拔山倒树而来"。待你定下神来，操控Cozmo追踪不明生物，竟破解了一个惊天谜团&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;妈，你早上买的鱼被我们家的猫偷藏在床底下了，人赃俱获，我已经用Cozmo拍到它躲在床底下吃鱼的照片了&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;刘瑜在《送你一颗子弹》中感慨:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;15岁的时候再得到那个5岁的时候热爱的洋娃娃，65岁的时候终于有钱买25岁的时候热爱的那条裙子，又有什么意义呢？&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这句话对我不大适用，我终于遇到9岁的时热爱的遥控车之后，恨不能像Cozmo一样原地大转三圈&lt;/p&gt;
&lt;h3 id="code"&gt;code!&lt;/h3&gt;
&lt;p&gt;如果cozmo预设的所有功能都不足以填满你的脑洞，那么你就应该撸起袖子开始编程了。代码可能是这个星球上可玩性最高的玩具。&lt;/p&gt;
&lt;p&gt;cozmo为你准备好了&lt;a href="https://github.com/anki/cozmo-python-sdk"&gt;cozmo-python-sdk&lt;/a&gt;，有了它，你就可以使用Python来驱动Cozmo，如果你愿意，可以接入OpenCV或是TensorFlow，社区已经有人用Tensorflow CNN 训练出来的模型自动驾驶cozmo了。&lt;/p&gt;
&lt;p&gt;下边我们来看看怎么用代码驱动Cozmo&lt;/p&gt;
&lt;p&gt;首先在你的app中启动SDK模式&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/cozmo6f84d476.png" /&gt;&lt;/p&gt;
&lt;p&gt;接着就可以在你的电脑上用python来为Cozmo编程。关于这块的原理我们今后再聊，Cozmo在易用性和灵活性上花了很多功夫，编程体验很惊艳&lt;/p&gt;
&lt;p&gt;下边这个例子是官方源码里包含的示例，源码如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;asyncio&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;

&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;cozmo&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;light_when_face&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;robot&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;cozmo&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;robot&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Robot&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;#39;&amp;#39;&amp;#39;The core of the light_when_face program&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;

    &lt;span class="c1"&gt;# Move lift down and tilt the head up&lt;/span&gt;
    &lt;span class="n"&gt;robot&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;move_lift&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;robot&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_head_angle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cozmo&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;robot&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;MAX_HEAD_ANGLE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;wait_for_completed&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="n"&gt;face&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;

    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Press CTRL-C to quit&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;face&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;face&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;is_visible&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;robot&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_all_backpack_lights&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cozmo&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lights&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;blue_light&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;robot&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_backpack_lights_off&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

            &lt;span class="c1"&gt;# Wait until we we can see another face&lt;/span&gt;
            &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="n"&gt;face&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;robot&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;world&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;wait_for_observed_face&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;timeout&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;30&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="n"&gt;asyncio&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;TimeoutError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Didn&amp;#39;t find a face.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                &lt;span class="k"&gt;return&lt;/span&gt;

        &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="n"&gt;cozmo&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run_program&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;light_when_face&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;use_viewer&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;force_viewer_on_top&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这段代码实现了这样一个功能: 当cozmo的视觉系统识别到人脸时(对应代码&lt;code&gt;if face and face.is_visible:&lt;/code&gt;)，将背部的灯设置为蓝色(对应代码&lt;code&gt;robot.set_all_backpack_lights(cozmo.lights.blue_light)&lt;/code&gt;)。即使你没有编程经验，也能大致看懂上边这段代码在干嘛，这也是Cozmo的作者选择Python的原因，这门编程语音以接近自然语言(英语)的方式来书写，让你轻松上手。&lt;/p&gt;
&lt;p&gt;就这点而言，Cozmo也是入门编程的理想工具(这是一种反馈强烈的编程体验，让你乐在其中，而不至于被语法和逻辑吓跑)&lt;/p&gt;
&lt;p&gt;我们来看看代码实现的效果:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/cozmo00576e90.png" /&gt;&lt;/p&gt;
&lt;p&gt;当然你可以发挥想象，将代码改造为：当Cozmo识别到人脸时，主动给你发一封邮件,如此一来在你们一家人出旅行时，它就负责看家&lt;/p&gt;
&lt;p&gt;又或者，你可以驱动它走到门口迎接找你玩的小伙伴，看到小伙伴时(&lt;code&gt;if face and face.is_visible&lt;/code&gt;)打个招呼，接着让Cozmo带他到你的卧室&lt;/p&gt;
&lt;h2 id="_9"&gt;后续&lt;/h2&gt;
&lt;p&gt;接下来的一段时间，我准备做一次长途路行，途中会继续写Cozmo系列文章&lt;/p&gt;
&lt;p&gt;选材原则是有趣，具体内容待定，大概会和机器视觉、语音识别、积木化编程(blockly)、编程教育相关&lt;/p&gt;
&lt;p&gt;如果你有好的想法，关于想用Cozmo做好玩的东西，欢迎给我邮件(wuwenjie718@gmail.com)，我在途中所经之处，只要有网络，每晚都会查阅邮件 : )&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Wed, 18 Oct 2017 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2017-10-18:cozmo-hello-world.html</guid><category>cozmo</category></item><item><title>对webduino运行流程的分析</title><link>/webduino-analysis.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/webduinoee40c06e.png" /&gt;&lt;/p&gt;
&lt;h1 id="_1"&gt;背景&lt;/h1&gt;
&lt;p&gt;在前一篇关于blockly的文章中，我参考了webduino对Web Speech的包装，并将其移植到blockly4pi中。&lt;/p&gt;
&lt;p&gt;webduino对blockly的使用，有许多出彩的地方。这篇文章将简要对其核心部分做个分析，为了更深入地借鉴它的设计&lt;/p&gt;
&lt;h1 id="_2"&gt;入手&lt;/h1&gt;
&lt;p&gt;我买了webduino的smart模块，所以我们从最简单的案例入手：将smart的led灯设为红色&lt;/p&gt;
&lt;p&gt;首先当然是将smart连上wifi，完成后它分配到网址:&lt;code&gt;192.168.0.119&lt;/code&gt;（显示在wifi名称中）&lt;/p&gt;
&lt;p&gt;接着我们拼搭出积木块&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/webduino5a6e33a8.png" /&gt;&lt;/p&gt;
&lt;p&gt;运行后，成功点亮红灯&lt;/p&gt;
&lt;h1 id="_3"&gt;分析&lt;/h1&gt;
&lt;p&gt;首先查看上边的积木生成的代码:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;rgbled&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="nx"&gt;boardReady&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="nx"&gt;board&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Smart&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;url&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;192.168.0.119&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;board&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="nx"&gt;board&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;systemReset&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
  &lt;span class="nx"&gt;board&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;samplingInterval&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="nx"&gt;rgbled&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;getRGBLedCathode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;board&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="nx"&gt;rgbled&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setColor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;#ff0000&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可以看到webduino通过积木生成js代码, 然后运行js代码来控制start.(我的blockly4pi同时生成js和python)&lt;/p&gt;
&lt;p&gt;容易看出,boardReady是浏览器与start通信的代理,接着我们进入&lt;a href="https://github.com/webduinoio/webduino-blockly"&gt;源码&lt;/a&gt;,去跟踪&lt;code&gt;boardReaety&lt;/code&gt;,它定义在&lt;a href="https://github.com/webduinoio/webduino-blockly/blob/19e40f0108e72dbd08628705a1e4fad9c3ccab7e/webduino-blockly.js#L21"&gt;这里&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  &lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;boardReady&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;options&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;autoReconnect&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;callback&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;callback&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;typeof&lt;/span&gt; &lt;span class="nx"&gt;autoReconnect&lt;/span&gt; &lt;span class="o"&gt;===&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;function&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;?&lt;/span&gt; &lt;span class="nx"&gt;autoReconnect&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;callback&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="nx"&gt;index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;boards&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nx"&gt;board&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;createBoard&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;options&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="nx"&gt;terminate&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;board&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="k"&gt;delete&lt;/span&gt; &lt;span class="nx"&gt;boards&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;index&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
    &lt;span class="nx"&gt;boards&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;splice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;index&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;autoReconnect&lt;/span&gt; &lt;span class="o"&gt;===&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;setTimeout&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;boardReady&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;options&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;autoReconnect&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;callback&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="mi"&gt;5000&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;};&lt;/span&gt;

    &lt;span class="nx"&gt;board&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;once&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;webduino&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;BoardEvent&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;ERROR&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;err&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;board&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;isConnected&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;board&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;once&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;webduino&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;BoardEvent&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;DISCONNECT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;terminate&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="nx"&gt;board&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;disconnect&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;terminate&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;});&lt;/span&gt;

    &lt;span class="nx"&gt;board&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;once&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;webduino&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;BoardEvent&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;READY&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;callback&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="nx"&gt;boards&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;push&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;board&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;其中board定义在&lt;a href="https://github.com/webduinoio/webduino-js/blob/master/src/core/Board.js#L63"&gt;Board&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;通过&lt;a href="https://github.com/webduinoio/webduino-js/blob/44023cf71ef3fcf3a618f7abab6d69ee17de9000/src/core/EventEmitter.js#L14"&gt;EventEmitter&lt;/a&gt;传递全局消息&lt;/p&gt;
&lt;h3 id="_4"&gt;休眠一秒&lt;/h3&gt;
&lt;p&gt;在js中休眠是个有趣的话题，我们知道js是非阻塞的,webduino使用await来实现(很新的特性，之后会通过babel来在浏览器里编译，后文再说)&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/webduinoee40c06e.png" /&gt;&lt;/p&gt;
&lt;p&gt;对应的代码是&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;async&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;

&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;rgbled&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;


&lt;span class="nx"&gt;boardReady&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="nx"&gt;board&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Smart&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;url&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;192.168.0.119&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="nx"&gt;async&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;board&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="nx"&gt;board&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;systemReset&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
  &lt;span class="nx"&gt;board&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;samplingInterval&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="nx"&gt;await&lt;/span&gt; &lt;span class="nx"&gt;delay&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="nx"&gt;rgbled&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;getRGBLedCathode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;board&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="nx"&gt;rgbled&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setColor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;#ff0000&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;

&lt;span class="p"&gt;}());&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这部分很有意思，我们仅仅添加一个等待一秒的模块，生成的代码结构整体变了，新添加的模块并不特殊，它生成的代码为&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nx"&gt;Blockly&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;JavaScript&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;delay&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;block&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;value_secs_&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;Blockly&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;JavaScript&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;valueToCode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;block&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;secs_&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;Blockly&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;JavaScript&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;ORDER_NONE&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;code&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;await delay(&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;value_secs_&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;);\n&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
          &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;code&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可以推测，代码在generate之前有个预处理,大概是根据generate出来的代码里是够包含&lt;code&gt;await&lt;/code&gt;关键字来处理，我们可以搜索源码来验证我们的想法:&lt;a href="https://github.com/webduinoio/webduino-blockly/search?utf8=%E2%9C%93&amp;amp;q=await&amp;amp;type="&gt;search await&lt;/a&gt;,果不其然&lt;/p&gt;
&lt;h1 id="_5"&gt;代码执行&lt;/h1&gt;
&lt;h3 id="_6"&gt;早期&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://github.com/webduinoio/webduino-blockly/blob/0b52eb33696834137630aaf9bcbb2547982f7be9/components/blockly-src/demos/code/code.js#L503"&gt;blockly-src/demos/code/code.js Code.runJS&lt;/a&gt;这个好理解,早期的做法，目前被废弃&lt;/p&gt;
&lt;p&gt;早期的执行机制如注释中说的&lt;code&gt;Just a quick and dirty eval&lt;/code&gt;，简单粗暴&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;code&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;Blockly&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;JavaScript&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;workspaceToCode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;Code&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;workspace&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="nx"&gt;Blockly&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;JavaScript&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;INFINITE_LOOP_TRAP&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="nb"&gt;eval&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;code&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="nx"&gt;alert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;MSG&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;badCode&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;].&lt;/span&gt;&lt;span class="nx"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;%1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;后来的机制颇为费解&lt;/p&gt;
&lt;h3 id="_7"&gt;后来的机制&lt;/h3&gt;
&lt;p&gt;我们可以从&lt;a href="https://github.com/webduinoio/webduino-blockly/blob/19e40f0108e72dbd08628705a1e4fad9c3ccab7e/code.js#L876"&gt;bindClick runButton&lt;/a&gt;追踪起、经过&lt;a href="https://github.com/webduinoio/webduino-blockly/blob/19e40f0108e72dbd08628705a1e4fad9c3ccab7e/code.js#L1019"&gt;Code.reloadSandbox()&lt;/a&gt;,在这个函数中将模块generate为代码:&lt;a href="https://github.com/webduinoio/webduino-blockly/blob/19e40f0108e72dbd08628705a1e4fad9c3ccab7e/code.js#L1165"&gt;Code.getContext&lt;/a&gt;,generate的过程会判断是否需要使用babel编译，如果需要会做好编辑，在之后的程序中用babel编译它:&lt;a href="https://github.com/webduinoio/webduino-blockly/blob/19e40f0108e72dbd08628705a1e4fad9c3ccab7e/code.js#L1183"&gt;Code.transform&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;如此一来我们就得到了可在普通浏览器里运行的js代码,如果是早期的做法，至此丢到eval里就结束了，目前的做法要复杂些，把代码丢到一个iframe中跑,用到了&lt;a href="https://github.com/bahmutov/iframe-api"&gt;iframe-api&lt;/a&gt; (本质上是window.postMessage)&lt;/p&gt;
&lt;p&gt;一些核心步骤如下:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/webduinoio/webduino-blockly/blob/19e40f0108e72dbd08628705a1e4fad9c3ccab7e/code.js#L1102"&gt;launcher.sandbox(frame, data);&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/webduinoio/webduino-blockly/blob/19e40f0108e72dbd08628705a1e4fad9c3ccab7e/launcher.js#L132"&gt;sandbox: function (frame, data) &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="_8"&gt;通信过程&lt;/h1&gt;
&lt;h3 id="websocket"&gt;websocket&lt;/h3&gt;
&lt;p&gt;我们先关注采用websocket的通信过程(本地运行)&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/webduinoio/webduino-js/blob/44023cf71ef3fcf3a618f7abab6d69ee17de9000/src/transport/WebSocketTransport.js#L43"&gt;onmessage handle&lt;/a&gt;定义了收到smart数据的回调&lt;/p&gt;
&lt;p&gt;值得注意的是，数据的传输使用了二进制数据&lt;/p&gt;
&lt;p&gt;之后通过事件系统发布消息,emit的定义之处在&lt;a href="https://github.com/webduinoio/webduino-js/blob/44023cf71ef3fcf3a618f7abab6d69ee17de9000/src/core/EventEmitter.js#L36"&gt;EventEmitter emit&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ps:使用mqtt与云端通信的部分在这 &lt;a href="https://github.com/webduinoio/webduino-js/blob/44023cf71ef3fcf3a618f7abab6d69ee17de9000/src/transport/MqttTransport.js"&gt;MqttTransport.js&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="_9"&gt;控制流&lt;/h1&gt;
&lt;p&gt;有了上边这些探索，我们可以挑战最后一个问题了，控制指令是如何抵达smart的，拿最初的例子来说，把点亮红灯积木块跑起来的时候发生了什么？&lt;/p&gt;
&lt;p&gt;首先是积木生成对应的代码&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  &lt;span class="nx"&gt;rgbled&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;getRGBLedCathode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;board&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="nx"&gt;rgbled&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setColor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;#ff0000&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;board我们在前头说过，检索源码发现&lt;a href="https://github.com/webduinoio/webduino-blockly/blob/19e40f0108e72dbd08628705a1e4fad9c3ccab7e/webduino-blockly.js#L207"&gt;getRGBLedCathode&lt;/a&gt;不过是对&lt;code&gt;webduino.module.RGBLed&lt;/code&gt;的包装&lt;/p&gt;
&lt;p&gt;于是我们到&lt;a href="https://github.com/webduinoio/webduino-js"&gt;webduino-js&lt;/a&gt;继续探索.我们沿着&lt;code&gt;rgbled.setColor('#ff0000');&lt;/code&gt;一路追踪下去，看到&lt;a href="https://github.com/webduinoio/webduino-js/blob/master/src/module/DataTransfer.js"&gt;DataTransfer.js&lt;/a&gt;  , webduino采用二进制来通信，发送数据的地方定义在&lt;a href="https://github.com/webduinoio/webduino-js/blob/master/src/core/Board.js#L819"&gt;send&lt;/a&gt; -&amp;gt; &lt;a href="https://github.com/webduinoio/webduino-js/blob/44023cf71ef3fcf3a618f7abab6d69ee17de9000/src/transport/WebSocketTransport.js#L56"&gt;sendOut&lt;/a&gt; 在此我们可以看到数据的发送也是用的二进制（收发都是)&lt;/p&gt;
&lt;h1 id="_10"&gt;其他感兴趣的地方&lt;/h1&gt;
&lt;h3 id="_11"&gt;与页面元素交互&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://github.com/webduinoio/webduino-blockly/blob/19e40f0108e72dbd08628705a1e4fad9c3ccab7e/generators/webduino.js#L54"&gt;demo_light_click generator&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="_12"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://javascript.ruanyifeng.com/stdlib/arraybuffer.html"&gt;JavaScript 标准参考教程 二进制数组&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.villainhr.com/page/2017/04/16/Web%20%E7%9B%B4%E6%92%AD%E6%B5%81%E7%9A%84%E8%A7%A3%E6%9E%90"&gt;Web 直播流的解析&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Sun, 21 May 2017 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2017-05-21:webduino-analysis.html</guid><category>rpi</category></item><item><title>在blockly中构建语音识别/合成 积木块</title><link>/blockly-sound_recognition.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/speech_block9f7d476a.png" /&gt;&lt;/p&gt;
&lt;h1 id="_1"&gt;背景&lt;/h1&gt;
&lt;p&gt;近期在完善blockly4pi中AI的相关部分，语音和图像/视频流是常见的输入，语音的输入之前计划在硬件积木那边采集，之后流向树莓派，交由树莓派来处理，不过协议因此变得复杂许多，一番权衡之下，我们决定在浏览器里来处理多媒体输入&lt;/p&gt;
&lt;p&gt;我一直在关注浏览器中的webRTC和Web Speech，之前在几个项目中也接触过它们,这些接口现在越发强大了，而且浏览器的支持也在变好&lt;/p&gt;
&lt;h1 id="web-speech"&gt;Web Speech&lt;/h1&gt;
&lt;p&gt;HTML5中和Web Speech相关的API有两类, 一类是"语音合成(Speech Synthesis)"，一类是"语音识别(Speech Recognition)",无论哪种,使用起来都非常简单. &lt;/p&gt;
&lt;h3 id="_2"&gt;语音合成&lt;/h3&gt;
&lt;p&gt;之前语音合成我一直用百度语音来做，效果还不错，不过多了一层网络请求.&lt;/p&gt;
&lt;p&gt;Chrome 浏览器在版本25之后开始支持这一特性，效果非常棒.你可以调出你的控制台,让浏览器说: '你好,世界',像下边这样:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;utterThis&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;SpeechSynthesisUtterance&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;你好，世界！&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;speechSynthesis&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;speak&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;utterThis&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;神奇的是，竟然没有用到云服务，完全在本地完成!&lt;/p&gt;
&lt;h3 id="_3"&gt;语音识别&lt;/h3&gt;
&lt;p&gt;相比于语音合成，语音识别还有些坑。&lt;/p&gt;
&lt;p&gt;我们先来说下它的简单用法&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;newRecognition&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;webkitSpeechRecognition&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;span class="nx"&gt;newRecognition&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;onresult&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;event&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;event&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nx"&gt;newRecognition&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;start&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;上边短短的几行，你就完成了浏览器调用麦克风，等待语音输入到结果输出的完成流程&lt;/p&gt;
&lt;p&gt;如果你只是想拿到输出结果的内容，可以这样:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;newRecognition&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;webkitSpeechRecognition&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;span class="c1"&gt;//newRecognition.continuous = false;&lt;/span&gt;
&lt;span class="nx"&gt;newRecognition&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;onresult&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;event&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="c1"&gt;//console.log(event);&lt;/span&gt;
        &lt;span class="nx"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;event&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;results&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
        &lt;span class="nx"&gt;transcript&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;result&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;transcript&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;transcript&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nx"&gt;newRecognition&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;start&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;识别结果比较理想&lt;/p&gt;
&lt;h4 id="_4"&gt;坑&lt;/h4&gt;
&lt;p&gt;有个恼人的坑是，识别开始后，浏览器有时候一直在等待输入，而无法返回识别结果（可能是墙的原因），这种情况时常发生，而且在各个平台下(mac/windows)下都是如此&lt;/p&gt;
&lt;p&gt;不过在chrome的开发版(canary)中一切正常,我的当前版本号是:&lt;code&gt;60.0.3099.0（正式版本）canary （64 位&lt;/code&gt;&lt;/p&gt;
&lt;h1 id="blockly"&gt;包装成blockly积木块&lt;/h1&gt;
&lt;p&gt;为了将其纳入到blockly4pi体系中，我们需要将Web Speech包装为blockly积木块&lt;/p&gt;
&lt;p&gt;语音合成部分比较简单,在积木中接受用户输入，传到api中即可，@dsl已经完成了这个工作&lt;/p&gt;
&lt;p&gt;语音识别部分会比较麻烦，在上边的语音识别示例代码里，我们看到对语音的识别结果出现在&lt;code&gt;onresult&lt;/code&gt;事件回调的函数里，这样一来控制流就不是线性的了(哈哈 在js中这才是常态)，如何在blockly中表达变达这种控制流，是个值得思考的问题&lt;/p&gt;
&lt;p&gt;熟悉js的同学会觉得思路上不难，可要在blockly中表达也没有很容易，首先得熟悉blockly的表达习惯和api,有些部分涉及比较高级的api&lt;/p&gt;
&lt;p&gt;这个问题webduino团队给出了漂亮的解答，我们稍后对其&lt;a href="https://github.com/webduinoio/webduino-blockly"&gt;源码&lt;/a&gt;做个分析&lt;/p&gt;
&lt;h3 id="_5"&gt;源码分析&lt;/h3&gt;
&lt;p&gt;熟悉blockly的小伙伴，很轻松能定位到目标积木块的源码(我们只关注sound_recognition块，其他块相对简单)&lt;/p&gt;
&lt;p&gt;在注释中我们找到了积木块的生成方式：&lt;a href="https://blockly-demo.appspot.com/static/demos/blockfactory/index.html#shuqaz"&gt;sound_recognition blockfactory&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/sound_blockfccbdea4.png" /&gt;&lt;/p&gt;
&lt;p&gt;积木外观由以下代码定义:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Blockly.Blocks[&amp;#39;sound_recognition&amp;#39;] = {
  init: function() {
    this.appendDummyInput()
        .appendField(&amp;quot;開始語音辨識 ( Chrome 限定，不支援 iOS )&amp;quot;);
    this.appendDummyInput()
        .appendField(&amp;quot;辨識語言：&amp;quot;)
        .appendField(new Blockly.FieldDropdown([[&amp;quot;中文&amp;quot;,&amp;quot;cmn-Hant-TW&amp;quot;], [&amp;quot;English&amp;quot;,&amp;quot;en-US&amp;quot;]]), &amp;quot;lang_&amp;quot;)
        .appendField(&amp;quot;    即時辨識：&amp;quot;)
        .appendField(new Blockly.FieldDropdown([[&amp;quot;on&amp;quot;,&amp;quot;on&amp;quot;], [&amp;quot;off&amp;quot;,&amp;quot;off&amp;quot;]]), &amp;quot;interimResults_&amp;quot;)
        .appendField(&amp;quot;( 行動裝置勾選 off )&amp;quot;);
    this.appendStatementInput(&amp;quot;recognition_&amp;quot;);
    this.setPreviousStatement(true);
    this.setNextStatement(true);
    this.setTooltip(&amp;#39;&amp;#39;);
    this.setHelpUrl(&amp;#39;&amp;#39;);
  }
};
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;(以js为例)拿到积木中的用户的输入很简单:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Blockly.JavaScript[&amp;#39;sound_recognition&amp;#39;] = function(block) {
  var dropdown_lang_ = block.getFieldValue(&amp;#39;lang_&amp;#39;);
  var dropdown_interimresults_ = block.getFieldValue(&amp;#39;interimResults_&amp;#39;);
  var statements_recognition_ = Blockly.JavaScript.statementToCode(block, &amp;#39;recognition_&amp;#39;);
  // TODO: Assemble JavaScript into code variable.
  var code = &amp;#39;...;\n&amp;#39;;
  return code;
};
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;其中&lt;code&gt;statements_recognition_&lt;/code&gt;值得留意&lt;/p&gt;
&lt;p&gt;至此整个积木块已经完成，只剩下最后也最核心的问题了，sound_recognition是如何来generate出代码的，上边提到的回调的问题也是在这里处理&lt;/p&gt;
&lt;p&gt;直接上代码更直观些: &lt;a href="https://github.com/webduinoio/webduino-blockly/blob/19e40f0108e72dbd08628705a1e4fad9c3ccab7e/generators/webduino.js#L1727"&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;抛开辅助性的代码，我们看到最核心的部分是&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &amp;#39;    window._recognition.onresult = async function(event,result) {\n&amp;#39; +
    &amp;#39;      result = {};\n&amp;#39; +
    &amp;#39;      result.resultLength = event.results.length-1;\n&amp;#39; +
    &amp;#39;      result.resultTranscript = event.results[result.resultLength][0].transcript;\n&amp;#39; +
    &amp;#39;      if(event.results[result.resultLength].isFinal===&amp;#39; + inter1 + &amp;#39;){\n&amp;#39; +
    &amp;#39;        console.log(result.resultTranscript);\n&amp;#39; +
    &amp;#39;        &amp;#39; + statements_recognition_ +
    &amp;#39;        &amp;#39; + consoleFinal1 +
    &amp;#39;      }else if(event.results[result.resultLength].isFinal===&amp;#39; + inter2 + &amp;#39;){\n&amp;#39; +
    &amp;#39;        &amp;#39; + consoleFinal2 +
    &amp;#39;      }\n&amp;#39; +
    &amp;#39;    };\n&amp;#39; +
    &amp;#39;    window._recognition.start();\n&amp;#39; +
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;特别注意&lt;code&gt;statements_recognition_&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;顺便吐个槽，尽管code的拼接极尽排版的工整，但读起来还是不舒服，用es6的模版字符串来写会好看很多&lt;/p&gt;
&lt;h1 id="_6"&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://javascript.ruanyifeng.com/htmlapi/webspeech.html"&gt;Web Speech&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/webduinoio/webduino-blockly"&gt;webduino-blockly&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Fri, 12 May 2017 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2017-05-12:blockly-sound_recognition.html</guid><category>rpi</category></item><item><title>嘿 Siri 关灯</title><link>/rpi-siri-close-light.html</link><description>&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/siri17469bd4.png" /&gt;&lt;/p&gt;
&lt;h1 id="_1"&gt;引言&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;你在南方的艳阳里大雪纷飞,我在北方的寒夜里四季如春&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;马頔的这句歌词，道尽南方人过冬的艰辛。在没有暖气的南方，过冬基本靠抖腿和一身正气&lt;/p&gt;
&lt;p&gt;我们以高中诗词鉴赏的套路来剖析下词作，"你在南方的艳阳里大雪纷飞"当然不是直白地描述一场太阳雪,艺术要有含蓄美。这句话实际上说的是"你"在南方灯如暖阳的房间里，忘穿秋裤，冻得像雪地里呆呆的兔子（由此可见这个灯是白炽灯而不是节能灯，节能灯如白月光而不似暖阳）&lt;/p&gt;
&lt;p&gt;如果你有兴趣深挖，会进一步坚定艳阳指的就是灯。小如洞穴的房间、灯与影子，不由让人想到柏拉图的洞穴理论，作者进而感慨现实世界的不真实性，于是有后边的"穷极一生做不完一场梦"&lt;/p&gt;
&lt;p&gt;至于如果题目问"你"指的是谁，你最好不要答前女友，其他随意，以免勾起阅卷老师伤感的回忆，给你个悲伤的分数&lt;/p&gt;
&lt;p&gt;在灯如暖阳床如霜的南方夜晚，你刚看完《汇编语言从入门到放弃》，准备起床关灯睡觉，却对被子依依不舍。这时你想：要是对着Siri说一声&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;嘿siri，宝宝困了帮我关灯么么哒&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;便可睡觉该是多美的场景&lt;/p&gt;
&lt;p&gt;又或者 圣诞夜你和你的小女朋友在被窝里讨论拉普拉斯变换或是傅里叶变换，可窗帘没拉，灯太亮影响发挥。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;嘿Siri关灯并闭上眼睛&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;让我们撸起袖子来实现它&lt;/p&gt;
&lt;h1 id="_2"&gt;思路&lt;/h1&gt;
&lt;p&gt;我不建议你给房间换一个智能灯泡，也不打算向你推销一套年底特价智能家居解决方案，我们延续之前的思路(&lt;a href="http://blog.just4fun.site/raspberrypi-lirc.html"&gt;用树莓派给家用电器加上智能&lt;/a&gt;)，尽量用非入侵的方式来解决问题，不去破坏和替换现有的设备&lt;/p&gt;
&lt;p&gt;于是我们就提出这样一个问题：如何在不改变现有灯泡特性、电路结构和开关特性的情况下，来关灯？&lt;/p&gt;
&lt;p&gt;能想到的方案似乎只有模拟人手的动作，以机械的方式来按下开关&lt;/p&gt;
&lt;p&gt;"舵机"就是我们的首选了&lt;/p&gt;
&lt;p&gt;剩下的就是如何躺在床上控制舵机来关灯，与硬件世界打交道，树莓派是我偏好的工具。树莓派控制舵机不成问题，至于如何用手机控制树莓派，我也在此前的文章中论述过&lt;/p&gt;
&lt;p&gt;不过本文将采用更酷的方式，你将无需编程，通过拖曳积木化的模块，就可以搭建出关灯机器人，然后通过siri控制这个机器人,如此一来你可以用自然语言的方式给siri发送关灯命令&lt;/p&gt;
&lt;p&gt;这个方案拓展开，我们几乎可以控制所有的按键式开关&lt;/p&gt;
&lt;p&gt;自然语言处理这部分Siri帮我们做了，之后有机会我们自己来实现，听起来有点像最近怒刷各种技术社区的&lt;a href="https://m.toutiao.com/i6366879371965235714/?tt_from=weixin_moments&amp;amp;utm_campaign=client_share&amp;amp;app=news_article&amp;amp;utm_source=weixin_moments&amp;amp;iid=6814510930&amp;amp;utm_medium=toutiao_android&amp;amp;wxshare_count=2&amp;amp;pbid=31547628651&amp;amp;from=timeline&amp;amp;isappinstalled=0"&gt;Jarvis&lt;/a&gt; --扎尔伯格用人工智能控制家居的项目&lt;/p&gt;
&lt;h1 id="_3"&gt;准备工作&lt;/h1&gt;
&lt;h3 id="_4"&gt;硬件部分&lt;/h3&gt;
&lt;p&gt;硬件部分包括：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;树莓派&lt;/li&gt;
&lt;li&gt;舵机&lt;/li&gt;
&lt;li&gt;长导线&lt;/li&gt;
&lt;li&gt;移动电源&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/siri56e654b0.png" /&gt;&lt;/p&gt;
&lt;p&gt;组件不多，考虑到电灯开关的位置一般齐胸，而树莓派和移动电源(供电)放在地上，所以你需要三根长导线，而不是普通的杜邦线，和往常一样，长导线这种东西都是从万能的@李老师的万能的实验室里要来的,感谢@李老师一直以来的助攻&lt;/p&gt;
&lt;p&gt;下边我们对各个部分做个简单介绍：&lt;/p&gt;
&lt;h4 id="_5"&gt;树莓派&lt;/h4&gt;
&lt;p&gt;关于树莓派，可以参考我此前的文章:&lt;a href="http://blog.just4fun.site/raspberrypi-install-and-config.html"&gt;树莓派折腾笔记之系统安装与配置&lt;/a&gt;.入门新手会遇到的问题我基本都列出了&lt;/p&gt;
&lt;p&gt;我也翻译了一份&lt;a href="https://github.com/wwj718/awesome-raspberry-pi-zh"&gt;树莓派(Raspberry Pi)资源大全中文版&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;供大家玩耍时参考&lt;/p&gt;
&lt;h4 id="_6"&gt;舵机&lt;/h4&gt;
&lt;p&gt;我买的是淘宝上的SG90 9g舵机，价格6块多,关于舵机的控制原理比较麻烦，李老师跟我描述过，我听个大概，不过不影响，去网上抄段程序修修改改，封装为黑盒函数基本能用，有空在细看这块&lt;/p&gt;
&lt;p&gt;简单介绍下舵机上的几根线:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;红色：电压&lt;/li&gt;
&lt;li&gt;粽色：地线&lt;/li&gt;
&lt;li&gt;橙色：信号线&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我把信号线接到18号引脚(BCM) ，查看gpio图：&lt;code&gt;gpio readall&lt;/code&gt;&lt;/p&gt;
&lt;h4 id="_7"&gt;李老师&lt;/h4&gt;
&lt;p&gt;顺便也介绍些李老师.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;李老师其实不是我的老师,我毕业后才认识他，我从李老师这边学到很多硬件知识，从传道解惑的角度来说，李老师确是我的老师&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;李老师南大博士毕业后，在大学执教，他博士阶段读的是图像识别，但他是个彻头彻尾的硬件黑客&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;李老师的实验室黑科技齐全，哆啦A梦口袋一般，有求必应&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;李老师常说的话有这样一种模式："没事没事，xx功能的电子设备买不到也没事，我们自己画，等印刷完，你过来取". 我们有个有趣的项目，硬件部分都是李老师画的&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;迄今 只有一次例外: 有一回李老师在论述分布式节点的连接策略时，我有点开小差，状态类似"一人虽听之 一心以为有鸿鹄将至 思援弓缴而射之". 我突然想要一个无线开关来控制我那不够智能的油汀，以便于用树莓派控制它。而李老师也和往常一样，一边论述一边离题，岔到其他他感兴趣的话题:这回是关于如何把无线模块画得更小，当他兴致勃勃地分享这个灵光一现时，我不合时宜地提出说我想要一个无线开关，能不能用继电器、开关外壳和无线模块，外加画个板子集成它们，李老师以一种给你糖吃别打岔的样子，说这个淘宝上有卖的，app都自带的，你去买一个，抓包hack它就能编程了。于是李老师继续谈论他画板子的布线方案&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;李老师实验室的四轴飞行器，除了飞行器是自己做的，遥控手柄也是自己画的&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;大家感受一下&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/lilaoshi397d1e4f.png" /&gt;&lt;/p&gt;
&lt;p&gt;让我们想到那句感人的话&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;情之所钟，虽丑不嫌&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;感觉哪里不对 ……&lt;/p&gt;
&lt;h3 id="_8"&gt;组装硬件&lt;/h3&gt;
&lt;p&gt;硬件部分的组装很容易，直接上效果图&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/siri4cc6a938.png" /&gt;&lt;/p&gt;
&lt;p&gt;接下来让我们用双面胶把舵机贴到开关边上，舵机转动即可关灯&lt;/p&gt;
&lt;h1 id="_9"&gt;软件部分&lt;/h1&gt;
&lt;p&gt;按照一般的套路，此处应该从舵机的驱动程序写起，加上通讯模块，接着写一些胶水程序黏合它们，组成实现完整的功能&lt;/p&gt;
&lt;p&gt;软件部分如开篇所说，这次我想试试不通过编程的方式来完成这个工作. 仅仅通过拖拽功能模块，我们就能拼出功能的机器人,这样可以让更多的人参与进来(当然包括哪些在玩王者荣耀的小学生)&lt;/p&gt;
&lt;p&gt;我已经完成了积木式的控制平台,硬件驱动全部封装为积木块(让每个人实现一次硬件驱动未免无聊)，拖曳即可，支持几乎完备的编程要素，可以实现丰富的功能&lt;/p&gt;
&lt;p&gt;我们来拖曳模块完成任务，Siri的请求本身被我封装为模块&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/siri.gif" /&gt;&lt;/p&gt;
&lt;p&gt;完成后，程序为: &lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/siri15bab0b4.png" /&gt;&lt;/p&gt;
&lt;p&gt;至于对原理有兴趣的geek小伙伴，在之后的文章里，我们再来讲解细节实现,实际hack了Siri&lt;/p&gt;
&lt;h1 id="_10"&gt;效果演示&lt;/h1&gt;
&lt;p&gt;点击"运行程序"，程序就会在树莓派中运行（开机自启）,我们做个演示&lt;/p&gt;
&lt;video src="http://ocfy0072v.bkt.clouddn.com/siri-%E5%85%B3%E7%81%AF-1.mp4" controls="controls"&gt;&lt;/video&gt;

&lt;h1 id="_11"&gt;自然语言&lt;/h1&gt;
&lt;p&gt;因为Siri本身具有处理自然语言的能力，我们可以用许多说法来关灯&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="http://wwj-fig-bed.just4fun.site/siri05dcb491.png" /&gt;&lt;/p&gt;
&lt;h1 id="todo"&gt;todo&lt;/h1&gt;
&lt;p&gt;当前的自然语言处理(NLU)用得到了Siri，下一个版本想试试&lt;a href="http://www.yige.ai/"&gt;yige.ai&lt;/a&gt;,然后把它植入到微信中，这样可以跨平台使用它&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">wuwenjie</dc:creator><pubDate>Sat, 24 Dec 2016 00:00:00 +0000</pubDate><guid isPermaLink="false">tag:,2016-12-24:rpi-siri-close-light.html</guid><category>rpi</category></item></channel></rss>